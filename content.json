{"meta":{"title":"XiaoHanys","subtitle":"Dont't forget to be awesome!","description":"ç”Ÿç‰©ä¿¡æ¯çŸ¥è¯†åº“, ç¼–ç¨‹, å‰ç«¯, ç½‘ç«™æ­å»º, äººå·¥æ™ºèƒ½, AI","author":"XiaoGuang","url":"https://xiaohanys.top","root":"/"},"pages":[{"title":"","date":"2024-10-19T07:56:31.863Z","updated":"2024-10-19T07:56:31.863Z","comments":false,"path":"about/index.html","permalink":"https://xiaohanys.top/about/index.html","excerpt":"","text":"ä¸€ä¸ªå­¤ç‹¬çš„äººã€‚ å“¥æœ¬å“ˆæ ¹ç”Ÿç‰©å­¦åšå£«ï¼Œç”Ÿç‰©ä¿¡æ¯ç ”ç©¶å‘˜ã€‚ 1991 å‡ºç”Ÿ 2010 -&gt; 2018 äºå±±ä¸œçœå†…çš„â€œ985å·¥ç¨‹â€ï¼Œâ€œ211å·¥ç¨‹â€çš„å±±ä¸œå¤§å­¦æ”»è¯»æœ¬ç§‘åŠç¡•å£«å­¦ä½ 2018 ç”Ÿç‰©ä¿¡æ¯ç ”ç©¶å‘˜ï¼Œç»§ç»­åœ¨ç”Ÿç‰©ä¸“ä¸šé¢†åŸŸæ·±è€•ç§‘ç ”ã€‚æ–¹å‘ä¸ºåŸºå› ç»„ç¼–è¾‘ç”Ÿç‰©ä¿¡æ¯å­¦åˆ†æï¼ŒæŸ“è‰²ä½“å¤–ç¯çŠ¶DNA(eccDNA) åœ¨ç™Œç—‡ç­‰å¤šç§ç–¾ç—…ä¸­çš„æ½œåœ¨ä½œç”¨åŠæ ‡è®°åŸºå› å‘ç°ã€‚ 2022 å“¥æœ¬å“ˆæ ¹å¤§å­¦åšå£«ï¼Œæ–¹å‘ä¸ºåŸºå› ç»„ç¼–è¾‘ã€‚"},{"title":"","date":"2024-09-20T04:22:15.938Z","updated":"2024-09-20T04:22:15.938Z","comments":true,"path":"404.html","permalink":"https://xiaohanys.top/404.html","excerpt":"","text":"404 å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"","date":"2024-10-23T07:54:22.591Z","updated":"2024-10-23T07:54:22.591Z","comments":false,"path":"gallery/index.html","permalink":"https://xiaohanys.top/gallery/index.html","excerpt":"","text":"AI ç»˜ç”»ä½œå“å±•è§ˆï¼š"},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2024-09-20T04:20:37.706Z","updated":"2024-09-20T04:20:37.706Z","comments":true,"path":"categories/index.html","permalink":"https://xiaohanys.top/categories/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2024-09-20T04:20:56.912Z","updated":"2024-09-20T04:20:56.912Z","comments":true,"path":"tags/index.html","permalink":"https://xiaohanys.top/tags/index.html","excerpt":"","text":""},{"title":"","date":"2024-09-20T04:21:15.257Z","updated":"2024-09-20T04:21:15.257Z","comments":true,"path":"mylist/index.html","permalink":"https://xiaohanys.top/mylist/index.html","excerpt":"","text":""}],"posts":[{"title":"å¦‚ä½•ä½¿ç”¨ Python è°ƒç”¨ CloudFlare WorkerAI æä¾›çš„ Flux æ¨¡å‹","slug":"å¦‚ä½•ä½¿ç”¨Pythonè°ƒç”¨CloudFlareWorkerAIæä¾›çš„Fluxæ¨¡å‹","date":"2024-10-24T09:16:39.000Z","updated":"2024-10-24T09:22:28.842Z","comments":true,"path":"py-cf-flux/","permalink":"https://xiaohanys.top/py-cf-flux/","excerpt":"å‰é¢çš„æ–‡ç« æ‰“ç ´ä¿¡æ¯å·®æœ‰æåˆ°è¿‡ï¼ŒCloudFlare æä¾›äº†ä¸€äº›å…è´¹çš„å¼€æºæ¨¡å‹çš„ APIï¼Œè€Œ Flux çš„ç”Ÿå›¾æ¨¡å‹å°±åœ¨å…¶ä¸­ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ¨¡å‹çš„ API æœ€ç»ˆè¿”å›ç»™æˆ‘ä»¬çš„æ˜¯ Base64 æ•°æ®ï¼Œè€Œä¸æ˜¯å¯ç›´è§‚æŸ¥çœ‹çš„å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡æ•°æ®å†™å…¥æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œç„¶åé€šè¿‡ URL è®¿é—®å®ƒã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ”¯æŒå†™ä¸­æ–‡çš„æç¤ºè¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å…¶ä¸­å¢åŠ ä¸€ä¸ªå¤§æ¨¡å‹çš„ç¿»è¯‘å±‚ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä¸­æ–‡çš„æç¤ºè¯ç¿»è¯‘æˆè‹±æ–‡ï¼Œä»è€Œè¢« Flux è¯†åˆ«ã€‚ä»Šå¤©ï¼Œæˆ‘å°±é€šè¿‡ Python ä»£ç çš„æ–¹å¼æ¥å®ç°ä¸Šè¿°çš„åŠŸèƒ½ã€‚ ğŸš€","text":"å‰é¢çš„æ–‡ç« æ‰“ç ´ä¿¡æ¯å·®æœ‰æåˆ°è¿‡ï¼ŒCloudFlare æä¾›äº†ä¸€äº›å…è´¹çš„å¼€æºæ¨¡å‹çš„ APIï¼Œè€Œ Flux çš„ç”Ÿå›¾æ¨¡å‹å°±åœ¨å…¶ä¸­ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ¨¡å‹çš„ API æœ€ç»ˆè¿”å›ç»™æˆ‘ä»¬çš„æ˜¯ Base64 æ•°æ®ï¼Œè€Œä¸æ˜¯å¯ç›´è§‚æŸ¥çœ‹çš„å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡æ•°æ®å†™å…¥æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œç„¶åé€šè¿‡ URL è®¿é—®å®ƒã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ”¯æŒå†™ä¸­æ–‡çš„æç¤ºè¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å…¶ä¸­å¢åŠ ä¸€ä¸ªå¤§æ¨¡å‹çš„ç¿»è¯‘å±‚ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä¸­æ–‡çš„æç¤ºè¯ç¿»è¯‘æˆè‹±æ–‡ï¼Œä»è€Œè¢« Flux è¯†åˆ«ã€‚ä»Šå¤©ï¼Œæˆ‘å°±é€šè¿‡ Python ä»£ç çš„æ–¹å¼æ¥å®ç°ä¸Šè¿°çš„åŠŸèƒ½ã€‚ ğŸš€ å‡†å¤‡å·¥ä½œé¦–å…ˆï¼Œæˆ‘ä»¬å½“ç„¶éœ€è¦ä¸€ä¸ª CloudFlare çš„è´¦å·äº†ï¼Œæ³¨å†Œè´¦å·çš„æ•™ç¨‹ç½‘ç»œä¸Šæ¯”æ¯”çš†æ˜¯ï¼Œæˆ‘å°±ä¸å†æ­¤å¤„èµ˜è¿°äº†ã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å¼€é€š CloudFlare çš„ R2 å¯¹è±¡å­˜å‚¨ï¼Œè¿™ä¸ªå¯¹è±¡å­˜å‚¨æ˜¯å…è´¹ 10G çš„ï¼Œè¶³å¤Ÿæˆ‘ä»¬æŒ¥éœäº†ã€‚å¼€é€šæ–¹æ³•å¯ä»¥å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« ï¼š ä½¿ç”¨ Cloudflare R2 å…è´¹æ­å»ºè‡ªç”¨å›¾åºŠ ä½¿ç”¨ Cloudflare R2 æ­å»ºä¸ªäººå›¾åºŠ ç„¶åæˆ‘ä»¬éœ€è¦è®°å½•æˆ‘ä»¬ç”Ÿæˆçš„ API_secret å’Œ API_tokenï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚ æˆ‘ä»¬è¿˜éœ€è¦è·å–æˆ‘ä»¬ CloudFlare çš„ account_id å’Œ worker çš„ API_tokenã€‚ è·å–è¿™äº›å€¼çš„æ­¥éª¤ï¼š ç™»å½•åˆ° Cloudflare æ§åˆ¶é¢æ¿å¹¶é€‰æ‹©æ‚¨çš„è´¦æˆ·ã€‚ è½¬åˆ° AI &gt; Workers AIã€‚ é€‰æ‹©ä½¿ç”¨ Workers AI APIã€‚ è·å–æ‚¨çš„ API ä»¤ç‰Œï¼š é€‰æ‹©è·å– API ä»¤ç‰Œã€‚ å®¡æŸ¥é¢„å¡«ä¿¡æ¯ã€‚ é€‰æ‹©ç»§ç»­åˆ°æ‘˜è¦ã€‚ é€‰æ‹©åˆ›å»ºä»¤ç‰Œã€‚ å¤åˆ¶ä»¤ç‰Œå€¼ä»¥å¤‡åç”¨ã€‚ è·å–æ‚¨çš„è´¦æˆ· IDï¼š å›åˆ°ä½¿ç”¨ Workers AI API çš„å±å¹•ï¼ˆæ‚¨æœ€åˆçš„æ ‡ç­¾é¡µï¼‰ã€‚ åœ¨è·å–è´¦æˆ· ID ä¸‹ï¼Œå¤åˆ¶è´¦æˆ· ID çš„å€¼ã€‚ å¦‚æœæ‚¨é€‰æ‹©åˆ›å»ºä¸€ä¸ª API ä»¤ç‰Œè€Œä¸ä½¿ç”¨æ¨¡æ¿ï¼Œè¯¥ä»¤ç‰Œå°†éœ€è¦ Workers AI - è¯»å– å’Œ Workers AI - ç¼–è¾‘ çš„æƒé™ã€‚ ä»£ç å®ç°å®‰è£…å¿…è¦çš„åŒ…pip install openai r2client httpx å¯¼å…¥ç›¸åº”çš„æ¨¡å—import httpximport base64from r2client.R2Client import R2Client as r2import tempfileimport datetimeimport osfrom openai import OpenAI å†™ä¸€ä¸ª Python ç±»å®ç°æ•°æ®å…±äº«class WorkerImage(): def __init__(self, account_id, api_token, r2_access_key, r2_secret_key, r2_bucket_name, r2_public_link): &quot;&quot;&quot; Parameters: account_id (str): cloudflare account id api_token (str): cloudflare api token r2_access_key (str): r2 access key r2_secret_key (str): r2 secret key r2_bucket_name (str): the name of the r2 bucket r2_public_link (str): the link to access the r2 bucket &quot;&quot;&quot; self.account_id = account_id self.api_token = api_token self.endpoint = ( f&quot;https://api.cloudflare.com/client/v4/accounts/&#123;account_id&#125;/ai/run/@cf/black-forest-labs/flux-1-schnell&quot; ) self.headers = &#123; &quot;Authorization&quot;: f&quot;Bearer &#123;api_token&#125;&quot;, &quot;Content-Type&quot;: &quot;application/json&quot;, &#125; self.r2_client = r2( access_key=r2_access_key, secret_key=r2_secret_key, endpoint=f&quot;https://&#123;account_id&#125;.r2.cloudflarestorage.com&quot;, ) self.bucket_name = r2_bucket_name self.link = r2_public_link def _get_flux_image_data(self, prompt, num_steps): payload = &#123; &quot;prompt&quot;: prompt, &quot;num_steps&quot;: num_steps &#125; response = httpx.post( self.endpoint, headers=self.headers, json=payload) if response.status_code == 400: # raise error return None else: image_data = base64.b64decode(response.json()[&#x27;result&#x27;][&#x27;image&#x27;]) return image_data def _save_image_to_tmp_file(self, image_data): with tempfile.NamedTemporaryFile(suffix=&#x27;.png&#x27;, delete=False) as f: f.write(image_data) temp_file_path = f.name return temp_file_path def get_translate_promt(self, prompt): flux_system_prompt = &quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªåŸºäºFlux.1æ¨¡å‹çš„æç¤ºè¯ç”Ÿæˆæœºå™¨äººã€‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œè‡ªåŠ¨ç”Ÿæˆç¬¦åˆFlux.1æ ¼å¼çš„ç»˜ç”»æç¤ºè¯ã€‚è™½ç„¶ä½ å¯ä»¥å‚è€ƒæä¾›çš„æ¨¡æ¿æ¥å­¦ä¹ æç¤ºè¯ç»“æ„å’Œè§„å¾‹ï¼Œä½†ä½ å¿…é¡»å…·å¤‡çµæ´»æ€§æ¥åº”å¯¹å„ç§ä¸åŒéœ€æ±‚ã€‚æœ€ç»ˆè¾“å‡ºåº”ä»…é™æç¤ºè¯ï¼Œæ— éœ€ä»»ä½•å…¶ä»–è§£é‡Šæˆ–ä¿¡æ¯ã€‚ä½ çš„å›ç­”å¿…é¡»å…¨éƒ¨ä½¿ç”¨è‹±è¯­è¿›è¡Œå›å¤æˆ‘ï¼### **æç¤ºè¯ç”Ÿæˆé€»è¾‘**ï¼š1. **éœ€æ±‚è§£æ**ï¼šä»ç”¨æˆ·çš„æè¿°ä¸­æå–å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š - è§’è‰²ï¼šå¤–è²Œã€åŠ¨ä½œã€è¡¨æƒ…ç­‰ã€‚ - åœºæ™¯ï¼šç¯å¢ƒã€å…‰çº¿ã€å¤©æ°”ç­‰ã€‚ - é£æ ¼ï¼šè‰ºæœ¯é£æ ¼ã€æƒ…æ„Ÿæ°›å›´ã€é…è‰²ç­‰ã€‚ - å…¶ä»–å…ƒç´ ï¼šç‰¹å®šç‰©å“ã€èƒŒæ™¯æˆ–ç‰¹æ•ˆã€‚2. **æç¤ºè¯ç»“æ„è§„å¾‹**ï¼š - **ç®€æ´ã€ç²¾ç¡®ä¸”å…·è±¡**ï¼šæç¤ºè¯éœ€è¦ç®€å•ã€æ¸…æ™°åœ°æè¿°æ ¸å¿ƒå¯¹è±¡ï¼Œå¹¶åŒ…å«è¶³å¤Ÿç»†èŠ‚ä»¥å¼•å¯¼ç”Ÿæˆå‡ºç¬¦åˆéœ€æ±‚çš„å›¾åƒã€‚ - **çµæ´»å¤šæ ·**ï¼šå‚è€ƒä¸‹åˆ—æ¨¡æ¿å’Œå·²æœ‰ç¤ºä¾‹ï¼Œä½†éœ€æ ¹æ®å…·ä½“éœ€æ±‚ç”Ÿæˆå¤šæ ·åŒ–çš„æç¤ºè¯ï¼Œé¿å…å›ºå®šåŒ–æˆ–è¿‡äºä¾èµ–æ¨¡æ¿ã€‚ - **ç¬¦åˆFlux.1é£æ ¼çš„æè¿°**ï¼šæç¤ºè¯å¿…é¡»éµå¾ªFlux.1çš„è¦æ±‚ï¼Œå°½é‡åŒ…å«è‰ºæœ¯é£æ ¼ã€è§†è§‰æ•ˆæœã€æƒ…æ„Ÿæ°›å›´çš„æè¿°ï¼Œä½¿ç”¨ä¸Flux.1æ¨¡å‹ç”Ÿæˆç›¸ç¬¦çš„å…³é”®è¯å’Œæè¿°æ¨¡å¼ã€‚3. **ä»…ä¾›ä½ å‚è€ƒå’Œå­¦ä¹ çš„å‡ ç§åœºæ™¯æç¤ºè¯**ï¼ˆä½ éœ€è¦å­¦ä¹ å¹¶çµæ´»è°ƒæ•´,&quot;[ ]&quot;ä¸­å†…å®¹è§†ç”¨æˆ·é—®é¢˜è€Œå®šï¼‰ï¼š - **è§’è‰²è¡¨æƒ…é›†**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆåŠ¨ç”»æˆ–æ¼«ç”»åˆ›ä½œè€…ä¸ºè§’è‰²è®¾è®¡å¤šæ ·çš„è¡¨æƒ…ã€‚è¿™äº›æç¤ºè¯å¯ä»¥ç”Ÿæˆå±•ç¤ºåŒä¸€è§’è‰²åœ¨ä¸åŒæƒ…ç»ªä¸‹çš„è¡¨æƒ…é›†ï¼Œæ¶µç›–å¿«ä¹ã€æ‚²ä¼¤ã€æ„¤æ€’ç­‰å¤šç§æƒ…æ„Ÿã€‚æç¤ºè¯ï¼šAn anime [SUBJECT], animated expression reference sheet, character design, reference sheet, turnaround, lofi style, soft colors, gentle natural linework, key art, range of emotions, happy sad mad scared nervous embarrassed confused neutral, hand drawn, award winning anime, fully clothed[SUBJECT] character, animation expression reference sheet with several good animation expressions featuring the same character in each one, showing different faces from the same person in a grid pattern: happy sad mad scared nervous embarrassed confused neutral, super minimalist cartoon style flat muted kawaii pastel color palette, soft dreamy backgrounds, cute round character designs, minimalist facial features, retro-futuristic elements, kawaii style, space themes, gentle line work, slightly muted tones, simple geometric shapes, subtle gradients, oversized clothing on characters, whimsical, soft puffy art, pastels, watercolor - **å…¨è§’åº¦è§’è‰²è§†å›¾**ï¼šåœºæ™¯è¯´æ˜ï¼šå½“éœ€è¦ä»ç°æœ‰è§’è‰²è®¾è®¡ä¸­ç”Ÿæˆä¸åŒè§’åº¦çš„å…¨èº«å›¾æ—¶ï¼Œå¦‚æ­£é¢ã€ä¾§é¢å’ŒèƒŒé¢ï¼Œé€‚ç”¨äºè§’è‰²è®¾è®¡ç»†åŒ–æˆ–åŠ¨ç”»å»ºæ¨¡ã€‚æç¤ºè¯ï¼šA character sheet of [SUBJECT] in different poses and angles, including front view, side view, and back view - **80 å¹´ä»£å¤å¤é£æ ¼**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆå¸Œæœ›åˆ›é€  80 å¹´ä»£å¤å¤é£æ ¼ç…§ç‰‡æ•ˆæœçš„è‰ºæœ¯å®¶æˆ–è®¾è®¡å¸ˆã€‚è¿™äº›æç¤ºè¯å¯ä»¥ç”Ÿæˆå¸¦æœ‰æ€€æ—§æ„Ÿçš„æ¨¡ç³Šå®ä¸½æ¥é£æ ¼ç…§ç‰‡ã€‚æç¤ºè¯ï¼šblurry polaroid of [a simple description of the scene], 1980s. - **æ™ºèƒ½æ‰‹æœºå†…éƒ¨å±•ç¤º**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆéœ€è¦å±•ç¤ºæ™ºèƒ½æ‰‹æœºç­‰äº§å“è®¾è®¡çš„ç§‘æŠ€åšå®¢ä½œè€…æˆ–äº§å“è®¾è®¡å¸ˆã€‚è¿™äº›æç¤ºè¯å¸®åŠ©ç”Ÿæˆå±•ç¤ºæ‰‹æœºå¤–è§‚å’Œå±å¹•å†…å®¹çš„å›¾åƒã€‚æç¤ºè¯ï¼ša iphone product image showing the iphone standing and inside the screen the image is shown - **åŒé‡æ›å…‰æ•ˆæœ**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆæ‘„å½±å¸ˆæˆ–è§†è§‰è‰ºæœ¯å®¶é€šè¿‡åŒé‡æ›å…‰æŠ€æœ¯åˆ›é€ æ·±åº¦å’Œæƒ…æ„Ÿè¡¨è¾¾çš„è‰ºæœ¯ä½œå“ã€‚æç¤ºè¯ï¼š[Abstract style waterfalls, wildlife] inside the silhouette of a [man]â€™s head that is a double exposure photograph . Non-representational, colors and shapes, expression of feelings, imaginative, highly detailed - **é«˜è´¨æ„Ÿç”µå½±æµ·æŠ¥**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆéœ€è¦ä¸ºç”µå½±åˆ›å»ºå¼•äººæ³¨ç›®æµ·æŠ¥çš„ç”µå½±å®£ä¼ æˆ–å¹³é¢è®¾è®¡å¸ˆã€‚æç¤ºè¯ï¼šA digital illustration of a movie poster titled [â€˜Sad Sax: Fury Toadâ€™], [Mad Max] parody poster, featuring [a saxophone-playing toad in a post-apocalyptic desert, with a customized car made of musical instruments], in the background, [a wasteland with other musical vehicle chases], movie title in [a gritty, bold font, dusty and intense color palette]. - **é•œé¢è‡ªæ‹æ•ˆæœ**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆæƒ³è¦æ•æ‰æ—¥å¸¸ç”Ÿæ´»ç¬é—´çš„æ‘„å½±å¸ˆæˆ–ç¤¾äº¤åª’ä½“ç”¨æˆ·ã€‚æç¤ºè¯ï¼šPhone photo: A woman stands in front of a mirror, capturing a selfie. The image quality is grainy, with a slight blur softening the details. The lighting is dim, casting shadows that obscure her features. [The room is cluttered, with clothes strewn across the bed and an unmade blanket. Her expression is casual, full of concentration], while the old iPhone struggles to focus, giving the photo an authentic, unpolished feel. The mirror shows smudges and fingerprints, adding to the raw, everyday atmosphere of the scene. - **åƒç´ è‰ºæœ¯åˆ›ä½œ**ï¼šåœºæ™¯è¯´æ˜ï¼šé€‚åˆåƒç´ è‰ºæœ¯çˆ±å¥½è€…æˆ–å¤å¤æ¸¸æˆå¼€å‘è€…åˆ›é€ æˆ–å¤åˆ»ç»å…¸åƒç´ é£æ ¼å›¾åƒã€‚æç¤ºè¯ï¼š[Anything you want] pixel art style, pixels, pixel art - **ä»¥ä¸Šéƒ¨åˆ†åœºæ™¯ä»…ä¾›ä½ å­¦ä¹ ï¼Œä¸€å®šè¦å­¦ä¼šçµæ´»å˜é€šï¼Œä»¥é€‚åº”ä»»ä½•ç»˜ç”»éœ€æ±‚**ï¼š4. **Flux.1æç¤ºè¯è¦ç‚¹æ€»ç»“**ï¼š - **ç®€æ´ç²¾å‡†çš„ä¸»ä½“æè¿°**ï¼šæ˜ç¡®å›¾åƒä¸­æ ¸å¿ƒå¯¹è±¡çš„èº«ä»½æˆ–åœºæ™¯ã€‚ - **é£æ ¼å’Œæƒ…æ„Ÿæ°›å›´çš„å…·ä½“æè¿°**ï¼šç¡®ä¿æç¤ºè¯åŒ…å«è‰ºæœ¯é£æ ¼ã€å…‰çº¿ã€é…è‰²ã€ä»¥åŠå›¾åƒçš„æ°›å›´ç­‰ä¿¡æ¯ã€‚ - **åŠ¨æ€ä¸ç»†èŠ‚çš„è¡¥å……**ï¼šæç¤ºè¯å¯åŒ…æ‹¬åœºæ™¯ä¸­çš„åŠ¨ä½œã€æƒ…ç»ªã€æˆ–å…‰å½±æ•ˆæœç­‰é‡è¦ç»†èŠ‚ã€‚ - **å…¶ä»–æ›´å¤šè§„å¾‹è¯·è‡ªå·±å¯»æ‰¾**---**é—®ç­”æ¡ˆä¾‹1**ï¼š**ç”¨æˆ·è¾“å…¥**ï¼šä¸€ä¸ª80å¹´ä»£å¤å¤é£æ ¼çš„ç…§ç‰‡ã€‚**ä½ çš„è¾“å‡º**ï¼šA blurry polaroid of a 1980s living room, with vintage furniture, soft pastel tones, and a nostalgic, grainy texture, The sunlight filters through old curtains, casting long, warm shadows on the wooden floor, 1980s,**é—®ç­”æ¡ˆä¾‹2**ï¼š**ç”¨æˆ·è¾“å…¥**ï¼šä¸€ä¸ªèµ›åšæœ‹å…‹é£æ ¼çš„å¤œæ™šåŸå¸‚èƒŒæ™¯**ä½ çš„è¾“å‡º**ï¼šA futuristic cityscape at night, in a cyberpunk style, with neon lights reflecting off wet streets, towering skyscrapers, and a glowing, high-tech atmosphere. Dark shadows contrast with vibrant neon signs, creating a dramatic, dystopian mood&quot;&quot;&quot; client = OpenAI( # This is the default and can be omitted api_key=self.api_token, base_url=f&quot;https://api.cloudflare.com/client/v4/accounts/&#123;self.account_id&#125;/ai/v1&quot;, max_retries=5, ) chat_completion = client.chat.completions.create( messages=[ &#123; &quot;role&quot;: &quot;system&quot;, &quot;content&quot;: flux_system_prompt, &#125;, &#123; &quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt, &#125; ], model=&quot;@cf/meta/llama-3.1-70b-instruct&quot;, ) return chat_completion.choices[0].message.content def get_image(self, prompt, num_steps): image_data = self._get_flux_image_data(prompt, num_steps) if image_data: local_file = self._save_image_to_tmp_file(image_data) # delete local file # get date time as newfile name newfilename = f&quot;&#123;datetime.datetime.now().strftime(&#x27;%Y-%m-%d-%H-%M-%S&#x27;)&#125;.png&quot; self.r2_client.upload_file( self.bucket_name, local_file, newfilename) os.remove(local_file) return f&quot;&#123;self.link&#125;/&#123;newfilename&#125;&quot; else: print(&quot;image data is None,please check your inputs&quot;) return None ä½¿ç”¨æ–¹æ³•é¦–å…ˆåˆå§‹åŒ–ç±»ï¼š work = WorkerImage(account_id, api_token, r2_access_key, r2_secret_key, r2_bucket_name, r2_public_link) æ³¨æ„ï¼Œæˆ‘ä»¬è¦æŠŠå‡†å¤‡å·¥ä½œé‡Œè·å–çš„è¿™äº›å€¼å¡«å…¥ WorkerImage ç±»ä¸­æ¥åˆå§‹åŒ–å®ƒã€‚ account_idï¼šCloudFlare è´¦æˆ· ID api_tokenï¼šCloudFlare Worker çš„ API token r2_access_keyï¼šCloudFlare R2 çš„ S3 access id r2_secret_keyï¼šCloudFlare R2 çš„ S3 access key r2_bucket_nameï¼šCloudFlare R2 çš„ S3 å­˜å‚¨æ¡¶åï¼ˆä½ è‡ªå·±æ‰‹åŠ¨åˆ›å»ºçš„ï¼‰ r2_public_linkï¼šCloudFlare R2 çš„è®¿é—®é“¾æ¥ï¼Œå¦‚æœä½ è®¾ç½®äº†è‡ªå®šä¹‰åŸŸå¯ä»¥é€‰æ‹©ä½ è‡ªå·±çš„æˆ–è€…å®ƒæä¾›çš„ dev ç»“å°¾çš„åŸŸå ç„¶åï¼Œæˆ‘ä»¬é¦–å…ˆè·å–ç¿»è¯‘åçš„æç¤ºè¯ï¼Œè°ƒç”¨ï¼š newprompt = worker.get_translate_promt(prompt=&quot;ä¸€ä¸ª80å¹´ä»£å¤å¤é£æ ¼çš„ç…§ç‰‡,ä¸€ä¸ªç”·å­©æ‰‹é‡Œæ‹¿ç€ä¸€ç½å¯ä¹ç«™åœ¨é•¿åŸä¸Šçœ‹å‘é•œå¤´.&quot;)print(newprompt)##a blurry polaroid photograph of a young boy standing on the Great Wall of China, holding a can of soda, with a curious, blissful expression on his face, wearing a red hat, and a backpack, set against the rugged, ancient stones, and the misty, mountains in the background, soft pastel tones, warm, nostalgic lighting, with a subtle, retro film grain, taken in the 1980s. ä¸‹ä¸€æ­¥åˆ™æŠŠè¿™ä¸ªæç¤ºè¯è¾“å…¥åˆ°ç”»å›¾ç¨‹åºä¸­å³å¯ï¼š url = worker.get_image(prompt=newprompt, num_steps=8)print(url) æ€»ç»“æˆ‘ä»¬è¿™ä¸ªç±»å…¶å®å°±æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„ç®¡é“ï¼Œé¦–å…ˆè°ƒç”¨ WorkerAI çš„æ–‡æœ¬ç”Ÿæˆå¤§æ¨¡å‹ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„ä¸­æ–‡æç¤ºè¯ç¿»è¯‘ä¸ºè‹±æ–‡ï¼Œå¹¶ç¾åŒ–å¢åŠ ç»†èŠ‚ã€‚ç„¶åæˆ‘ä»¬å°†ç”Ÿæˆçš„æç¤ºè¯ç»™ Flux å¤§æ¨¡å‹æ¥ç”»å›¾å³å¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ç”Ÿæˆå¹¶ä¸Šä¼ å›¾ç‰‡ï¼ŒåŒæ—¶æ”¯æŒä¸­æ–‡æç¤ºè¯ã€‚ ğŸ¨âœ¨ Bonus timeæˆ‘å°†ä¸Šè¿°ä»£ç éƒ¨ç½²åˆ°äº†æˆ‘è‡ªå·±çš„ç½‘ç«™ï¼Œç°åœ¨ä½ å¯ä»¥é€šè¿‡æˆ‘çš„ç½‘ç«™æ¥ä½“éªŒè¯¥è¿‡ç¨‹ï¼š reflex-chathttps://sequencetool.reflex.run/freeimage/ å®Œæ•´çš„ä»£ç ä¹Ÿå¯ä»¥é€šè¿‡è°·æ­Œçš„colabè®¿é—®ï¼š How to run Flux text2image model from CloudFlare WorkerAI.ipynbhttps://colab.research.google.com/drive/1CPjBq2soIryLEWzxW-6rutgyw_iZA6UI?usp=sharing","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://xiaohanys.top/tags/AI/"},{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"},{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"}],"author":"Xiaoguang Pan"},{"title":"æ‰“ç ´ä¿¡æ¯å·®ï¼š2024å¥½ç”¨çš„AIå·¥å…·åˆ†äº«","slug":"AIå·¥å…·åˆ†äº«","date":"2024-10-19T08:39:04.000Z","updated":"2024-10-22T05:59:45.751Z","comments":true,"path":"AI-share1/","permalink":"https://xiaohanys.top/AI-share1/","excerpt":"2024 å¹´ï¼Œé å¥—å£³ AI æŒ£é’±çš„å›¢é˜Ÿå·²ç»ä»å†™æ–‡æ‹“å±•åˆ°äº†å–è¯¾ï¼Œä»èµšä¿¡æ¯å·®æ‹“å±•åˆ°äº†è´©å–ç„¦è™‘ï¼ŒèƒŒåé  API è½¬å‘è·åˆ©çš„è€æ¿ä»¬è®¸å¤šä¹Ÿå·²ç»èµšå¾—ç›†æ»¡é’µæ»¡ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šæœ‹å‹éƒ½æ²¡å¬è¿‡ä»€ä¹ˆæ˜¯ APIï¼Œä¹Ÿå¯¹è¿™ç§æ— èŠçš„è®¡ç®—æœºæœ¯è¯­ä¸æ„Ÿå…´è¶£ï¼Œä½†è¿™å°±æ˜¯ä¸€ç§ä¿¡æ¯å·®ã€‚","text":"2024 å¹´ï¼Œé å¥—å£³ AI æŒ£é’±çš„å›¢é˜Ÿå·²ç»ä»å†™æ–‡æ‹“å±•åˆ°äº†å–è¯¾ï¼Œä»èµšä¿¡æ¯å·®æ‹“å±•åˆ°äº†è´©å–ç„¦è™‘ï¼ŒèƒŒåé  API è½¬å‘è·åˆ©çš„è€æ¿ä»¬è®¸å¤šä¹Ÿå·²ç»èµšå¾—ç›†æ»¡é’µæ»¡ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šæœ‹å‹éƒ½æ²¡å¬è¿‡ä»€ä¹ˆæ˜¯ APIï¼Œä¹Ÿå¯¹è¿™ç§æ— èŠçš„è®¡ç®—æœºæœ¯è¯­ä¸æ„Ÿå…´è¶£ï¼Œä½†è¿™å°±æ˜¯ä¸€ç§ä¿¡æ¯å·®ã€‚ è¿™ä¸€æ³¢ç”Ÿæˆå¼ AI çš„æµªæ½®ï¼Œå¯ä»¥ç§°å¾—ä¸Šç›¸å½“ç ´åœˆï¼Œå°±è¿æˆ‘èº«è¾¹è®¸å¤šè·Ÿè®¡ç®—æœºå…«ç«¿å­æ‰“ä¸ç€çš„æœ‹å‹ï¼Œéƒ½å–œæ¬¢ç”¨ AI å¸®å¿™å†™ä¸€äº›å…¬å¼åŒ–çš„ææ–™å’Œä½œä¸šã€‚ å‡ ä¹æ˜¯ä¸ªå­¦ç”Ÿéƒ½çŸ¥é“ï¼Œé‚£ä¸ªå«åšã€ŒG ä»€ä¹ˆ Tã€çš„ç½‘ç«™ï¼Œå¯ä»¥åƒäººä¸€æ ·è¯´è¯ï¼Œå¯ä»¥æ— æ‰€ä¸èƒ½ï¼Œå¯ä»¥æ´‹æ´‹æ´’æ´’å†™ä¸€å¤§ç¯‡æ¼‚äº®çš„æ–‡å­—ï¼›ä½†ä¸æ˜¯æ‰€æœ‰äººéƒ½çŸ¥é“ï¼Œä½ ç”¨çš„è¿™ä¸ªåˆ°åº•æ˜¯ã€ŒGPT-4o-miniã€ï¼Œè¿˜æ˜¯ã€ŒGLM-4-airã€ ï¼›ä¹Ÿä¸æ˜¯æ‰€æœ‰äººéƒ½çŸ¥é“ï¼Œå¤§æ¨¡å‹åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šä¹±ç¼–ï¼›ä¸€å¤§æ®µåˆ†å¥½ç‚¹è¿˜å¸¦åŠ ç²—çš„ Markdown æ–‡å­—ï¼Œæœ‰ç»éªŒçš„äººä¸€çœ¼å°±èƒ½çœ‹å‡ºæ˜¯ ChatGPT çš„æ‰‹ç¬”ã€‚ ä¹Ÿè®¸æœ‰çš„å­¦ç”Ÿï¼Œæœ‰èƒ½åŠ›ç”¨ä¸Š chatgpt.comï¼Œä½† 20 ç¾å…ƒä¸€ä¸ªæœˆçš„ä¼šå‘˜è´¹è´µå•Šã€‚å¯¹äºå¤§å­¦ç”Ÿæ¥è¯´ï¼Œè¿™å‡ ä¹æ˜¯ä¸€æ˜ŸæœŸçš„åˆé¥­é’±ã€‚å†è¯´ï¼Œå°±ç®—çœŸçš„èŠ±çš„ä¸‹å»æ‰‹ï¼Œè§£å†³å¤–å¡æ”¯ä»˜å’Œæ‰‹æœºå·ï¼Œåˆå¾—æ˜¯é“åï¼›æœ€åå…œå…œè½¬è½¬ä¸€åœˆï¼Œè¿˜æ˜¯è¢«æ·˜å®é—²é±¼ä¸€ä¼—å”®å–æˆå“è§£å†³æ–¹æ¡ˆçš„å•†å®¶èµšå»äº†è¡€æ±—ç”Ÿæ´»è´¹ã€‚ ä¸€ä¼—å¥—å£³ AI ä¹‹æ‰€ä»¥åœ¨ä»Šå¤©è¿˜èƒ½èƒ½æ´»ä¸‹æ¥ï¼Œè€Œä¸”è¿˜èƒ½ä»¥åŠ¨è¾„æ•°ç™¾ä¸Šåƒå…ƒä¸€å¹´çš„ä»·æ ¼ç»§ç»­æ”¶å‰²ï¼Œä¸€ä¸ªæ˜¯é å–è¯¾è´©å–ç„¦è™‘ï¼Œä¸€ä¸ªå°±æ˜¯é å–å¾—ä¸€æ‰‹å¥½ä¿¡æ¯å·®ã€‚é‚£ä¹ˆä»Šå¤©å°±è®©æˆ‘ä»¬æ‰“ç ´è¿™ç§ç„¦è™‘ï¼Œæ¥åˆ†äº«ä¸€äº›å¯ä»¥è®©æˆ‘ä»¬å¯ä»¥ä»¥è¾ƒé«˜çš„æ€§ä»·æ¯”ä½¿ç”¨ä¸Šæœ€å…ˆè¿›çš„AIæ¨¡å‹çš„ç½‘ç«™ã€‚ æ–‡å­—ç”Ÿæˆ(text generation) æ–‡å­—ç”Ÿæˆæ˜¯å¦‚ä»Šç”Ÿæˆå¼AIçš„å¤§å–ç‚¹ä¹‹ä¸€ï¼Œå…¶ä¸­æœ‰åçš„ChatGPTå°±æ˜¯é€šè¿‡æˆ‘ä»¬é—®é—®é¢˜çš„æ–¹å¼ï¼ŒAIå¤§æ¨¡å‹ç”Ÿæˆå›ç­”ã€‚ä¾‹å¦‚è®©å®ƒå¸®æˆ‘ä»¬å†™æ–‡ç« ï¼Œæ¶¦è‰²è¯­æ³•ï¼Œå¸®æˆ‘ä»¬å†™ä¸€äº›ä»£ç ç­‰ç­‰ã€‚é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆä»‹ç»æ–‡ç”Ÿæ–‡ç›¸å…³çš„ã€‚ å…±äº«è´¦å·å¤§æ³•å¤©æ„äº‘ è¿™å®¶æœ¬æ˜¯åšç”Ÿç‰©ä¿¡æ¯äº‘è®¡ç®—å¹³å°çš„ï¼Œä»–ä»¬å®¶æœ‰ç”Ÿç‰©ä¿¡æ¯é«˜æ€§èƒ½æœåŠ¡å™¨å‡ºå”®ã€‚è€Œchatgptæ˜¯é™„åŠ çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ä¹Ÿæ˜¯éå¸¸æœ‰ç‰¹è‰²çš„ä¸šåŠ¡ã€‚å› ä¸ºä»–ä»¬æ˜¯é‡‡ç”¨é•œåƒçš„æ–¹å¼æŠŠChatGPTæ•´ä¸ªç½‘ç«™ç»™ä»£ç†äº†ï¼Œç„¶åæˆ‘ä»¬å°±æ— éœ€è€ƒè™‘å›½å†…çš„è®¿é—®é—®é¢˜ã€‚å¦å¤–ï¼Œä»–ä»¬æä¾›æœ‰ç‹¬äº«å’Œä¸åŒäººæ•°çš„å…±äº«å¥—é¤ï¼Œä»·æ ¼éå¸¸ä¼˜æƒ  ã€‚å¦‚æœä½ ä¸å¸¸ä½¿ç”¨æˆ–è€…åªæ˜¯å°è¯•ï¼Œé‚£ä¹ˆå…±äº«è´¦å·å°†æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚ ç‚¹æˆ‘ç›´è¾¾äº«å—9æŠ˜ä¼˜æƒ https://cloud.dftianyi.com/referral/juf6xhiylmco API è°ƒç”¨æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»å¦ä¸€ç§ä½¿ç”¨GPT4çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯é€šè¿‡APIè®¿é—®ã€‚å…¶å®æ‰€è°“çš„ChatGPTæ˜¯OpenAIå…¬å¸åŸºäºä»–ä»¬è‡ªå·±å®¶çš„GPTæ¨¡å‹æ¥æ­å»ºçš„åº”ç”¨ï¼Œè€Œæˆ‘ä»¬é™¤äº†å¯ä»¥ç›´æ¥ä½¿ç”¨åº”ç”¨å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨APIã€‚å›½å†…å¤§éƒ¨åˆ†çš„æ‰€è°“ChatGPTçš„ç½‘ç«™åŸºæœ¬ä¸Šéƒ½æ˜¯é è¿™ç§APIæ¥é©±åŠ¨çš„ï¼Œæ‰€ä»¥ç”¨ä»–ä»¬çš„ä¸å¦‚ç”¨è‡ªå·±çš„ï¼Œå…å»ä¸­é—´å•†èµšå·®ä»·ï¼ ä½¿ç”¨APIçš„å¥½å¤„æ˜¯ç”¨å¤šå°‘èŠ±å¤šå°‘é’±ï¼Œè€Œä¸æ˜¯æœˆç§Ÿ 20 åˆ€ç”¨ä¸å®Œä¹Ÿè¦èŠ±è¿™äº›é’±ã€‚è€Œç›®å‰æœ‰å¾ˆå¤šå¼€æºçš„å¤§æ¨¡å‹å‰ç«¯åº”ç”¨é¡µé¢ï¼Œè¶³å¤Ÿæˆ‘ä»¬é©±åŠ¨APIæ¥ä»£æ›¿ChatGPTäº†ã€‚æ¯”è¾ƒæœ‰åçš„å¼€æºåº”ç”¨æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ lobe-chat lobe-chathttps://github.com/lobehub/lobe-chat NextChat åŸå ChatGPT-Next-Web NextChathttps://github.com/ChatGPTNextWeb/ChatGPT-Next-Web chatgpt-web-midjourney-proxy chatgpt-web-midjourney-proxyhttps://github.com/Dooy/chatgpt-web-midjourney-proxy OpenAI-HKOpenAI-HK æ˜¯é¦–é€‰ï¼Œè™½ç„¶ä»·æ ¼ç¨å¾®ï¼ˆå’Œå®˜æ–¹ 1 æ¯” 1ï¼‰ï¼Œä½†æ˜¯èƒœåœ¨ç¨³å®šï¼ï¼ï¼ä»–ä¹Ÿæ”¯æŒMidjourneyç”»å›¾APIè°ƒç”¨ï¼ŒFluxç”»å›¾ï¼ŒIdeogramç”»å›¾ç­‰ç­‰ï¼Œå¯ä»¥å»å®˜æ–¹æŸ¥çœ‹ã€‚ 1.å…ˆç‚¹æˆ‘æ³¨å†Œä¸€ä¸ªè´¦å·(ç›®å‰ 100 å…ƒä»¥ä¸Šçš„å……å€¼æ˜¯æœ‰æŠ˜æ‰£çš„ï¼Œ 100 èƒ½ç”¨å¾ˆä¹…å¾ˆä¹…â€¦â€¦)2.ç™»å½•åï¼Œç‚¹å‡»ï¼šã€è·å–keyã€‘å³å¯è·å¾—api-key;3.å¤åˆ¶KEY è¿”å›çš„hk-å¼€å¤´çš„api_keyï¼Œå°†åŸè¯·æ±‚å¤´ä¸­çš„api_key æ›¿æ¢æˆHKä¸“å±çš„ api_key ä¾‹å¦‚ï¼š åŸæ¥: sk-sdiL2SMN4D7GBqFhBsYdT2345kFJhwEHGXbU5RzCM8dS3lrn ç°åœ¨: hk-wsvj0oyeb0srl8b76xgzolc678996mhwlk3p3y7p3qo9wjdl OpenAI çš„ api_key é€šå¸¸ä»¥ sk- ä½œä¸ºå¼€å¤´ï¼Œä½†HKå¹³å°çš„ api_key ä»¥ hk- å¼€å¤´ åé¢æ˜¯ 48 ä½éšæœºå­—ç¬¦ä¸² åŸè¯·æ±‚åœ°å€ api.openai.comçš„åé¢åŠ ä¸Š-hkï¼Œå³ api.openai-hk.com è®¿é—® https://s2024.ddaiai.com/ ç„¶ååœ¨ä¸‹å›¾ç›¸åº”çš„åœ°æ–¹è®¾ç½®OpenAiæ¥å£åœ°å€ï¼šhttps://api.openai-hk.comOpenAi API KEY: hk-ä½ çš„apiKey ä½ ä¼šå‘ç°æˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯chatgpt-web-midjourney-proxyæ¥è°ƒç”¨çš„API,å› ä¸ºå®ƒçš„åŠŸèƒ½æœ€ä¸°å¯Œï¼Œé™¤å»èŠå¤©å¤–ï¼Œè¿˜æ”¯æŒAIç»˜ç”»ç­‰ã€‚å…¶å®å¤§å¤šæ•°çš„APPéƒ½æ˜¯å·®ä¸å¤šçš„è®¾ç½®ï¼Œå”¯ç‹¬éœ€è¦æ³¨æ„çš„æ˜¯lobe-chatçš„è®¾ç½®éœ€è¦åœ¨APIé“¾æ¥åé¢æ·»åŠ \\v1: ç‚¹æˆ‘ç›´è¾¾https://openai-hk.com/?i=13621 å°æµ·Chatå°æµ·æ˜¯å¦å¤–ä¸€ä¸ªæˆ‘å‘ç°çš„å¥½ç”¨çš„APIæä¾›å•†ï¼Œä»–åŸºæœ¬ä¸Šæ˜¯å±äºæºå¤´äº†ï¼Œå› ä¸ºä»–å®¶çš„ä»·æ ¼éå¸¸çš„ä¾¿å®œï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšåˆ°æ¯”å®˜æ–¹ä¾¿å®œ 7 å€ä»¥ä¸Šï¼Œæ”¯æŒMidjourneyç”»å›¾APIè°ƒç”¨ã€‚ ç‚¹æˆ‘ç›´è¾¾https://api1.zhtec.xyz/register?aff=0LXM AI-earthAI-earthæ˜¯å¦ä¸€å®¶å¾ˆæœ‰å®åŠ›çš„æºå¤´å•†å®¶ï¼ŒåŸºæœ¬ä»·æ ¼ä¹Ÿæ˜¯å®˜æ–¹çš„ 1&#x2F;7ï¼Œä¹Ÿæ”¯æŒ midjourney. ç‚¹æˆ‘ç›´è¾¾https://maxapi.aiearth.dev/register?aff=Rabe ä¸€ä¸ªå°ç«™ä¸€ä¸ªå°ç«™æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„åšå®¢ï¼Œåšä¸»æ­å»ºäº†å¾ˆå¤šå…¬ç›Šçš„æœåŠ¡ï¼Œä¹Ÿè‡´åŠ›äºæ‰“ç ´AIä¿¡æ¯å·®ï¼Œæ‰€ä»¥ä»–ä¹Ÿæä¾›çš„APIæœåŠ¡ã€‚ä»–ä»¬å®¶çš„ä¼˜åŠ¿æ˜¯è‡ªå»º CDNï¼Œæ‰€ä»¥ç»å¯¹çš„ç¨³å®šå’Œé€Ÿåº¦ï¼Œä½†æ˜¯ä»·æ ¼ç¨å¾®è´µï¼Œä¸ºå®˜æ–¹çš„åŠä»·ã€‚ ç‚¹æˆ‘ç›´è¾¾https://one-api.ygxz.in/register?aff=GbyM å¦å¤–ï¼Œä¸€ä¸ªå°ç«™æä¾›äº†å…è´¹çš„NextChatå’ŒLobeChatç»™å¤§å®¶ä½¿ç”¨ï¼Œå…å»æˆ‘ä»¬è‡ªå·±æ­å»ºçš„çƒ¦æ¼ã€‚ NextChat: https://boxask.ygxz.inLobeChat: https://lobe-chat.ygxz.in/ å›¾ç‰‡ç”Ÿæˆ(text to image) ç›®å‰AIç»˜ç”»æ¯”è¾ƒæœ‰åçš„é€šç”¨å¤§æ¨¡å‹ä¸»è¦æœ‰Flux, Midjourney, Ideogram2. å› ä¸ºæ¨¡å‹é€šç”¨æ€§å¼ºä¸”å‚æ•°å·¨å¤§ï¼Œå¾ˆéš¾æœ¬åœ°å®ç°ï¼Œæ‰€ä»¥è¿™ç§ä¸€èˆ¬é€šè¿‡APIçš„æ–¹å¼è°ƒç”¨ã€‚ SiliconFlowSiliconFlowæä¾›å¾ˆå¤šçš„ç”Ÿå›¾APIä»¥åŠå¼€æºå¤§æ¨¡å‹ï¼Œå…¶æœ€å¤§çš„å¥½å¤„æ˜¯é™¤äº† FLUX.1-devæ¨¡å‹å¤–å…¶ä½™çš„ç”Ÿå›¾æ¨¡å‹éƒ½æ˜¯å…è´¹ä½¿ç”¨çš„ï¼Œå¤§å–„äººå•Šï¼ ç‚¹æˆ‘ç›´è¾¾https://cloud.siliconflow.cn/i/g39XciHv CloudFlare workerAIå¯¹ï¼Œå°±æ˜¯é‚£ä¸ªå¤§å–„äºº CloudFlare, ä»–ä»¬çš„WORKAIç”Ÿå›¾æ¨¡å‹å…¨éƒ¨éƒ½æ˜¯å…è´¹æä¾›çš„ï¼Œå…¶ä¸­åŒ…æ‹¬ Fluxæ¨¡å‹ï¼š REST API è°ƒç”¨æ–‡æ¡£ï¼šflux-1-schnell ç‚¹æˆ‘ç›´è¾¾https://dash.cloudflare.com/a236551d1022e39375953d5d724094f0/ai/workers-ai OpenAI-HK &amp;&amp; AI-earthè¿™ä¸¤å®¶éƒ½æä¾› Midjourneyçš„ APIè°ƒç”¨ï¼Œå…¶ä¸­OpenAI-HKè¿˜æä¾› FLUX-devçš„ APIè°ƒç”¨ã€‚è¯·å›åˆ°åˆšæ‰æ–‡å­—ç”Ÿæˆéƒ¨åˆ†æŸ¥çœ‹ï¼ ç®—åŠ›ï¼ˆGPUï¼‰ç§Ÿç”¨é™¤äº†è·‘APIå¤–ï¼Œæœ¬åœ°è¿è¡Œ Stable Diffusionæˆ–è€… Fluxæ¨¡å‹ä¹Ÿæ˜¯ä¸€ç§å¥½çš„é€‰æ‹©ï¼Œä½¿ç”¨ WebUIæˆ–è€… ComfyUI, å¯ä»¥å®ç°æ›´å¥½çš„å®šåˆ¶åŠŸèƒ½ã€‚ ç«¯è„‘äº‘ç”µè„‘äº‘å¯¹äºAIç»˜ç”»æœ‰éå¸¸å¥½çš„ä¼˜åŒ–ï¼Œå› ä¸ºä»–ä»¬æä¾›äº†é¢„å…ˆå®šåˆ¶å¥½çš„åº”ç”¨å’Œä¸‹è½½å¥½çš„æ¨¡å‹ï¼Œç”¨æˆ·ç™»å½•ååªéœ€è¦é€‰æ‹©åº”ç”¨å¹¶ä¸”é€‰æ‹©æ˜¾å¡ç±»å‹å³å¯ï¼Œä»¥ComfyUIä¸ºå‡†ï¼ŒRTX4090æ˜¾å¡æ¯åˆ†é’Ÿåªéœ€è¦0.042 å…ƒã€‚ ç‚¹æˆ‘æ³¨å†Œè·å–å…è´¹ç®—åŠ›https://cephalon.cloud/#/share/register-landing?id=P761Pe OnethingAIOnethingAIæ˜¯å¦ä¸€å®¶å’Œç«¯è„‘äº‘å·®ä¸å¤šæ¨¡å¼çš„æœåŠ¡å•†ï¼Œå¯ä»¥ä½œä¸ºç«¯è„‘äº‘çš„æ›¿ä»£å“ã€‚å…¶æ˜¾å¡ä»·æ ¼ä¹Ÿæ˜¯éå¸¸ä¼˜æƒ çš„ã€‚ ç‚¹æˆ‘æ³¨å†Œè·å–å…è´¹ä»£é‡‘åˆ¸https://onethingai.com/invitation?code=rEstPUx6 æœªå®Œå¾…ç»­â€¦â€¦æŒç»­æ¨èå¥½ç”¨é“¾æ¥","categories":[{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://xiaohanys.top/tags/AI/"},{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"}],"author":"Xiaoguang Pan"},{"title":"2024æœ€æ–°å…è´¹ä½¿ç”¨Fluxå…¨æ¨¡å‹ç½‘ç«™åˆ†äº«","slug":"Fluxä¸‹ä¸€ä»£AIå›¾åƒç”Ÿæˆ","date":"2024-10-18T05:12:00.000Z","updated":"2024-10-18T07:44:23.227Z","comments":true,"path":"flux-new-model/","permalink":"https://xiaohanys.top/flux-new-model/","excerpt":"åœ¨å¿«é€Ÿå‘å±•çš„ AI å›¾åƒç”Ÿæˆé¢†åŸŸï¼Œå‡ºç°äº†ä¸€ä¸ªæ–°çš„å‚ä¸è€…ï¼Œå®ƒå°†é‡æ–°å®šä¹‰AIç»˜ç”»çš„å¯èƒ½æ€§ã€‚Flux.1 å°±æ˜¯ç”±é»‘æ£®æ—å®éªŒå®¤å¼€å‘çš„ä¸€å¥—å¼€åˆ›æ€§çš„æ¨¡å‹ï¼Œå®ƒæ­£åœ¨å¸­å· AI ç¤¾åŒºã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ Flux.1 çš„ç‰¹åˆ«ä¹‹å¤„ï¼Œä»¥åŠå®ƒä¸ºä½•è¢«èª‰ä¸ºå›¾åƒåˆæˆé¢†åŸŸçš„æ–°ç‹ï¼Ÿ","text":"åœ¨å¿«é€Ÿå‘å±•çš„ AI å›¾åƒç”Ÿæˆé¢†åŸŸï¼Œå‡ºç°äº†ä¸€ä¸ªæ–°çš„å‚ä¸è€…ï¼Œå®ƒå°†é‡æ–°å®šä¹‰AIç»˜ç”»çš„å¯èƒ½æ€§ã€‚Flux.1 å°±æ˜¯ç”±é»‘æ£®æ—å®éªŒå®¤å¼€å‘çš„ä¸€å¥—å¼€åˆ›æ€§çš„æ¨¡å‹ï¼Œå®ƒæ­£åœ¨å¸­å· AI ç¤¾åŒºã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ Flux.1 çš„ç‰¹åˆ«ä¹‹å¤„ï¼Œä»¥åŠå®ƒä¸ºä½•è¢«èª‰ä¸ºå›¾åƒåˆæˆé¢†åŸŸçš„æ–°ç‹ï¼Ÿ ä½•ä¸º Flux.1 ?Flux.1 ä¸ä»…ä»…æ˜¯å¦ä¸€ä¸ª AI æ¨¡å‹ï¼Œå®ƒæ˜¯ç”± Black Forest Labs(é»‘æ£®æ—å®éªŒå®¤) å¼€å‘çš„ä¸€ç³»åˆ—æœ€å…ˆè¿›çš„æ–‡æœ¬è½¬å›¾åƒç”Ÿæˆæ¨¡å‹ã€‚Black Forest Labs ç”±ä¸€ç¾¤æ°å‡ºçš„ AI ç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆåˆ›ç«‹ï¼Œå…¶ä¸­åŒ…æ‹¬ Stable Diffusion çš„åˆ›å»ºè€…ï¼Œè‡´åŠ›äºæ¨åŠ¨ç”Ÿæˆ AI çš„å‘å±•ã€‚ Flux.1 å¥—ä»¶åŒ…å«ä¸‰ä¸ªç‰ˆæœ¬ï¼š Flux.1 [pro]ï¼šæ——èˆ°å‹å·ï¼Œåœ¨å›¾åƒç”Ÿæˆæ–¹é¢æä¾›æ— ä¸ä¼¦æ¯”çš„æ€§èƒ½ã€‚ Flux.1 [dev]ï¼šé’ˆå¯¹éå•†ä¸šåº”ç”¨çš„å¼€æ”¾æƒé‡æ¨¡å‹ã€‚ Flux.1 [schnell]ï¼šæœ€å¿«çš„å‹å·ï¼Œä¸“ä¸ºæœ¬åœ°å¼€å‘å’Œä¸ªäººä½¿ç”¨è€Œè®¾è®¡ã€‚ æ¯ä¸ªç‰ˆæœ¬éƒ½é’ˆå¯¹ä¸åŒçš„ç”¨ä¾‹è¿›è¡Œäº†å®šåˆ¶ï¼Œç¡®ä¿æ— è®ºæ‚¨æ˜¯æ™®é€šç”¨æˆ·è¿˜æ˜¯ä¸“ä¸šå¼€å‘äººå‘˜ï¼Œéƒ½æœ‰é€‚åˆæ‚¨éœ€æ±‚çš„ Flux.1 æ¨¡å‹ã€‚ èƒŒåçš„æŠ€æœ¯Flux.1 çš„æ ¸å¿ƒæ˜¯æ··åˆæ¶æ„ï¼Œå®ƒç»“åˆäº†å¤šæ¨¡æ€å’Œå¹¶è¡Œæ‰©æ•£å˜å‹å™¨å—ã€‚Flux.1 å¯æ‰©å±•åˆ°ä»¤äººå°è±¡æ·±åˆ»çš„ 120 äº¿ä¸ªå‚æ•°ï¼Œåˆ©ç”¨æµåŒ¹é…ã€æ—‹è½¬ä½ç½®åµŒå…¥å’Œå¹¶è¡Œæ³¨æ„å±‚ç­‰å…ˆè¿›æŠ€æœ¯æ¥å®ç°å…¶å“è¶Šçš„æ€§èƒ½ã€‚ è¿™ç§åˆ›æ–°æ–¹æ³•ä½¿ Flux.1 åœ¨å›¾åƒç”Ÿæˆçš„å„ä¸ªæ–¹é¢è¡¨ç°å‡ºè‰²ï¼ŒåŒ…æ‹¬ï¼š è§†è§‰è´¨é‡ åŠæ—¶éµå®ˆ å°ºå¯¸å’Œé•¿å®½æ¯”å˜åŒ– æ’ç‰ˆ è¾“å‡ºåˆ†é›† Flux.1 ä¸ºä½•è„±é¢–è€Œå‡º æ— ä¸ä¼¦æ¯”çš„æ€§èƒ½ï¼šFlux.1 [pro] å’Œ [dev] åœ¨å¤šä¸ªåŸºå‡†æµ‹è¯•ä¸­çš„è¡¨ç°ä¼˜äº Midjourney v6.0ã€DALLÂ·E 3 (HD) å’Œ SD3-Ultra ç­‰çƒ­é—¨å‹å·ã€‚ å¤šåŠŸèƒ½æ€§ï¼šé€šè¿‡æ”¯æŒå„ç§å®½é«˜æ¯”å’Œåˆ†è¾¨ç‡ï¼ŒFlux.1 åœ¨å›¾åƒåˆ›å»ºæ–¹é¢æä¾›äº†å‰æ‰€æœªæœ‰çš„çµæ´»æ€§ã€‚ é€Ÿåº¦ï¼šFlux.1 [schnell] æ˜¯ç›®å‰æœ€å…ˆè¿›çš„å¿«é€Ÿæ¨¡å‹ï¼Œå¯åœ¨ä¸å½±å“è´¨é‡çš„æƒ…å†µä¸‹å¿«é€Ÿç”Ÿæˆå›¾åƒã€‚ å¼€æºï¼š[dev] å’Œ [schnell] ç‰ˆæœ¬æ˜¯å¼€æºçš„ï¼Œä¿ƒè¿›äº† AI ç¤¾åŒºå†…çš„åˆ›æ–°å’Œåä½œã€‚ ä¼ä¸šè§£å†³æ–¹æ¡ˆï¼šå¯¹äºå¸Œæœ›åˆ©ç”¨å°–ç«¯äººå·¥æ™ºèƒ½çš„ä¼ä¸šï¼ŒFlux.1 [pro] æä¾›ä¸“ç”¨å’Œå®šåˆ¶çš„ä¼ä¸šè§£å†³æ–¹æ¡ˆã€‚ å¦‚ä½•å¼€å§‹ä½¿ç”¨ Flux.1å‡†å¤‡å¥½ä½“éªŒ AI å›¾åƒç”Ÿæˆçš„æœªæ¥äº†å—ï¼Ÿæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹æ³•å¼€å§‹ï¼š å¯¹äº Flux.1 [pro] å»å®˜æ–¹è·å–API åœ¨ Hugging Face ä¸Šå°è¯• Flux.1 [dev] æˆ–è€… Replicate ä» GitHub ä¸‹è½½ Flux.1 [schnell] ä¾›æœ¬åœ°ä½¿ç”¨ ä»Šå¤©æˆ‘ä»¬æ¨èä¸€ä¸ªç›®å‰æ¥è¯´å®Œå…¨å…è´¹çš„ç½‘ç«™å¯ä»¥å®Œå…¨ä½¿ç”¨ä¸‰ä¸ªæ¨¡å‹ï¼Œæ— è®ºæ˜¯ Proäº¦æˆ–è€…schnell, éƒ½æ˜¯å…è´¹æ— é™åˆ¶çš„ï¼Œé€Ÿé€Ÿä½“éªŒã€‚ fluximageaihttps://www.fluximageai.com/ ç»“è®ºFlux.1 ä»£è¡¨äº† AI å›¾åƒç”ŸæˆæŠ€æœ¯çš„é‡å¤§é£è·ƒã€‚å®ƒç»“åˆäº†å…ˆè¿›çš„æ¶æ„ã€å¤šåŠŸèƒ½æ¨¡å‹å’Œå¼€æºå¯ç”¨æ€§ï¼Œä½¿å…¶æˆä¸ºè¯¥é¢†åŸŸçš„æ¸¸æˆè§„åˆ™æ”¹å˜è€…ã€‚æ— è®ºæ‚¨æ˜¯ AI çˆ±å¥½è€…ã€ä¸“ä¸šå¼€å‘äººå‘˜è¿˜æ˜¯å¸Œæœ›åˆ©ç”¨ç”Ÿæˆ AI åŠ›é‡çš„ä¼ä¸šï¼ŒFlux.1 éƒ½èƒ½æä¾›æ»¡è¶³ç”šè‡³è¶…å‡ºæ‚¨æœŸæœ›çš„è§£å†³æ–¹æ¡ˆã€‚ éšç€äººå·¥æ™ºèƒ½é¢†åŸŸçš„ä¸æ–­å‘å±•ï¼Œæœ‰ä¸€ç‚¹æ˜¯æ˜ç¡®çš„ï¼šFlux.1 æ­£å¼•é¢†æˆ‘ä»¬è¿›å…¥ä¸€ä¸ªå……æ»¡åˆ›æ„å¯èƒ½æ€§çš„æ–°æ—¶ä»£ã€‚è‹¥æƒ³ç«™åœ¨è¿™é¡¹æ¿€åŠ¨äººå¿ƒçš„æŠ€æœ¯çš„å‰æ²¿ï¼Œè¯·åŠ¡å¿…è®¿é—®https://www.fluximageai.comæ¢ç´¢ Flux.1 ï¼Œå¹¶åŠ å…¥å¡‘é€ äººå·¥æ™ºèƒ½ç”Ÿæˆåª’ä½“æœªæ¥çš„åˆ›æ–°è€…ç¤¾åŒºã€‚","categories":[{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://xiaohanys.top/tags/AI/"},{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"}],"author":"Xiaoguang Pan"},{"title":"å°ç™½å¦‚ä½•ç”¨reflexæ­å»ºä¸€ä¸ªAIåº”ç”¨?","slug":"å°ç™½ç”¨reflexæ­å»ºä¸€ä¸ªAIç»˜ç”»çš„åº”ç”¨æ˜¯æ€ä¹ˆæ ·çš„ä½“éªŒ","date":"2024-10-16T09:12:34.000Z","updated":"2024-10-18T05:33:05.164Z","comments":true,"path":"reflex-ai-app/","permalink":"https://xiaohanys.top/reflex-ai-app/","excerpt":"æˆ‘ä»¬åœ¨ä¸€å¹´å‰å¯åŠ¨äº† Reflexï¼Œä»¥ä¾¿ä»»ä½•äº†è§£ Python çš„äººéƒ½å¯ä»¥è½»æ¾æ„å»º Web åº”ç”¨ç¨‹åºå¹¶ä¸ä¸–ç•Œåˆ†äº«ï¼Œè€Œæ— éœ€å­¦ä¹ æ–°è¯­è¨€å’Œæ‹¼å‡‘ä¸€å †ä¸åŒçš„å·¥å…·ã€‚ Web å¼€å‘æ˜¯æœ€æµè¡Œçš„ç¼–ç¨‹ç”¨ä¾‹ä¹‹ä¸€ã€‚ Python æ˜¯ä¸–ç•Œä¸Šæœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç”¨ Python æ„å»º Web åº”ç”¨ç¨‹åºå‘¢ï¼Ÿ ä»¥ä¸Šæ¥è‡ªReflexæ„å»ºè€…å‘å¸ƒçš„åšå®¢ï¼ŒåŸæ–‡é“¾æ¥å¦‚ä¸‹ï¼š è®¾è®¡çº¯Python Webæ¡†æ¶https://reflex.dev/blog/2024-03-21-reflex-architecture/","text":"æˆ‘ä»¬åœ¨ä¸€å¹´å‰å¯åŠ¨äº† Reflexï¼Œä»¥ä¾¿ä»»ä½•äº†è§£ Python çš„äººéƒ½å¯ä»¥è½»æ¾æ„å»º Web åº”ç”¨ç¨‹åºå¹¶ä¸ä¸–ç•Œåˆ†äº«ï¼Œè€Œæ— éœ€å­¦ä¹ æ–°è¯­è¨€å’Œæ‹¼å‡‘ä¸€å †ä¸åŒçš„å·¥å…·ã€‚ Web å¼€å‘æ˜¯æœ€æµè¡Œçš„ç¼–ç¨‹ç”¨ä¾‹ä¹‹ä¸€ã€‚ Python æ˜¯ä¸–ç•Œä¸Šæœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç”¨ Python æ„å»º Web åº”ç”¨ç¨‹åºå‘¢ï¼Ÿ ä»¥ä¸Šæ¥è‡ªReflexæ„å»ºè€…å‘å¸ƒçš„åšå®¢ï¼ŒåŸæ–‡é“¾æ¥å¦‚ä¸‹ï¼š è®¾è®¡çº¯Python Webæ¡†æ¶https://reflex.dev/blog/2024-03-21-reflex-architecture/ æ‰€ä»¥çœŸçš„æœ‰ä¸€ç§æ„Ÿè§‰ï¼ŒReflexä½¿ç”¨ä¸€ç§è¯­è¨€è®©æˆ‘ä»¬å°ç™½å¯ä»¥ç›´æ¥åšåˆ°ä»¥å‰éœ€è¦æ•´åˆ Html, Javascript, Pythonç­‰ä¼—å¤šè¯­è¨€æ‰èƒ½æ„å»ºçš„å¤æ‚åº”ç”¨ï¼Œç®€ç›´æ˜¯ç¥å¥‡ï¼é‚£ä¹ˆä»Šå¤©ï¼Œæˆ‘æ¥ä»‹ç»ä¸€ä¸‹æˆ‘è‡ªå·±æ­å»ºçš„åŸºäºå…è´¹APIçš„AIå·¥å…·çš„ã€‚ é¦–å…ˆçœ‹ä¸€ä¸‹é»˜è®¤ç•Œé¢ã€‚ é¦–å…ˆæ˜¯ AI ç»˜ç”»åº”ç”¨ï¼Œ åŠŸèƒ½ä»‹ç»ï¼š ç›®å‰ä¸€å…±æ”¯æŒ 4 ä¸ªæ¨¡å‹ï¼Œå…¶ä¸­Fluxç³»åˆ—æ˜¯æœ€å¥½çš„ï¼ŒFlux-devæ˜¯æ”¶è´¹çš„ æ”¯æŒé­”æœ¯æç¤ºè¯ï¼Œå³ä½¿è¾“å…¥ä¸­æ–‡ï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘æˆåˆé€‚ä¸”æœ‰æƒ³è±¡åŠ›çš„æç¤ºè¯ æ”¯æŒä¸åŒå°ºå¯¸å›¾å½¢ç»˜åˆ¶ æ”¯æŒé«˜çº§é€‰é¡¹ï¼Œä¾‹å¦‚è´Ÿé¢æç¤ºè¯ï¼Œæ­¥æ•°å’Œcfg_scale æ‡’ï¼Œæ²¡æœ‰ä¼˜åŒ–æ‰‹æœºç«¯ï¼Œæ‰€ä»¥å¿…é¡»ç”¨ç”µè„‘ï¼Œå¦åˆ™ï¼Œé¡µé¢ä¼šä¹± å¦‚ä½•ä½¿ç”¨ï¼šå…è´¹ç‰ˆçš„APIæœ‰é€Ÿç‡é™åˆ¶ï¼Œæˆ‘ä¸€å¼€å§‹ä¹Ÿæƒ³ç›´æ¥å†…ç½®æˆ‘çš„ç®—äº†ï¼Œåæ¥å‘ç°ä¸è¡Œï¼Œäºæ˜¯ä¿®æ”¹ä¸ºå¯ä»¥æ‰‹åŠ¨è®¾ç½®è‡ªå·±çš„APIï¼Œè€Œè·å–APIä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å»åˆ°SiliconFlowå®˜ç½‘å°±å¯ä»¥è·å–äº†ã€‚ è€Œé­”æœ¯æç¤ºè¯ï¼ˆMagic Promptï¼‰æ˜¯éœ€è¦ OpenAIæä¾›çš„å¤§è¯­è¨€æ¨¡å‹æ¥å®ç°ç¿»è¯‘å¹¶ä¼˜åŒ–çš„ï¼Œæˆ–è€…ä½¿ç”¨ OpenAIå…¼å®¹çš„ APIç«¯ç‚¹ã€‚è¿™é‡Œæ¨èå¤§å®¶ä½¿ç”¨ å°æµ·Chathttps://api1.zhtec.xyz/ æä¾›çš„ APIï¼ŒGPT4çš„ä»·æ ¼éƒ½éå¸¸ä¾¿å®œã€‚ è®¾ç½®ç•Œé¢å¦‚å›¾æ‰€ç¤º å…¶ä¸­ï¼š SiliconFlow API Key: å°±æ˜¯ä»siliconflowè·å–çš„ APIçš„ Magic Prompt endpoint: OpenAIï¼ˆGPTï¼‰å…¼å®¹çš„APIç«¯ç‚¹é“¾æ¥ Magic Prompt API key: GPTæ¨¡å‹å¯¹åº”çš„API Magic Prompt Model: ä½ æ‰“ç®—ç”¨å“ªä¸ªæ¨¡å‹æ¥ä¼˜åŒ–æç¤ºè¯ï¼Œgpt-4oæœ€å¼ºï¼Œä½†æ˜¯è´µï¼ï¼ï¼ æµ‹è¯•å½“ä½ è®¾ç½®å¥½ä»¥ä¸Šä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šè¢«å‚¨å­˜åˆ°ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ï¼Œç„¶åä¸‹æ¬¡å†æ‰“å¼€å°±ä¸ç”¨é‡å¤è¾“å…¥äº†ã€‚ç„¶åæˆ‘ä»¬å°è¯•è¾“å…¥ä¸€ä¸‹æç¤ºè¯çœ‹çœ‹ï¼š è™½ç„¶è¾“å…¥äº†ä¸­æ–‡ï¼Œä½†æ˜¯ç”»é¢ä¾æ—§å¾ˆä¼˜ç§€ ç›´è¾¾é“¾æ¥: aiarthttps://sequencetool.reflex.run/aiart/ è‡³äºAI å¯¹è¯åº”ç”¨å°±å’Œ AI ç»˜ç”»æ˜¯ç›¸åŒçš„é€»è¾‘ï¼Œä½ åªéœ€è¦è·å–APIå°±å¯ä»¥äº†ï¼Œæ²¡æœ‰åˆ«çš„è¦æ³¨æ„çš„ã€‚ èŠå¤©é¡µé¢ ç›´è¾¾é“¾æ¥: aichathttps://sequencetool.reflex.run/aichat/ æºä»£ç å› ä¸ºå®ç°é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥åœ¨æœ¬æ–‡å°±ä¸å†è¯¦ç»†çš„ä»‹ç»å®ç°çš„åŸç†äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥æŸ¥çœ‹ä»£ç ï¼š panxiaoguang/SequenceToolhttps://github.com/panxiaoguang/SequenceTool","categories":[{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://xiaohanys.top/tags/AI/"},{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://xiaohanys.top/tags/%E5%89%8D%E7%AB%AF/"}],"author":"Xiaoguang Pan"},{"title":"å¦‚ä½•åœ¨Reflexé‡Œé¢ä½¿ç”¨IGVæµè§ˆå™¨ï¼Ÿ","slug":"å¦‚ä½•åœ¨Reflexé‡Œé¢ä½¿ç”¨IGVæµè§ˆå™¨","date":"2024-10-09T04:49:48.000Z","updated":"2024-10-18T05:32:23.667Z","comments":true,"path":"reflex-igv/","permalink":"https://xiaohanys.top/reflex-igv/","excerpt":"note Reflex æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œæ—¨åœ¨ä½¿ç”¨çº¯ Python æ„å»ºå…¨æ ˆ Web åº”ç”¨ç¨‹åºã€‚å®ƒçš„è®¾è®¡ç†å¿µæ˜¯è®©å¼€å‘è€…èƒ½å¤Ÿå®Œå…¨ä½¿ç”¨ Python ç¼–å†™åº”ç”¨çš„å‰ç«¯å’Œåç«¯ï¼Œæ— éœ€å­¦ä¹  JavaScriptã€‚è¿™å¯¹äºé‚£äº›å¸Œæœ›ä¸“æ³¨äº Python ç¼–ç¨‹è¯­è¨€çš„å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä¸ªé‡å¤§çš„ç¦éŸ³ã€‚ ä¸Šé¢è¯´çš„éƒ½æ˜¯åœºé¢è¯ï¼Œè¿™éƒ½ä¾æ‰˜äºå®ƒè‡ªèº«åŒ…è£…çš„ç¬¬ä¸‰æ–¹åº”ç”¨å¤Ÿä¸°å¯Œã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€äº›å†·é—¨çš„åº”ç”¨ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¦è¯´çš„IGVæµè§ˆå™¨ï¼Œå°±æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“äº†ã€‚è¿™é‡Œæˆ‘å°±æ¥åˆ†äº«ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•åœ¨ Reflex é‡Œé¢ä½¿ç”¨ IGV æµè§ˆå™¨çš„ã€‚","text":"note Reflex æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œæ—¨åœ¨ä½¿ç”¨çº¯ Python æ„å»ºå…¨æ ˆ Web åº”ç”¨ç¨‹åºã€‚å®ƒçš„è®¾è®¡ç†å¿µæ˜¯è®©å¼€å‘è€…èƒ½å¤Ÿå®Œå…¨ä½¿ç”¨ Python ç¼–å†™åº”ç”¨çš„å‰ç«¯å’Œåç«¯ï¼Œæ— éœ€å­¦ä¹  JavaScriptã€‚è¿™å¯¹äºé‚£äº›å¸Œæœ›ä¸“æ³¨äº Python ç¼–ç¨‹è¯­è¨€çš„å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä¸ªé‡å¤§çš„ç¦éŸ³ã€‚ ä¸Šé¢è¯´çš„éƒ½æ˜¯åœºé¢è¯ï¼Œè¿™éƒ½ä¾æ‰˜äºå®ƒè‡ªèº«åŒ…è£…çš„ç¬¬ä¸‰æ–¹åº”ç”¨å¤Ÿä¸°å¯Œã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€äº›å†·é—¨çš„åº”ç”¨ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¦è¯´çš„IGVæµè§ˆå™¨ï¼Œå°±æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“äº†ã€‚è¿™é‡Œæˆ‘å°±æ¥åˆ†äº«ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•åœ¨ Reflex é‡Œé¢ä½¿ç”¨ IGV æµè§ˆå™¨çš„ã€‚ åŒ…è£…igv.jsåˆ°reactç»„ä»¶é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠ igv.js åŒ…è£…æˆä¸€ä¸ª React ç»„ä»¶ã€‚æˆ‘ä»¬ä»¥ä¸¤ä¸ªéœ€è¦å®ç°çš„äº¤äº’ä¸ºä¾‹å­æ¥è¯´æ˜ï¼š ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨çš„æ§åˆ¶å™¨ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ§åˆ¶å™¨æ¥æ§åˆ¶ igv.js æ˜¾ç¤ºçš„åæ ‡èŒƒå›´ã€‚ ç¬¬äºŒä¸ªæ˜¯å½“æˆ‘ä»¬é¼ æ ‡ç‚¹å‡»æŸä¸ªåŒºåŸŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°è¿™ä¸ªåŒºåŸŸçš„æ‰€æœ‰ä¿¡æ¯ã€‚ é¦–å…ˆï¼Œé€šè¿‡æŸ¥é˜… IGV.jsçš„æ–‡æ¡£ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ igv.createBrowser æ¥åˆ›å»ºä¸€ä¸ª IGV æµè§ˆå™¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª IGV æµè§ˆå™¨ï¼Œç„¶åé€šè¿‡è¿™ä¸ªæµè§ˆå™¨çš„å®ä¾‹æ¥æ§åˆ¶ IGV çš„æ˜¾ç¤ºã€‚ import igv from &quot;https://cdn.jsdelivr.net/npm/igv@3.0.0/dist/igv.esm.min.js&quot;const div = document.getElementById(&quot;igv_div&quot;)const config = &#123; genome: &quot;hg19&quot;&#125;const browser = await igv.createBrowser(div, config) ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡igv.removeAllBrowsers()æ¥ç§»é™¤æ‰€æœ‰çš„æµè§ˆå™¨ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬æ”¾åˆ° React ç»„ä»¶é‡Œé¢ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼š import React, &#123; useEffect, useRef &#125; from &quot;react&quot;;import igv from &quot;igv&quot;;const IgvComponent = () =&gt; &#123; const igvContainerRef = useRef(null); const browserRef = useRef(null); useEffect(()=&gt;&#123; const options = &#123; genome: &#x27;hg19&#x27;, &#125;; igv.createBrowser(igvContainerRef.current, options).then(browser =&gt; &#123; browserRef.current = browser; &#125;); &#125;); return ( &lt;&gt; &lt;div ref=&#123;igvContainerRef&#125; /&gt;; &lt;/&gt; );&#125;;export default IgvComponent; ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ·»åŠ äº¤äº’ï¼Œæˆ‘ä»¬æƒ³è¦å®ç°çš„ç¬¬äºŒä¸ªåŠŸèƒ½éœ€è¦ browser.onæ¥ç›‘å¬äº‹ä»¶ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦ç›‘å¬é¼ æ ‡ç‚¹å‡»äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š browser.on(&quot;trackclick&quot;, (track, popoverData) =&gt; &#123;&#125;) æˆ‘ä»¬æ”¾å…¥ React ç»„ä»¶é‡Œé¢ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼š import React, &#123; useEffect, useRef &#125; from &quot;react&quot;;import igv from &quot;igv&quot;;const IgvComponent = (genome, locus, tracks, onTrackClick) =&gt; &#123; const igvContainerRef = useRef(null); const browserRef = useRef(null); useEffect(()=&gt;&#123; const options = &#123; genome, locus, tracks, &#125;; igv.createBrowser(igvContainerRef.current, options).then(browser =&gt; &#123; browserRef.current = browser; if (onTrackClick) &#123; browser.on(&quot;trackclick&quot;, (track, popoverData) =&gt; &#123; const trackName = track.name; const trackValue = popoverData.map((data) =&gt; (&#123; name: data.name, value: data.value, &#125;)); onTrackClick(trackName, trackValue); &#125;); &#125; &#125;); &#125;); return ( &lt;&gt; &lt;div ref=&#123;igvContainerRef&#125; /&gt;; &lt;/&gt; );&#125;;export default IgvComponent; è€Œç¬¬ä¸€ä¸ªè¦æ±‚é‡Œï¼Œæˆ‘ä»¬è¦å¤–éƒ¨æ§åˆ¶ï¼Œéœ€è¦è·å–åˆ°browserçš„å®ä¾‹ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå®ä¾‹æ¥æ§åˆ¶ IGV çš„æ˜¾ç¤ºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ browser.search æ¥æœç´¢æŸä¸ªåŸºå› ï¼Œé€šè¿‡ browser.zoomIn å’Œ browser.zoomOut æ¥ç¼©æ”¾ã€‚è¿™åœ¨reacté‡Œæ˜¯è¿™æ ·çš„ï¼š import React, &#123; useEffect, useRef &#125; from &quot;react&quot;;import igv from &quot;../node_modules/igv/dist/igv.esm.min.js&quot;;const IgvComponent = (&#123; genome, locus, tracks, onTrackClick &#125;) =&gt; &#123; const igvContainerRef = useRef(null); const browserRef = useRef(null); useEffect(() =&gt; &#123; const options = &#123; genome, locus, tracks, &#125;; if (!browserRef.current) &#123; igv.createBrowser(igvContainerRef.current, options).then((browser) =&gt; &#123; browserRef.current = browser; if (onTrackClick) &#123; browser.on(&quot;trackclick&quot;, (track, popoverData) =&gt; &#123; const trackName = track.name; const trackValue = popoverData.map((data) =&gt; (&#123; name: data.name, value: data.value, &#125;)); onTrackClick(trackName, trackValue); &#125;); &#125; &#125;); &#125; // æ¸…ç†å‡½æ•°ï¼Œåœ¨ç»„ä»¶å¸è½½æ—¶è°ƒç”¨ return () =&gt; &#123; if (browserRef.current) &#123; igv.removeAllBrowsers() &#125; &#125;; &#125;, []); useEffect(() =&gt; &#123; if (browserRef.current) &#123; browserRef.current.search(locus); &#125; &#125;, [locus]); return &lt;div ref=&#123;igvContainerRef&#125; /&gt;;&#125;;export default IgvComponent; è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†æœ€ç»ˆçš„åŒ…è£…ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºReactç¯å¢ƒæ¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯è¡Œï¼Œæˆ–è€…å¯ä»¥å»æ‰¾åœ¨çº¿å¹³å°æµ‹è¯•ï¼Œä¾‹å¦‚playcode åœ¨ Reflex é‡Œé¢ä½¿ç”¨æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¡¨è¿°ï¼ŒReactç»„ä»¶çš„åŒ…è£…å°±ç›¸å½“ç®€å•äº†ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯æœ¬åœ°çš„ç»„ä»¶ï¼Œæ‰€ä»¥å°±å¯ä»¥è¿™æ ·ï¼š ### IGV.pyimport reflex as rxfrom typing import List, Dictfrom reflex.components.component import NoSSRComponent### ä¸€å®šè¦æ³¨æ„è¿™ä¸ªåªå¯ä»¥åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œä¸æ”¯æŒæœåŠ¡ç«¯class IGV(NoSSRComponent): ###å®˜æ–¹æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬çš„ç»„ä»¶éœ€è¦æ”¾åœ¨assetsæ–‡ä»¶å¤¹ä¸‹,ä½†æ˜¯è¿™é‡Œè¦å†™public library = &quot;/public/igv&quot; tag = &quot;IgvComponent&quot; is_default = True lib_dependencies: list[str] = [ &quot;igv@3.0.6&quot; ] genome: rx.Var[str] locus: rx.Var[str] tracks: rx.Var[List[Dict[str, str]]] on_track_click: rx.EventHandler[lambda e0, e1: [e0, e1]]igvComponent = IGV.create ä¸€å®šè¦æ³¨æ„çš„æ˜¯ï¼ŒReflexé»˜è®¤æ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„ï¼Œä½†æ˜¯æ˜¾ç„¶ IGVæµè§ˆå™¨æ— æ³•åœ¨æœåŠ¡ç«¯å…¼å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯ç”¨ NoSSRComponentæ¥åŒ…è£…ã€‚ å¦‚ä½•ä½¿ç”¨ï¼Ÿæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå°çš„ Demoæ¥æµ‹è¯•ä¸€ä¸‹ï¼š import reflex as rxfrom .IGV import igvComponentclass State(rx.State): &quot;&quot;&quot;The app state.&quot;&quot;&quot; genome: str = &quot;hg38&quot; loc: str = &quot;chr8:127736588-127739371&quot; tracks: list[dict[str, str]] = [ &#123; &quot;name&quot;: &quot;HG00103&quot;, &quot;url&quot;: &quot;https://s3.amazonaws.com/1000genomes/data/HG00103/alignment/HG00103.alt_bwamem_GRCh38DH.20150718.GBR.low_coverage.cram&quot;, &quot;indexURL&quot;: &quot;https://s3.amazonaws.com/1000genomes/data/HG00103/alignment/HG00103.alt_bwamem_GRCh38DH.20150718.GBR.low_coverage.cram.crai&quot;, &quot;format&quot;: &quot;cram&quot; &#125;] location: str trackName: str trackdata: list[dict[str, str]] def change_loc(self): self.loc = self.location def get_click_info(self, e0: str, e1: list[dict[str, str]]): self.trackName = e0 self.trackdata = [&#123;&quot;name&quot;: itm[&#x27;name&#x27;], &quot;value&quot;: itm[&#x27;value&#x27;]&#125; for itm in e1 if itm[&#x27;name&#x27;]]def data_item(name: str, value: str) -&gt; rx.Component: return rx.data_list.item( rx.data_list.label(name), rx.data_list.value(value) )def data_card(trackdata: list[dict[str, str]]) -&gt; rx.Component: return rx.card( rx.data_list.root( rx.foreach(trackdata, lambda item: data_item( item[&#x27;name&#x27;], item[&#x27;value&#x27;])) ) )def index() -&gt; rx.Component: # Welcome Page (Index) return rx.container( rx.vstack( rx.heading(&quot;IGV test!&quot;, size=&quot;9&quot;), rx.box( igvComponent(genome=State.genome, locus=State.loc, tracks=State.tracks, on_track_click=State.get_click_info), width=&quot;100%&quot;, ), rx.hstack( rx.input(placeholder=&quot;Enter location&quot;, on_blur=State.set_location, width=&quot;40%&quot;), rx.button(&quot;GoTo!&quot;, on_click=State.change_loc), width=&quot;100%&quot;, justify=&quot;center&quot; ), rx.divider(), rx.cond( State.trackName, rx.vstack( rx.heading(State.trackName, size=&quot;4&quot;), data_card(State.trackdata) ), rx.heading(&quot;No track clicked&quot;, size=&quot;4&quot;) ), spacing=&quot;5&quot;, justify=&quot;center&quot;, min_height=&quot;85vh&quot;, ), rx.logo() )app = rx.App()app.add_page(index) ä½¿ç”¨å°±å¾ˆç®€å•äº†ï¼Œä¸€æ—¦åŒ…è£…å¥½ï¼Œæˆ‘ä»¬å¯¼å…¥å®ƒå°±å¯ä»¥å½“åšå®˜æ–¹çš„ç»„ä»¶æ¥ä½¿ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä»–å†™ Stateï¼Œå†™ EventHandlerï¼Œå†™é¡µé¢ï¼Œå†™äº¤äº’ï¼Œå†™æ ·å¼ï¼Œå†™é€»è¾‘ï¼Œå†™ä¸€åˆ‡ã€‚ æ€»ç»“è¿™é‡Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å°† igv.js åŒ…è£…æˆ React ç»„ä»¶ï¼Œç„¶åå°† React ç»„ä»¶åŒ…è£…æˆ Reflex ç»„ä»¶ï¼Œæœ€ååœ¨ Reflex é‡Œé¢ä½¿ç”¨ã€‚è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®é™¿ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åŒ…è£…ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ç»„ä»¶ï¼Œåªè¦æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„è€å¿ƒå’ŒæŠ€æœ¯ã€‚æœ¬æ–‡çš„ä»£ç åœ¨ Github å¯ä»¥è·å–ã€‚ note è¿™é‡Œçš„ igv.js æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®é™¿ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åŒ…è£…ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ç»„ä»¶ï¼Œåªè¦æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„è€å¿ƒå’ŒæŠ€æœ¯ã€‚","categories":[{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"author":"Xiaoguang Pan"},{"title":"ä½¿ç”¨äºŒä»£å’Œä¸‰ä»£WGSæ•°æ®è¿›è¡ŒåŸºå› ç»„ç»„è£…","slug":"ä½¿ç”¨äºŒä»£å’Œä¸‰ä»£WGSæ•°æ®è¿›è¡ŒåŸºå› ç»„ç»„è£…","date":"2024-09-20T05:12:14.000Z","updated":"2024-10-18T05:32:48.022Z","comments":true,"path":"sec-third-16s-assembly/","permalink":"https://xiaohanys.top/sec-third-16s-assembly/","excerpt":"æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ç¬¬äºŒä»£å’Œç¬¬ä¸‰ä»£å…¨åŸºå› ç»„æµ‹åº (WGS) æ•°æ®ç»„è£…ç»†èŒåŸºå› ç»„ã€‚æˆ‘ä»¬å°†ä»¥æ­¤ä¸ºä¾‹æ¥æ¢è®¨WGSæ•°æ®åˆ†æï¼Œå¹¶æ¢è®¨æµ‹åºæŠ€æœ¯ä¹‹é—´çš„å·®å¼‚ã€‚","text":"æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ç¬¬äºŒä»£å’Œç¬¬ä¸‰ä»£å…¨åŸºå› ç»„æµ‹åº (WGS) æ•°æ®ç»„è£…ç»†èŒåŸºå› ç»„ã€‚æˆ‘ä»¬å°†ä»¥æ­¤ä¸ºä¾‹æ¥æ¢è®¨WGSæ•°æ®åˆ†æï¼Œå¹¶æ¢è®¨æµ‹åºæŠ€æœ¯ä¹‹é—´çš„å·®å¼‚ã€‚ è½¯ä»¶å®‰è£…Dockeré•œåƒæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»DockerHubä¸­æå–é•œåƒï¼š docker pull yanhui09/mac2023_extra ç”¨mambaå®‰è£…å»ºè®®ä½¿ç”¨mambaåœ¨ç‹¬ç«‹ condaç¯å¢ƒä¸­å®‰è£…è½¯ä»¶ã€‚ å‡è®¾æ‚¨å·²ç»åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†mambaè½¯ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨mambaåˆ›å»ºä¸€ä¸ªæ–°condaç¯å¢ƒï¼š è½¬åˆ°ä¸‹è½½çš„æ•°æ®ç›®å½•ã€‚ç¡®ä¿æ‚¨çŸ¥é“è‡ªå·±å½“å‰çš„å·¥ä½œç›®å½•ä½ç½®ã€‚ ä¾‹å¦‚ï¼Œä¸‹è½½çš„æ•°æ®ç›®å½•ä½äº/home/username/MAC2023-extera cd /home/username/MAC2023-exterapwd æ‚¨å°†çœ‹åˆ°ä¸‹è½½çš„æ•°æ®ç›®å½•çš„è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ /home/username/MAC2023-extera ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–°condaç¯å¢ƒå¹¶å®‰è£…è½¯ä»¶ï¼š mamba env create -n wgs1 -f envs/env1.yaml æ¿€æ´»ç¯å¢ƒä»¥è¿›è¡Œä»¥ä¸‹åˆ†æã€‚ conda activate wgs1 ä½¿ç”¨æ¼”ç¤ºæ•°æ®è¿›è¡Œæ¢ç´¢WGS æ•°æ®å¯ä»¥åƒä»¥å‰ä¸€æ ·ä»MAC2023-extraè·å–ã€‚ é¦–å…ˆç”¨seqkitæ¥æŸ¥çœ‹æ•°æ®seqkit stat data/wgs/*.fastq.gz data/wgs/ncbi_pacbio_TL110.fasta é¢„æœŸè¾“å‡ºï¼š file format type num_seqs sum_len min_len avg_len max_lendata/wgs/NXT20x_R1.fastq.gz FASTQ DNA 200,000 30,200,000 151 151 151data/wgs/NXT20x_R2.fastq.gz FASTQ DNA 200,000 30,200,000 151 151 151data/wgs/ont_r10_20x.fastq.gz FASTQ DNA 7,862 51,201,670 129 6,512.6 87,688data/wgs/ncbi_pacbio_TL110.fasta FASTA DNA 1 2,566,312 2,566,312 2,566,312 2,566,312 è¿™æ˜¯æ¥è‡ªè´¹æ°ä¸™é…¸æ†èŒèŒæ ªçš„ä¸€ç»„æµ‹åºæ•°æ®ã€‚æˆ‘ä»¬å¯¹ Illumina å’Œ Oxford Nanopore Technologies (ONT) è¯»æ•°çš„æµ‹åºæ•°æ®è¿›è¡ŒäºŒæ¬¡é‡‡æ ·ï¼Œè¦†ç›–ç‡è¾¾åˆ° 20 å€ã€‚PacBio å‚è€ƒåŸºå› ç»„æ¥è‡ªNCBI RefSeq æ•°æ®åº“ã€‚ Q1ï¼šè¯¥èŒæ ªçš„åŸºå› ç»„å¤§å°æ˜¯å¤šå°‘ï¼Ÿæµ‹åºè¦†ç›–åº¦æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ illuminaï¼š30,200,000*2&#x2F;2,566,312â‰ˆ20 ONTï¼š51,201,670&#x2F;2,566,312â‰ˆ20 æˆ‘ä»¬ç”¨fastqcæ¥çœ‹çœ‹æµ‹åºæ•°æ®çš„è´¨é‡ã€‚ mkdir -p fastqc/illumina fastqc/ont_r10fastqc data/wgs/NXT20x_R*.fastq.gz -o ./fastqc/illuminafastqc data/wgs/ont_r10_20x.fastq.gz -o ./fastqc/ont_r10 æ‚¨å¯ä»¥æ‰“å¼€.htmlè¯¥fastqcç›®å½•ä¸‹çš„æ–‡ä»¶æ¥æŸ¥çœ‹æµ‹åºæ•°æ®çš„è´¨é‡ã€‚ ONT Illumina æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ONT è¯»å–æ¯” Illumina è¯»å–æ›´é•¿ï¼Œä½†åŒ…å«æ›´å¤šé”™è¯¯ã€‚ ä½¿ç”¨ Illumina æ•°æ®è¿›è¡ŒåŸºå› ç»„ç»„è£…trimmomaticå»é™¤æ¥å¤´trimmomaticæ˜¯ä¸€ä¸ªç”¨äºç§»é™¤æ¥å¤´å’Œä½è´¨é‡æ•°æ®çš„å·¥å…·ã€‚[é˜…è¯»æ›´å¤š] ä½¿ç”¨Nexteraæ–‡åº“åˆ¶å¤‡è¯•å‰‚ç›’ä»NextSeqå¹³å°æ”¶é›† Illumina è¯»æ•°ã€‚ mkdir illuminatrimmomatic PE -threads 4 -phred33 data/wgs/NXT20x_R1.fastq.gz data/wgs/NXT20x_R2.fastq.gz illumina/NXT20x_R1_paired.fastq.gz illumina/NXT20x_R1_unpaired.fastq.gz illumina/NXT20x_R2_paired.fastq.gz illumina/NXT20x_R2_unpaired.fastq.gz ILLUMINACLIP:data/wgs/NexteraPE-PE.fa:2:30:10 LEADING:3 TRAILING:3 MINLEN:50 é¢„æœŸè¾“å‡ºï¼š illumina/NXT20x_R1_paired.fastq.gzillumina/NXT20x_R1_unpaired.fastq.gzillumina/NXT20x_R2_paired.fastq.gzillumina/NXT20x_R2_unpaired.fastq.gz æ•°æ®è´¨é‡æ§åˆ¶bbmapbbmapæ˜¯ä¸€å¥—ç”¨äºæµ‹åºè¯»æ•°è´¨é‡æ§åˆ¶çš„å·¥å…·ã€‚å®ƒå¯ç”¨äºåˆ é™¤å†—ä½™æ•°æ®å’Œ PhiX å¯¹ç…§ã€‚[é˜…è¯»æ›´å¤š] clumpify.shæ˜¯ä¸€ä¸ªåˆ é™¤å†—ä½™æ•°æ®çš„å·¥å…·ã€‚[é˜…è¯»æ›´å¤š] bbduk.shæ˜¯ä¸€ç§å»é™¤æ±¡æŸ“æ•°æ®çš„å·¥å…·ï¼ˆä¾‹å¦‚ï¼Œå®¿ä¸»åŸºå› ç»„ã€PhiX å¯¹ç…§ï¼‰ã€‚[é˜…è¯»æ›´å¤š] #clumpifyclumpify.sh in=illumina/NXT20x_R1_paired.fastq.gz in2=illumina/NXT20x_R2_paired.fastq.gz out=illumina/NXT20x_R1_paired_dedup.fastq.gz out2=illumina/NXT20x_R2_paired_dedup.fastq.gz dedupe optical spany adjacent# bbdukbbduk.sh in=illumina/NXT20x_R1_paired_dedup.fastq.gz in2=illumina/NXT20x_R2_paired_dedup.fastq.gz out=illumina/NXT20x_R1_paired_dedup_deduk.fastq.gz out2=illumina/NXT20x_R2_paired_dedup_deduk.fastq.gz ref=data/wgs/phiX174.fasta k=31 hdist=1 é¢„æœŸè¾“å‡ºï¼š illumina/NXT20x_R1_paired_dedup.fastq.gzillumina/NXT20x_R1_paired_dedup_deduk.fastq.gzillumina/NXT20x_R2_paired_dedup.fastq.gzillumina/NXT20x_R2_paired_dedup_deduk.fastq.gz åŸºå› ç»„ç»„è£…spadesspadesæ˜¯ä¸€ä¸ªç”¨äºçŸ­è¯»é•¿çš„åŸºå› ç»„ç»„è£…å™¨ã€‚[é˜…è¯»æ›´å¤š] spades.py --isolate -t 4 -1 illumina/NXT20x_R1_paired_dedup_deduk.fastq.gz -2 illumina/NXT20x_R2_paired_dedup_deduk.fastq.gz -o illumina/spades é¢„è®¡ç»„è£…ï¼š illumina/spades/contigs.fasta Q2ï¼šæˆ‘ä»¬åœ¨è¿™é‡Œä»åˆ†ç¦»æ ªä¸­ç»„è£…äº†ç»†èŒåŸºå› ç»„ã€‚å¦‚æœæˆ‘ä»¬æœ‰å®åŸºå› ç»„æ ·æœ¬æ€ä¹ˆåŠï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨--metaé€‰é¡¹åœ¨spadesä¸­æ¥ç»„è£…å®åŸºå› ç»„æ ·æœ¬ã€‚[é˜…è¯»æ›´å¤š] ä½¿ç”¨ ONT æ•°æ®è¿›è¡ŒåŸºå› ç»„ç»„è£…ä½¿ç”¨guppyï¼ˆå¯é€‰ï¼‰æˆ–è€…porechopç§»é™¤æ¥å¤´ æœ¬ç»ƒä¹ ä¸­æœªæä¾›guppyå’Œporechopçš„å®‰è£…å¦‚æœæ‚¨æƒ³ä½¿ç”¨å®ƒä»¬ï¼Œè¯·å°è¯•è‡ªè¡Œå®‰è£…ã€‚ guppyæ˜¯ä¸€ç§ç”¨äº ONT æ•°æ®çš„ç¢±åŸºè¯†åˆ«å’Œæ¥å¤´ä¿®å‰ªçš„å·¥å…·ã€‚guppyä¸æ˜¯å¼€æºçš„ï¼Œå› æ­¤éœ€è¦æ³¨å†ŒONTå¸æˆ·æ‰èƒ½æŸ¥çœ‹å…¶æ–‡æ¡£å’Œä¸‹è½½ã€‚[é˜…è¯»æ›´å¤š] porechopæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œç”¨äº ONT æ•°æ®çš„æ¥å¤´ä¿®å‰ªã€‚[é˜…è¯»æ›´å¤š] é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡å½¢ç å°†åœ¨guppyå¤šè·¯åˆ†è§£æ­¥éª¤ä¸­è¢«ä¿®å‰ªã€‚æˆ‘ä»¬ä¸ä¼šå¯¹æˆ‘ä»¬çš„æ•°æ®é‡å¤è¿›è¡Œæ¡å½¢ç ä¿®å‰ªã€‚ å¦‚æœæ‚¨æƒ³ä¿®å‰ªæ¡å½¢ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤guppyã€‚ guppy_barcoder -i data/wgs/ont_r10_20x.fastq.gz -s ont_r10/ont_r10_20x_barcoded.fastq.gz --barcode_kits EXP-NBD104 --trim_barcodes ä»¥åŠä»¥ä¸‹å‘½ä»¤porechopã€‚ porechop -i data/wgs/ont_r10_20x.fastq.gz -o ont_r10/ont_r10_20x_porechop.fastq.gz --threads 4 seqkitè¯»å–è´¨é‡æ§åˆ¶seqkitæ˜¯ä¸€ç§ç”¨äºæ“ä½œæµ‹åºæ•°æ®çš„å·¥å…·ã€‚[é˜…è¯»æ›´å¤š]è¿™é‡Œæˆ‘ä»¬ç”¨æ¥seqkitå»é™¤çŸ­è¯»å’Œä½è´¨é‡æ•°æ®ã€‚ mkdir ont_r10seqkit seq -j 4 -Q 10 -m 2000 -i data/wgs/ont_r10_20x.fastq.gz -o ont_r10/ont_r10_20x_f.fastq.gz ä½¿ç”¨seqkit statæ¥æ£€æŸ¥è´¨é‡æ§åˆ¶ä¹‹å‰å’Œä¹‹åçš„ ONT è¯»æ•°ã€‚ seqkit stat data/wgs/ont_r10_20x.fastq.gz ont_r10/ont_r10_20x_f.fastq.gz é¢„æœŸè¾“å‡ºï¼š file format type num_seqs sum_len min_len avg_len max_lendata/wgs/ont_r10_20x.fastq.gz FASTQ DNA 7,862 51,201,670 129 6,512.6 87,688ont_r10/ont_r10_20x_f.fastq.gz FASTQ DNA 6,561 48,742,515 2,001 7,429.1 87,688 flyeåŸºå› ç»„ç»„è£…flyeæ˜¯ ONT æ¨èçš„é•¿è¯»åŸºå› ç»„ç»„è£…å™¨ã€‚[é˜…è¯»æ›´å¤š] flye --nano-raw ont_r10/ont_r10_20x_f.fastq.gz --out-dir ont_r10/flye --threads 4 é¢„æœŸçš„ç»„è£…è¾“å‡ºï¼š ont_r10/flye/assembly.fasta Q3ï¼šé»˜è®¤flyeç”¨äºç»„è£…åŸºå› ç»„ã€‚å¦‚æœæˆ‘ä»¬æœ‰å®åŸºå› ç»„æ ·æœ¬æ€ä¹ˆåŠï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨--metaé€‰é¡¹æ¥åœ¨flyeä¸­ç»„è£…å®åŸºå› ç»„æ ·æœ¬ã€‚[é˜…è¯»æ›´å¤š] ä½¿ç”¨raconä¸medakaè¿›è¡ŒåŸºå› ç»„çŸ«æ­£é•¿è¯»é•¿åŸºå› ç»„ç»„è£…ç¨‹åºé€šå¸¸ä¼šäº§ç”Ÿè¿ç»­æ€§é«˜ä½†å‡†ç¡®æ€§ä½çš„åŸºå› ç»„è‰å›¾ã€‚éœ€è¦é¢å¤–çš„çŸ«æ­£æ­¥éª¤æ¥æé«˜åŸºå› ç»„è‰å›¾çš„å‡†ç¡®æ€§ã€‚ä½†æœ€ä½³çš„çŸ«æ­£ç­–ç•¥å’Œå·¥å…·ä»åœ¨äº‰è®ºä¸­ã€‚ raconæ˜¯ä¸€ç§åŸºäºå›¾çš„ç›¸ä¼¼åº¦ç®—æ³•ï¼Œç”¨äºå®Œå–„é•¿è¯»é•¿åŸºå› ç»„ç»„è£…ã€‚[é˜…è¯»æ›´å¤š]ã€‚ medakaæ˜¯å®˜æ–¹ä¸ºONTæ•°æ®æ‰“é€ çš„åŸºäºç¥ç»ç½‘ç»œçš„æ•°æ®çŸ«æ­£å·¥å…·ã€‚[é˜…è¯»æ›´å¤š] æœ€è¿‘ï¼ŒONT æ¨èç”¨medakaç›´æ¥çŸ«æ­£flyeç»„è£…åçš„æ•°æ®ã€‚ä½†ç»“åˆraconå’Œmedakaä»ç„¶æ˜¯ä¸€ç§å¸¸è§çš„åšæ³•ã€‚ è¿™é‡Œæˆ‘ä»¬ä»¥medakaåœ¨ä¾‹å­ï¼š ç”±äºmedakaæ˜¯åŸºäºç¥ç»ç½‘ç»œçš„ï¼Œé€‰æ‹©åˆé€‚çš„æ¨¡å‹ä¼šå½±å“æŠ›å…‰æ•ˆæœã€‚æ‚¨å¯ä»¥ç”¨æ¥medaka tools list_modelsåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ¨¡å‹ã€‚å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼ŒONT è¯»æ•°æ˜¯ä»R10.4.1 flowcellæ”¶é›†çš„ï¼Œå¹¶ä¸”guppyé‡‡ç”¨hacæ¨¡å¼æ¥åšç¢±åŸºç”Ÿæˆã€‚ medaka tools list_modelsmedaka_consensus -i ont_r10/ont_r10_20x_f.fastq.gz -d ont_r10/flye/assembly.fasta -o ont_r10/medaka -t 4 -m r1041_e82_260bps_hac_v4.1.0 é¢„æœŸç»“æœï¼š ont_r10/medaka/consensus.fasta raconå’Œmedakaæ··åˆæ¨¡å¼ mkdir ont_r10/raconminimap2 -t 4 -x map-ont ont_r10/flye/assembly.fasta ont_r10/ont_r10_20x_f.fastq.gz &gt; ont_r10/racon/flye_assembly.pafracon -t 4 ont_r10/ont_r10_20x_f.fastq.gz ont_r10/racon/flye_assembly.paf ont_r10/flye/assembly.fasta &gt; ont_r10/racon/racon.fastamedaka_consensus -i ont_r10/ont_r10_20x_f.fastq.gz -d ont_r10/racon/racon.fasta -o ont_r10/racon/medaka -t 4 -m r1041_e82_260bps_hac_v4.1.0 é¢„æœŸçš„ç»“æœï¼š ont_r10/racon/racon.fastaont_r10/racon/medaka/consensus.fasta ONT å’Œ Illumina è¯»å–çš„æ··åˆç»„è£…æ··åˆç»„è£…æ˜¯ç»“åˆä¸åŒæµ‹åºæŠ€æœ¯ä¼˜åŠ¿çš„å¸¸è§åšæ³•ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸¤ç§å¸¸ç”¨çš„æ··åˆç»„è£…ç­–ç•¥ï¼š pilonï¼šç›´æ¥ä½¿ç”¨ ONT ç»„è£…ä½œä¸ºä¸»å¹²ï¼Œå¹¶ç”¨ Illumina è¯»å–å¯¹å…¶è¿›è¡ŒçŸ«æ­£ã€‚ unicyclerï¼šçŸ­è¯»ä¼˜å…ˆæ··åˆç»„è£…ã€‚ pilonILLUMINA è¯»å–çŸ«æ­£pilonæ˜¯ä¸€ç§ç”¨çŸ­è¯»é•¿ä¼˜åŒ–åŸºå› ç»„ç»„è£…çš„å·¥å…·ã€‚[é˜…è¯»æ›´å¤š] mkdir -p hybrid/pilonbwa index ont_r10/medaka/consensus.fastabwa mem -t 4 ont_r10/medaka/consensus.fasta illumina/NXT20x_R1_paired_dedup_deduk.fastq.gz illumina/NXT20x_R2_paired_dedup_deduk.fastq.gz | samtools sort -@ 4 -o hybrid/pilon/aligned.bamsamtools index hybrid/pilon/aligned.bampilon --genome ont_r10/medaka/consensus.fasta --frags hybrid/pilon/aligned.bam --output hybrid/pilon/pilon --threads 4 é¢„æœŸäº§å‡ºï¼š hybrid/pilon/pilon.fasta å¯é€‰ï¼šunicycleræ··åˆç»„è£…unicyclerå¯ä»¥è¿›è¡ŒçŸ­è¯»ä¼˜å…ˆæ··åˆç»„è£…ã€‚[é˜…è¯»æ›´å¤š] è¿™éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨ç¤ºä¾‹ä¸­è·³è¿‡è¿™ä¸€æ­¥ã€‚å®Œæˆå…¶ä»–æ­¥éª¤åï¼Œè¯·éšæ—¶è¿”å›æ­¤æ­¥éª¤ã€‚ Linuxç”¨æˆ· unicycler -l ont_r10/ont_r10_20x_f.fastq.gz -1 illumina/NXT20x_R1_paired_dedup_deduk.fastq.gz -2 illumina/NXT20x_R2_paired_dedup_deduk.fastq.gz -o hybrid/unicycler --threads 4 MacOS ç”¨æˆ· ç”±äºonçš„æœ€æ–°MacOSç‰ˆæœ¬è½åäº0.5.0ï¼Œæˆ‘ä»¬é™„åŠ ä¸¤ä¸ªæ ‡å¿—å’Œæ¥ä¿æŒæœ€å¤§çš„å…¼å®¹æ€§ã€‚unicyclerconda--no_correct--no_pilon unicycler --no_correct --no_pilon -l ont_r10/ont_r10_20x_f.fastq.gz -1 illumina/NXT20x_R1_paired_dedup_deduk.fastq.gz -2 illumina/NXT20x_R2_paired_dedup_deduk.fastq.gz -o hybrid/unicycler é¢„æœŸçš„äº§å‡ºï¼š hybrid/unicycler/assembly.fasta ä½¿ç”¨quastå¯¹ç»„è£…åŸºå› ç»„è¿›è¡Œè´¨é‡è¯„ä¼°æˆ‘ä»¬å·²ç»ç”Ÿæˆäº†è®¸å¤šå…·æœ‰ä¸åŒç­–ç•¥çš„ç¨‹åºé›†ã€‚è®©æˆ‘ä»¬ä½¿ç”¨åŸºäºPacBioæ·±åº¦æµ‹åºçš„å®Œæ•´ç»„è£…ä½œä¸ºå‚è€ƒåŸºå› ç»„æ¥è¯„ä¼°æ¯ä¸ªæ•°æ®é›†çš„è´¨é‡ã€‚å¦‚æœæ‚¨å°šæœªå®Œæˆæ‰€æœ‰ç»„è£…æ­¥éª¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨./data/wgs/assembliesæä¾›çš„ç»„è£…æ–‡ä»¶ã€‚ seqkit stat data/wgs/assemblies/*.fasta data/wgs/ncbi_pacbio_TL110.fasta é¢„æœŸè¾“å‡ºï¼š file format type num_seqs sum_len min_len avg_len max_lendata/wgs/assemblies/hybrid_pilon.fasta FASTA DNA 2 2,579,926 29,242 1,289,963 2,550,684data/wgs/assemblies/hybrid_pilon_proovframe.fasta FASTA DNA 2 2,579,979 29,245 1,289,989.5 2,550,734data/wgs/assemblies/hybrid_unicycler.fasta FASTA DNA 1 2,564,177 2,564,177 2,564,177 2,564,177data/wgs/assemblies/illumina.fasta FASTA DNA 217 2,527,918 78 11,649.4 60,978data/wgs/assemblies/ont_flye.fasta FASTA DNA 2 2,579,333 29,239 1,289,666.5 2,550,094data/wgs/assemblies/ont_flye_medaka.fasta FASTA DNA 2 2,579,052 29,238 1,289,526 2,549,814data/wgs/assemblies/ont_flye_racon.fasta FASTA DNA 2 2,578,932 29,231 1,289,466 2,549,701data/wgs/assemblies/ont_flye_racon_medaka.fasta FASTA DNA 2 2,578,566 29,229 1,289,283 2,549,337data/wgs/ncbi_pacbio_TL110.fasta FASTA DNA 1 2,566,312 2,566,312 2,566,312 2,566,312 ä¸å‚è€ƒç›¸æ¯”ï¼Œå„ä¸ªç»„è£…çš„æ€»é•¿åº¦ç›¸ä¼¼ã€‚ ä½†åºåˆ—æ•° ( num_seqs) å’Œæœ€å¤§åºåˆ—é•¿åº¦ ( max_len) å˜åŒ–å¾ˆå¤§ã€‚ è®©æˆ‘ä»¬ç”¨quastæ¥æ£€æŸ¥å„ä¸ªç»„è£…çš„è´¨é‡ã€‚ quast data/wgs/assemblies/*.fasta -r data/wgs/ncbi_pacbio_TL110.fasta -o quast æ‚¨å¯ä»¥æ‰“å¼€quastç›®å½•ä¸­çš„report.htmlæ–‡ä»¶æ¥æŸ¥çœ‹å„ä¸ªç»„è£…æ•°æ®é›†çš„è´¨é‡ã€‚ Q4ï¼šæ ¹æ®ç¤ºä¾‹ï¼Œæ‚¨è®¤ä¸ºå“ªç§æµ‹åºæŠ€æœ¯åœ¨åŸºå› ç»„å®Œæ•´æ€§å’Œè¿ç»­æ€§æ–¹é¢æ•ˆæœæ›´å¥½ï¼Ÿ æ£€æŸ¥Genome fractionå’ŒNGA50 Q5ï¼šæ ¹æ®ç¤ºä¾‹ï¼Œæ‚¨è®¤ä¸ºå“ªç§è£…é…çš„ç²¾åº¦æœ€å¥½ï¼Ÿ æ£€æŸ¥Misassemblieså’ŒMismatches Q6ï¼šæ ¹æ®ç¤ºä¾‹ï¼ŒONT ç»„ä»¶ä¸­çš„ä¸»è¦é”™è¯¯ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ æ£€æŸ¥mismatcheså’Œindelsã€‚[é˜…è¯»æ›´å¤š] Q7ï¼šæ‚¨è®¤ä¸ºæ­¤ç¤ºä¾‹çš„æœ€ä½³ç»„è£…ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ å¯é€‰ï¼šå‚è€ƒå¼•å¯¼æ ¡æ­£proovframeé«˜é¢‘ç‡indelsä¼šå¯¼è‡´ ONT ç»„è£…çš„ç¼–ç åºåˆ— (CDS) å‘ç”Ÿç§»ç ã€‚é€šè¿‡å‚è€ƒå¼•å¯¼æ ¡æ­£ï¼Œæˆ‘ä»¬å¯ä»¥æ ¡æ­£ ONT ç»„è£…çš„ CDS ä¸­çš„ç§»ç ã€‚ æ­¤æ­¥éª¤æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ—¶é—´ï¼Œå¯ä»¥è·³è¿‡å®ƒã€‚ ä¸ºäº†ä½¿ç”¨è¯¥å·¥å…·ï¼Œç”±äºä¾èµ–å†²çªï¼Œproovframeæˆ‘ä»¬éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªcondaç¯å¢ƒã€‚ conda deactivatemamba env create -n wgs2 -f envs/env2.yamlconda activate wgs2 åŸºå› ç»„æ³¨é‡Šprokkaprokkaæ˜¯å¿«é€Ÿæ³¨é‡Šç»†èŒåŸºå› ç»„çš„å¸¸ç”¨å·¥å…·ã€‚[é˜…è¯»æ›´å¤š] mkdir proovframeconda activate wgs2prokka --outdir proovframe/prokka --prefix pacbio --cpus 4 data/wgs/ncbi_pacbio_TL110.fasta é¢„æœŸè¾“å‡ºï¼š proovframe/prokka/pacbio.errproovframe/prokka/pacbio.faaproovframe/prokka/pacbio.ffnproovframe/prokka/pacbio.fnaproovframe/prokka/pacbio.fsaproovframe/prokka/pacbio.gbkproovframe/prokka/pacbio.gffproovframe/prokka/pacbio.logproovframe/prokka/pacbio.sqnproovframe/prokka/pacbio.tblproovframe/prokka/pacbio.tsvproovframe/prokka/pacbio.txt æˆ‘ä»¬æœ‰è®¸å¤šæ¥è‡ªprokkaçš„è¾“å‡ºæ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬ä»…ä½¿ç”¨ç¿»è¯‘åçš„è›‹ç™½è´¨åºåˆ—ï¼ˆ./proovframe/prokka/pacbio.faaæ–‡ä»¶ï¼‰ ç§»ç æ ¡æ­£proovframe proovframeæ˜¯ CDS ä¸­åŸºäºå‚è€ƒåºåˆ—çš„ç§»ç æ ¡æ­£å·¥å…·ã€‚[é˜…è¯»æ›´å¤š] proovframe map -a proovframe/prokka/pacbio.faa -o proovframe/pilon.tsv hybrid/pilon/pilon.fastaproovframe fix -o proovframe/pilon_corrected.fasta hybrid/pilon/pilon.fasta proovframe/pilon.tsv é¢„æœŸçš„è¾“å‡ºï¼š proovframe/pilon_corrected.fasta Q8ï¼šåœ¨ä¹‹å‰çš„æŠ¥å‘Šä¸­ï¼Œshybrid_pilon_proovframe.fastaä¸­çš„N&#39;ä¼šå¢åŠ ã€‚ä½ è§‰å¾—è¿™æ˜¯å¥½æ˜¯åï¼Ÿ æœ¬æ–‡ä¸ºå­¦ä¹ è®°å½•ï¼Œè¯¾ç¨‹ä½œè€…ä¸ºï¼šYanHui","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"author":"Xiaoguang Pan"},{"title":"ä½¿ç”¨NARTé€šè¿‡è¯»å–åˆ†ç±»è¿›è¡Œé•¿æ‰©å¢å­åˆ†æ","slug":"ä½¿ç”¨NARTé€šè¿‡è¯»å–åˆ†ç±»è¿›è¡Œé•¿æ‰©å¢å­åˆ†æ","date":"2024-09-20T05:11:35.000Z","updated":"2024-10-18T05:32:57.411Z","comments":true,"path":"nart-16s-long/","permalink":"https://xiaohanys.top/nart-16s-long/","excerpt":"NARTè®¾è®¡ç”¨äºåŸºäºå›¾è°±çš„çº³ç±³å­”æ‰©å¢å­ï¼ˆå®æ—¶ï¼‰åˆ†æï¼Œä¾‹å¦‚ 16S rRNA åŸºå› ã€‚NARTç”±NARTï¼ˆNanopore Amplicon Real-Time entryï¼‰å’Œ NAWFï¼ˆNanopore Amplicon snakemake WorkFlow entryï¼‰ç»„æˆã€‚é€šè¿‡åŸºäºæ˜ å°„çš„ç­–ç•¥æä¾›ä»åŸºç¡€è°ƒç”¨è¯»å–åˆ°æœ€ç»ˆè®¡æ•°çŸ©é˜µçš„ï¼ˆå®æ—¶ï¼‰ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆã€‚","text":"NARTè®¾è®¡ç”¨äºåŸºäºå›¾è°±çš„çº³ç±³å­”æ‰©å¢å­ï¼ˆå®æ—¶ï¼‰åˆ†æï¼Œä¾‹å¦‚ 16S rRNA åŸºå› ã€‚NARTç”±NARTï¼ˆNanopore Amplicon Real-Time entryï¼‰å’Œ NAWFï¼ˆNanopore Amplicon snakemake WorkFlow entryï¼‰ç»„æˆã€‚é€šè¿‡åŸºäºæ˜ å°„çš„ç­–ç•¥æä¾›ä»åŸºç¡€è°ƒç”¨è¯»å–åˆ°æœ€ç»ˆè®¡æ•°çŸ©é˜µçš„ï¼ˆå®æ—¶ï¼‰ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆã€‚ nawfæä¾›ä¸‰ä¸ªé€‰é¡¹ï¼ˆemuï¼Œminimap2lcaå’Œblast2lcaï¼‰æ¥ç¡®å®šå¾®ç”Ÿç‰©ç»„æˆã€‚ NARTå®‰è£…å®Œæ•´çš„å®‰è£…æŒ‡å—NARTå¯åœ¨æ­¤å¤„è·å–ã€‚ æ‚¨å¯ä»¥æ ¹æ®æ‚¨çš„å–œå¥½é€‰æ‹©NARTä½¿ç”¨dockeræ˜ åƒå®‰è£…ï¼ˆè¿™åªæ˜¯MacOSç”¨æˆ·çš„è§£å†³æ–¹æ¡ˆï¼‰æˆ–ä»GitHubå­˜å‚¨åº“å®‰è£…ã€‚ Dockeré•œåƒæœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä»Docker Hubæ‹‰å–NARTé•œåƒä»¥è·å¾—è·¨å¹³å°æ”¯æŒã€‚ docker pull yanhui09/nart NARTæ˜¯é€šè¿‡dockerä¸ºlinux/amd64å¹³å°è€Œæ„å»ºçš„ï¼Œ MacOSç”¨æˆ·éœ€è¦ä½¿ç”¨dockerå®¹å™¨æ¥è¿è¡ŒNARTã€‚ ä» GitHub å­˜å‚¨åº“å®‰è£…1.å…‹éš†Githubä»“åº“å¹¶åˆ›å»ºéš”ç¦»condaç¯å¢ƒ git clone https://github.com/yanhui09/nart.gitcd nartmamba env create -n nart -f env.yaml 2.å®‰è£…NART ä¸ºäº†é¿å…ä¸ä¸€è‡´ï¼Œå»ºè®®NARTåœ¨ä¸Šè¿°condaç¯å¢ƒä¸­å®‰è£… conda activate nartpip install --editable . ä½¿ç”¨NARTè¿è¡Œçš„æ¼”ç¤ºåœ¨è¿™é‡Œæ‰¾åˆ°å®Œæ•´çš„ä½¿ç”¨æŒ‡å—ã€‚ å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°è§†é¢‘æ•™ç¨‹ã€‚ å¿«é€Ÿå¯åŠ¨ç¤ºä¾‹å•æ‰¹æ¬¡æ‰©å¢å­åˆ†ænawfå¯ç”¨äºåˆ†æNanopore è¿è¡Œæˆ–æ‰¹æ¬¡ä¸­çš„ä»»ä½•å•ä¸ªç¢±åŸºè°ƒç”¨æ–‡ä»¶ã€‚ nawf config -b /path/to/basecall_fastq -d /path/to/database # init config file and checknawf run all # start analysis å®æ—¶åˆ†ænartæä¾›å®ç”¨ç¨‹åºæ¥è®°å½•ã€å¤„ç†å’Œåˆ†æè¿ç»­ç”Ÿæˆçš„fastqæ‰¹æ¬¡ã€‚ åœ¨å¼€å§‹å®æ—¶åˆ†æä¹‹å‰ï¼Œæ‚¨éœ€è¦nawfæ ¹æ®éœ€è¦é…ç½®å·¥ä½œæµç¨‹ã€‚ nawf config -d /path/to/database # init config file and check åœ¨å¸¸è§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ä¸‰ä¸ªç‹¬ç«‹çš„ä¼šè¯æ¥åˆ†åˆ«å¤„ç†ç›‘æ§ã€å¤„ç†å’Œå¯è§†åŒ–ã€‚ 1.ç›‘å¬ bascall è¾“å‡ºå¹¶è®°å½• nart monitor -q /path/to/basecall_fastq_dir # monitor basecall output 2.å¼€å§‹æ–°çš„ fastq çš„æ‰©å¢å­åˆ†æ nart run -t 10 # real-time process in batches 3.æ›´æ–°ç‰¹å¾è¡¨ä»¥åœ¨æµè§ˆå™¨ä¸­äº¤äº’å¼å¯è§†åŒ– nart visual # interactive visualization ç†Ÿæ‚‰NARTä½¿ç”¨NARTç”±ä¸¤ç»„è„šæœ¬ç»„æˆï¼šnartå’Œnawfï¼Œåˆ†åˆ«æ§åˆ¶å®æ—¶åˆ†æå’Œå·¥ä½œæµæ€§èƒ½ã€‚ å¦‚æœNARTå®‰è£…åœ¨condaç¯å¢ƒä¸­ï¼Œè¯·è®°ä½æ¿€æ´»ç¯å¢ƒcondaã€‚ conda activate nartnawf -hnart -h è¦ä½¿ç”¨ docker é•œåƒï¼Œæ‚¨éœ€è¦å°†æ•°æ®ç›®å½•ï¼ˆä¾‹å¦‚pwd ï¼‰æŒ‚è½½åˆ°å®¹å™¨ä¸­/homeç›®å½•ã€‚ docker run -it -v `pwd`:/home --network host --privileged yanhui09/nartnawf -hnart -h æ³¨æ„ï¼š--network hostéœ€è¦nart monitoræ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ ä½¿ç”¨æ¼”ç¤ºæ•°æ®é›†è¿è¡ŒNART0.ç¡®ä¿æ‚¨å·²ä»æ­¤å¤„ä¸‹è½½æ‰€éœ€çš„æ¼”ç¤ºæ•°æ®é›†ã€‚ç„¶åè¿›å…¥ç›®å½•cdã€‚ ä¾‹å¦‚ï¼Œè¾“å…¥ç»å¯¹è·¯å¾„ï¼ˆâ€œé•¿è·¯å¾„â€ï¼‰çš„ç›®å½•æ˜¯/home/me/MAC2023-extraã€‚ cd /home/me/MAC2023-extra å¦‚æœæ‚¨å°šæœªä¸‹è½½ä½¿ç”¨Gitä¸‹è½½æ•°æ®ï¼Œ git clone https://github.com/yanhui09/MAC2023-extra.gitcd ./MAC2023-extra nawfåˆ†æå·²å®Œæˆçš„ ONT1.1. æ£€æŸ¥æ‚¨æ‰€åœ¨çš„ä½ç½®å¹¶å°è¯•laca initæ£€æŸ¥ç”Ÿæˆçš„config.yamlæ–‡ä»¶ã€‚ pwdnawf config -b ./data/ont16s/*.fastq.gz -d ./database -w ./nart_outputcat ./nart_output/config.yaml 1.2.å¼€å§‹nawfè¯•è¿è¡Œ nawf run all -w ./nart_output -n 2. å®æ—¶åˆ†ænart2.1. é‡æ–°ç”Ÿæˆconfig.yamlä¸å¸¦-bæ ‡å¿—çš„æ–‡ä»¶ rm -rf ./nart_outputnawf config -d ./database -w ./nart_outputhead ./nart_output/config.yaml basecall_fqæ£€æŸ¥æ–‡ä»¶ä¸­çš„æ›´æ”¹config.yamlã€‚ 2.2. ç›‘æ§ bascalling è¾“å‡ºå¹¶è®°å½• nart monitor -q ./data/ont16s -w ./nart_output nart monitoråœ¨å·¥ä½œç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªfqs.txtæ¥è®°å½•å³å°†åˆ°æ¥çš„fastqæ–‡ä»¶ã€‚ 2.3. å¼€å§‹æ‰©å¢å­åˆ†æï¼ˆéœ€è¦æ–°ç»ˆç«¯ï¼‰ nart run -t 4 -w ./nart_output åœ¨æ–°ç»ˆç«¯ä¸­ï¼Œæ£€æŸ¥ä»¥ä¸‹æ“ä½œnart monitor ls ./nart_outputcat ./nart_output/fqs.txtcp ./data/ont16s/*.fastq.gz ./data/ont16s/new.fastq.gzcat ./nart_output/fqs.txt æ£€æŸ¥æ–‡ä»¶å†…å®¹fqs.txtçš„å˜åŒ–ã€‚ nart runå°†ç‰¹å®šäºæ‰¹æ¬¡çš„è®¡æ•°çŸ©é˜µå­˜å‚¨åœ¨æ–‡ä»¶å¤¹batchesä¸‹ã€‚å½“åˆ›å»ºæ–°çŸ©é˜µæ—¶ï¼Œåˆå¹¶è¡¨ ( otu_table.tsv) ä¼šè¿­ä»£æ›´æ–°ã€‚ å½“æ‚¨åœ¨è¾“å‡ºæ–‡ä»¶å¤¹ä¸­çœ‹åˆ°ä¸€ä¸ªotu_table.tsvï¼Œä¾‹å¦‚nart_output/ï¼Œæ‚¨å¯ä»¥å°è¯•ä¸‹é¢çš„äº¤äº’å¼å¯è§†åŒ–ã€‚ 2.4. æµè§ˆå™¨ä¸­çš„äº¤äº’å¼å¯è§†åŒ–ï¼ˆéœ€è¦æ–°ç»ˆç«¯ï¼‰ nart visual -i ./nart_output åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç”Ÿæˆçš„é“¾æ¥ã€‚æ‚¨é¢„è®¡ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„äº¤äº’å¼æ¡å½¢å›¾ã€‚ MacOSç”¨æˆ·æ— æ³•é€šè¿‡dockerä½“éªŒnart visualã€‚:( ä¸»æœºç½‘ç»œé©±åŠ¨ç¨‹åºä»…é€‚ç”¨äº Linux ä¸»æœºï¼Œåœ¨ Docker Desktop for Macã€Docker Desktop for Windows æˆ– Docker EE for Windows Server ä¸Šä¸å—æ”¯æŒã€‚[é˜…è¯»æ›´å¤š] æœ¬æ–‡ä¸ºæ•™ç¨‹æ•´ç†ï¼ŒåŸä½œè€…ä¸ºYanHui","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"author":"Xiaoguang Pan"},{"title":"ä½¿ç”¨LACAä»é•¿æ‰©å¢å­ä¸­ä»å¤´æŒ‘é€‰OTU","slug":"ä½¿ç”¨LACAä»é•¿æ‰©å¢å­ä¸­ä»å¤´æŒ‘é€‰OTU","date":"2024-09-20T05:10:53.000Z","updated":"2024-10-18T05:32:50.996Z","comments":true,"path":"laca-16s-long/","permalink":"https://xiaohanys.top/laca-16s-long/","excerpt":"LACAæ˜¯ç”¨äºé•¿æ‰©å¢å­ä¸€è‡´æ€§åˆ†æï¼ˆä¾‹å¦‚ 16S rRNA åŸºå› æ‰©å¢å­åˆ†æï¼‰çš„å¯é‡å¤ä¸”å¯æ‰©å±•çš„å·¥ä½œæµç¨‹ã€‚å®ƒä½¿ç”¨ç”¨snakemakeç®¡ç†å·¥ä½œæµç¨‹ä»¥åŠcondaæ¥ç®¡ç†ç¯å¢ƒã€‚","text":"LACAæ˜¯ç”¨äºé•¿æ‰©å¢å­ä¸€è‡´æ€§åˆ†æï¼ˆä¾‹å¦‚ 16S rRNA åŸºå› æ‰©å¢å­åˆ†æï¼‰çš„å¯é‡å¤ä¸”å¯æ‰©å±•çš„å·¥ä½œæµç¨‹ã€‚å®ƒä½¿ç”¨ç”¨snakemakeç®¡ç†å·¥ä½œæµç¨‹ä»¥åŠcondaæ¥ç®¡ç†ç¯å¢ƒã€‚ LACAçš„å®‰è£…å®Œæ•´çš„å®‰è£…æŒ‡å—LACAå¯åœ¨æ­¤å¤„è·å–ã€‚ æ‚¨å¯ä»¥æ ¹æ®æ‚¨çš„å–œå¥½é€‰æ‹©ä½¿ç”¨dockeræˆ–ä»GitHubå­˜å‚¨åº“å®‰è£…LACA Dockeré•œåƒæœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä»Docker Hubæ‹‰å–LACAé•œåƒä»¥è·å¾—è·¨å¹³å°æ”¯æŒ docker pull yanhui09/laca LACAæ˜¯é€šè¿‡dockerä¸ºlinux/amd64å¹³å°è€Œæ„å»ºçš„ï¼Œ MacOSç”¨æˆ·éœ€è¦ä½¿ç”¨dockerå®¹å™¨æ¥è¿è¡ŒLACAã€‚ ä» GitHub å­˜å‚¨åº“å®‰è£…1.å…‹éš†Githubä»“åº“å¹¶åˆ›å»ºéš”ç¦»condaç¯å¢ƒ git clone https://github.com/yanhui09/laca.gitcd lacamamba env create -n laca -f env.yaml 2.å®‰è£…LACA ä¸ºäº†é¿å…ä¸ä¸€è‡´ï¼Œå»ºè®®åœ¨ä¸Šé¢å»ºç«‹çš„condaç¯å¢ƒä¸­å®‰è£…LACA conda activate lacapip install --editable . ä½¿ç”¨LACAè¿è¡Œæ¼”ç¤ºæ•°æ®åœ¨è¿™é‡Œæ‰¾åˆ°å®Œæ•´çš„ä½¿ç”¨æŒ‡å—ã€‚ å¿«é€Ÿå¯åŠ¨ç¤ºä¾‹laca init -b /path/to/basecalled_fastqs -d /path/to/database # init config file and checklaca run all # start analysis ç†Ÿæ‚‰LACAä½¿ç”¨LACAå¾ˆå®¹æ˜“ä½¿ç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨laca initå’Œlaca runåˆ†ä¸¤æ­¥å¼€å§‹æ–°çš„åˆ†æã€‚ å¦‚æœLACAå®‰è£…åœ¨condaç¯å¢ƒä¸­ï¼Œè¯·è®°ä½æ¿€æ´»condaç¯å¢ƒã€‚ conda activate lacalaca -h è¦ä½¿ç”¨ docker é•œåƒï¼Œæ‚¨éœ€è¦å°†æ•°æ®ç›®å½•ï¼ˆä¾‹å¦‚pwdï¼‰æŒ‚è½½åˆ°å®¹å™¨ä¸­/home ç›®å½•ã€‚ docker run -it -v `pwd`:/home --privileged yanhui09/lacalaca -h 1.åˆå§‹åŒ–é…ç½®æ–‡ä»¶laca init laca initä¼šåœ¨å·¥ä½œç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¿è¡ŒLACAæ‰€éœ€çš„æ‰€æœ‰å‚æ•°ã€‚ laca init -h 2.å¼€å§‹laca runåˆ†æ laca runå°†ç›¸åº”åœ°è§¦å‘å®Œæ•´çš„å·¥ä½œæµç¨‹æˆ–å®šä¹‰èµ„æºä¸‹çš„ç‰¹å®šæ¨¡å—ã€‚ä½¿ç”¨laca run -hè·å¾—è¯•è¿è¡Œæ¦‚è¿°ã€‚ laca run -h ä½¿ç”¨æ¼”ç¤ºæ•°æ®é›†è¿è¡ŒLACA0.ç¡®ä¿æ‚¨å·²ä»æ­¤å¤„ä¸‹è½½æ‰€éœ€çš„æ¼”ç¤ºæ•°æ®é›†ã€‚ç„¶åcdè¿›å…¥ç›®å½•ã€‚ ä¾‹å¦‚ï¼Œè¾“å…¥ç»å¯¹è·¯å¾„ï¼ˆâ€œé•¿è·¯å¾„â€ï¼‰/home/me/MAC2023-extraã€‚ cd /home/me/MAC2023-extra å¦‚æœæ‚¨å°šæœªä¸‹è½½æ•°æ®ç”¨Gitä¸‹è½½ï¼Œ git clone https://github.com/yanhui09/MAC2023-extra.gitcd ./MAC2023-extra 1.æ£€æŸ¥æ‚¨æ‰€åœ¨çš„ä½ç½®å¹¶å°è¯•laca initæ£€æŸ¥ç”Ÿæˆçš„config.yamlæ–‡ä»¶ã€‚ pwdlaca init -b ./data/ont16s -d ./database -w ./laca_output --fqs-min 50cat ./laca_output/config.yaml 2.LACAä¼ªè¿è¡Œå’ŒçœŸå®è¿è¡Œ laca run all -w ./laca_output -n laca run kmerCon -j 4 -w ./laca_output LACAèƒ½å¤Ÿç”Ÿæˆotu tableï¼Œtaxonomy tableä»¥åŠphylogenetic treeå¦‚æœæ‚¨ä½¿ç”¨laca run allè¿è¡Œå®Œæ•´çš„å·¥ä½œæµç¨‹ã€‚ä½†ç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦æ—¶é—´å‡†å¤‡æ•°æ®åº“å’Œå®‰è£…ã€‚ ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œæˆ‘ä»¬åªè¿è¡Œæ¨¡å—kmerConæ¥æ ¹æ® kmer é¢‘ç‡æå–ä¸€è‡´åºåˆ—ã€‚ çœ‹çœ‹è¿™äº›å…±æœ‰åºåˆ—ï¼Œå–ç¬¬ä¸€ä¸ªåºåˆ—å¯¹rRNA/ITSæ•°æ®åº“è¿›è¡ŒBLASTæœç´¢ã€‚ head -n2 ./laca_output/kmerCon/kmerCon.fna é¢„æœŸè¾“å‡ºï¼š &gt;pooled_0b000_0cand1CACAATGGGCGCAAGCCTGATGCAGCGACGCCGCGTGCGGGATGACGGCCTTCGGGTTGTAAACCGCTTTTGACTGGGAGCAAGCCCTTCGGGGTGAGTGTACCTTTCGAATAAGCACCGGCTAACTACGTGCCAGCAGCCGCGGTAATACGTAGGGTGCAAGCGTTATCCGGAATTATTGGGCGTAAAGGGCTCGTAGGCGGTTCGTCGCGTCCGGTGTGAAAGTCCATCGCTTAACGGTGGATCCGCGCCGGGTACGGGCGGGCTTGAGTGCGGTAGGGGAGACTGGAATTCCCGGTGTAACGGTGGAATGTGTAGATATCGGGAAGAACACCAATGGCGAAGGCAGGTCTCTGGGCCGTCACTGACGCTGAGGAGCGAAAGCGTGGGGAGCGAACAGGATTAGATACCCTGGTAGTCCACGCCGTAAACGGTGGATGCTGGATGTGGGGACCATTCCACGGTCTCCGTGTCGGAGCCAACGCGTTAAGCATCCCGCCTGGGGAGTACGGCCGCAAGGCTAAAACTCAAAGAAATTGACGGGGGCCCGCACAAGCGGCGGAGCATGCGGATTAATTCGATGCAACGCGAAGAACCTTACCTGGGCTTGACATGTTCCCGACAGCCGTAGAGATACGGCCTCCCTTCGGGGCGGGTTCACAGGTGGTGCATGGTCGTCGTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCGCAACGAGCGCAACCCTCGCCCTGTGTTGCCAGCACGTCGTGGTGGGAACTCACGGGGGACCGCCGGGGTCAACTCGGAGGAAGGTGGGGATGACGTCAGATCATCATGCCCCTTACGTCCAGGGCTTCACGCATGCTACAATGGCCGGTACAACGGGATGCGACCTCGCGAGGGGGAGCGGATCCCTTAAAACCGGTCTCAGTTCGGATTGGAGTCTGCAACCCGACTCCATGAAGGCGGAGTCGCTAGTAATCGCGGATCAGCAACGCCGCGGTGAATGCGTTCCCGGGCC ç»“æœBLASTè¡¨æ˜ï¼Œè¯¥åºåˆ—æ˜¯ä¸€ä¸ª16S rRNAåŸºå› ç‰‡æ®µï¼ŒBifidobacteriumä¸€æ€§æ€§è¶…è¿‡99%ã€‚ è¯»å–ä¸€ä¸ª ONT å¹¶è¿›è¡Œç›¸åŒçš„BLASTæœç´¢ã€‚æ‚¨å¸Œæœ›çœ‹åˆ°ä»€ä¹ˆï¼Ÿ zcat ./data/ont16s/*.fastq.gz | head æœ¬æ–‡ä¸ºå­¦ä¹ è®°å½•ï¼Œè¯¾ç¨‹ä½œè€…ä¸ºï¼šYanHui","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"author":"Xiaoguang Pan"},{"title":"16S rRNAåŸºå› æ‰©å¢å­åˆ†æ","slug":"16SrRNAåŸºå› æ‰©å¢å­åˆ†æ","date":"2024-09-20T05:10:07.000Z","updated":"2024-10-18T03:36:37.525Z","comments":true,"path":"undefined/","link":"16s-long-analysis","permalink":"https://xiaohanys.top/undefined/","excerpt":"åœ¨æ­¤å·¥ä½œæµç¨‹ä¸­ï¼Œä»‹ç»äº† Qiime2 å’Œ R ä¸­ 16S rRNA åŸºå› æ‰©å¢å­æ•°æ®åˆ†æçš„ä¸»è¦æ­¥éª¤ã€‚æœ¬æ•™ç¨‹æ˜¯ä¸ºå“¥æœ¬å“ˆæ ¹å¤§å­¦é£Ÿå“ç§‘å­¦ç³»çš„ MAC 2023 è¯¾ç¨‹å‡†å¤‡çš„ã€‚å°½ç®¡è¿™äº›æ­¥éª¤æ˜¯ä¸º Oxford Nanopore Tech (ONT) æµ‹åºè®¾è®¡çš„ï¼Œä½†ä¹Ÿåœ¨ Ilumina çŸ­è¯»é•¿ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚","text":"åœ¨æ­¤å·¥ä½œæµç¨‹ä¸­ï¼Œä»‹ç»äº† Qiime2 å’Œ R ä¸­ 16S rRNA åŸºå› æ‰©å¢å­æ•°æ®åˆ†æçš„ä¸»è¦æ­¥éª¤ã€‚æœ¬æ•™ç¨‹æ˜¯ä¸ºå“¥æœ¬å“ˆæ ¹å¤§å­¦é£Ÿå“ç§‘å­¦ç³»çš„ MAC 2023 è¯¾ç¨‹å‡†å¤‡çš„ã€‚å°½ç®¡è¿™äº›æ­¥éª¤æ˜¯ä¸º Oxford Nanopore Tech (ONT) æµ‹åºè®¾è®¡çš„ï¼Œä½†ä¹Ÿåœ¨ Ilumina çŸ­è¯»é•¿ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚ Qiime2ä¸­çš„æ­¥éª¤1. åˆ¶ä½œæ¸…å•æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¯¹äºå°†åŸå§‹è¯»æ•°å¯¼å…¥ Qiime2 éå¸¸é‡è¦ã€‚è¯¥æ–‡ä»¶åªæ˜¯ä¸€ä¸ªåˆ¶è¡¨ç¬¦åˆ†éš”çš„æ–‡æœ¬ï¼Œæœ‰ä¸¤åˆ—ï¼ˆå¦‚æœæˆ‘ä»¬æœ‰åŒç«¯è¯»å–ï¼‰ï¼›æ­£å‘ç»å¯¹æ–‡ä»¶è·¯å¾„å’Œåå‘ç»å¯¹æ–‡ä»¶è·¯å¾„ã€‚æ¯åˆ—åŒ…å«æ­£å‘å’Œåå‘é€šé“æ¯æ¬¡è¯»å–çš„ç»å¯¹è·¯å¾„ã€‚ #path to forwardls -f ~/microbiome_analysis_ku/data/*_R1_001.fastq.gz | sort -V &gt; r1path#path to reversels -f ~/microbiome_analysis_ku/data/*_R2_001.fastq.gz | sort -V &gt; r2path#checking if we have all pairs of forward and reverse readsdiff -s &lt;(cat r1path | cut -d_ -f4) &lt;(cat r2path | cut -d_ -f4) #if the outcome is &quot;identical&quot;, then we good :)#Cutting sample IDs from the path file (from either is good)cut -d_ -f4 r1path &gt; SampleID#adding sample ids to pathspaste SampleID r1path r2path &gt; manifest#Binning ids and forward reverse columns together with tab-delimited seperationsed -i $&#x27;1 i\\\\\\nsampleid \\t forward-absolute-filepath \\t reverse-absolute-filepath&#x27; manifest ä¸€äº›æ•°æ®çš„æ¨ç†è°ƒæŸ¥ ## Exploring the readszcat ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz zcat ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz | grep ^@FS10000714| cut -d &quot;:&quot; -f1 | wc -lwc -l ./data/*_R1_001.fastq.gz | awk &#x27;&#123;$1=$1&#125;;1&#x27;| cut -d&quot; &quot; -f1|datamash min 1wc -l ./data/*_R1_001.fastq.gz | awk &#x27;&#123;$1=$1&#125;;1&#x27;| cut -d&quot; &quot; -f1|head -n -1|datamash max 1wc -l ./data/*_R1_001.fastq.gz | awk &#x27;&#123;$1=$1&#125;;1&#x27;| cut -d&quot; &quot; -f1|head -n -1|datamash mean 1#reversewc -l ./data/*_R2_001.fastq.gz| awk &#x27;&#123;$1=$1&#125;;1&#x27; | cut -d &quot; &quot; -f1|datamash min 1wc -l ./data/*_R2_001.fastq.gz| awk &#x27;&#123;$1=$1&#125;;1&#x27; | cut -d &quot; &quot; -f1|datamash max 1wc -l ./data/*_R2_001.fastq.gz| awk &#x27;&#123;$1=$1&#125;;1&#x27; | cut -d &quot; &quot; -f1|datamash mean 1#searching for primerszcat ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz | headzgrep &#x27;^CCTACGGG.GGC.GCAG&#x27; ./data/MAC2022_iSeq001_S1_L001_R2_001.fastq.gz | wc -lzgrep &#x27;^GACTAC..GGGTATCTAATCC&#x27; ./data/MAC2022_iSeq001_S1_L001_R2_001.fastq.gz | wc -l#Eventually you can use Seqkit packageseqkit stats ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz 2. ä½¿ç”¨åˆ›å»ºçš„æ¸…å•æ–‡ä»¶å°†è¯»å–å¯¼å…¥ Qiime2source activate qiime2.Xqiime tools import \\ --type &quot;SampleData[PairedEndSequencesWithQuality]&quot; \\ --input-format PairedEndFastqManifestPhred33V2 \\ --input-path ~/MAC2023/manifest.tsv \\ # link to the folder in which my manifest file is located --output-path ~/MAC2023/demuxed_MAC23.qza # link to the path where I want my demultiplexed data to be exported in 3. å¯è§†åŒ–è§£å¤ç”¨è¯»å–çš„æ¨è®ºç»Ÿè®¡qiime demux summarize \\ --i-data ./demuxed_mac23.qza \\ --o-visualization ./demuxed_mac23.qzv 4. qiime2ä¸­DADA2åŒ…çš„è¿‡æ»¤ã€å»é‡å¤ã€æ ·æœ¬æ¨æ–­ã€åµŒåˆä½“è¯†åˆ«ã€åŒç«¯è¯»æ®µåˆå¹¶ã€‚qiime dada2 denoise-paired \\--i-demultiplexed-seqs ~/demuxed_mac23.qza \\ #the input file for denoising is our demultiplexed pairedEnd reads that was generated in the previous step.--p-trim-left-f 17 \\ #length of my forward primer (17 nt) --p-trim-left-r 21 \\ #length of my reverse primer (21 nt)--p-trunc-len-f 260 \\ #truncation length for forward reads. I.e. we truncate reads over 260 base since their quality started dropping from this point onwards. --p-trunc-len-r 220 \\ #truncation length for reverse reads. I.e. we truncate reads over 220 base since their quality started dropping from this point onwards. --o-table ~/count_table.qza \\ #the ASV count table--o-representative-sequences ~/repseqs.qza \\ #the representative sequences for in each read--o-denoising-stats ~/denoising_stats.qza \\ #the status of the denoising process in a full catalogue--p-n-threads 10 4.1. å¯è§†åŒ–è®¡æ•°è¡¨qiime feature-table summarize --i-table ~/count_table.qza \\ #The ASV table as the input--m-sample-metadata-file ~/metadataA.tsv \\ #The metadata as the input--o-visualization ./table.qzv #The qzv format of our ASV table 4.2. å¯è§†åŒ–ä»£è¡¨æ€§åºåˆ—qiime feature-table tabulate-seqs \\--i-data ~/repseqs.qza \\--o-visualization ~/repseqs.qzv 4.3. å¯è§†åŒ–å»å™ªç»Ÿè®¡æ•°æ®qiime metadata tabulate \\--m-input-file ./denoising_stats.qza \\--o-visualization ./denoising_stats.qzv 5. é€šè¿‡æœ´ç´ è´å¶æ–¯æ–¹æ³•è®­ç»ƒåŸºäºå¼•ç‰©çš„åŒºåŸŸç‰¹å¼‚æ€§åˆ†ç±»å™¨ï¼ˆåœ¨ Qiime2 ä¸­ï¼‰qiime feature-classifier fit-classifier-naive-bayes \\ # here you can train your classifier based on a Naive-Bayes method--i-reference-reads ~/derepseqs-uniq-341f-805r.qza \\ # Dereplicated sequences based on the primer set as input--i-reference-taxonomy ~/dereptaxa-uniq-341f-805r.qza\\ # Dereplicated taxonomic annotations based on the primer set as input --o-classifier ~/silva-classifier-primered4.qza # Running the classifierqiime feature-classifier classify-sklearn \\ # Sklearn package for classification--i-reads ~/repseqs.qza \\ # Representative sequences as the (input)--i-classifier ~/classifier/silva138-classifier-341f-805r.qza \\ # Our costumized SILVA 138 classifier (input)--o-classification ~/taxonomy.qza \\ # The taxonomic annotation linked to the repseqs (output)--p-n-jobs 10 # The number of cores/jobs 5.1. å¯è§†åŒ–åˆ†ç±»è¡¨qiime metadata tabulate \\--m-input-file ~/Taxonomy/taxonomy.qza \\--o-visualization ~/Taxonomy/taxonomy.qzv 6. ä½¿ç”¨æ”¯æŒ SATE çš„ç³»ç»Ÿå‘è‚²æ”¾ç½® (SEPP) æ–¹æ³•åˆ›å»ºç³»ç»Ÿå‘è‚²æ ‘ä»¥è¿›è¡Œå¤šæ ·æ€§åˆ†æqiime fragment-insertion sepp \\ # The package for generating the phylogenetic tree--i-representative-sequences ~/repseqs.qza \\ # Our representative sequences (input)--i-reference-database ~/epp-ref-gg-13-8.qza \\ # The SEPP sequence dataset (input)--o-tree ~/tree.qza \\ # The rooted tree (output)--o-placements ~/dss/tree-placements.qza \\--p-threads 10 R ä¸­çš„æ­¥éª¤1.å®‰è£…å’ŒåŠ è½½åº“#Update Rinstall.packages(&#x27;installr&#x27;)installr::updateR()github.pkg &lt;- c(&quot;jfukuyama/phyloseqGraphTest&quot;, &quot;jbisanz/qiime2R&quot;) bioc.pkg &lt;- c(&quot;phyloseq&quot;, &quot;DESeq2&quot;, &quot;MicrobiotaProcess&quot;, &quot;ggtree&quot;, &quot;vsn&quot;)cran.pkg &lt;- c(&quot;tidyverse&quot;, &quot;readr&quot;, &quot;ape&quot;, &quot;pacman&quot;, &quot;picante&quot;, &quot;glue&quot;, &quot;vegan&quot;, &quot;devtools&quot;, &quot;ggrepel&quot;, &quot;reshape2&quot;, &quot;BiocManager&quot;, &quot;ggnetwork&quot;, &quot;DT&quot;, &quot;VennDiagram&quot;, &quot;lsmeans&quot;, &quot;pheatmap&quot;, &quot;phyloseqGraphTest&quot;)inst.pkg &lt;- cran.pkg %in% installed.packages()BiocManager::install(&quot;ggtree&quot;)if (any(!inst.pkg))&#123; install.packages(cran.pkg[!inst.pkg],repos = &quot;http://cran.rstudio.com/&quot;) &#125; inst.pkg &lt;- github.pkg %in% installed.packages() if (any(!inst.pkg))&#123; devtools::install_github(github.pkg[!inst.pkg], force = TRUE) &#125; inst.pkg &lt;- bioc.pkg %in% installed.packages() if(any(!inst.pkg))&#123; BiocManager::install(bioc.pkg[!inst.pkg])&#125; pkg = c(&quot;tidyverse&quot;, &quot;phyloseq&quot;, &quot;DESeq2&quot;, &quot;qiime2R&quot; , &quot;gridExtra&quot;, &quot;BiocManager&quot;, &quot;vegan&quot;, &quot;ggtree&quot;, &quot;devtools&quot;, &quot;ggrepel&quot;, &quot;reshape2&quot;, &quot;ggnetwork&quot;, &quot;igraph&quot;, &quot;biomformat&quot;, &quot;pheatmap&quot;, &quot;glue&quot;, &quot;ape&quot;, &quot;readr&quot;, &quot;vsn&quot;, &quot;vegan&quot;)for(i in 1:length(pkg))&#123; library(pkg[i], character.only = TRUE, verbose = FALSE, attach.required = FALSE)&#125; save.image(&#x27;./data/r.RData&#x27;)load(&quot;./data/r.RData&quot;) 2.ä»qiime2å¯¼å…¥å·¥ä»¶åˆ°r#making phyloseq objects from qiime filesps &lt;- qiime2R::qza_to_phyloseq(features = &quot;~/data/ccd/table-ccd.qza&quot;, taxonomy = &quot;~/data/ccd/taxonomy-ccd.qza&quot;, tree = &quot;./tree-ccd.qza&quot;)repseqs &lt;- qiime2R::read_qza(&quot;~/data/ccd/repseqa.qza&quot;)$data#we need to merge the refseqs like this since in above fun, there is no argument for thatps= merge_phyloseq(ps, repseqs)# Metadata#importing the metadatametadata &lt;- read.table(&quot;./metadata.tsv&quot;, header = TRUE, sep = &quot;\\t&quot;)#converting non numeric and non-logical variables to factorsfor(i in seq_len(ncol(metadata))) &#123; if(!is.numeric(metadata[[i]]) &amp;&amp; !is.logical(metadata[[i]]) &amp;&amp; !is.integer(metadata[[i]])) &#123; metadata[[i]] = as.factor(metadata[[i]]) &#125; else &#123; metadata[[i]] &#125; &#125;#changing sample namesasvs &lt;- otu_table(ps) %&gt;% as.matrix#Merging all artifactspst = phyloseq(otu_table(asvs, taxa_are_rows = TRUE), phy_tree(ps), sample_data(metadata), refseq(ps), tax_table(ps)) å°† Illumina è¾“å‡ºå¯¼å…¥ r ft = read_tsv(&#x27;./MAC2023.github.io/data/illumina/Results_MAC23_MAC96_S96/OTU-tables/zOTU_table_GG.txt&#x27; ) %&gt;% data.frame()ft &lt;- column_to_rownames(ft, &quot;X.OTU.ID&quot;)tx = ft %&gt;% as.data.frame() %&gt;% select(81)ft[,dim(ft)[2]] &lt;-NULLtx = tidyr::separate(tx, col = taxonomy, into =c(&quot;Kingdom&quot;, &quot;Phylum&quot;, &quot;Class&quot;, &quot;Order&quot;, &quot;Family&quot;, &quot;Genus&quot;, &quot;Species&quot;), sep = &#x27;;&#x27;) %&gt;% as.matrix()tx = apply(tx, 2, function(x) &#123;gsub(&quot;^.__&quot;, &quot;&quot;, x)&#125;)colnames(ft) &lt;- sapply(colnames(ft), function(x) &#123;gsub(&quot;.*[S]([0-9]+)$&quot;, &quot;BRK\\\\1&quot;, x)&#125;) %&gt;% as.vector()mt = read.table(&#x27;./data/metadata.txt&#x27;, header = TRUE) mtdata.frame(barcode = colnames(ft))mt[!rownames(mt) %in% colnames(ft),] %&gt;% select(barcode) %&gt;% pull()tr$tip.label %&gt;% length()tr = ggtree::read.tree(&#x27;./MAC2023.github.io/data/illumina/Results_MAC23_MAC96_S96/zOTU.tree&#x27;) phyloseq(otu_table(ft, TRUE), phy_tree(tr), tax_table(tx)) %&gt;% ggtree(layout = &quot;circular&quot;, aes(color = Phylum)) å°† ONT è¾“å‡ºå¯¼å…¥ R #setwd(&#x27;/home/hackion/Dropbox/Old-2gb/postdoc/mac2023&#x27;)#Reading feature tableft = read_tsv(&#x27;./data/count_matrix.tsv&#x27;) %&gt;% as.data.frame() %&gt;% column_to_rownames(&#x27;#OTU ID&#x27;) %&gt;% as.matrix()# Reading taxonomy tabletx = read.table(&#x27;./data/taxonomy.tsv&#x27;, header = F, sep = &#x27;\\t&#x27;, row.names = 1)dim(tx) ## [1] 5056 1 # Parse the taxonomytx = tidyr::separate(data = tx, col = V2, into = c(&quot;Kingdom&quot;, &quot;Phylum&quot;, &quot;Class&quot;, &quot;Order&quot;, &quot;Family&quot;, &quot;Genus&quot;, &quot;Species&quot;), sep = &#x27;;&#x27;) #removing taxon tags tx = apply(tx, 2, function(x) &#123;gsub(&quot;^.__&quot;, &quot;&quot;, x)&#125;)#reading metadatamt = read.table(&#x27;./data/metadata.txt&#x27;, header = TRUE) # Reading rep_seqsseqs = Biostrings::readDNAStringSet(&#x27;./data/rep_seqs.fasta&#x27;)# Reading the treetr = ggtree::read.tree(&#x27;./data/tree.nwk&#x27;)# Merging datapst = phyloseq(otu_table(ft, taxa_are_row=TRUE), phyloseq::tax_table(tx), phy_tree(tr), sample_data(mt), refseq(seqs))pst ## phyloseq-class experiment-level object## otu_table() OTU Table: [ 5056 taxa and 95 samples ]## sample_data() Sample Data: [ 95 samples by 2 sample variables ]## tax_table() Taxonomy Table: [ 5056 taxa by 7 taxonomic ranks ]## phy_tree() Phylogenetic Tree: [ 5056 tips and 4980 internal nodes ]## refseq() DNAStringSet: [ 5056 reference sequences ] sum(rowSums(pst@otu_table)==0) ## [1] 0 3ã€readsçš„è¿‡æ»¤å’Œé¢„å¤„ç†#removing unassigned and NA phylum taxapst &lt;- subset_taxa(pst, !is.na(Phylum) &amp; !Phylum %in% c(&quot;&quot;, &quot;uncharacterized&quot;, &quot;unassigned&quot;))#keeping only bacterial kingdompst &lt;- subset_taxa(pst, Kingdom %in% &quot;Bacteria&quot;)pst ## phyloseq-class experiment-level object## otu_table() OTU Table: [ 4858 taxa and 95 samples ]## sample_data() Sample Data: [ 95 samples by 2 sample variables ]## tax_table() Taxonomy Table: [ 4858 taxa by 7 taxonomic ranks ]## phy_tree() Phylogenetic Tree: [ 4858 tips and 4784 internal nodes ]## refseq() DNAStringSet: [ 4858 reference sequences ] åŸºäºï¼ˆä½ï¼‰æµè¡Œç‡çš„åˆ†ç±»è¿‡æ»¤ï¼šç›‘ç£ #monitoring the number of the samples in which the prevalence of a taxon is at least oneprevdf &lt;- apply(otu_table(pst),ifelse(taxa_are_rows(pst), 1, 2), function(x)&#123;sum(x&gt;0)&#125;)weight_df &lt;- data.frame(ASVprev = prevdf, TaxaAbund = taxa_sums(pst), tax_table(pst))head(weight_df) ## ASVprev TaxaAbund Kingdom Phylum Class## OTU_1133 14 22 Bacteria Actinobacteriota Actinobacteria## OTU_3649 28 50 Bacteria Actinobacteriota Actinobacteria## OTU_3778 15 30 Bacteria Actinobacteriota Actinobacteria## OTU_614 70 934 Bacteria Actinobacteriota Actinobacteria## OTU_1186 51 110 Bacteria Firmicutes Clostridia## OTU_4237 22 35 Bacteria Firmicutes Clostridia## Order Family Genus## OTU_1133 Bifidobacteriales Bifidobacteriaceae Bifidobacterium## OTU_3649 Bifidobacteriales Bifidobacteriaceae Bifidobacterium## OTU_3778 Bifidobacteriales Bifidobacteriaceae Bifidobacterium## OTU_614 Bifidobacteriales Bifidobacteriaceae Bifidobacterium## OTU_1186 Lachnospirales Lachnospiraceae Blautia## OTU_4237 Lachnospirales Lachnospiraceae Blautia## Species## OTU_1133 Bifidobacterium_adolescentis## OTU_3649 Bifidobacterium_longum## OTU_3778 Bifidobacterium_bifidum## OTU_614 Bifidobacterium_adolescentis## OTU_1186 &lt;NA&gt;## OTU_4237 &lt;NA&gt; #Find out the phyla that are of mostly low-prevalence features by computing the total and average prev of features in Phylumplyr::ddply(weight_df, &quot;Phylum&quot;, function(x)&#123;cbind(means = round(mean(x$ASVprev), 2), sums = round(sum(x$ASVprev),2))&#125;) %&gt;% mutate(sanity = ifelse(means == sums, &quot;TRUE&quot;, &quot;FALSE&quot;)) ## Phylum means sums sanity## 1 Actinobacteriota 40.19 17645 FALSE## 2 Bacteroidota 29.43 25282 FALSE## 3 Cyanobacteria 20.25 486 FALSE## 4 Desulfobacterota 22.89 435 FALSE## 5 Firmicutes 35.80 116352 FALSE## 6 Fusobacteriota 24.02 985 FALSE## 7 Proteobacteria 26.01 4941 FALSE## 8 Spirochaetota 9.80 49 FALSE## 9 Verrucomicrobiota 35.52 1101 FALSE æ ¹æ®æ‰€æœ‰æ ·æœ¬ä¸­ n ä¸ªæ ·æœ¬ä¸­å‡ºç°çš„æµè¡Œé˜ˆå€¼è¿‡æ»¤ ASV # This means that each ASV should have appeared at least in n samples to be kept.asv.filter = function(asvtab, n.samples = 1 )&#123; filter.threshold &lt;- n.samples/ncol(asvtab) *100 # In how many samples out of total samples an ASV should have occured table_count &lt;- apply(otu_table(asvtab), 2, function(x) ifelse(x&gt;0, 1, 0)) %&gt;% as.data.frame() suspected_ASV = table_count[which((rowSums(table_count)/ncol(table_count))*100 &lt; filter.threshold),] %&gt;% rownames() return(suspected_ASV)&#125;print(glue(&quot;&#123; asv.filter(asvtab = otu_table(pst), n.samples = 2) &#125; occured only in two samples&quot;))sus_ASV = asv.filter(asvtab = otu_table(pst), n.samples = 2) ## Will you remove them?#pst = subset_taxa(pst, !taxa_names(pst) %in% sus_ASV)#or you could also do it by the phyloseq functioncondition &lt;- function(x) x&gt;0TaxaTokeep &lt;- genefilter_sample(pst,condition,2) #pst = subset_taxa(pst, taxa_names(pst) %in% TaxaTokeep) æ ¹æ®ä¸°åº¦åˆ é™¤å•è°ƒ #A function to find singletones. You need to be careful about this step!out.ASV = function(phyloseq, threshold =1, binwidth = 0.01) &#123; #Loading necessary pkgs pacman::p_load(glue, tidyverse, reshape2, ggrepel, S4Vectors) # nolint#This function requires phyloseq, tidyverse and glue packages to be loaded. if (sum(colSums(otu_table(phyloseq)))/ncol(otu_table(phyloseq)) == 100 ) &#123;#making the relative abundance table rel_abund = as(t(otu_table(phyloseq)), &quot;matrix&quot;) &#125; else if (sum(colSums(otu_table(phyloseq)))/ncol(otu_table(phyloseq)) == 1) &#123; rel_abund = as(t(otu_table(phyloseq)), &quot;matrix&quot;) &#125; else &#123; rel_abund = as(t(apply(otu_table(phyloseq), ifelse(taxa_are_rows(phyloseq), 1,2), function(x) x/sum(x))), &quot;matrix&quot;) &#125; names.single = apply(rel_abund, 1, function(x)&#123;ifelse(x == threshold, TRUE, ifelse(x == sum(x), TRUE, FALSE))&#125;) %&gt;% reshape2::melt() %&gt;% filter(value == TRUE) %&gt;% dplyr::select(2) %&gt;% pull%&gt;% as.vector() if (length(names.single) == 0 ) &#123; print(glue(&quot;WOW! &#123;length(names.single)&#125; singletones detected in this dataset&quot;)) qplot.noSing = qplot(rel_abund, geom = &quot;histogram&quot;, binwidth = binwidth, show.legend = F, main = &quot;Frequency count of relative abundance, no singletones detected&quot;) + xlab (&quot;Relative abundance in samples&quot;) + ylab(&quot;Frequency&quot;) + theme_bw() return(structure(list(qplot.noSing))) &#125; else &#123; single.ASV = rel_abund[rownames(rel_abund) %in% names.single,]single.ASV[single.ASV == 0] &lt;- NA # A separate dataset for annotation of singletones on the barplot qplot.withSing = qplot(rel_abund, geom = &quot;histogram&quot;, binwidth = binwidth, main = &quot;Frequency count of relative abundance with singletones&quot;) + geom_bar(aes(single.ASV), fill = &quot;red&quot;, color = NA, width = binwidth)+ xlab (&quot;Relative abundance in samples&quot;) + ylab(&quot;Frequency&quot;) + geom_label_repel(aes(x = 1, y =length(rel_abund)/5), label.padding = unit(0.55, &quot;lines&quot;), label = glue(&quot;&#123;length(names.single)&#125;\\n Singletones&quot;), color = &quot;black&quot;) + theme_bw() qplot.rmSing = qplot(rel_abund[!rownames(rel_abund) %in% names.single, ], geom = &quot;histogram&quot;, binwidth = binwidth, main = &quot;Frequency count of relative abundance without singletones&quot;) + xlab (&quot;Relative abundance in samples&quot;) + ylab(&quot;Frequency&quot;)+ theme_bw() print(glue(&#x27;Oh no..! &#123;length(names.single)&#125; singletones detected in the dataset&#x27;)) return(structure(list(qplot.withSing, qplot.rmSing, unlist(names.single))) ) &#125; &#125; single.test = out.ASV(phyloseq = pst, threshold = 2, binwidth = 0.01)#singletones = single.test[[3]] #here you can extract the names of the singletonessingle.test[[1]]#to show the plot with singletonessingle.test[[2]]#to show the plot without singletones#Now you can remove the singletones from your pst file as follows:#pst = subset_taxa(pst, !taxa_names(ps)%in% singletones)rm(single.test) 4.é˜¿å°”æ³•å¤šæ ·æ€§4.1. ç¨€ç–#library(MicrobiotaProcess)#This takes a bit of timeps_rar_curve &lt;- MicrobiotaProcess::ggrarecurve(obj = pst, indexNames = c(&quot;Observe&quot;, &quot;Shannon&quot;), chunks=400, theme(legend.spacing.y = unit(0.02, &quot;cm&quot;), legend.text = element_text(size = 6)), show.legend=F) ps_rar_curve + theme_bw() + geom_vline(xintercept = 30000, lty = 2, color = alpha(&quot;red&quot;, 0.5)) + ggtitle(&quot;Rarefaction curves based on Richnessh and evenness&quot;, &quot;Each line is a sample&quot;) #ggsave(&quot;./Alpha/rarefaction.curve.jpeg&quot;, device = &quot;png&quot;, dpi = 300, height = 6, width = 9)#rarefying the table with minimum depth of 10000 reads per sampleps_rar = rarefy_even_depth(pst, sample.size = 30000, replace = FALSE)#in this depth we have lost one sapmle (F.29) and no ASVs.# Taxonomic filtering based on abundance for rarefied data: supervsed## Abumdance: ASV &gt; 0.0001% overall abundance across all samplestotal.depth &lt;- sum(otu_table(ps_rar))totAbuThreshold &lt;- 1e-4 * total.depthps_rar &lt;- prune_taxa(taxa_sums(ps_rar)&gt;totAbuThreshold, ps_rar)ps_rar ## phyloseq-class experiment-level object## otu_table() OTU Table: [ 1221 taxa and 87 samples ]## sample_data() Sample Data: [ 87 samples by 2 sample variables ]## tax_table() Taxonomy Table: [ 1221 taxa by 7 taxonomic ranks ]## phy_tree() Phylogenetic Tree: [ 1221 tips and 1214 internal nodes ]## refseq() DNAStringSet: [ 1221 reference sequences ] sum(rowSums(ps_rar@otu_table)==0) ## [1] 0 4.2. Alpha å¤šæ ·æ€§æŒ‡æ ‡#Calculating the alpha diversity indexes## RichnessChao1 = estimate_richness(pst, split = TRUE, measures = &quot;Chao1&quot;)#for richness, we don&#x27;t use rarefied table## Evenness: shannon =&gt; H&#x27; = -Î£ (Pi * ln(Pi))Shannon = estimate_richness(ps_rar, split = TRUE, measures = &quot;Shannon&quot;)#Faith Phylogenetic Diversity: PD = Î£(branch lengths leading to selected species)library(picante, verbose = FALSE)FaithPD = picante::pd(samp = t(otu_table(ps_rar)), tree = phy_tree(ps_rar))$PD#adding the indexes to the metadatas sample_data(ps_rar) &lt;- data.frame(sample_data(ps_rar), Chao1=Chao1[rownames(Chao1)%in% rownames(sample_data(ps_rar)),][[1]], Shannon = Shannon$Shannon, FaithPD = FaithPD) #note that we have removed that sample which has been removed by rarefaction. 4.3.å¯è§†åŒ–Î±å¤šæ ·æ€§æŒ‡æ•°library(ggpubr, verbose = FALSE)library(reshape2, verbose = FALSE)alpha_ccd = sample_data(ps_rar) %&gt;% data.framelong_mtdat &lt;- melt(alpha_ccd, )long_mtdat&lt;- long_mtdat[long_mtdat$variable %in% c(&quot;Chao1&quot;, &quot;Shannon&quot;, &quot;FaithPD&quot;),]long_mtdat$variable &lt;- factor(long_mtdat$variable , levels = c(&quot;Chao1&quot;, &quot;Shannon&quot;, &quot;FaithPD&quot;))pie(rep(10, 9), col = colors()[c(190, 20, 30, 15, 8, 90, 35, 120, 42)], clockwise = TRUE, labels = as.character(colors()[c(1, 20, 30, 15, 8, 90, 35, 120, 42)])) cols = colors()[c(190, 20, 30, 15, 8, 90, 35, 120, 42)]my_comp = list(c(&quot;A&quot;, &quot;B&quot;), c(&quot;A&quot;, &quot;C&quot;), c(&quot;A&quot;, &quot;E&quot;), c(&quot;A&quot;, &quot;Mock&quot;), c(&quot;A&quot;, &quot;B&quot;))#comparison between Samples by SampleID and digestaalpha_p = ggplot(long_mtdat, aes(x = group, y = value)) + geom_violin(aes(fill = group), trim = F) + stat_compare_means(paired = FALSE, comparison = my_comp, method = &quot;t.test&quot;, label = &quot;p.signif&quot;) + geom_boxplot(width = 0.10) + geom_jitter(color = &quot;black&quot;, alpha = 0.5)+ facet_wrap(~long_mtdat$variable, scales = &quot;free_y&quot;) + theme_bw() + scale_fill_manual(values = cols) + theme(legend.title = element_text( size = 15, face = &quot;bold&quot;), axis.title.x = element_text( face = &quot;bold&quot;, size = 15), axis.text.x = element_text( size = 15), axis.title.y = element_text( face = &quot;bold&quot;, size = 15), axis.text.y = element_text( size = 15), strip.text.x = element_text( size = 15, face = &quot;bold&quot;)) + labs(fill = &quot;Sample type&quot;, y = &quot;Alpha diversity&quot;, title = &quot;Alpha diversity metrics in different group samples.\\n Means are compared by unpaired t.test&quot;) + xlab(&quot;Sample type&quot;)#ggsave(plot = alpha_p, &quot;./Alpha/alpha.jpeg&quot;, device = &quot;jpeg&quot;, width = 15, dpi =300)alpha_p lm1 = lm(Chao1 ~ group, data = alpha_ccd)summary(lm1) ## ## Call:## lm(formula = Chao1 ~ group, data = alpha_ccd)## ## Residuals:## Min 1Q Median 3Q Max ## -679.86 -196.49 40.58 234.99 533.47 ## ## Coefficients:## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2588.961 92.412 28.015 &lt; 2e-16 ***## groupB 335.459 130.690 2.567 0.012177 * ## groupC -31.262 133.628 -0.234 0.815637 ## groupD 5.494 130.690 0.042 0.966577 ## groupE 535.158 130.690 4.095 0.000102 ***## groupF 169.873 130.690 1.300 0.197493 ## groupG -802.872 170.400 -4.712 1.05e-05 ***## groupH -1066.241 141.162 -7.553 6.86e-11 ***## groupMock -1103.125 244.499 -4.512 2.24e-05 ***## ---## Signif. codes: 0 &#x27;***&#x27; 0.001 &#x27;**&#x27; 0.01 &#x27;*&#x27; 0.05 &#x27;.&#x27; 0.1 &#x27; &#x27; 1## ## Residual standard error: 320.1 on 78 degrees of freedom## Multiple R-squared: 0.7232, Adjusted R-squared: 0.6948 ## F-statistic: 25.47 on 8 and 78 DF, p-value: &lt; 2.2e-16 5. è´å¡”å¤šæ ·æ€§è®¡æ•°æ•°æ®çš„è½¬æ¢åˆç§°ä¸ºç‰¹å¾ç¼©æ”¾ library(&quot;patchwork&quot;, verbose = FALSE)#Untransformedp1 = ggplot() + geom_histogram(aes(x = rowSums(otu_table(pst))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 2000) + theme_bw() + ggtitle(&quot;Histogram for raw&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p2 = ggplot() + geom_histogram(aes(x = log10(rowSums(otu_table(pst)))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 0.05) + theme_bw() + ggtitle(&quot;Histogram for raw, Log10T&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p1 + p2 + plot_layout(ncol = 2 , heights = 8) #Rarefiedp3 = ggplot() + geom_histogram(aes(x = rowSums(otu_table(ps_rar))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 2000) + theme_bw() + ggtitle(&quot;Histogram for rarefied data&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p4 = ggplot() + geom_histogram(aes(x = log10(rowSums(otu_table(ps_rar)))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 0.07) + theme_bw() + ggtitle(&quot;Histogram for raw, rarefied Log10T&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p3 + p4 +plot_layout(ncol = 2 , heights = 8) #Relabundps_rel = transform_sample_counts(ps_rar, function(x) &#123;x / sum(x) * 100&#125;)p5 = ggplot() + geom_histogram(aes(x = rowSums(otu_table(ps_rel))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 5) + theme_bw() + ggtitle(&quot;Histogram for relabund data&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p6 = ggplot() + geom_histogram(aes(x = log10(rowSums(otu_table(ps_rel)))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 0.07) + theme_bw() + ggtitle(&quot;Histogram for relabund, Log10T&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;) p5 + p6+ plot_layout(ncol = 2 , heights = 8) #Natural logps_log = transform_sample_counts(ps_rar, function(x) (log(1+x)))p7 = ggplot() + geom_histogram(aes(x = rowSums(otu_table(ps_log))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 5) + theme_bw() + ggtitle(&quot;Histogram for log data&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p8 = ggplot() + geom_histogram(aes(x = log10(rowSums(otu_table(pst)))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 0.07) + theme_bw() + ggtitle(&quot;Histogram for log, Log10T&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p7 + p8 + plot_layout(ncol = 2 , heights = 8) #VSTvst_count = varianceStabilizingTransformation(object = as(otu_table(ps_rar), &quot;matrix&quot;), fitType = &quot;mean&quot;, blind = TRUE)ps_vst = ps_rarotu_table(ps_vst) &lt;- otu_table(vst_count, taxa_are_rows = TRUE)p9 = ggplot() + geom_histogram(aes(x = rowSums(otu_table(ps_vst))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 10) + theme_bw() + ggtitle(&quot;Histogram for VST data&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p10 = ggplot() + geom_histogram(aes(x = log10(rowSums(otu_table(ps_vst)))), fill = &quot;#4a8d78&quot;, color = &quot;#ffffff&quot;, binwidth = 0.07) + theme_bw() + ggtitle(&quot;Histogram for VST, Log10T&quot;) + xlab(&quot;Taxa sum&quot;) + ylab(&quot;Count, all samples&quot;)p9 + p10 + plot_layout(ncol = 2 , heights = 8) msd = meanSdPlot(otu_table(ps_rar), plot = FALSE, ranks = TRUE)p11 = msd$gg + ggtitle(&quot;Mean vs. STD for raw counts of taxa&quot;) +theme_bw() + xlab(&quot;Mean of normalized raw counts&quot;) + ylab(&quot;Standard deviation of counts&quot;) +guides(fill = &quot;none&quot;)msd2 = meanSdPlot(otu_table(ps_vst), plot = FALSE, ranks = TRUE)p12 = msd2$gg + ggtitle(&quot;Mean vs. STD for VST counts of taxa&quot;) +theme_bw() + xlab(&quot;Mean of normalized VST counts&quot;) + ylab(&quot;Standard deviation of VST counts&quot;)p11 + p12 + plot_layout(ncol = 2 , heights = 8) # Standardization (x-mean(x)/sd(x))tb = ps_rar@otu_table %&gt;% data.frame()std = apply(tb, 2, function(x)&#123;scale(x)&#125;)rownames(std) &lt;- rownames(tb)qplot(rowSums(std), bins = 100) pca_result = prcomp(std, scale = FALSE)names(pca_result) ## [1] &quot;sdev&quot; &quot;rotation&quot; &quot;center&quot; &quot;scale&quot; &quot;x&quot;pca_result$center## BRK01 BRK02 BRK03 BRK04 BRK05 ## -4.841882e-18 -4.516532e-18 -1.260552e-17 3.100055e-18 -3.685399e-18 ## BRK06 BRK07 BRK08 BRK09 BRK10 ## 7.618008e-18 2.040467e-17 3.316007e-18 -1.672069e-17 -6.933211e-19 ## BRK11 BRK12 BRK13 BRK14 BRK15 ## -4.578867e-18 1.868983e-17 -9.308688e-18 -9.223444e-18 6.710865e-18 ## BRK16 BRK17 BRK18 BRK19 BRK20 ## 1.265311e-17 3.233746e-17 2.415258e-19 8.945689e-18 1.014977e-17 ## BRK21 BRK22 BRK23 BRK24 BRK25 ## -3.020138e-18 -2.631637e-17 -1.553153e-17 -1.329742e-17 -1.175662e-18 ## BRK26 BRK27 BRK28 BRK29 BRK30 ## 7.176868e-18 -4.081786e-18 -7.600248e-18 -1.728401e-17 1.236790e-17 ## BRK31 BRK32 BRK33 BRK34 BRK36 ## 1.065555e-17 -5.702317e-18 1.599895e-17 -9.921737e-18 -1.142879e-17 ## BRK37 BRK38 BRK39 BRK40 BRK41 ## -1.132330e-18 4.797839e-18 -1.785160e-17 -9.740593e-18 -1.431395e-18 ## BRK42 BRK43 BRK44 BRK45 BRK46 ## 7.954723e-18 2.809868e-18 9.705075e-18 1.118122e-18 -1.449013e-17 ## BRK47 BRK48 BRK49 BRK50 BRK51 ## -1.050495e-17 3.361471e-18 8.628154e-18 -6.707313e-18 6.816000e-18 ## BRK52 BRK53 BRK54 BRK55 BRK56 ## 1.298627e-17 -3.862992e-18 -2.711482e-18 4.148383e-18 1.683044e-18 ## BRK57 BRK58 BRK59 BRK60 BRK61 ## 1.528432e-17 -1.047796e-17 -2.039188e-17 -1.482258e-17 -1.254087e-17 ## BRK62 BRK63 BRK64 BRK65 BRK66 ## 3.474420e-18 3.078743e-17 -1.463362e-17 -1.260125e-17 -1.770952e-18 ## BRK67 BRK68 BRK69 BRK70 BRK71 ## -2.333565e-18 6.753132e-18 1.052697e-17 8.008267e-18 4.469648e-18 ## BRK72 BRK81 BRK82 BRK83 BRK84 ## 1.414045e-17 1.019807e-17 -3.789824e-18 -3.597314e-18 -9.277432e-18 ## BRK85 BRK86 BRK87 BRK88 BRK89 ## 9.331420e-18 4.660027e-19 1.505984e-17 -7.615166e-18 -1.365615e-17 ## BRK90 BRK91 BRK92 BRK93 BRK94 ## 1.325266e-17 9.757642e-18 -3.472288e-18 -8.391956e-18 -1.005031e-17 ## BRK95 BRK96 ## 6.060166e-18 1.130554e-17 pca_df = data.frame(PC1 = pca_result$rotation[,1], PC2 = pca_result$rotation[,2], group = sample_data(ps_rar)$group)explained_variance &lt;- pca_result$sdev^2 / sum(pca_result$sdev^2)pc_labels &lt;- paste0(&quot;PC&quot;, 1:length(explained_variance))var_df &lt;- data.frame(PC = pc_labels, ExplainedVariance = explained_variance)ggplot(pca_df, aes(x = PC1, y = PC2, color = group)) +geom_point(size = 8, alpha = 0.6) +scale_color_manual(values = colors()[c(190, 40, 30, 15, 8, 90, 35, 80, 42)]) + theme_bw() +xlab(glue(&quot;PC1, &#123;round(var_df$ExplainedVariance[1] * 100,1)&#125;%&quot;)) +ylab(glue(&quot;PC1, &#123;round(var_df$ExplainedVariance[2] * 100,1)&#125;%&quot;)) +guides(color = guide_legend(title = &quot;Group&quot;)) +geom_vline(xintercept = 0, lty = 2, color = alpha(&quot;orange&quot;, alpha = 0.7))+geom_hline(yintercept = 0, lty = 2, color = alpha(&quot;orange&quot;, alpha = 0.7)) 5.1. æ’åºå›¾cols = colors()[c(190, 20, 30, 15, 8, 90, 35, 120, 42)]#bray #bray PCoA: BC = (Î£|X_i - Y_i|) / (Î£(X_i + Y_i))bray_pcoa=ordinate(ps_log, method=&quot;PCoA&quot;, distance = &quot;bray&quot;)evals&lt;-bray_pcoa$values$Eigenvaluesbray_p = plot_ordination(ps_log, bray_pcoa, title = &quot;Bray-Curtis PCoA plot, Log&quot;, color = &quot;white&quot;) + labs(col=&quot;Group&quot;)+ geom_point( aes(fill = group), alpha = 0.75, pch = 21, size = 8, color = &quot;black&quot;, show.legend = FALSE) + #coord_fixed() + #stat_ellipse(aes(group = group, fill = group), # show.legend = F, type = &quot;t&quot;, level = 0.05, lty = 2, geom = &quot;polygon&quot;, alpha = 0.1) + labs(x = sprintf(&quot;PCo1 [%s%%]&quot;, round(evals/sum(evals)*100,1)[1]), y = sprintf(&quot;PCo2 [%s%%]&quot;, round(evals/sum(evals)*100, 2)[2])) + scale_fill_manual(values = cols) + geom_vline(xintercept = 0, lty = 2, alpha = 0.5, color = &quot;blue&quot;) + geom_hline(yintercept = 0, lty = 2, alpha = 0.5, color = &quot;blue&quot;) + theme_bw()+ theme(axis.title = element_text(face = &quot;bold&quot;), legend.title = element_text(size = 10, face = &quot;bold&quot;), legend.text = element_text(face = &quot;bold&quot;), axis.text = element_text(size = 15))#ggsave(&quot;./Beta/bray.pcoa.dig.vs.muc.jpeg&quot;, dpi = 300)wunifrac = ordinate(ps_log, method=&quot;NMDS&quot;, distance=&#x27;wunifrac&#x27;) ## Run 0 stress 0.04758852 ## Run 1 stress 0.05257593 ## Run 2 stress 0.04758856 ## ... Procrustes: rmse 3.155827e-05 max resid 8.339069e-05 ## ... Similar to previous best## Run 3 stress 0.04758858 ## ... Procrustes: rmse 3.471801e-05 max resid 8.939346e-05 ## ... Similar to previous best## Run 4 stress 0.0475886 ## ... Procrustes: rmse 1.71134e-05 max resid 5.518678e-05 ## ... Similar to previous best## Run 5 stress 0.04758853 ## ... Procrustes: rmse 1.978362e-05 max resid 5.187433e-05 ## ... Similar to previous best## Run 6 stress 0.07429898 ## Run 7 stress 0.05257595 ## Run 8 stress 0.07429908 ## Run 9 stress 0.04758852 ## ... Procrustes: rmse 1.726039e-05 max resid 4.740674e-05 ## ... Similar to previous best## Run 10 stress 0.04758851 ## ... New best solution## ... Procrustes: rmse 1.241057e-05 max resid 2.7403e-05 ## ... Similar to previous best## Run 11 stress 0.04758852 ## ... Procrustes: rmse 4.215754e-06 max resid 1.148943e-05 ## ... Similar to previous best## Run 12 stress 0.07429939 ## Run 13 stress 0.04758853 ## ... Procrustes: rmse 8.518784e-06 max resid 2.341394e-05 ## ... Similar to previous best## Run 14 stress 0.04758852 ## ... Procrustes: rmse 7.077508e-06 max resid 1.774362e-05 ## ... Similar to previous best## Run 15 stress 0.04758853 ## ... Procrustes: rmse 1.264987e-05 max resid 3.6171e-05 ## ... Similar to previous best## Run 16 stress 0.04758853 ## ... Procrustes: rmse 3.895438e-05 max resid 0.0001050886 ## ... Similar to previous best## Run 17 stress 0.04758853 ## ... Procrustes: rmse 4.289572e-05 max resid 0.0001150774 ## ... Similar to previous best## Run 18 stress 0.05257595 ## Run 19 stress 0.04758852 ## ... Procrustes: rmse 1.454469e-06 max resid 7.042092e-06 ## ... Similar to previous best## Run 20 stress 0.04758853 ## ... Procrustes: rmse 6.52229e-06 max resid 2.010471e-05 ## ... Similar to previous best## *** Best solution repeated 9 times wunifrac_p = plot_ordination(ps_log, wunifrac, title = &quot;WUNIFRAC NMDS, LogT&quot;) + geom_point( aes(fill = group), pch = 21, alpha = 0.75, color = &quot;black&quot;, size =8, show.legend = TRUE) + #coord_fixed()+ labs(fill=&quot;Group&quot;)+ scale_fill_manual(values = cols) + geom_vline(xintercept = 0, lty = 2, alpha = 0.5, color = &quot;blue&quot;) + geom_hline(yintercept = 0, lty = 2, alpha = 0.5, color = &quot;blue&quot;) + theme_bw()+ theme(axis.title = element_text(face = &quot;bold&quot;), legend.title = element_text(size = 10, face = &quot;bold&quot;), legend.text = element_text(face = &quot;bold&quot;), axis.text = element_text(size = 15))bray_p + wunifrac_p + plot_layout( heights = 8, widths = 15, ncol = 2) + plot_annotation(&quot;Ordination plots of compostional analysis&quot;, &quot;Bray-Curtis dissimilarity and\\n Weighted Unifrac phylogenetic distance&quot;, &quot;You might know this as Beta diversity&quot;) Gloomerï¼šä¸€ä¸ªåŒ…è£…â€œtax_glom()â€å‡½æ•°å¹¶å‘åˆ†ç±»å•å…ƒæ·»åŠ ç®€æ´å”¯ä¸€åç§°çš„å‡½æ•°# Gloomer#A function to create unique names for each ASV. If species is set as the taxa level, it removes any NA in Order level then attempts to use the name of one level higher taxa for those who have similar names, e.g. uncultured_bacteriumgloomer = function(ps = data, taxa_level = taxa_level, NArm = &quot;TRUE&quot;)&#123; rank.names = c(&#x27;Kingdom&#x27;,&#x27;Phylum&#x27;, &#x27;Class&#x27;, &#x27;Order&#x27;, &#x27;Family&#x27;, &#x27;Genus&#x27;, &#x27;Species&#x27;) #====================Sometimes in genus level, we might have multiple uncultured organisms, which if we want to make unique out of them for the species level it won&#x27;t work==== #since adding uncultured to uncultered is sill duplication. therefore if the taxa_level is set to species we first make a unique genus and then we go further to the speices===##Removing unculured Familyps = subset_taxa(ps, !Family %in% c(&quot;uncultured&quot;, &quot;NA&quot;, &quot;uncategorized&quot;, &quot;unassigend&quot;, &quot;&quot;, &quot; &quot;)) if(taxa_level == &quot;Species&quot;) &#123; ps = subset_taxa(ps, !Genus %in% NA)#we remove genus tagged NAtax_table(ps)[, taxa_level] &lt;- ifelse(is.na(tax_table(ps)[, taxa_level]), paste0(&quot;unknown&quot;), paste(tax_table(ps)[, taxa_level]))#convert NA in species into unknown physeq = tax_glom(physeq = ps, taxrank = taxa_level, NArm = NArm) taxdat = tax_table(physeq)[, seq_along(rank.names[1:which(rank.names == taxa_level)])] taxdat = taxdat[complete.cases(taxdat),] %&gt;% as.data.frame otudat = otu_table(physeq) #first take care of the uncultured genustaxdat[,6] = ifelse(taxdat[,6] %in% c(&quot;uncategorized&quot;, NA, &quot;uncultured&quot;, &quot;unassigend&quot;, &quot;&quot;, &quot; &quot;), paste0(&quot;[&quot;, taxdat[,length(rank.names[1:which(rank.names==&quot;Genus&quot;)])-1], &quot;]&quot;, &quot;_&quot;, taxdat[,6]), taxdat[,6]) spec1 = taxdat[, taxa_level] %&gt;% as.vectorspec2 = taxdat[, taxa_level] %&gt;% as.vector uni = matrix(NA, ncol = length(spec2), nrow = length(spec1)) for(i in seq_along(spec1))&#123; for(j in seq_along(spec2))&#123; uni[i, j] = ifelse(spec1[i] == spec2[j] , &quot;TRUE&quot;, &quot;FALSE&quot;) &#125; &#125;rownames(uni) &lt;-spec1colnames(uni) &lt;- spec2 uni[upper.tri(uni, diag = TRUE)] = 0 #get rid of diagonals and upper triangleduplis = uni %&gt;% reshape2::melt() %&gt;% filter(value == &quot;TRUE&quot;) if(dim(duplis)[[1]] &gt; 0) &#123;duplis = uni %&gt;% reshape2::melt() %&gt;% filter(value == &quot;TRUE&quot;) %&gt;% dplyr::select(1) %&gt;% unique() %&gt;% unlist %&gt;% as.vectortaxdat = taxdat %&gt;% mutate( uni= ifelse(taxdat[, taxa_level] %in% duplis, paste0(&quot;[&quot;, taxdat[,length(rank.names[1:which(rank.names==taxa_level)])-1], &quot;]&quot;, &quot;_&quot;, taxdat[,taxa_level]), taxdat[,taxa_level]))#check if all the names are unique at species level, otherwise we will bring family instead of genus dupies &lt;- taxdat[duplicated(taxdat[,&quot;uni&quot;]), &quot;uni&quot;] if(length(dupies)&gt;0) &#123; taxdat = taxdat %&gt;% data.frame %&gt;% mutate( uni2= ifelse(taxdat[, &quot;uni&quot;] %in% dupies, paste0(&quot;[&quot;, taxdat[,length(rank.names[1:which(rank.names==taxa_level)])-2], &quot;]&quot;, &quot;_&quot;, taxdat[,&quot;uni&quot;]), taxdat[,&quot;uni&quot;])) taxdat[, taxa_level] = taxdat[, &quot;uni2&quot;] taxdat[, &quot;uni&quot;] &lt;- NULL taxdat[, &quot;uni2&quot;] &lt;- NULL taxdat &lt;- as(taxdat, &quot;matrix&quot;) rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level] rownames(taxdat) &lt;- taxdat[, taxa_level] taxdat &lt;- tax_table(taxdat) taxa_names(physeq) &lt;- taxa_names(taxdat) tax_table(physeq) &lt;- taxdat otu_table(physeq) &lt;- otudat &#125; else &#123; taxdat[, taxa_level] = taxdat[, &quot;uni&quot;]taxdat[, &quot;uni&quot;] &lt;- NULLtaxdat &lt;- as(taxdat, &quot;matrix&quot;) rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level]rownames(taxdat) &lt;- taxdat[, taxa_level]taxdat &lt;- tax_table(taxdat)taxa_names(physeq) &lt;- taxa_names(taxdat)tax_table(physeq) &lt;- taxdatotu_table(physeq) &lt;- otudat &#125; &#125; else &#123; taxdat &lt;- as.matrix(taxdat) taxdat &lt;- tax_table(taxdat)rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level]rownames(taxdat) &lt;- taxdat[, taxa_level]taxdat &lt;- tax_table(taxdat)taxa_names(physeq) &lt;- taxa_names(taxdat)tax_table(physeq) &lt;- taxdatotu_table(physeq) &lt;- otudat &#125; #==========================================# &#125; else if (taxa_level == &quot;Genus&quot;) &#123; physeq = tax_glom(physeq = ps, taxrank = taxa_level, NArm = NArm) taxdat = tax_table(physeq)[, seq_along(rank.names[1:which(rank.names == taxa_level)])] taxdat = taxdat[complete.cases(taxdat),] %&gt;% as.data.frame otudat = otu_table(physeq) # take care of the uncultured genustaxdat[,6] = ifelse(taxdat[,6] %in% c(&quot;uncategorized&quot;, NA, &quot;uncultured&quot;, &quot;unassigend&quot;, &quot;&quot;, &quot; &quot;), paste0(&quot;[&quot;, taxdat[,length(rank.names[1:which(rank.names==taxa_level)])-1], &quot;]&quot;, &quot;_&quot;, taxdat[,taxa_level]), taxdat[,taxa_level]) gen1 = taxdat[, taxa_level] %&gt;% as.vectorgen2 = taxdat[, taxa_level] %&gt;% as.vector uni = matrix(NA, ncol = length(gen2), nrow = length(gen1)) for(i in seq_along(gen1))&#123; for(j in seq_along(gen2))&#123; uni[i, j] = ifelse(gen1[i] == gen2[j] , &quot;TRUE&quot;, &quot;FALSE&quot;) &#125; &#125;rownames(uni) &lt;-gen1colnames(uni) &lt;- gen2 uni[upper.tri(uni, diag = TRUE)] = 0 #get rid of diagonals and upper triangleduplis = uni %&gt;% reshape2::melt() %&gt;% filter(value == &quot;TRUE&quot;) if(dim(duplis)[[1]] &gt; 0)&#123;#if there is not duplications, we can simply use the taxa names as the row name duplis = uni %&gt;% reshape2::melt() %&gt;% filter(value == &quot;TRUE&quot;) %&gt;% dplyr::select(1)%&gt;% unique() %&gt;% unlist %&gt;% as.vector taxdat = taxdat %&gt;% mutate( uni= ifelse(taxdat[, taxa_level] %in% duplis, paste0(&quot;[&quot;, taxdat[,length(rank.names[1:which(rank.names==taxa_level)])-1], &quot;]&quot;, &quot;_&quot;, taxdat[,taxa_level]), taxdat[,taxa_level])) taxdat[, taxa_level] = taxdat[, &quot;uni&quot;] taxdat[, &quot;uni&quot;] &lt;- NULL taxdat &lt;- as(taxdat, &quot;matrix&quot;) rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level] rownames(taxdat) &lt;- taxdat[taxdat[,taxa_level] %in% rownames(otudat), taxa_level] taxdat &lt;- as.matrix(taxdat) taxdat &lt;- tax_table(taxdat) taxa_names(physeq) &lt;- taxa_names(taxdat) tax_table(physeq) &lt;- taxdat otu_table(physeq) &lt;- otudat &#125; else &#123; taxdat &lt;- as.matrix(taxdat) taxdat &lt;- tax_table(taxdat) rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level] rownames(taxdat) &lt;- taxdat[, taxa_level] taxdat &lt;- tax_table(taxdat) taxa_names(physeq) &lt;- taxa_names(taxdat) tax_table(physeq) &lt;- taxdat otu_table(physeq) &lt;- otudat &#125; &#125; else &#123; physeq = tax_glom(physeq = ps, taxrank = taxa_level, NArm = TRUE) taxdat = tax_table(physeq)[, seq_along(rank.names[1:which(rank.names == taxa_level)])] taxdat = taxdat[complete.cases(taxdat),] %&gt;% as.data.frameotudat = otu_table(physeq) spec1 = taxdat[, taxa_level] %&gt;% as.vectorspec2 = taxdat[, taxa_level] %&gt;% as.vector uni = matrix(NA, ncol = length(spec2), nrow = length(spec1)) for(i in seq_along(spec1))&#123; for(j in seq_along(spec2))&#123; uni[i, j] = ifelse(spec1[i] == spec2[j] , &quot;TRUE&quot;, &quot;FALSE&quot;) &#125; &#125;rownames(uni) &lt;-spec1colnames(uni) &lt;- spec2 uni[upper.tri(uni, diag = TRUE)] = 0 #get rid of diagonals and upper triangleduplis = uni %&gt;% reshape2::melt() %&gt;% filter(value == &quot;TRUE&quot;)if(dim(duplis)[[1]] &gt; 0)&#123;#if there is not duplications, we can simply use the taxa names as the row name duplis = uni %&gt;% reshape2::melt() %&gt;% filter(value == &quot;TRUE&quot;) %&gt;% dplyr::select(1)%&gt;% unique() %&gt;% unlist %&gt;% as.vectortaxdat = taxdat %&gt;% mutate( uni= ifelse(taxdat[, taxa_level] %in% duplis, paste(taxdat[,length(rank.names[1:which(rank.names==taxa_level)])-1], &quot;_&quot;, taxdat[,taxa_level]), taxdat[,taxa_level])) taxdat[, taxa_level] = taxdat[, &quot;uni&quot;]taxdat[, &quot;uni&quot;] &lt;- NULLtaxdat &lt;- as.matrix(taxdat) rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level]rownames(taxdat) &lt;- taxdat[, taxa_level]taxdat &lt;- tax_table(taxdat)taxa_names(physeq) &lt;- taxa_names(taxdat)tax_table(physeq) &lt;- taxdatotu_table(physeq) &lt;- otudat&#125; else &#123;taxdat &lt;- as.matrix(taxdat) taxdat &lt;- tax_table(taxdat)rownames(otudat) &lt;- taxdat[rownames(taxdat) %in% rownames(otudat), taxa_level]rownames(taxdat) &lt;- taxdat[, taxa_level]taxdat &lt;- tax_table(taxdat)taxa_names(physeq) &lt;- taxa_names(taxdat)tax_table(physeq) &lt;- taxdatotu_table(physeq) &lt;- otudat&#125;#ps = phyloseq(otu_table(otudat, taxa_are_rows = T), tax_table(as.matrix(taxdat)), sample_data(physeq)) &#125;return(physeq) &#125; 5.2. åŸºäºå›¾è¡¨çš„ beta å¤šæ ·æ€§åˆ†ælibrary(igraph, verbose = FALSE)library(ggnetwork, verbose = FALSE)library(phyloseqGraphTest, verbose = FALSE)#For total none-rarefied datasetpst.spec &lt;- gloomer(ps = pst, taxa_level = &quot;Species&quot;, NArm = TRUE)ps_total = prune_taxa(taxa_sums(pst.spec)&gt;1000, pst.spec)#filtering the taxa based on total sumsample_data(ps_total)$sampleID &lt;- rownames(sample_data(ps_total))net &lt;- make_network(ps_total, directed = FALSE, max.dist = 0.35, distance = &quot;bray&quot;, type = &quot;samples&quot;)sampledata &lt;- sample_data(ps_total) %&gt;% data.framesampledata$sampleID &lt;- rownames(sampledata)V(net)$id &lt;- sampledata[names(V(net)), &quot;group&quot;] %&gt;% as.vectorV(net)$sample &lt;- rownames(sampledata)[rownames(sampledata) %in% names(V(net))] %&gt;% as.vectorV(net)$sample_type &lt;- sampledata[names(V(net)), &quot;group&quot;] %&gt;% as.vector#graph permutational testset.seed(2023)graph.test &lt;- graph_perm_test(ps_total, sampletype = &quot;group&quot;, max.dist = 0.35, grouping = &quot;sampleID&quot;, distance = &quot;bray&quot;, type = &quot;mst&quot;, nperm = 1000) print(glue(&quot;Test statistic for the graph-based analysis indicates that\\n with p-value = &#123;graph.test$pval&#125;, \\n we REJECT the Null hypothesis that the distribution of taxa in samples from different groiups are similar!&quot;)) ## Test statistic for the graph-based analysis indicates that## with p-value = 0.000999000999000999, ## we REJECT the Null hypothesis that the distribution of taxa in samples from different groiups are similar! V(graph.test$net)$group &lt;- sampledata[names(V(graph.test$net)), &quot;group&quot;] %&gt;% as.vectorplotNet1 = phyloseqGraphTest::plot_test_network(graph.test) + theme(legend.text = element_text(size = 8), legend.title = element_text(size = 9)) + geom_nodes(size = 4, aes(color = sampletype))+scale_color_manual(values = cols)plotPerm1=plot_permutations(graph.test, bins = 40) + geom_text(aes(label = glue(&quot;&#123;ifelse(round(graph.test$pval, 2) == 0, &#x27;P &lt; 0.01&#x27;, round(graph.test$pval, 2))&#125;&quot;), x = 65, y =40), color = &quot;red&quot;) + theme_bw()+ ggtitle(&quot;Permutation test for pure edges&quot;, &quot;Bray-Curtis&quot;)grid.arrange(ncol = 2, plotNet1, plotPerm1) + geom_col(inherit.aes = F, color = &quot;red&quot;) ## NULL#ggsave(&quot;./graph_perm_total.jpeg&quot;, plot = net.grid, device = &quot;jpeg&quot;, width = 15, beight = 10, dpi = 300) 5.3. Betaå¤šæ ·æ€§æŒ‡æ•°çš„ç»Ÿè®¡åˆ†æï¼šåŸºäºè·ç¦»çš„å†—ä½™åˆ†æï¼ˆdbRDAï¼‰#Calculating Bray-Curtis dissimilarity coefficeintsbray_log = phyloseq::distance(ps_log, method = &quot;bray&quot;) 5.3.1. æ£€æŸ¥è´¨å¿ƒå‘¨å›´æ–¹å·®çš„ç¦»æ•£ç¨‹åº¦ï¼ˆæ–¹å·®åŒæºæ£€éªŒï¼‰#test for the disperssion of the variance around the centroidslibrary(vegan)library(permute, verbose = FALSE)#set the age of the animal as the random variableset.seed(1990)h &lt;- with(data = data.frame(sample_data(ps_log)), how(blocks = group, nperm = 999))##total data#Now we do a Homogeneity of dispersion testset.seed(10)bray.disp &lt;- vegan::betadisper(bray_log, group = sample_data(ps_log)$group, type = &quot;centroid&quot;)#if the p-value is significant, it means that there is a significant difference in variance for any of the tested levels. perm.test = permutest(bray.disp, permutation =h, pairwise = T)p.val.perm = perm.test$tab$`Pr(&gt;F)`[[1]]disp.centroid = bray.disp$centroids %&gt;% as.data.framedisp.vectors = bray.disp$vectors %&gt;% as.data.frameeig.vals = bray.disp$eig#jpeg( &quot;./Beta/dispersion of variance_bray_total_sample.type.jpeg&quot;, quality = 100)plot(bray.disp, col = cols, bty = &quot;n&quot;, las = 1, main = &quot;Dispersion of variance around the centroids, \\n bray | LogT dataset&quot;, sub=NULL, xlab = sprintf(&quot;PCo1 [%s%%]&quot;, round(eig.vals/sum(eig.vals)*100,1)[1]), ylab = sprintf(&quot;PCo2 [%s%%]&quot;, round(eig.vals/sum(eig.vals)*100,1)[2])); text(glue(&quot;P = &#123;p.val.perm&#125;&quot;), x = -0.1, y = -0.29, cex = 1.5, col = &quot;red&quot;) 5.3.2. æ•°æ®åº“RDAæ¨¡å‹#Whole datasetset.seed(2023)h &lt;- with(data = data.frame(sample_data(ps_log)), how(blocks = group, nperm = 999))bray.dbrda = dbrda(t(otu_table(ps_log)) ~ group, dist = &quot;bray&quot;, permutations=h, data = sample_data(ps_log)%&gt;%data.frame)#Sex not sig, so reduced the modelbray.dbrda ## Call: dbrda(formula = t(otu_table(ps_log)) ~ group, data =## sample_data(ps_log) %&gt;% data.frame, distance = &quot;bray&quot;, permutations =## h)## ## Inertia Proportion Rank RealDims## Total 13.5609 1.0000 ## Constrained 8.3821 0.6181 8 8## Unconstrained 5.1788 0.3819 78 62## Inertia is squared Bray distance ## ## Eigenvalues for constrained axes:## dbRDA1 dbRDA2 dbRDA3 dbRDA4 dbRDA5 dbRDA6 dbRDA7 dbRDA8 ## 4.931 1.071 0.857 0.555 0.470 0.343 0.138 0.017 ## ## Eigenvalues for unconstrained axes:## MDS1 MDS2 MDS3 MDS4 MDS5 MDS6 MDS7 MDS8 ## 1.9737 1.1133 0.6623 0.4507 0.1619 0.1129 0.0996 0.0569 ## (Showing 8 of 78 unconstrained eigenvalues) permutest(x = bray.dbrda, by = &quot;terms&quot;, permutations = h) ## ## Permutation test for dbrda under reduced model ## ## Blocks: group ## Permutation: free## Number of permutations: 999## ## Model: dbrda(formula = t(otu_table(ps_log)) ~ group, data =## sample_data(ps_log) %&gt;% data.frame, distance = &quot;bray&quot;, permutations =## h)## Permutation test for all constrained eigenvalues## Df Inertia F Pr(&gt;F)## group 8 8.3821 15.781 1## Residual 78 5.1788 5.3.3. ç»˜åˆ¶æ¨¡å‹æå–å›¾# Make the plot out of the model, which is the variation explained only by the terms #digestascore.site = vegan::scores(bray.dbrda, display = &quot;sites&quot;) %&gt;% as.data.framescore.centroid = vegan::scores(bray.dbrda, display = &quot;cn&quot;)%&gt;% as.data.framerownames(score.centroid)&lt;- levels(sample_data(ps_log)$group)eig.vals = bray.dbrda$CCA$eiginertia.total = bray.dbrda$tot.chi #total variation (inertia) explained. #this number should be used as the denominator for measuring the amount of variance out of totoal variance wxplained by each dbrda#Digestascore.site %&gt;% ggplot(aes(dbRDA1, dbRDA2)) +geom_point(aes(fill = sample_data(ps_log)$group), color = &quot;black&quot;, pch = 21, alpha = 0.5, size =6 ) + geom_hline(yintercept = 0, lty = 2, alpha =0.5) + geom_vline(xintercept = 0, lty = 2, alpha = 0.5)+scale_fill_manual(values = cols) + theme_bw() + scale_y_continuous(na.value = c(-2, 3), n.breaks = 10) +scale_x_continuous(na.value = c(-1, 1), n.breaks = 10) + labs(fill =&quot;Groups&quot;) + xlab(label = paste(&quot;dbRDA1 [&quot;, round(eig.vals[[1]]/sum(eig.vals)*100, 1), &quot;% of fitted and&quot;, round(eig.vals[[1]]/inertia.total*100, 1), &quot;% of total variation]&quot;)) + ylab(label = paste(&quot;dbRDA2 [&quot;, round(eig.vals[[2]]/sum(eig.vals)*100, 1), &quot;% of fitted and&quot;, round(eig.vals[[2]]/inertia.total*100, 1), &quot;of total variation]&quot;)) + theme(axis.title = element_text(size = 10), text = element_text(size = 13, face = &quot;bold&quot;), axis.text.x =element_text(size =10, face = &quot;bold&quot;),axis.text.y =element_text(size =10, face = &quot;bold&quot;)) + ggtitle(label = &quot;dbRDA plot of Bray&quot;, &quot;LogT data&quot;) #ggsave(&quot;./Beta/bray.dbRDA.dig.jpeg&quot;, height = 8, width = 9, dpi =300) 6. å·®å¼‚ä¸°åº¦åˆ†æï¼šDESeq26.1. å †ç§¯æ¡å½¢å›¾#Aglomerating the taxaphyl = gloomer(ps_rar, taxa_level = &quot;Phylum&quot;, NArm = TRUE)spec = gloomer(ps_rar, taxa_level = &quot;Species&quot;, NArm = TRUE)#Barplot of relative abundance of phylum in digestatrans_phyl &lt;- merge_samples(phyl, &quot;group&quot;)relabund_phyl &lt;- transform_sample_counts(trans_phyl, function(x) x / sum(x)*100)relabund_phyl = prune_taxa( taxa_sums(relabund_phyl)&gt;0.0001, relabund_phyl)#choosing colorsphylcol=c( &quot;deepskyblue&quot;,&#x27;springgreen3&#x27;,&#x27;snow3&#x27;,&#x27;burlywood4&#x27;, &#x27;cadetblue&#x27;, &#x27;darkblue&#x27;, &#x27;cornflowerblue&#x27;,&#x27;deeppink2&#x27;,&#x27;orangered&#x27;, &#x27;dimgrey&#x27;, &#x27;red&#x27;,&#x27;limegreen&#x27;, &#x27;cyan1&#x27;,&#x27;darkmagenta&#x27;, &#x27;purple&#x27;, &#x27;cyan4&#x27;, &#x27;gold&#x27;) phy_col = phylcol[1:7] phyl_p &lt;- plot_bar(relabund_phyl, fill=&quot;Phylum&quot;) + scale_fill_manual(values = phylcol) + xlab(&quot;Groups&quot;) + ylab(&quot;Relative abundance, %&quot;)+ ggtitle(label = &quot;Stacked barplot&quot;, &quot;rarefied, relabund data &gt; 0.01%&quot;) + theme_bw() + theme( legend.position = &quot;right&quot;, text = element_text(size =15, face = &quot;bold&quot;)) #+ #coord_flip() phyl_p 6.2. DESeq2è¯·è®°ä½ä½¿ç”¨åŸå§‹æ•°æ®ï¼Œå› ä¸º DESEq2 å†…éƒ¨ä¼šè®¡ç®—å¤§å°å› å­å’Œè‰²æ•£çš„å·®å¼‚ã€‚ phyl = gloomer(pst, taxa_level = &quot;Phylum&quot;, NArm = TRUE)spec = gloomer(pst, taxa_level = &quot;Species&quot;, NArm = TRUE)#converting phylosq to deseqphyl_dds &lt;- phyloseq_to_deseq2(phyl, design = ~ group) spec_dds &lt;- phyloseq_to_deseq2(spec, design = ~ group)#calculate geometric means prior to estimate size factorsgm.mean = function(x, na.rm= TRUE) &#123; exp(sum(log(x[x&gt;0]), na.rm=na.rm)/length(x))&#125;##Phylum levelgeo.mean = apply(counts(phyl_dds), 1, gm.mean)phyl_dds = estimateSizeFactors(phyl_dds, geoMeans = geo.mean)phyl_dds &lt;-DESeq(phyl_dds, test = &quot;Wald&quot;, fitType = &quot;parametric&quot;)#Species levelgeo.mean = apply(counts(spec_dds), 1, gm.mean)spec_dds = estimateSizeFactors(spec_dds, geoMeans = geo.mean)spec_dds &lt;-DESeq(spec_dds, test = &quot;Wald&quot;, fitType = &quot;parametric&quot;) 6.3. å¯è§†åŒ– DESeq ç»“æœï¼šç€‘å¸ƒå›¾å’Œç«å±±å›¾library(ggrepel, verbose = FALSE)#Waterfall plot for phylumsigtabspec = results(spec_dds, contrast = c(&quot;group&quot;, &quot;Mock&quot;, &quot;A&quot;)) %&gt;% data.frame() %&gt;% filter(padj &lt;=0.05, abs(log2FoldChange) &gt; 7 ) sigtabspec$Order &lt;- tax_table(spec)[,4][rownames(tax_table(spec)) %in% rownames(sigtabspec)] sigtabspec$Species &lt;- rownames(sigtabspec)#plotting for the phylum alonespec_col=c( &quot;deepskyblue&quot;,&#x27;springgreen3&#x27;,&#x27;snow3&#x27;,&#x27;burlywood4&#x27;, &#x27;cadetblue&#x27;, &#x27;darkblue&#x27;, &#x27;cornflowerblue&#x27;,&#x27;deeppink2&#x27;,&#x27;orangered&#x27;, &#x27;dimgrey&#x27;, &#x27;red&#x27;,&#x27;limegreen&#x27;, &#x27;cyan1&#x27;,&#x27;darkmagenta&#x27;, &#x27;purple&#x27;, &#x27;cyan4&#x27;, &#x27;gold&#x27;, &#x27;#470e19&#x27;, &#x27;#124435&#x27;, &#x27;#1d723f&#x27;, &#x27;#57e9ff&#x27;) colindex = data.frame(color = spec_col[1:length(unique(sigtabspec$Order))], Order = sort(unique(sigtabspec$Order)))ords = unique(data.frame(sigtabspec$Order)) %&gt;% pullcolors = c()for(i in ords)&#123; colors[i] = colindex[colindex$Order == i,1]&#125;# Phylum orderx = tapply(sigtabspec$log2FoldChange, sigtabspec$Order, function(x) max(x))x = sort(x, TRUE)sigtabspec$Order = factor(as.character(sigtabspec$Order), levels=names(x))#Species reorderx = tapply(sigtabspec$log2FoldChange, sigtabspec$Species, function(x) max(x))x = sort(x, TRUE)sigtabspec$Species = factor(as.character(sigtabspec$Species), levels=names(x))waterfall_p = ggplot(sigtabspec, aes(y=Species, x=log2FoldChange), stroke = 0.5) + geom_vline(xintercept = 0.0, color = &quot;orange&quot;, size = 0.5, lty = 2) + geom_point(aes(fill = Order), alpha = 0.6, size = 10, color = &quot;black&quot;, shape = 21, stroke = 0.5) + theme_bw() + scale_x_continuous(limits = c(-20, 15), n.breaks = 10) + ggtitle(&quot;Log2FoldChange of Species&quot;, &quot;Mock vs. A&quot;) + scale_fill_manual(values = colors[names(colors) %in% sigtabspec$Order]) #ggsave(&quot;./deseq2/mucus/difabund_muc_DiarNoInfl_vs_NoDiar.jpeg&quot;, device = &quot;jpeg&quot;, dpi = 300)waterfall_p rm(sigtabphyl, alpha, x, colors, colindex, phyla) #Volcano plotalpha = 0.05spec_dat = results(spec_dds, contrast = c(&quot;group&quot;, &quot;Mock&quot;, &quot;A&quot;))%&gt;% data.framespec_dat = spec_dat[complete.cases(spec_dat),]spec_dat$Significant = ifelse(spec_dat$padj &lt;= alpha, paste0(&quot;FDR &lt; &quot;, alpha), &quot;Not Sig&quot;) %&gt;% factor(levels = c(&quot;FDR &lt; 0.05&quot;, &quot;Not Sig&quot;)) spec_taxa = tax_table(spec) %&gt;% as.matrixsigtabspec = cbind(as(spec_dat, &quot;data.frame&quot;), as(spec_taxa[rownames(spec_taxa) %in% rownames(spec_dat),], &quot;matrix&quot;))#a costumized color schemephylcol=c(&#x27;coral4&#x27;, &quot;deeppink&quot;,&#x27;brown2&#x27;,&#x27;antiquewhite4&#x27;, &#x27;cornflowerblue&#x27;, &#x27;plum4&#x27;, &#x27;darkgoldenrod3&#x27;,&#x27;aquamarine4&#x27;, &#x27;yellow&#x27;, &#x27;red&#x27;, &#x27;darkblue&#x27;, &#x27;Maroon&#x27;, &#x27;Gray&#x27;, &#x27;steelblue2&#x27;,&#x27;darkgreen&#x27;, &#x27;tomato1&#x27;, &#x27;cyan4&#x27;, &#x27;magenta&#x27;)colindex = data.frame(color = phylcol[1:length(unique(tax_table(spec)[,2]))], phylum = sort(unique(tax_table(spec)[,2])))phyla = unique(data.frame(tax_table(spec)[,2])) %&gt;% pullcolors = c()for(i in phyla)&#123; colors[i] = colindex[colindex$Phylum == i,1]&#125;#filtering out the taxa below 2 LFC#sigtabspec = sigtabspec[abs(sigtabspec$log2FoldChange)&gt;2,]volc_p = sigtabspec %&gt;% group_by(log2FoldChange) %&gt;% arrange(desc(log2FoldChange)) %&gt;% ggplot(aes(x = log2FoldChange, y = -log10(pvalue), label = Genus)) + geom_hline(yintercept = -log10(sigtabspec[sigtabspec$Significant == &quot;Not Sig&quot;,&quot;pvalue&quot;]) %&gt;% max, color = alpha(&quot;red&quot;,0.5), lty = 2) +geom_vline(xintercept = 0, color = alpha(&quot;black&quot;, 0.3)) +geom_point(data = sigtabspec[sigtabspec$Significant == &quot;Not Sig&quot;,], aes(x = log2FoldChange, y = -log10(pvalue)), color = alpha(&quot;darkgreen&quot;, 0.6), size = 2) + theme_bw(base_size = 12) + theme(legend.position= &quot;right&quot;, text = element_text(size = 15, face = &quot;bold&quot;)) + geom_point(data = sigtabspec[sigtabspec$Significant == &quot;FDR &lt; 0.05&quot;,], aes(x = log2FoldChange, y = -log10(pvalue), fill = Phylum), size = 6, alpha = 0.5, color = &quot;black&quot;, shape = 21, stroke = 0.5) + scale_fill_manual(values = colors[names(colors) %in% sigtabspec[sigtabspec$Significant == &quot;FDR &lt; 0.05&quot;, &quot;Phylum&quot;]]) +geom_text_repel( nudge_y = 0.15, nudge_x = -.5, data= top_n(sigtabspec[sigtabspec$Significant == &quot;FDR &lt; 0.05&quot; &amp; sigtabspec$log2FoldChange &lt; -2,], n = -10, wt = pvalue), aes(label = Genus), size = 2.5, box.padding = unit( 0.4, units =&quot;lines&quot;), point.padding = unit(0.4, &quot;lines&quot;), max.overlaps = 20) + geom_text_repel(nudge_y = 0, nudge_x =0.5, data= top_n(sigtabspec[sigtabspec$Significant == &quot;FDR &lt; 0.05&quot; &amp; sigtabspec$log2FoldChange &gt; 2,], -10, pvalue), aes(label = Genus), size = 2, box.padding = unit( 0.4, units =&quot;lines&quot;), point.padding = unit(0.4, &quot;lines&quot;), max.overlaps = 20)+geom_text( aes(x = 4, y =0, label = &quot;Not Sig&quot;), color = &quot;red&quot;, size = 2.5) +geom_text(aes(x = 4, y =5, label = &quot;FDR &lt; 0.05&quot;), color = &quot;red&quot;, size = 2.5)+ ggtitle (label = &quot;Volcano Plot of the top 10 most significant log2FoldChange&quot;, &quot;Species in Mock vs. A groups&quot;) + scale_y_continuous(limits = c(0, 10), n.breaks = 5) + scale_x_continuous(limits = c(-7.5, 6), n.breaks = 10) + guides(size = &quot;none&quot;) volc_p #ggsave(&quot;./deseq2/mucus/volc_gen_DiarNoInfl_vs_NoDiar_muc.jpeg&quot;, device = &quot;jpeg&quot;, dpi = 300) 7. ç”Ÿç‰©æ ‡å¿—ç‰©å’Œåˆ†ç±»å•å…ƒæ•°æ®ä¹‹é—´çš„çƒ­å›¾å…³è”#correlation heatmap between biomarker and the Genusgen &lt;- gloomer(ps_rar, taxa_level = &quot;Genus&quot;, NArm = TRUE)gen_log = filter_taxa(gen, function(x) sum(x&gt;0)&gt;0, TRUE) #filtering the zero counts outgen_log = transform_sample_counts(gen_log, function(x) &#123;log(1+x)&#125;)# Creating dummy variables biodf = sample_data(gen_log)biodf = data.frame(biodf, geneA = rnorm(87, mean = 0, sd = 1), geneB = rnorm(87, mean = 0, sd = 0.5), geneC = rnorm(87, mean = 0, sd = 0.005)) %&gt;% select(-c(1:2)) %&gt;% as.matrix() countdf = as.matrix(otu_table(gen_log)) countdf = countdf[!rownames(countdf) %in% c(&quot;Unknown&quot;, &quot;uncultured&quot;, &quot;Uncultured&quot;, &quot;Unassigned&quot;, &quot;NA&quot;),] countdf = t(countdf) countdf = countdf[rownames(countdf) %in% rownames(biodf),] #cor gene taxacor_main = Hmisc::rcorr(countdf, biodf, type = &quot;spearman&quot;)cors = cor_main$rcors = cors[rownames(cors) %in% colnames(countdf), colnames(cors) %in% colnames(biodf)] #rows as taxa, cols as chemical data#calculating the qvalues for the correlationscor.pval = cor_main$P[rownames(cor_main$P) %in% rownames(cors) , colnames(cor_main$P) %in% colnames(cors)] cor.qval = p.adjust(cor.pval, method = &quot;BH&quot;)q.vals = matrix(cor.qval, ncol = ncol(cor.pval), nrow = nrow(cor.pval), dimnames = list(rownames(cor.pval), colnames(cor.pval))) #Adding significance signes to the qval matrix to be used in the heatmap later onq.vals[cor.qval &lt;0.05] = &quot;*&quot;q.vals[cor.qval &gt;= 0.05] = &quot;&quot;library(Biobase, verbose = FALSE)asvdat = as(cors,&quot;matrix&quot;)#in the aassay dataset, we add our correlation matrix instead of the abundance matrixtaxadat = Biobase::AnnotatedDataFrame(data.frame(cors))#taxa tablepdata = cors %&gt;% data.framex = ExpressionSet(assayData = asvdat, featureData = taxadat )#Adding phenotype datapData(x) &lt;- pdata # Filtering based on row standard deviation and choosing the most variable 50 taxalibrary(matrixStats)sds &lt;- rowSds(Biobase::exprs(x))o &lt;- order(sds, decreasing = TRUE)[1:50]h_1 &lt;- hclust(dist(Biobase::exprs(x)[o,]), method = &quot;ward.D2&quot;)h_2 &lt;- hclust(dist(t(Biobase::exprs(x)[o,])), method = &quot;ward.D2&quot;)#making a phylum annotation and it only accepts one column dataframerow.annot = gen_log@tax_table[rownames(gen_log@tax_table) %in% rownames(Biobase::exprs(x)[o,]),2]#making color index for the phylum annotation phylcol=c(&#x27;coral4&#x27;, &#x27;cyan&#x27;,&#x27;#ff00aa&#x27;, &#x27;tomato1&#x27;, &#x27;cornflowerblue&#x27;, &#x27;plum4&#x27;, &#x27;darkgoldenrod3&#x27;,&#x27;aquamarine4&#x27;, &#x27;cadetblue2&#x27;, &#x27;red&#x27;, &#x27;darkblue&#x27;, &#x27;Maroon&#x27;, &#x27;Gray&#x27;, &#x27;steelblue2&#x27;,&#x27;darkmagenta&#x27;, &#x27;antiquewhite4&#x27;, &quot;darkorange&quot;, &#x27;darkgreen&#x27;)set.seed(2)phylcol = sample(phylcol, size = length(unique(row.annot[,1])), replace = F)phyl.col = data.frame(Phylum = unique(row.annot[,1]), phyl.col = phylcol[1:length(unique(row.annot[,1]))])rownames(phyl.col) &lt;- NULLphyl.col = column_to_rownames(phyl.col, &quot;Phylum&quot;) %&gt;% as.matrixlibrary(RColorBrewer, verbose = FALSE) mat = matrix(NA, ncol = 1, nrow = nrow(row.annot))for(i in 1:nrow(row.annot))&#123; mat[i,] = ifelse(row.annot[i,1][[1]] %in% rownames(phyl.col), phyl.col[rownames(phyl.col) %in% row.annot[i,1][[1]] ,1], &quot;NA&quot;)&#125;colnames(mat) &lt;- &quot;col&quot;row.annot = cbind(row.annot, mat) %&gt;% data.frame()pheatmap(Biobase::exprs(x)[o,], annotation_row = row.annot %&gt;% select(1), cellheight = 12, annotation_colors = list( Phylum = phyl.col[,1]), cellwidth = 15, cutree_rows = 4, border_color = NA, fontsize_number = 15, number_color = &quot;black&quot;, display_numbers = q.vals[rownames(q.vals) %in% rownames(Biobase::exprs(x)[o,]), colnames(q.vals) %in% colnames(exprs(x)[o,])], angle_col = 45, Rowv = as.dendrogram(h_1), Colv = as.dendrogram(h_2), cutcluster_rows = T, cluster_cols = F, col = brewer.pal(9, &quot;Reds&quot;), width = 10, height = 12, main = &quot;Spearman correlation of top 50 Genre \\nand 3 Genes, clustered row &quot;) #ggsave(plot = pheat.chem.scfa, &quot;./heatmap/heatmap.SCFA.gen_50.jpeg&quot;, dpi = 750, height = 10, width = 8) åœ¨åŸå‡è®¾ä¸‹ï¼Œp å€¼æ˜¯å…·æœ‰å‡åŒ€åˆ†å¸ƒçš„éšæœºå€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æ‰§è¡Œè°ƒæ•´åçš„ p å€¼æ¥æ ¡æ­£æ—é”™è¯¯ç‡ (FWER)ã€‚FWER æ˜¯æŒ‡åŒæ—¶è¿›è¡Œå¤šä¸ªå‡è®¾æ£€éªŒæ—¶è‡³å°‘å‡ºç°ä¸€ä¸ª I ç±»é”™è¯¯ï¼ˆè¯¯æŠ¥ï¼‰çš„æ¦‚ç‡ã€‚ # Set the parametersnum_simulations &lt;- 10000 # Number of simulated datasetssample_size &lt;- 50 # Sample size for each group# Initialize a vector to store p-valuessimulated_p_values &lt;- numeric(num_simulations)# Simulate data and compute p-valuesfor (i in 1:num_simulations) &#123; # Simulate data under the null hypothesis for two groups group1 &lt;- rnorm(sample_size) group2 &lt;- rnorm(sample_size) # Perform a two-sample t-test on the simulated data test_result &lt;- t.test(group1, group2) # Store the p-value simulated_p_values[i] &lt;- test_result$p.value&#125;# Plot a histogram of simulated p-valueshist(simulated_p_values, breaks = 30, col = &quot;lightblue&quot;, main = &quot;Distribution of Simulated P-values under Null hypothesis&quot;) print(glue(&quot;&#123;sum(simulated_p_values&lt;=0.05)&#125; of the tests out of 10000 test were significant. \\n This indicates that under the Null hypothesis alpha % of times your test will be rendered false positive (type-I error).&quot;)) ## 515 of the tests out of 10000 test were significant. ## This indicates that under the Null hypothesis alpha % of times your test will be rendered false positive (type-I error). 8. ç³»ç»Ÿå‘è‚²æ ‘å¯è§†åŒ–library(phytools)library(TDbook)library(ggimage)library(treeio)library(tidyverse)library(tidytree)spec &lt;- gloomer(ps_rar, taxa_level = &quot;Class&quot;)spec &lt;- transform_sample_counts(spec, function(x)&#123;x/sum(x)*100&#125;)spec &lt;- prune_taxa(taxa_sums(spec)&gt;1, spec)taxadf &lt;- as.data.frame(tax_table(spec))color.index &lt;- c(&quot;#771155&quot;, &quot;#AA4488&quot;, &quot;#CC99BB&quot;, &quot;#114477&quot;, &quot;#4477AA&quot;, &quot;#77AADD&quot;, &quot;#117777&quot;, &quot;#44AAAA&quot;, &quot;#77CCCC&quot;, &quot;#117744&quot;, &quot;#44AA77&quot;, &quot;#88CCAA&quot;, &quot;#777711&quot;, &quot;#AAAA44&quot;, &quot;#DDDD77&quot;, &quot;#774411&quot;, &quot;#AA7744&quot;, &quot;#DDAA77&quot;, &quot;#771122&quot;, &quot;#AA4455&quot;, &quot;#DD7788&quot;)#creating a highlihgt df with a costum functionmrca.wrap &lt;- function(highlight, taxa.df, tree, tax_level=&quot;Phylum&quot;, type.id = &quot;node&quot;)&#123;taxa &lt;- taxa.df %&gt;% data.frame node.id &lt;- list() for(i in phyls)&#123; node.id[i] &lt;- findMRCA(tree, tree$tip.label[taxa[,tax_level] == i], type = type.id) node.df &lt;- data.frame(phyl = names(node.id), node.id = c(node.id[1][[1]]))&#125; node.id = node.id = as(node.id,&quot;matrix&quot;) node.df = data.frame(highlights = rownames(node.id), node.id = unlist(node.id)) return(node.df) &#125;ps_mock = phyloseq::subset_samples(spec, group == &quot;Mock&quot;) phyls = tax_table(ps_mock)[rowSums(ps_mock@otu_table)&gt;0,2] %&gt;% data.frame() %&gt;% distinct() %&gt;% pull()#chosoing phylum that that are in Mock samplesnode.df &lt;- mrca.wrap(highlight = phyls, taxa.df = tax_table(spec), tree = phy_tree(spec), tax_level = &quot;Phylum&quot;, type = &quot;node&quot;) #drwing the treetree_p = ggtree(spec, aes(color = Phylum),branch.length = &quot;none&quot;,layout = &quot;circular&quot;,show.legend =TRUE,open.angle = 5,size = 1.5) + ggtitle(&quot;Phylogenetic tree of different Classes.&quot;, &quot;Mock comunity phyla are highligted!&quot;) +geom_tiplab(aes(label=Class, color = Phylum), check.overlap = FALSE, face = &quot;bold&quot;, size = 3, offset = 0.3) +scale_color_manual(values = sample(color.index, length(unique(taxadf$Phylum)), FALSE), breaks = unique(taxadf$Phylum)) + #to remove the NA from the legendgeom_highlight(data = node.df, lwd = 0.25, lty = 3, alpha = 0.1,aes(node = node.id, fill = highlights), extend =0.05, to.bottom = TRUE, align = &quot;right&quot;, show.legend = TRUE) +geom_nodepoint( pch = 21, color = &quot;black&quot;, size = 2, fill = &quot;white&quot;) + geom_nodepoint(aes(subset = node %in% node.df$node.id), pch = 21, size = 3, color = &quot;black&quot;, fill = c(&quot;#00ffff&quot;, &quot;#ff7700&quot;)) +geom_tippoint(size = 1, pch = 21, color = alpha(colour = &quot;white&quot;, alpha = 0.2)) + geom_label(aes(x = branch, label = round(branch.length,2)),label.padding = unit(0.05, &quot;line&quot;), size = 3, inherit.aes = TRUE) +scale_fill_manual(values = c( &quot;#16f476&quot;, &quot;#fc00fc&quot;)) # geom_cladelab(node = node.df$node.id, align = FALSE,# label = node.df$highlights,# offset.text = 0.25, # offset = 16,# barsize = 0.05, # extend = 0.01,# angle =&quot;auto&quot;,# fontface = 2, size = 7) +#Plotting abundance on treerel.df &lt;- psmelt(spec) %&gt;% select(OTU, Abundance, group) %&gt;% group_by( OTU, group) %&gt;% summarise(rel = mean(Abundance), .groups = &quot;drop&quot;) %&gt;% pivot_wider(values_from = &quot;rel&quot;, id_cols = &quot;OTU&quot;, names_from = &quot;group&quot;) %&gt;% column_to_rownames( &quot;OTU&quot;)rescaled.reldf &lt;- apply(rel.df, 2, function(x) &#123;log(x+1)&#125;)library(ggnewscale, verbose = FALSE)p2 &lt;- tree_p + new_scale_fill()p3 &lt;- gheatmap(p2, font.size = 5, rescaled.reldf, offset=6.04, width=.8, colnames_angle=60, colnames_offset_y = -.45, colnames_position = &quot;top&quot;) + scale_fill_viridis_c(option=&quot;C&quot;, name=&quot;Log relative abundance, %&quot;)p3 åŸæ–‡é“¾æ¥å’ŒGithubå­˜å‚¨åº“ä½ç½®","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"ç”¨VueJSå’ŒFastapié€šè¿‡websocketå®ç°è¿›åº¦æ¡è¿½è¸ª","slug":"ç”¨VueJSå’ŒFastapié€šè¿‡websocketå®ç°è¿›åº¦æ¡è¿½è¸ª","date":"2024-09-20T05:09:13.000Z","updated":"2024-10-18T05:33:21.867Z","comments":true,"path":"vue-fastapi-websocket/","permalink":"https://xiaohanys.top/vue-fastapi-websocket/","excerpt":"ç®€ä»‹åœ¨æˆ‘ä»¬çš„åº”ç”¨å°ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æ˜¯å‰åç«¯åˆ†ç¦»çš„ã€‚å‰ç«¯é¡µé¢åªè´Ÿè´£æ¸²æŸ“ï¼Œè€Œåç«¯éœ€è¦å¤„ç†æ•°æ®ã€‚ä½†æ˜¯å¦‚æœé‡åˆ°æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¤„ç†èµ·æ¥å°±å¾ˆç¼“æ…¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡AJAXçš„æ–¹æ³•è¿½è¸ªåå°æ•°æ®å˜åŒ–çš„è¿›åº¦ï¼Œéœ€è¦ç”¨åˆ°è½®è¯¢çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªæ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨VueJSå’ŒFastapiçš„å°ä¾‹å­æ¼”ç¤ºå‰ç«¯ä¼ é€’æ•°æ®ï¼Œåå°ç”¨10ç§’å¤„ç†æ•°æ®å¹¶å®æ—¶ååº”è¿›åº¦ç»™å‰å°çš„å®ç°ã€‚","text":"ç®€ä»‹åœ¨æˆ‘ä»¬çš„åº”ç”¨å°ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æ˜¯å‰åç«¯åˆ†ç¦»çš„ã€‚å‰ç«¯é¡µé¢åªè´Ÿè´£æ¸²æŸ“ï¼Œè€Œåç«¯éœ€è¦å¤„ç†æ•°æ®ã€‚ä½†æ˜¯å¦‚æœé‡åˆ°æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¤„ç†èµ·æ¥å°±å¾ˆç¼“æ…¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡AJAXçš„æ–¹æ³•è¿½è¸ªåå°æ•°æ®å˜åŒ–çš„è¿›åº¦ï¼Œéœ€è¦ç”¨åˆ°è½®è¯¢çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªæ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨VueJSå’ŒFastapiçš„å°ä¾‹å­æ¼”ç¤ºå‰ç«¯ä¼ é€’æ•°æ®ï¼Œåå°ç”¨10ç§’å¤„ç†æ•°æ®å¹¶å®æ—¶ååº”è¿›åº¦ç»™å‰å°çš„å®ç°ã€‚ åç«¯Fastapiå› ä¸ºåç«¯å†™èµ·æ¥ç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬å…ˆå†™ä¸ªåç«¯ æ–°å»ºmy-fastapiç›®å½•ï¼Œç„¶åæ–°å»ºmain.pyæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š from time import sleepfrom fastapi import FastAPI, WebSocket ##å¯¼å…¥websocket##åˆ›å»ºappapp = FastAPI()##è·¯ç”±ç«¯ç‚¹éœ€è¦websocket@app.websocket(&quot;/ws&quot;)async def websocket_endpoint(websocket: WebSocket): await websocket.accept() ## ç­‰å¾…é“¾æ¥ while True: data = await websocket.receive_json() ###ç­‰å¾…æ¥æ”¶Jsonæ•°æ® ### è¿™æ˜¯ä¸€ä¸ª10Sçš„ä»»åŠ¡ for i in range(10): sleep(1) ### å°†æ­¤åˆ»çš„å¾ªç¯æ¬¡æ•°ä¼ é€’ç»™å‰ç«¯ await websocket.send_json(&#123;&quot;data&quot;: &quot;&quot;, &quot;time&quot;: (i+1)*10&#125;) jieguo = data[&#x27;input&#x27;] + &quot; finished!&quot; ### ç­‰å¾…è¿”å›æ•°æ® await websocket.send_json(&#123;&quot;data&quot;: jieguo, &quot;time&quot;: 100&#125;) å‰ç«¯å‰ç«¯ç”¨Vuejs+NaiveUIå®ç°ï¼š åˆ›å»ºä¸€ä¸ªViteé¡¹ç›®ï¼š npm create vite@latest my-vue-app -- --template vue å®‰è£… Naive-UI npm i -D naive-ui vfonts å°†src/app.vue ä¸­çš„å†…å®¹åˆ é™¤ï¼Œæ›¿æ¢æˆä¸‹é¢çš„ï¼š &lt;script setup&gt;///UIimport &#123; NButton, NInput, NSpace, NH1, NProgress, useThemeVars &#125; from &#x27;naive-ui&#x27;import &#123; onMounted, ref &#125; from &#x27;vue&#x27;import &#123; changeColor &#125; from &quot;seemly&quot;;/// ç»‘å®šæ•°æ®const data = ref(&#x27;&#x27;)const tm = ref(&#x27;&#x27;)const inputData = ref(&#x27;&#x27;)/// å»ºç«‹æŒä¹…é€šä¿¡const connection = new WebSocket(&quot;ws://localhost:8000/ws&quot;)const themeVars = useThemeVars()///è¿™é‡Œç”¨æ¥å‘åç«¯å‘é€Jsonæ•°æ®ï¼Œæ³¨æ„è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ JSON.stringify()const submit = () =&gt; &#123; connection.send(JSON.stringify(&#123; input: inputData.value &#125;))&#125;/// è¿™é‡Œæ¥æ”¶æ•°æ®ï¼Œæ³¨æ„è¦æŠŠå­—ç¬¦ä¸²æ ¼å¼çš„JSONè§£æä¸ºjsonå¯¹è±¡ JSON.parse()onMounted(() =&gt; &#123; connection.onmessage = function (e) &#123; const backData = JSON.parse(e.data) data.value = backData.data tm.value = backData.time &#125;&#125;)&lt;/script&gt;&lt;template&gt; &lt;n-space justify=&quot;center&quot; vertical&gt; &lt;n-h1 style=&quot;text-align: center;&quot;&gt;Hello &#123;&#123; data &#125;&#125;&lt;/n-h1&gt; &lt;n-space justify=&quot;center&quot;&gt; &lt;n-progress style=&quot;width: 300px;&quot; type=&quot;line&quot; indicator-placement=&quot;inside&quot; :color=&quot;themeVars.errorColor&quot; :rail-color=&quot;changeColor(themeVars.errorColor, &#123; alpha: 0.2 &#125;)&quot; :percentage=&quot;tm&quot; /&gt; &lt;/n-space&gt; &lt;n-space style=&quot;display: flex; margin: 10px auto; justify-content: center;&quot;&gt; &lt;n-input v-model:value=&quot;inputData&quot; type=&quot;text&quot; placeholder=&quot;æµ‹è¯•è¾“å…¥&quot; /&gt; &lt;n-button type=&quot;primary&quot; @click=&quot;submit&quot;&gt;Submit&lt;/n-button&gt; &lt;/n-space&gt; &lt;/n-space&gt;&lt;/template&gt; æœ€ç»ˆçš„æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š è¿™ä¸ªåŠ¨å›¾æ²¡æœ‰å½•åˆ¶å®Œæ•´ï¼Œæœ€ç»ˆä¼šåˆ°100%ã€‚","categories":[{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://xiaohanys.top/tags/%E5%89%8D%E7%AB%AF/"},{"name":"åç«¯","slug":"åç«¯","permalink":"https://xiaohanys.top/tags/%E5%90%8E%E7%AB%AF/"}],"author":"Xiaoguang Pan"},{"title":"ç”Ÿä¿¡å°ç™½å¦‚ä½•ç”¨vuejsç®€å•åˆ›å»ºä¸€ä¸ªäº¤äº’å¼ç½‘é¡µ","slug":"ç”Ÿä¿¡å°ç™½å¦‚ä½•ç”¨vuejsç®€å•åˆ›å»ºä¸€ä¸ªäº¤äº’å¼ç½‘é¡µ","date":"2024-09-20T05:08:07.000Z","updated":"2024-10-18T05:32:27.495Z","comments":true,"path":"vue-web-app/","permalink":"https://xiaohanys.top/vue-web-app/","excerpt":"ä»€ä¹ˆæ˜¯Vue.jsVueJSæ˜¯ä¸€ä¸ªæ¸è¿›å¼çš„å‰ç«¯æ¡†æ¶ï¼Œæ‰€è°“æ¸è¿›å¼çš„æ„æ€å°±æ˜¯ä½ å¯ä»¥ç”¨å®ƒå¿«é€Ÿå®ŒæˆåŸå‹åˆ›ä½œï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šé€æ­¥å®Œå–„ã€‚ä»–å¯ä»¥è¶³å¤Ÿç®€å•ï¼Œä¹Ÿå¯ä»¥è¶³å¤Ÿå®Œå–„ï¼Œé‚£ä¹ˆå¯¹äºæ–°æ‰‹å°ç™½æ¥è¯´ï¼Œè¿™ç®€ç›´å°±æ˜¯ç¦åˆ©ï¼","text":"ä»€ä¹ˆæ˜¯Vue.jsVueJSæ˜¯ä¸€ä¸ªæ¸è¿›å¼çš„å‰ç«¯æ¡†æ¶ï¼Œæ‰€è°“æ¸è¿›å¼çš„æ„æ€å°±æ˜¯ä½ å¯ä»¥ç”¨å®ƒå¿«é€Ÿå®ŒæˆåŸå‹åˆ›ä½œï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šé€æ­¥å®Œå–„ã€‚ä»–å¯ä»¥è¶³å¤Ÿç®€å•ï¼Œä¹Ÿå¯ä»¥è¶³å¤Ÿå®Œå–„ï¼Œé‚£ä¹ˆå¯¹äºæ–°æ‰‹å°ç™½æ¥è¯´ï¼Œè¿™ç®€ç›´å°±æ˜¯ç¦åˆ©ï¼ Vuejs ç›¸å½“äºä½¿ç”¨nodejsæ¥æ¸²æŸ“ä¸€ä¸ªhtmlæ¨¡æ¿ï¼Œä»è€ŒåŠ¨æ€çš„ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„ç•Œé¢ï¼ˆDOMï¼‰ï¼Œç±»ä¼¼çš„åŠŸèƒ½æˆ‘ä»¬å¯èƒ½åœ¨Pythonä¸­è§è¿‡ï¼Œä¾‹å¦‚Jinja2 æˆ–è€… Django template. å°±æ˜¯ç»™å®šä¸€ä¸ªåŸºç¡€çš„æ¨¡æ¿ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦æŠŠç»™å®šçš„æ•°æ®è¾“å…¥ï¼Œå°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„é¡µé¢äº†ï¼ åˆ›å»ºé¡¹ç›®å·¥ç¨‹ç›®å½•è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Viteæ¥å¼€å‘å‰ç«¯é¡µé¢ã€‚åˆ›å»ºä¸€ä¸ªVueçš„æ¨¡æ¿ npm create vite@latest my-vue-app -- --template vue å®‰è£…NaiveUI npm i -D naive-ui vfonts é…ç½®NaiveUI å› ä¸ºNaiveUIæ˜¯å¯ä»¥ä»»æ„å¼•ç”¨çš„(Tree shaking),æ‰€ä»¥æˆ‘ä»¬ç›´æ¥é¥®ç”¨æƒ³ä½¿ç”¨çš„codeå³å¯ï¼Œæ— éœ€é…ç½®ã€‚ åˆ›å»ºå•é¡µé¢åº”ç”¨åœ¨SRCç›®å½•ä¸­æ–°å»ºä¸€ä¸ªComponentsé¡µé¢ï¼Œæˆ–è€…Views æˆ–è€… Pages,ä»€ä¹ˆåå­—éƒ½å¯ä»¥ï¼Œæˆ‘ä»¬æŠŠè¯¥é¡µé¢çš„é€»è¾‘æ”¾è¿›å»ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºäº†/Components/upload.vue. &lt;script setup&gt;import &#123; ref &#125; from &quot;vue&quot;;import &#123; lyla &#125; from &quot;lyla&quot;;import &#123; useMessage &#125; from &quot;naive-ui&quot;;const message = useMessage();const DataFromServer = ref([]);const sampleName = ref(4);const barcode = ref(23);const chip = ref(27);const lane = ref(28);const datapath = ref(48);const path = ref(&quot;10.2.100.1:/pakpox/pob8d1/&quot;);const code1 = ref(&quot;&quot;);const code2 = ref(&quot;&quot;);const tableUpload = ref();const params = ref(&#123; sampleName: sampleName, barcode: barcode, chip: chip, lane: lane, datapath: datapath, path: path,&#125;);const params2 = ref(&#123; file: &quot;&quot;, sampleName: sampleName, barcode: barcode, chip: chip, lane: lane, datapath: datapath, path: path,&#125;);const customUpload = (&#123; file, data, headers, withCredentials, action, onFinish, onError, onProgress,&#125;) =&gt; &#123; const formData = new FormData(); params2.value.file = file.file; if (data) &#123; Object.keys(data).forEach((key) =&gt; &#123; formData.append(key, data[key]); &#125;); &#125; formData.append(&quot;file&quot;, file.file); lyla .post(action, &#123; withCredentials, headers, body: formData, onUploadProgress: (&#123; percent &#125;) =&gt; &#123; onProgress(&#123; percent: Math.ceil(percent) &#125;); &#125;, &#125;) .then((&#123; json &#125;) =&gt; &#123; if (json.hasBlank == 1) &#123; message.warning(&quot;Upload success, but some blank in table&quot;); &#125; if (json.hasDup == 1) &#123; message.warning(&quot;Upload success, but some duplicate in table&quot;); &#125; DataFromServer.value = json.rawData; code1.value = json.cmd1; code2.value = json.cmd2; onFinish(); &#125;) .catch((error) =&gt; &#123; message.success(error.message); onError(); &#125;);&#125;;const customUpload2 = (&#123; file, data, headers, withCredentials, action, onFinish, onError, onProgress,&#125;) =&gt; &#123; const formData = new FormData(); params2.value.file2 = file.file; if (data) &#123; Object.keys(data).forEach((key) =&gt; &#123; formData.append(key, data[key]); &#125;); &#125; formData.append(&quot;file2&quot;, file.file); lyla .post(action, &#123; withCredentials, headers, body: formData, onUploadProgress: (&#123; percent &#125;) =&gt; &#123; onProgress(&#123; percent: Math.ceil(percent) &#125;); &#125;, &#125;) .then((&#123; json &#125;) =&gt; &#123; if (json.hasBlank == 1) &#123; message.warning(&quot;Upload success, but some blank in table&quot;); &#125; if (json.hasDup == 1) &#123; message.warning(&quot;Upload success, but some duplicate in table&quot;); &#125; DataFromServer.value = json.rawData; code1.value = json.cmd1; code2.value = json.cmd2; onFinish(); &#125;) .catch((error) =&gt; &#123; message.success(error.message); onError(); &#125;);&#125;;const columns = [ &#123; title: &quot;sampleName&quot;, key: &quot;sampleName&quot;, &#125;, &#123; title: &quot;barcode&quot;, key: &quot;barcode&quot;, &#125;, &#123; title: &quot;chip&quot;, key: &quot;chip&quot;, &#125;, &#123; title: &quot;lane&quot;, key: &quot;lane&quot;, &#125;, &#123; title: &quot;dataPath&quot;, key: &quot;dataPath&quot;, width: 100, ellipsis: &#123; tooltip: true, &#125;, &#125;,];const submitdata = () =&gt; &#123; tableUpload.value?.submit();&#125;;&lt;/script&gt;&lt;template&gt; &lt;n-layout&gt; &lt;n-layout-header bordered&gt; &lt;div style=&quot;margin: 10px 12px;&quot;&gt; &lt;span style=&quot;font-size: 1.3rem;font-weight: 500;&quot;&gt;Glims to copy&lt;/span&gt; &lt;/div&gt; &lt;/n-layout-header&gt; &lt;n-layout-content&gt; &lt;div style=&quot;margin-top: 20px;&quot;&gt; &lt;n-grid x-gap=&quot;12&quot; :cols=&quot;12&quot;&gt; &lt;n-gi :span=&quot;1&quot;&gt; &lt;/n-gi&gt; &lt;n-gi :span=&quot;3&quot;&gt; &lt;n-card hoverable&gt; &lt;n-space vertical&gt; &lt;n-p&gt;Excel from Glims...&lt;/n-p&gt; &lt;n-upload ref=&quot;tableUpload&quot; :default-upload=&quot;false&quot; action=&quot;https://glims2excel-1-w4936186.deta.app/upload&quot; response-type=&quot;json&quot; :custom-request=&quot;customUpload&quot; :data=&quot;params&quot; &gt; &lt;n-button style=&quot;height: 35px&quot;&gt;Upload..&lt;/n-button&gt; &lt;/n-upload&gt; &lt;n-p&gt;Index for sampleName&lt;/n-p&gt; &lt;n-input-number v-model:value=&quot;sampleName&quot; clearable /&gt; &lt;n-p&gt;Index for barcode&lt;/n-p&gt; &lt;n-input-number v-model:value=&quot;barcode&quot; clearable /&gt; &lt;n-p&gt;Index for chip&lt;/n-p&gt; &lt;n-input-number v-model:value=&quot;chip&quot; clearable /&gt; &lt;n-p&gt;Index for lane&lt;/n-p&gt; &lt;n-input-number v-model:value=&quot;lane&quot; clearable /&gt; &lt;n-p&gt;Index for dataPath&lt;/n-p&gt; &lt;n-input-number v-model:value=&quot;datapath&quot; clearable /&gt; &lt;n-p&gt;Remoth path&lt;/n-p&gt; &lt;n-input v-model:value=&quot;path&quot; type=&quot;text&quot; /&gt; &lt;n-button type=&quot;error&quot; @click=&quot;submitdata&quot;&gt; Submit! &lt;/n-button&gt; &lt;n-divider dashed&gt; Change Names &lt;/n-divider&gt; &lt;n-upload action=&quot;https://glims2excel-1-w4936186.deta.app/changenames&quot; response-type=&quot;json&quot; :custom-request=&quot;customUpload2&quot; :data=&quot;params2&quot; &gt; &lt;n-button round type=&quot;primary&quot;&gt;Upload..&lt;/n-button&gt; &lt;/n-upload&gt; &lt;/n-space&gt; &lt;/n-card&gt; &lt;/n-gi&gt; &lt;n-gi :span=&quot;7&quot;&gt; &lt;n-space vertical style=&quot;margin-top: 50px&quot;&gt; &lt;n-tabs type=&quot;segment&quot;&gt; &lt;n-tab-pane name=&quot;table&quot; tab=&quot;Table Preview&quot;&gt; &lt;n-data-table :columns=&quot;columns&quot; :data=&quot;DataFromServer&quot; max-height=&quot;600px&quot; /&gt; &lt;/n-tab-pane&gt; &lt;n-tab-pane name=&quot;cmd&quot; tab=&quot;Shell cmd&quot;&gt; &lt;n-tabs type=&quot;line&quot; animated&gt; &lt;n-tab-pane name=&quot;shell1&quot; tab=&quot;Shell1&quot;&gt; &lt;n-card style=&quot;overflow-y: scroll; max-height: 700px&quot;&gt; &lt;n-code :code=&quot;code1&quot; language=&quot;bash&quot; word-wrap&gt; &lt;/n-code&gt; &lt;/n-card&gt; &lt;/n-tab-pane&gt; &lt;n-tab-pane name=&quot;shell2&quot; tab=&quot;Shell2&quot;&gt; &lt;n-card style=&quot;overflow-y: scroll; max-height: 700px&quot;&gt; &lt;n-code :code=&quot;code2&quot; language=&quot;bash&quot; word-wrap&gt; &lt;/n-code&gt; &lt;/n-card&gt; &lt;/n-tab-pane&gt; &lt;/n-tabs&gt; &lt;/n-tab-pane&gt; &lt;/n-tabs&gt; &lt;/n-space&gt; &lt;/n-gi&gt; &lt;n-gi :span=&quot;1&quot;&gt; &lt;/n-gi&gt; &lt;/n-grid&gt; &lt;/div&gt; &lt;/n-layout-content&gt; &lt;n-layout-footer&gt; &lt;div style=&quot;height: 90px;text-align: center;padding-top: 30px;&quot;&gt; &lt;p&gt;built by XiaoguangPan&lt;/p&gt; &lt;p&gt;Based on Vue.js &amp; Naive UI&lt;/p&gt; &lt;/div&gt; &lt;/n-layout-footer&gt; &lt;/n-layout&gt;&lt;/template&gt; ç„¶åæˆ‘ä»¬æŠŠè¯¥ç»„ä»¶å¼•å…¥App.vue, &lt;script setup&gt;import upload from &quot;./components/upload.vue&quot;;import hljs from &#x27;highlight.js/lib/core&#x27;import bash from &#x27;highlight.js/lib/languages/bash&#x27;hljs.registerLanguage(&#x27;bash&#x27;, bash)&lt;/script&gt;&lt;template&gt; &lt;n-message-provider&gt; &lt;n-config-provider :hljs=&quot;hljs&quot;&gt; &lt;upload /&gt; &lt;/n-config-provider&gt; &lt;/n-message-provider&gt;&lt;/template&gt; å°±è¿™ä¹ˆç®€å•ï¼ŒçŸ­çŸ­å‡ è¡Œä»£ç ï¼Œä¸€ä¸ªå‰ç«¯é¡µé¢å®Œæˆã€‚å®Œæ•´çš„é¡¹ç›®å¯ä»¥åœ¨githubè®¿é—®ã€‚ éƒ¨ç½²å•é¡µé¢åº”ç”¨åˆ°github pageå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åç«¯ï¼Œå®Œå…¨çš„å°±æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ï¼Œæ‰€ä»¥å¯ä»¥æŒ‰ç…§çº¯é™æ€å»éƒ¨ç½²ã€‚ åœ¨å½“å‰ç›®å½•åˆ›å»º.github/workflows/deploy.ymlæ–‡ä»¶ å°†ä»¥ä¸‹æµç¨‹ä»£ç å†™å…¥ï¼š # å°†é™æ€å†…å®¹éƒ¨ç½²åˆ° GitHub Pages çš„ç®€æ˜“å·¥ä½œæµç¨‹name: Deploy static content to Pageson: # ä»…åœ¨æ¨é€åˆ°é»˜è®¤åˆ†æ”¯æ—¶è¿è¡Œã€‚ push: branches: [&#x27;main&#x27;] # è¿™ä¸ªé€‰é¡¹å¯ä»¥ä½¿ä½ æ‰‹åŠ¨åœ¨ Action tab é¡µé¢è§¦å‘å·¥ä½œæµ workflow_dispatch:# è®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pagesã€‚permissions: contents: read pages: write id-token: write# å…è®¸ä¸€ä¸ªå¹¶å‘çš„éƒ¨ç½²concurrency: group: &#x27;pages&#x27; cancel-in-progress: truejobs: # å•æ¬¡éƒ¨ç½²çš„å·¥ä½œæè¿° deploy: environment: name: github-pages url: $&#123;&#123; steps.deployment.outputs.page_url &#125;&#125; runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 - name: Set up Node uses: actions/setup-node@v3 with: node-version: 18 cache: &#x27;npm&#x27; - name: Install dependencies run: npm install - name: Build run: npm run build - name: Setup Pages uses: actions/configure-pages@v3 - name: Upload artifact uses: actions/upload-pages-artifact@v1 with: # Upload dist repository path: &#x27;./dist&#x27; - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v1 æ€»ç»“æˆ‘ä»¬å€ŸåŠ©Vuejs å’Œ NaiveUI, å®Œå…¨ä¸éœ€è¦æˆ‘ä»¬çŸ¥é“Htmlå’ŒCSSçš„çŸ¥è¯†ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠéœ€è¦çš„ç»„ä»¶è°ƒç”¨å³å¯ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬çš„åç«¯APIå·²ç»åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å†™å¥½éƒ¨ç½²ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨å³å¯ã€‚","categories":[{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://xiaohanys.top/tags/%E5%89%8D%E7%AB%AF/"}],"author":"Xiaoguang Pan"},{"title":"æŠŠFastapiéƒ¨ç½²åˆ°å…è´¹çš„Deta Spaceä¸Š","slug":"æŠŠFastapiéƒ¨ç½²åˆ°å…è´¹çš„DetaSpaceä¸Š","date":"2024-09-20T05:06:48.000Z","updated":"2024-10-18T05:31:55.220Z","comments":true,"path":"fastapi-dataspace/","permalink":"https://xiaohanys.top/fastapi-dataspace/","excerpt":"ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å†™äº†ä¸€ä¸ªStreamlitçš„ç¨‹åºæ¥å…¨æ ˆçš„æ‰§è¡Œæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å®ƒçš„ä¸€ä¸ªç¼ºç‚¹ï¼šå‰ç«¯ç•Œé¢éå¼‚æ­¥ï¼ŒUIå®šåˆ¶ç¼ºä¹çµæ´»æ€§ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°è¯•é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ–¹å¼æ¥å®Œæˆä¸Šæ¬¡çš„ä»»åŠ¡ã€‚","text":"ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å†™äº†ä¸€ä¸ªStreamlitçš„ç¨‹åºæ¥å…¨æ ˆçš„æ‰§è¡Œæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å®ƒçš„ä¸€ä¸ªç¼ºç‚¹ï¼šå‰ç«¯ç•Œé¢éå¼‚æ­¥ï¼ŒUIå®šåˆ¶ç¼ºä¹çµæ´»æ€§ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°è¯•é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ–¹å¼æ¥å®Œæˆä¸Šæ¬¡çš„ä»»åŠ¡ã€‚ å‰ç«¯ï¼šVue.js + Naive-UI + Vite + github page åç«¯ï¼šFastapi é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å‰ç«¯é€šè¿‡AJAXçš„æ–¹å¼ä»åç«¯è·å–æ•°æ®ï¼Œåç«¯å¼‚æ­¥çš„æ‰§è¡Œæˆ‘ä»¬è¡¨æ ¼çš„å¤„ç†ä»»åŠ¡ï¼Œå¹¶ç”Ÿæˆè„šæœ¬ï¼Œæ¨é€ç»™å‰ç«¯ã€‚è¦æƒ³æ‰§è¡Œåç«¯ä»»åŠ¡ï¼Œå¿…ç„¶éœ€è¦æœåŠ¡å™¨ã€‚æˆ‘ä»¬è¿™ä¹ˆä¸ªå°çš„ç¨‹åºå®Œå…¨æ²¡å¿…è¦é‚£ä¹ˆåšï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±å» â€œç™½å«–â€ Deta Spaceçš„åŠŸèƒ½æ¥å®Œæˆåç«¯çš„éƒ¨ç½²ï¼Œè¿™æ ·æˆ‘ä»¬çš„å‰ç«¯åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è°ƒå–è¯¥APIï¼Œå‰ç«¯å°±æ˜¯ä¸ªå®¢æˆ·ç«¯APPè€Œå·²ã€‚ æˆ‘ä»¬å…ˆæŠŠFastapiçš„ä¸šåŠ¡é€»è¾‘å®Œæˆå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨main.appä¸­å†™å°±å¯ä»¥äº†ï¼š é¦–å…ˆå¯¼å…¥éœ€è¦çš„æ¨¡å—ï¼š from fastapi import FastAPI, File, UploadFile, Form, Dependsimport pandas as pdimport os å› ä¸ºæˆ‘ä»¬è¯»å–è¡¨æ ¼æ–‡ä»¶ï¼Œç„¶åç”Ÿæˆshellè„šæœ¬è¿™ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼Œæ˜¯æˆ‘ä»¬çš„ä¸€ä¸ªä¾èµ–ï¼ˆä¸€ç›´è¦ç”¨çš„ä¸œè¥¿ã€‚ æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªä¾èµ–å†™å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¾èµ–å‡½æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªå»æ‰äº†è·¯ç”±çš„è·¯ç”±å‡½æ•°ï¼ async def load_file(file: UploadFile = File(...), sampleName: int = Form(...), barcode: int = Form(...), chip: int = Form(...), lane: int = Form(...), dataPath: int = Form(...))-&gt;pd.DataFrame: contents = await file.read() df = pd.read_excel(contents) df = df.fillna(&#x27;&#x27;) df = df.iloc[:,[sampleName-1,barcode-1,chip-1,lane-1,dataPath-1]] df.columns = [&quot;sampleName&quot;, &quot;barcode&quot;, &quot;chip&quot;, &quot;lane&quot;, &quot;dataPath&quot;] return df ç„¶åæ˜¯ç¬¬ä¸€ä¸ªè·¯ç”±å‡½æ•°ï¼š å°±åƒå‰é¢è¯´çš„ï¼Œæˆ‘ä»¬çš„å†—ä½™å¤„ç†ï¼Œç®€å•çš„åŠ åç¼€å³å¯ã€‚ ## å°†å†—ä½™åˆ—åŠ åç¼€def makenames(df:pd.DataFrame,col:str)-&gt;pd.DataFrame: s=&#x27;_&#x27;+df.groupby(col).cumcount().add(1).astype(str) df.loc[:,col]+=s.mask(s==&quot;_1&quot;,&quot;&quot;) return df @app.post(&quot;/upload&quot;)async def process(path:str = Form(...),df:pd.DataFrame = Depends(load_file)): isBlank = 0 isDuplicate = 0 remotePath = path ## åˆ¤æ–­dataPathåˆ—ä¹¦å¦ä¸º&quot;&quot; if &quot;&quot; in df.dataPath.tolist(): isBlank = 1 df = df[df.dataPath!=&quot;&quot;] if df.sampleName.duplicated().sum() &gt; 0: isDuplicate = 1 df = makenames(df,&quot;sampleName&quot;) df = df.assign(filename1=df.apply(lambda row : &quot;_&quot;.join([row[&#x27;chip&#x27;],row[&#x27;lane&#x27;],str(row[&#x27;barcode&#x27;]),&quot;1.fq.gz&quot;]),axis=1)) df = df.assign(filename2=df.apply(lambda row : &quot;_&quot;.join([row[&#x27;chip&#x27;],row[&#x27;lane&#x27;],str(row[&#x27;barcode&#x27;]),&quot;2.fq.gz&quot;]),axis=1)) cmd1 = &quot;\\n&quot;.join(df.apply(lambda row: &quot;scp &quot; + os.path.join(row[&#x27;dataPath&#x27;],row[&#x27;filename1&#x27;]) + &quot; &quot; + os.path.join(remotePath,row[&#x27;sampleName&#x27;] + &quot;_R1.fastq.gz&quot;),axis=1).tolist()) cmd2 = &quot;\\n&quot;.join(df.apply(lambda row: &quot;scp &quot; + os.path.join(row[&#x27;dataPath&#x27;],row[&#x27;filename2&#x27;]) + &quot; &quot; + os.path.join(remotePath,row[&#x27;sampleName&#x27;] + &quot;_R2.fastq.gz&quot;),axis=1).tolist()) return &#123;&quot;rawData&quot;:df.to_dict(orient=&quot;records&quot;),&quot;cmd1&quot;:cmd1,&quot;cmd2&quot;:cmd2,&quot;HasBlank&quot;:isBlank,&quot;hasDup&quot;:isDuplicate&#125; æœ€åæ˜¯ç¬¬äºŒä¸ªå‡½æ•°é€šè¿‡æäº¤æ ·æœ¬åå¯¹åº”æ–‡ä»¶ï¼Œä¿®æ”¹æ ·æœ¬åä¸ºçœŸå®æ•°æ®ã€‚ @app.post(&quot;/changenames&quot;)async def change(file2:UploadFile= File(...),path:str = Form(...),df2:pd.DataFrame = Depends(load_file)): remotePath = path isDuplicate = 0 df = pd.read_csv(file2.file,header=None,delimiter=&quot;\\t&quot;) df.columns = [&quot;sampleName&quot;,&quot;trueName&quot;] df2 = df2.merge(df,how=&quot;left&quot;,on=&quot;sampleName&quot;) df2 = df2.drop(columns=[&quot;sampleName&quot;]) df2 = df2.dropna() df2 = df2.rename(columns=&#123;&quot;trueName&quot;:&quot;sampleName&quot;&#125;) if df.sampleName.duplicated().sum() &gt; 0: isDuplicate = 1 df2 = makenames(df,&quot;sampleName&quot;) df2 = df2.assign(filename1=df2.apply(lambda row : &quot;_&quot;.join([row[&#x27;chip&#x27;],row[&#x27;lane&#x27;],str(row[&#x27;barcode&#x27;]),&quot;1.fq.gz&quot;]),axis=1)) df2 = df2.assign(filename2=df2.apply(lambda row : &quot;_&quot;.join([row[&#x27;chip&#x27;],row[&#x27;lane&#x27;],str(row[&#x27;barcode&#x27;]),&quot;2.fq.gz&quot;]),axis=1)) cmd1 = &quot;\\n&quot;.join(df2.apply(lambda row: &quot;scp &quot; + os.path.join(row[&#x27;dataPath&#x27;],row[&#x27;filename1&#x27;]) + &quot; &quot; + os.path.join(remotePath,row[&#x27;sampleName&#x27;] + &quot;_R1.fastq.gz&quot;),axis=1).tolist()) cmd2 = &quot;\\n&quot;.join(df2.apply(lambda row: &quot;scp &quot; + os.path.join(row[&#x27;dataPath&#x27;],row[&#x27;filename2&#x27;]) + &quot; &quot; + os.path.join(remotePath,row[&#x27;sampleName&#x27;] + &quot;_R2.fastq.gz&quot;),axis=1).tolist()) return &#123;&quot;rawData&quot;:df2.to_dict(orient=&quot;records&quot;),&quot;cmd1&quot;:cmd1,&quot;cmd2&quot;:cmd2,&quot;HasBlank&quot;:0,&quot;hasDup&quot;:isDuplicate&#125; è·¨åŸŸCORSé—®é¢˜ï¼šåˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è¦éšå¤„è®¿é—®è¯¥APIï¼Œæ‰€ä»¥è·¨åŸŸé—®é¢˜éœ€è¦æš´åŠ›ç§»é™¤ï¼šæ·»åŠ å‡ è¡Œä»£ç åœ¨å¤´éƒ¨ï¼š from fastapi.middleware.cors import CORSMiddleware## 1. Create the FastAPI instanceapp = FastAPI()## 2. Add the CORS middlewareorigins = [ &quot;*&quot;]app.add_middleware( CORSMiddleware, allow_origins=origins, allow_credentials=True, allow_methods=[&quot;*&quot;], allow_headers=[&quot;*&quot;],) æ³¨å†ŒDeta Spaceå¸æˆ·åˆ›å»ºå…è´¹çš„Deta Spaceå¸æˆ·æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå…è´¹å¸æˆ·Deta Spaceï¼Œæ‚¨åªéœ€è¦ä¸€ä¸ªç”µå­é‚®ä»¶å’Œå¯†ç ã€‚ æ‚¨ç”šè‡³ä¸éœ€è¦ä¿¡ç”¨å¡ï¼Œä½†è¯·ç¡®ä¿åœ¨æ³¨å†Œæ—¶å¯ç”¨å¼€å‘è€…æ¨¡å¼ã€‚ å®‰è£…space cliå·¥å…·curl -fsSL https://get.deta.dev/space-cli.sh | sh ç™»é™†cliä¸ºäº†ä½¿ç”¨ Deta Space éªŒè¯æ‚¨çš„ CLIï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªè®¿é—®ä»¤ç‰Œã€‚ è¦è·å–æ­¤ä»¤ç‰Œï¼Œè¯·æ‰“å¼€æ‚¨çš„Deta Space canvasï¼Œæ‰“å¼€Teletypeï¼ˆç”»å¸ƒåº•éƒ¨çš„å‘½ä»¤æ ï¼‰ï¼Œç„¶åå•å‡»â€œè®¾ç½®â€ã€‚ä»é‚£é‡Œï¼Œé€‰æ‹©ç”Ÿæˆä»¤ç‰Œå¹¶å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œã€‚ ç°åœ¨ä» Space CLI è¿è¡Œspace loginã€‚å°†ä»¤ç‰Œç²˜è´´åˆ° CLI æç¤ºç¬¦å¹¶æŒ‰ Enter é”®åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ã€‚ $ space loginTo authenticate the Space CLI with your Space account, generate a new access token in your Space settings and paste it below:*****************************************ğŸ‘ Login Successful! åœ¨ç©ºé—´ä¸­åˆ›å»ºæ–°çš„å·¥ç¨‹å¹¶æäº¤åˆ›å»ºå·¥ç¨‹ç°åœ¨æ‚¨å·²ç»ä½¿ç”¨ Space CLI è¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹: $ space new# What is your project&#x27;s name? &gt;$ Glims2Excel Space CLI ä¼šè¦æ±‚æ‚¨ä¸ºé¡¹ç›®å‘½åï¼Œæˆ‘ä»¬å°†ç§°ä¹‹ä¸ºGlims2Excelã€‚ ç„¶åï¼Œå®ƒä¼šå°è¯•è‡ªåŠ¨æ£€æµ‹æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ¡†æ¶æˆ–è¯­è¨€ï¼Œå¹¶å‘æ‚¨å±•ç¤ºå®ƒæ‰¾åˆ°çš„å†…å®¹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒå°†é€šè¿‡ä»¥ä¸‹æ¶ˆæ¯è¯†åˆ« Python åº”ç”¨ç¨‹åºï¼Œæç¤ºæ‚¨ç¡®è®¤ï¼š âš™ï¸ No Spacefile found, trying to auto-detect configuration ...ğŸ‘‡ Deta detected the following configuration:Micros:name: Glims2Excel L src: . L engine: python3.9# Do you want to bootstrap &quot;Glims2Excel&quot; with this configuration? (y/n)$ y ç¡®è®¤åï¼Œæ‚¨çš„é¡¹ç›®å°†åœ¨ Deta Space ä¸­åˆ›å»ºã€‚Builder æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œå¯å¸®åŠ©æ‚¨åœ¨ Deta Space ä¸­åˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚ CLI è¿˜å°†åœ¨æœ¬åœ°Glims2Excelç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªSpacefileã€‚Spacefileæ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰ Deta Space å¦‚ä½•è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æ‚¨çš„åº”ç”¨ç¨‹åºçš„å†…å®¹Spacefileå¦‚ä¸‹ï¼š v: 0micros: - name: Glims2Excel src: . engine: python3.9 å®ƒæ˜¯ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡ç­‰åŠŸèƒ½æˆ–ä¿®æ”¹åº”ç”¨ç¨‹åºçš„è¿è¡Œæ–¹å¼ï¼Œæˆ‘ä»¬ç¨åå°†æ‰§è¡Œæ­¤æ“ä½œã€‚ åœ¨Spacefileä¸­å®šä¹‰è¿è¡Œå‘½ä»¤Spacefile ä¸­çš„å‘½ä»¤å‘Šè¯‰ Space åº”æ‰§è¡Œä»€ä¹ˆå‘½ä»¤æ¥å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåº”è¯¥æ˜¯uvicorn main:appã€‚æ³¨æ„ï¼Œæˆ‘è¿˜æ·»åŠ äº†public_routesé€‰é¡¹ï¼Œç›®çš„æ˜¯ä»¤æˆ‘çš„APIå¯ä»¥å…¬å¼€è®¿é—®ã€‚ v: 0micros: - name: Glims2Excel src: . engine: python3.9 run: uvicorn main:app public_routes: - &quot;/*&quot; æ·»åŠ requirements.txtåœ¨æ­£å¼ä¸Šä¼ ä¹‹å‰ï¼ŒåŠ¡å¿…æ·»åŠ ä¾èµ–æ–‡ä»¶ï¼Œè¯¥ä¾èµ–æ–‡ä»¶åº”è¯¥å’Œmain.pyåœ¨åŒä¸€ä¸ªä½ç½®ï¼ŒåŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¦åˆ™æ— æ³•è¿è¡Œï¼š # requirements.txtfastapiuvicorn[standard]python-multipart ##å¤„ç†Formdatapandas ##åˆ†æè¡¨æ ¼æ•°æ®openpyxl ## è¯»å–excel æ­£å¼éƒ¨ç½²è¿è¡Œspace pushå³å¯ã€‚ä½ å¯ä»¥åœ¨ä½ çš„Canvasä¸­è·å¾—ä¸€ä¸ªappï¼Œæœ¬æ–‡çš„appåœ°å€ä¸º https://glims2excel-1-w4936186.deta.app/docs ã€‚ æ€»ç»“ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸçš„å°†è‡ªå·±çš„apiéƒ¨ç½²åˆ°äº†å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é‡‡ç”¨ä»»ä½•æ–¹å¼æ¥å’Œè¯¥appäº¤äº’ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†æŠŠå‰ç«¯é¡µé¢å†™å‡ºæ¥ã€‚","categories":[{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"åç«¯","slug":"åç«¯","permalink":"https://xiaohanys.top/tags/%E5%90%8E%E7%AB%AF/"}],"author":"Xiaoguang Pan"},{"title":"Juliaè¯­è¨€ç¼–å†™Needleman Wunschå…¨å±€æ¯”å¯¹ç®—æ³•","slug":"Juliaè¯­è¨€ç¼–å†™NeedlemanWunschå…¨å±€æ¯”å¯¹ç®—æ³•","date":"2024-09-20T05:05:46.000Z","updated":"2024-10-18T05:34:04.469Z","comments":true,"path":"jl-global-alignment/","permalink":"https://xiaohanys.top/jl-global-alignment/","excerpt":"è¾“å…¥æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œè¾“å‡ºæ˜¯å¯¹é½åçš„ä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚","text":"è¾“å…¥æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œè¾“å‡ºæ˜¯å¯¹é½åçš„ä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚ function needleman_wunsch(seq1::String, seq2::String; gap_penalty::Int64=-1, match_score::Int64=1, mismatch_penalty::Int64=-1) # Check if the sequences are valid if !all(isuppercase(i) for i in seq1) || !all(isuppercase(j) for j in seq2) throw(ArgumentError(&quot;The sequences must contain only upper-case letters.&quot;)) end # Calculate the length of the two sequences len1, len2 = length(seq1), length(seq2) # Initialize the matrix matrix = zeros(Int64, len1 + 1, len2 + 1) # Initialize the first column first_col = @views matrix[2:end, 1] first_col[:] .= [i * gap_penalty for i in 1:(length(seq1))] # Initialize the first row first_row = @views matrix[1, 2:end] first_row[:] .= [j*gap_penalty for j in 1:(length(seq2))] # Fill the matrix for i in 2:(len1+1) for j in 2:(len2+1) match = seq1[i-1] == seq2[j-1] ? matrix[CartesianIndex(i - 1, j - 1)] + match_score : matrix[CartesianIndex(i - 1, j - 1)] + mismatch_penalty delete = matrix[CartesianIndex(i - 1, j)] + gap_penalty insert = matrix[CartesianIndex(i, j - 1)] + gap_penalty matrix[CartesianIndex(i, j)] = max(match, delete, insert) end end # Initialize the aligned sequences aligned_seq1 = &quot;&quot; aligned_seq2 = &quot;&quot; # Initialize the current index i = len1 + 1 j = len2 + 1 # Traceback while i &gt; 1 || j &gt; 1 if i &gt; 1 &amp;&amp; j &gt; 1 &amp;&amp; matrix[i, j] == matrix[i-1, j-1] + (seq1[i-1] == seq2[j-1] ? match_score : mismatch_penalty) aligned_seq1 = string(seq1[i-1], aligned_seq1) aligned_seq2 = string(seq2[j-1], aligned_seq2) i -= 1 j -= 1 elseif i &gt; 1 &amp;&amp; matrix[i, j] == matrix[i-1, j] + gap_penalty aligned_seq1 = string(seq1[i-1], aligned_seq1) aligned_seq2 = string(&#x27;-&#x27;, aligned_seq2) i -= 1 else aligned_seq1 = string(&#x27;-&#x27;, aligned_seq1) aligned_seq2 = string(seq2[j-1], aligned_seq2) j -= 1 end end (aligned_seq1, aligned_seq2)end ä¾‹å¦‚ï¼š @time needleman_wunsch(&quot;AGTACGCAGTCAGGTGACGTA&quot;,&quot;AGTACCCAGTCAGGGACGTA&quot;) 0.000017 seconds (129 allocations: 8.109 KiB)(&quot;AGTACGCAGTCAGGTGACGTA&quot;, &quot;AGTACCCAGTCAGG-GACGTA&quot;) æ•´ä¸ªç®—æ³•ä¸»è¦æ˜¯çŸ©é˜µæ“ä½œã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"Juliaè¯­è¨€æ¨¡ä»¿BAMæ–‡ä»¶çš„pileupç±»ä¼¼æ“ä½œ","slug":"Juliaè¯­è¨€æ¨¡ä»¿BAMæ–‡ä»¶çš„pileupç±»ä¼¼æ“ä½œ","date":"2024-09-20T05:05:01.000Z","updated":"2024-10-18T05:34:07.454Z","comments":true,"path":"jl-bam-pileup/","permalink":"https://xiaohanys.top/jl-bam-pileup/","excerpt":"ç®€ä»‹ä½¿ç”¨è¿‡pysamå’Œsamtoolsçš„å°ä¼™ä¼´è‚¯å®šäº†è§£ pileupçš„æ“ä½œï¼Œå¦‚æœæŠŠBAMæ–‡ä»¶çœ‹ä½œè¡¨æ ¼çš„è¯ï¼Œé‚£ä¹ˆé€šå¸¸æˆ‘ä»¬æ˜¯æŒ‰è¡Œå»è§£æå®ƒçš„recordï¼Œè¿›è€Œè·å¾—ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚æ¯”å¯¹åˆ°å“ªæ¡æŸ“è‰²ä½“ï¼Œæ¯”å¯¹çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ç­‰. å¦ä¸€ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦æŒ‰ç…§åˆ—å»å¾ªç¯è§£æï¼Œå¾—åˆ°è¿™ä¸ªåˆ—ä¸Šçš„å…·ä½“ä¿¡æ¯ï¼Œå…¸å‹çš„å°±æ˜¯è¿™ä¸ªåˆ—ä¸Šæ¯”å¯¹åºåˆ—çš„ç¢±åŸºæ˜¯ä»€ä¹ˆï¼Ÿæ¯”å¯¹åºåˆ—çš„ä½ç½®æ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠæ˜¯Match or Mismatch or indel ç­‰ã€‚é‚£ä¹ˆï¼Œè¯¥æ“ä½œå°±éœ€è¦å¼•å…¥pileupæ“ä½œäº†ã€‚","text":"ç®€ä»‹ä½¿ç”¨è¿‡pysamå’Œsamtoolsçš„å°ä¼™ä¼´è‚¯å®šäº†è§£ pileupçš„æ“ä½œï¼Œå¦‚æœæŠŠBAMæ–‡ä»¶çœ‹ä½œè¡¨æ ¼çš„è¯ï¼Œé‚£ä¹ˆé€šå¸¸æˆ‘ä»¬æ˜¯æŒ‰è¡Œå»è§£æå®ƒçš„recordï¼Œè¿›è€Œè·å¾—ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚æ¯”å¯¹åˆ°å“ªæ¡æŸ“è‰²ä½“ï¼Œæ¯”å¯¹çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ç­‰. å¦ä¸€ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦æŒ‰ç…§åˆ—å»å¾ªç¯è§£æï¼Œå¾—åˆ°è¿™ä¸ªåˆ—ä¸Šçš„å…·ä½“ä¿¡æ¯ï¼Œå…¸å‹çš„å°±æ˜¯è¿™ä¸ªåˆ—ä¸Šæ¯”å¯¹åºåˆ—çš„ç¢±åŸºæ˜¯ä»€ä¹ˆï¼Ÿæ¯”å¯¹åºåˆ—çš„ä½ç½®æ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠæ˜¯Match or Mismatch or indel ç­‰ã€‚é‚£ä¹ˆï¼Œè¯¥æ“ä½œå°±éœ€è¦å¼•å…¥pileupæ“ä½œäº†ã€‚ indel ç­‰ã€‚é‚£ä¹ˆï¼Œè¯¥æ“ä½œå°±éœ€è¦å¼•å…¥pileupæ“ä½œäº†ã€‚ pysamåŒ…ä¸­åˆ†åˆ«æœ‰pileupï¼ŒPileupColumnä»¥åŠPuleupRead å¯¹è±¡æ¥æ‰¿æ‹…ä¸Šè¿°ä»»åŠ¡, é‚£ä¹ˆæˆ‘ä»¬ç®€å•çš„åœ¨juliaä½¿ç”¨ï¼Œä¸éœ€è¦æ„å»ºå¯¹è±¡è¿™ä¹ˆå¤æ‚çš„æ“ä½œï¼Œå†™å‡ ä¸ªå‡½æ•°å³å¯ å¼•å…¥éœ€è¦çš„åŒ…using XAMusing BioAlignmentsusing GenomicFeaturesusing BioGenerics è·å–æ¯”å¯¹åˆ°æŸä¸ªä½ç‚¹å’ŒæŸä¸ªåŒºé—´çš„read æ•°é‡function pileup(bam::BAM.Reader,contig::String, pos::Int64) ### get the intervealCollection site = Interval(contig, pos,pos) ### get the pileup GenomicFeatures.eachoverlap(bam,site)end## return number of segments in the pileupfunction nsegments(bam::BAM.Reader,contig::String, start::Int64, stop::Int64) interval = Interval(contig, start, stop) num = 0 for i in eachoverlap(bam,interval) num+=1 end numendfunction nsegments(bam::BAM.Reader,contig::String, pos::Int64) interval = Interval(contig, pos, pos) num = 0 for i in eachoverlap(bam,interval) num+=1 end numend è·å–æ¯”å¯¹åˆ°æŸä¸ªä½ç‚¹çš„Query åºåˆ—çš„ä½ç½®å’Œæ¯”å¯¹æƒ…å†µfunction get_query_position(bam::BAM.Reader, contig::String, pos::Int) # get the pileup at the contig position PileupReads = pileup(bam, contig, pos) # get the reference base Iterators.map(x-&gt;(ref2seq(BAM.alignment(x),pos)[1]),PileupReads)end function get_query_operation(bam::BAM.Reader,contig::String, pos::Int) # Get pileup reads PileupReads = pileup(bam,contig, pos) # Map each read to the base at the given position Iterators.map(x-&gt;(ref2seq(BAM.alignment(x),pos)[2]),PileupReads)end è¯¥get_query_positionå‡½æ•°è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¯ä»¥è¿­ä»£è·å–æ¯”å¯¹åˆ°æŸä¸ªå‚è€ƒä½ç‚¹çš„recordä¸Šçš„å…·ä½“ä½ç½®ï¼Œä¾‹å¦‚ bam = open(BAM.Reader,&quot;45T.cs.rmdup.sort.bam&quot;,index=&quot;45T.cs.rmdup.sort.bam.bai&quot;)pos = get_query_position(bam,&quot;chr6&quot;,36434531)for p in pos println(p)end å½“ç„¶ï¼Œä½ å¯ä»¥åšä¸€ä¸ªåŒé‡å¾ªç¯ï¼Œè®¡ç®—å¾ˆå¤šä½ç‚¹çš„å…·ä½“ä½ç½®ã€‚ åŒæ ·ï¼Œè¯¥get_query_operationå‡½æ•°è¿”å›çš„æ˜¯å…·ä½“æ¯”å¯¹ç±»å‹ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯”å¯¹æœ‰M(match),I(insertion),D(deletion)ç»„æˆï¼Œè¿™ä¸ªå°±å¯ä»¥æ‰“å°å¯¹åº”çš„è¡Œä¸ºã€‚ bam = open(BAM.Reader,&quot;45T.cs.rmdup.sort.bam&quot;,index=&quot;45T.cs.rmdup.sort.bam.bai&quot;)pos = get_query_operation(bam,&quot;chr6&quot;,36434531)for p in pos println(p)endMMMMM...","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"Pythonç¼–å†™æ‹†åˆ†Barcodeçš„è„šæœ¬ï¼Œå¹¶ç”¨Codonç¼–è¯‘ä¸ºNative code","slug":"Pythonç¼–å†™æ‹†åˆ†Barcodeçš„è„šæœ¬","date":"2024-09-20T05:04:10.000Z","updated":"2024-10-18T05:34:10.194Z","comments":true,"path":"py-barcode-split/","permalink":"https://xiaohanys.top/py-barcode-split/","excerpt":"æ‘˜è¦æˆå¯¹çš„readsä¸­ï¼Œread_2çš„å¼€å¤´åŒ…å«ä¸¤ä»½barcodeåºåˆ—ï¼Œåˆ†åˆ«é•¿10bp,ä¸­é—´æœ‰ä¸€æ®µå›ºå®šé•¿åº¦ä¸º15bpçš„åºåˆ—åˆ†å‰²ï¼Œä¾‹å¦‚ ATCTATGACATGTTACGTTAACTCCNATCTATCACTTAGCGCTGNCCCTGTCCTCTACACTCCACCCCCTCCCCACCAGACTAAACAACGCCCTTTCCCC è¯¥åºåˆ—ä¸­ATTTATGACAåŠAATCTATCAAä¸ºbarcodeåºåˆ—ã€‚è¦æ³¨æ„ï¼Œbarcodeå› ä¸ºæµ‹åºçš„åŸå› å­˜åœ¨ä¸€å®šçš„é”™é…ï¼Œéœ€è¦å¯¹å…¶æœ‰ä¸€å®šçš„å®¹çº³ã€‚","text":"æ‘˜è¦æˆå¯¹çš„readsä¸­ï¼Œread_2çš„å¼€å¤´åŒ…å«ä¸¤ä»½barcodeåºåˆ—ï¼Œåˆ†åˆ«é•¿10bp,ä¸­é—´æœ‰ä¸€æ®µå›ºå®šé•¿åº¦ä¸º15bpçš„åºåˆ—åˆ†å‰²ï¼Œä¾‹å¦‚ ATCTATGACATGTTACGTTAACTCCNATCTATCACTTAGCGCTGNCCCTGTCCTCTACACTCCACCCCCTCCCCACCAGACTAAACAACGCCCTTTCCCC è¯¥åºåˆ—ä¸­ATTTATGACAåŠAATCTATCAAä¸ºbarcodeåºåˆ—ã€‚è¦æ³¨æ„ï¼Œbarcodeå› ä¸ºæµ‹åºçš„åŸå› å­˜åœ¨ä¸€å®šçš„é”™é…ï¼Œéœ€è¦å¯¹å…¶æœ‰ä¸€å®šçš„å®¹çº³ã€‚ å…·ä½“è¿‡ç¨‹1. ç¼–å†™è¯†åˆ«Barcodeå®¹é”™çš„ç¨‹åºBarcodeå’Œåºåˆ—æœ¬è´¨ä¸Šæ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæœ€ç®€å•çš„å®¹é”™å°±æ˜¯ä½¿ç”¨æ±‰æ˜è·ç¦»æ¥è®¡ç®—å‡ºä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²çš„é”™é…ä¸ªæ•°ï¼Œå¹¶åŠ ä»¥é™åˆ¶ã€‚ def hamming_distance(s1: str, s2: str) -&gt; int: &quot;&quot;&quot;Return the Hamming distance between equal-length sequences&quot;&quot;&quot; if len(s1) != len(s2): raise ValueError(&quot;Undefined for sequences of unequal length&quot;) return sum(ch1 != ch2 for ch1, ch2 in zip(s1, s2)) æ ¹æ®æ ‡é¢˜æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦å°†Pythonä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Œå› æ­¤éœ€è¦å¯¹ä¸€äº›å˜é‡åŠ ä»¥æ ‡æ³¨ï¼Œä»¥ç”Ÿæˆé«˜æ€§èƒ½ä»£ç ã€‚Codonä¸­å¯¹å˜é‡ç±»å‹çš„å£°æ˜s1:strï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„pythonä¸­æ˜¯å­˜åœ¨çš„ã€‚ 2. ç¼–å†™ä¸€ä¸ªè§£æå‹ç¼©æ ¼å¼fastqæ–‡ä»¶çš„ç¨‹åºè¿™é‡Œå› ä¸ºæµ‹åºæ•°æ®é‡å¾ˆå¤§ï¼Œä¸å»ºè®®ç›´æ¥è¯»å…¥å†…å­˜ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å¦å¤–ï¼Œå› ä¸ºCodonä¸æ”¯æŒBioPythonåŒ…ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥å†™ã€‚ import gzip@tupleclass FastqRecord: id: str sequence: str quality: strdef parse_gzip_fastq(filename:str): with gzip.open(filename, &#x27;rt&#x27;) as f: while True: try: lines = [next(f).strip(&quot;\\n&quot;) for _ in range(4)] except: break if not all(lines): break id = lines[0][1:] sequence = lines[1] quality = lines[3] yield FastqRecord(id, sequence, quality) 3. è¯»å–Barcodeåºåˆ—Barcodeæ˜¯ä»»æ„ä¸¤ä¸ªåºåˆ—çš„2V2ç»„åˆï¼Œè€Œä¸”åœ¨read_2ä¸Šï¼Œæ‰€ä»¥éœ€è¦åå‘äº’è¡¥ã€‚ import itertoolsdef reverse_complement(seq: str) -&gt; str: &quot;&quot;&quot;Compute reverse complement of a sequence&quot;&quot;&quot; basecomplement = &#123;&#x27;A&#x27;: &#x27;T&#x27;, &#x27;C&#x27;: &#x27;G&#x27;, &#x27;G&#x27;: &#x27;C&#x27;, &#x27;T&#x27;: &#x27;A&#x27;&#125; letters = list(seq) letters = [basecomplement[base] for base in letters] return &#x27;&#x27;.join(letters[::-1])def read_barcode(barcode: str): &quot;&quot;&quot;Read barcode from file&quot;&quot;&quot; codes = List[str]() with open(barcode, &#x27;r&#x27;) as f: codes = [reverse_complement(line.strip(&quot;\\n&quot;)) for line in f] return [cc for cc in itertools.product(codes, codes)] æœ€ç»ˆæ‹†åˆ†Barcodeçš„Mainå‡½æ•°å¦‚ä¸‹def split_barcodes(fq1:str,fq2:str, barcodes: List[Tuple[str,str]]): &quot;&quot;&quot;make files for every barcode&quot;&quot;&quot; read1_files = &#123;barcode:open(f&quot;&#123;barcode[0]&#125;_&#123;barcode[1]&#125;_1.fastq&quot;,&quot;a+&quot;) for barcode in barcodes&#125; read2_files = &#123;barcode:open(f&quot;&#123;barcode[0]&#125;_&#123;barcode[1]&#125;_2.fastq&quot;,&quot;a+&quot;) for barcode in barcodes&#125; &quot;&quot;&quot;read raw fastq files&quot;&quot;&quot; for record1, record2 in zip(parse_gzip_fastq(fq1), parse_gzip_fastq(fq2)): for barcode in barcodes: barcode_l, barcode_r = barcode if hamming_distance(record2.sequence[:len(barcode_l)], barcode_l) &lt;= 1 and hamming_distance(record2.sequence[len(barcode_r)+15:len(barcode_r)*2+15], barcode_r) &lt;= 3: read1_files[barcode].write(f&quot;&#123;record1.id&#125;\\n&quot;) read1_files[barcode].write(record1.sequence+&quot;\\n&quot;) read1_files[barcode].write(&quot;+\\n&quot;) read1_files[barcode].write(record1.quality+&quot;\\n&quot;) read2_files[barcode].write(f&quot;&#123;record2.id&#125;\\n&quot;) read2_files[barcode].write(record2.sequence+&quot;\\n&quot;) read2_files[barcode].write(&quot;+\\n&quot;) read2_files[barcode].write(record2.quality+&quot;\\n&quot;) [f.close() for f in read1_files.values()] [f.close() for f in read2_files.values()] ç¼–è¯‘æˆæœ¬åœ°ä»£ç ä¸‹è½½codonç¼–è¯‘å™¨ /bin/bash -c &quot;$(curl -fsSL https://exaloop.io/install.sh)&quot; ç„¶åæ‰§è¡Œç¼–è¯‘ codon build -release -o split_barcode split_barcodes.codon æ€»ç»“Codonä½œä¸ºä¸€æ¬¾é«˜æ€§èƒ½çš„å…¼å®¹Pythonè¯­æ³•çš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡Pythonçš„æ‰§è¡Œé€Ÿåº¦åˆ°C/C++çš„æ°´å¹³ï¼ŒåŸåˆ™ä¸Šåªè¦ä¼šå†™Pythonï¼Œé‚£ä¹ˆå°±æŒæ¡äº†99%çš„Codonäº†ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå‘ç°äº†ï¼Œç›®å‰Codonåªæ”¯æŒéƒ¨åˆ†çš„Pythonæ ‡å‡†åº“ï¼Œæœ‰äº›åº“å‡½æ•°è¿˜ä¸å¥å…¨ï¼Œä¾‹å¦‚GZfileçš„readline()å‡½æ•°å°±ä¸å­˜åœ¨ï¼Œéœ€è¦æˆ‘ä»¬ç”¨next(iter)æ¥æ›¿ä»£ï¼Œå¹¶æ·»åŠ é¢å¤–çš„EOF æ£€æµ‹ã€‚åœ¨è¯»å–fastqæ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•è°ƒç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€è¦è‡ªè¡Œâ€œé€ è½®å­â€ã€‚è™½ç„¶æå‡äº†æ‰§è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯ç¼–å†™ä»£ç çš„é€Ÿåº¦ä¾æ—§é™ä½äº†ã€‚ ä½†æ˜¯ï¼Œä¸è¦å¿˜äº†ç°åœ¨æˆ‘ä»¬æœ‰å¼ºå¤§çš„chatGPTäº†ï¼Œé’ˆå¯¹ä¸€äº›åŠŸèƒ½ï¼Œä½ å®Œå…¨å¯ä»¥è®©chatGPTå¸®ä½ å†™å¥½ä»£ç ï¼Œè¿™æ ·é‡å¤é€ è½®å­çš„å·¥ä½œä¾¿å¯ä»¥ç”±AI å–ä»£ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šç®—æ˜¯å‡å°‘äº†Codonçš„ç¼ºé™·äº†ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"}],"author":"Xiaoguang Pan"},{"title":"å•ç»†èƒæ•°æ®å¦‚ä½•ç»˜åˆ¶stacked violin?","slug":"å•ç»†èƒæ•°æ®å¦‚ä½•ç»˜åˆ¶stackedviolin","date":"2024-09-20T05:03:11.000Z","updated":"2024-10-18T05:32:03.082Z","comments":true,"path":"scrna-stack-violin/","permalink":"https://xiaohanys.top/scrna-stack-violin/","excerpt":"Pythonçš„ScanpyåŒ…å’ŒSeuratåŒ…ä¸€æ ·ï¼Œæ˜¯å•ç»†èƒæ•°æ®å¤„ç†çš„åˆ©å™¨ï¼Œå…¶ä¸­ï¼ŒScanpyä¸­æœ‰ä¸€ç§å †ç§¯çš„å°æç´å›¾ï¼Œå¯ä»¥å¾ˆå¥½çš„å±•ç¤ºmarkerçš„è¡¨è¾¾æƒ…å†µï¼Œä½†æ˜¯åœ¨Seuratä¸­å¹¶æ²¡æœ‰å†…ç½®å‘½ä»¤ã€‚å› æ­¤ï¼Œæˆ‘è‡ªå·±å°è¯•æå–æ•°æ®å¹¶ç”¨ggplot2åŒ…æ¥ç”»è¯¥å›¾ã€‚ é¦–å…ˆæ¥å±•ç¤ºä»¥ä¸‹ç”»å›¾çš„æˆæœï¼Œå¦‚å›¾","text":"Pythonçš„ScanpyåŒ…å’ŒSeuratåŒ…ä¸€æ ·ï¼Œæ˜¯å•ç»†èƒæ•°æ®å¤„ç†çš„åˆ©å™¨ï¼Œå…¶ä¸­ï¼ŒScanpyä¸­æœ‰ä¸€ç§å †ç§¯çš„å°æç´å›¾ï¼Œå¯ä»¥å¾ˆå¥½çš„å±•ç¤ºmarkerçš„è¡¨è¾¾æƒ…å†µï¼Œä½†æ˜¯åœ¨Seuratä¸­å¹¶æ²¡æœ‰å†…ç½®å‘½ä»¤ã€‚å› æ­¤ï¼Œæˆ‘è‡ªå·±å°è¯•æå–æ•°æ®å¹¶ç”¨ggplot2åŒ…æ¥ç”»è¯¥å›¾ã€‚ é¦–å…ˆæ¥å±•ç¤ºä»¥ä¸‹ç”»å›¾çš„æˆæœï¼Œå¦‚å›¾ é¦–å…ˆæ¥å±•ç¤ºä»¥ä¸‹ç”»å›¾çš„æˆæœï¼Œå¦‚å›¾ é‚£ä¹ˆç›´æ¥ä¸Šå‘½ä»¤å§ï¼ ###è½½å…¥éœ€è¦çš„RåŒ…library(Seurat)library(dplyr)library(tidyr)library(ggplot2)##loadæµ‹è¯•æ•°æ®data&lt;-readRDS(&quot;cluster_1.afterclu.rds&quot;) ##ç¬¬ä¸€ä¸ªå‡½æ•°ä»Seuratå¯¹è±¡ä¸­è·å–è¡¨è¾¾å€¼å¹¶è½¬åŒ–ä¸ºéœ€è¦çš„æ ¼å¼tidygotData&lt;-function(seurat.obj,features,groups)&#123; mat&lt;-GetAssayData(data,assay = &quot;RNA&quot;,slot = &quot;data&quot;)[features,] plotData&lt;-mat%&gt;% as.data.frame()%&gt;% tibble::rownames_to_column(var=&quot;gene&quot;)%&gt;% as_tibble()%&gt;% tidyr::pivot_longer(names_to = &quot;cell&quot;,values_to=&quot;exp&quot;,cols=2:(ncol(mat)+1)) cellmeta&lt;-data@meta.data%&gt;% tibble::rownames_to_column(var=&quot;cell&quot;)%&gt;% as_tibble()%&gt;% select(cell,sym(groups)) plotData&lt;-plotData%&gt;% left_join(cellmeta,by=&quot;cell&quot;)%&gt;% setNames(c(&quot;gene&quot;,&quot;cell&quot;,&quot;value&quot;,&quot;cellID&quot;)) plotData&#125;##ç¬¬äºŒä¸ªå‡½æ•°ç”»å›¾plot_stacked_violin&lt;-function(plotData,xlab,ylab,cols)&#123; ggplot(plotData,aes(y=cellID,x=value,fill=cellID))+ geom_violin()+ facet_wrap(.~gene)+ theme_test()+ xlab(xlab)+ ylab(ylab)+ scale_fill_manual(values = cols)+ theme(panel.spacing=unit(0,&quot;cm&quot;), strip.background = element_rect(fill=&quot;transparent&quot;,color = &quot;white&quot;), axis.text.x = element_blank(), axis.ticks.x = element_blank(), panel.border = element_rect(size=0.7,colour = &quot;black&quot;), strip.text = element_text(size=10,face = &quot;italic&quot;), axis.text.y = element_text(size = 11.5,face=&quot;bold&quot;), axis.title.y = element_text(size = 13))+ NoLegend()&#125; ä¸‹é¢æ˜¯ä½¿ç”¨æ–¹æ³• plot_stacked_violin(gotData(data,c(&quot;CD7&quot;,&quot;KLRB1&quot;,&quot;NKG7&quot;),&quot;integrated_snn_res.0.1&quot;),&quot;&quot;,&quot;Cell cluster&quot;,c(&quot;#8dd3c7&quot;,&quot;#ffffb3&quot;,&quot;#bebada&quot;,&quot;#fb8072&quot;))","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"ä¸åŒçš„è¯­è¨€å¤„ç†gzipå‹ç¼©æ–‡ä»¶çš„æ—¶é—´å¯¹æ¯”","slug":"ä¸åŒçš„è¯­è¨€å¤„ç†gzipå‹ç¼©æ–‡ä»¶çš„æ—¶é—´å¯¹æ¯”","date":"2024-09-20T05:01:02.000Z","updated":"2024-10-18T05:31:59.362Z","comments":true,"path":"gzip-decompress-eff/","permalink":"https://xiaohanys.top/gzip-decompress-eff/","excerpt":"é¦–å…ˆåœ¨shellä¸­æµ‹è¯•å¦‚ä¸‹å‘½ä»¤#!/bin/shtime gzip -d -c risearch_chr1:143971112-143971134:+:FAM72C.out.gz &gt; risearch_chr1:143971112-143971134:+:FAM72C.out","text":"é¦–å…ˆåœ¨shellä¸­æµ‹è¯•å¦‚ä¸‹å‘½ä»¤#!/bin/shtime gzip -d -c risearch_chr1:143971112-143971134:+:FAM72C.out.gz &gt; risearch_chr1:143971112-143971134:+:FAM72C.out 0.28s user 0.02s system 99% cpu 0.297 total ç„¶åæµ‹è¯•pythonimport gzipdef parse_gzip_py(ris_file): inf = gzip.open(ris_file, &#x27;rt&#x27;) with open(&quot;test_py_gz.txt&quot;,&quot;w&quot;) as f: for line in inf: f.write(line+&quot;\\n&quot;) inf.close() %timeit parse_gzip_py(&quot;risearch_chr1:143971112-143971134:+:FAM72C.out.gz&quot;)399 ms +/- 1.91 ms per loop Julia é‡Œé¢æœ‰ä¸¤ä¸ªè§£æGzipçš„åŒ…ï¼Œåˆ†åˆ«æ˜¯GZip.jl å’Œ CodecZlib.jlã€‚ æˆ‘ä»¬åˆ†åˆ«æ¥æµ‹è¯•ä¸€ä¸‹ using GZipfunction parse_gzip_file(filename::String) out = open(&quot;test_gzipjl.txt&quot;, &quot;w&quot;) zips = GZip.open(filename) while !eof(zips) line = readline(zips) println(out, line) end close(out)end @time parse_gzip_file(&quot;risearch_chr1:143971112-143971134:+:FAM72C.out.gz&quot;)0.388812 seconds ç„¶åæ˜¯codeczlib,å¿…é¡»ç”¨å¦ä¸€ä¸ªåŒ…è°ƒç”¨å®ƒusing TranscodingStreamsusing CodecZlibfunction parse_gzi_trans(filename::String) out = open(&quot;test_trans.txt&quot;, &quot;w&quot;) stream = GzipDecompressorStream(open(filename)) for line in eachline(stream) println(out, line) end close(out)end @time parse_gzi_trans(&quot;risearch_chr1:143971112-143971134:+:FAM72C.out.gz&quot;)0.280360 seconds ç»“è®ºï¼šJuliaè¯­è¨€ä½¿ç”¨GZipåŒ…çš„æ—¶å€™ï¼Œé€Ÿåº¦è¦æ…¢äºshellï¼Œå¿«äºpythonï¼›ä½¿ç”¨CodecZlibçš„æ—¶å€™ï¼Œé€Ÿåº¦å¿«äºshell å’Œ pythonã€‚ä½†æ˜¯æ•´ä½“æ—¶é—´æ¥çœ‹ï¼Œæœ€å¿«çš„æ¯”æœ€æ…¢çš„ä¹Ÿå°±å¿«0.1sï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå³ä½¿æ˜¯è¦è§£å‹10000ä¸ªæ–‡ä»¶ï¼ŒJuliaä¹Ÿå°±æ¯”pythonå¿«16åˆ†é’Ÿè€Œå·²ã€‚è¿™ä¸ªåœ¨å·¨å¤§çš„è§£å‹ç”¨æ—¶é¢å‰ï¼Œå¹¶ä¸ç®—ä»€ä¹ˆã€‚ æ•°æ®æ–‡ä»¶å¯ä»æˆ‘çš„githubè·å–link","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"},{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"}],"author":"Xiaoguang Pan"},{"title":"ä½¿ç”¨Rè¯­è¨€å®ç°bedtoolsæ±‚äº¤é›†çš„åŠŸèƒ½?","slug":"ä½¿ç”¨Rè¯­è¨€å®ç°bedtoolsæ±‚äº¤é›†çš„åŠŸèƒ½","date":"2024-09-20T05:00:06.000Z","updated":"2024-10-18T05:33:02.069Z","comments":true,"path":"r-bedtools-intersect/","permalink":"https://xiaohanys.top/r-bedtools-intersect/","excerpt":"Bedtoolsä½œä¸ºåŸºå› ç»„ç ”ç©¶çš„ â€œ ç‘å£«å†›åˆ€ â€ï¼Œ åŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºæ“ä½œï¼Œæ˜¯ç”Ÿä¿¡è¡Œä¸šä¸å¯å¤šå¾—çš„å¥½è½¯ä»¶ã€‚é€šå¸¸å¯¹bedåŒºé—´çš„æ³¨é‡Šï¼Œæˆ‘ä»¬ä½¿ç”¨å…¶ä¸­â€œ æ±‚äº¤é›† â€çš„åŠŸèƒ½ï¼ˆbedtools intersect) ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é€šå¸¸è¦ç”Ÿæˆå¯¹åº”çš„bedæ–‡ä»¶ï¼Œå†æ³¨é‡Šå®Œæˆåè¿˜éœ€è¦ç”¨Rè¯­è¨€ç­‰è¯»å…¥æ‰èƒ½ç»§ç»­åˆ†æï¼Œæ‰€ä»¥æ•´åˆåº¦ä¸æ˜¯å¾ˆå¥½ï¼Œæœ¬æ–‡å¸Œæœ›æä¾›Rè¯­è¨€çš„æ€è·¯æ¥è§£å†³è¯¥é—®é¢˜ã€‚","text":"Bedtoolsä½œä¸ºåŸºå› ç»„ç ”ç©¶çš„ â€œ ç‘å£«å†›åˆ€ â€ï¼Œ åŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºæ“ä½œï¼Œæ˜¯ç”Ÿä¿¡è¡Œä¸šä¸å¯å¤šå¾—çš„å¥½è½¯ä»¶ã€‚é€šå¸¸å¯¹bedåŒºé—´çš„æ³¨é‡Šï¼Œæˆ‘ä»¬ä½¿ç”¨å…¶ä¸­â€œ æ±‚äº¤é›† â€çš„åŠŸèƒ½ï¼ˆbedtools intersect) ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é€šå¸¸è¦ç”Ÿæˆå¯¹åº”çš„bedæ–‡ä»¶ï¼Œå†æ³¨é‡Šå®Œæˆåè¿˜éœ€è¦ç”¨Rè¯­è¨€ç­‰è¯»å…¥æ‰èƒ½ç»§ç»­åˆ†æï¼Œæ‰€ä»¥æ•´åˆåº¦ä¸æ˜¯å¾ˆå¥½ï¼Œæœ¬æ–‡å¸Œæœ›æä¾›Rè¯­è¨€çš„æ€è·¯æ¥è§£å†³è¯¥é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯bedtools?bedtoolsï¼šä¸€ä¸ªå¼ºå¤§çš„åŸºå› ç»„ç®—æ³•å·¥å…·é›†æ€»çš„æ¥è¯´ï¼Œbedtoolså®ç”¨ç¨‹åºæ˜¯ç”¨äºå¹¿æ³›åŸºå› ç»„å­¦åˆ†æä»»åŠ¡çš„ç‘å£«å†›åˆ€ã€‚æœ€å¹¿æ³›ä½¿ç”¨çš„å·¥å…·æ”¯æŒåŸºå› ç»„ç®—æ³•ï¼šå³åŸºå› ç»„çš„é›†åˆè®ºã€‚ä¾‹å¦‚ï¼Œbedtoolså…è®¸ä»å¹¿æ³›ä½¿ç”¨çš„åŸºå› ç»„æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚ BAMã€BEDã€GFF&#x2F;GTFã€VCFï¼‰çš„å¤šä¸ªæ–‡ä»¶ä¸­äº¤å‰ã€åˆå¹¶ã€è®¡æ•°ã€è¡¥å……å’Œæ´—ç‰ŒåŸºå› ç»„åŒºé—´ã€‚è™½ç„¶æ¯ä¸ªå•ç‹¬çš„å·¥å…·éƒ½æ—¨åœ¨å®Œæˆä¸€é¡¹ç›¸å¯¹ç®€å•çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œ ç›¸äº¤ä¸¤ä¸ªé—´éš”æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡åœ¨ UNIX å‘½ä»¤è¡Œä¸Šç»„åˆå¤šä¸ª bedtools æ“ä½œæ¥è¿›è¡Œç›¸å½“å¤æ‚çš„åˆ†æã€‚ bedtoolsæ˜¯åœ¨çŠ¹ä»–å¤§å­¦çš„æ˜†å…°å®éªŒå®¤å¼€å‘çš„ï¼Œå—ç›Šäºä¸–ç•Œå„åœ°ç§‘å­¦å®¶çš„æ°å‡ºè´¡çŒ®ã€‚ä½ å¯ä»¥ä»è¯¥é“¾æ¥https://bedtools.readthedocs.io/en/latest/content/bedtools-suite.htmlè·å–å®ƒæ‰€æœ‰çš„æ‰€æœ‰åŠŸèƒ½ã€‚ ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šè·å–bedåŒºé—´å¼€å§‹&#x2F;ç»“æŸä½ç‚¹è½åœ¨åŸºå› åŒºé—´ä¸Šçš„ç»“æœè¿™ä¸ªé—®é¢˜ç”¨bedtoolsä¹Ÿä¸å¥½è§£å†³ï¼Œå› ä¸ºå®é™…ä¸Šæˆ‘ä»¬éœ€è¦è·å–äº¤é›†çš„å­é›†ã€‚éœ€è¦é¦–å…ˆæŠŠbedåŒºé—´è½¬å˜ä¸ºåªæœ‰1bpçš„åŒºé—´ï¼Œè¿™å¢åŠ äº†æ“ä½œæ­¥éª¤ï¼Œä½†æ˜¯åœ¨Rè¯­è¨€ä¸­æˆ‘ä»¬å¯ä»¥å¾ˆçµæ´»å®ç°è¯¥æ–¹æ¡ˆã€‚ éœ€è¦å…ˆå¯¼å…¥RåŒ… library(GenomicRanges)library(readr)library(dplyr) ç„¶åå†™ä¸€ä¸ªå‡½æ•°ï¼Œè´Ÿè´£å°†bedæ–‡ä»¶è½¬åŒ–ä¸ºGRangeså¯¹è±¡ã€‚ makeGranges&lt;-function(x,meta.name)&#123; df&lt;-read_tsv(x,col_names=F) if(stringr::str_detect(df$X1[1],&quot;chr&quot;))&#123; df$X1&lt;-stringr::str_remove(df$X1,&quot;chr&quot;) &#125; names(df)&lt;-c(&quot;seqname&quot;,&quot;start&quot;,&quot;end&quot;,meta.name) makeGRangesFromDataFrame(df,keep.extra.columns = T,ignore.strand = T)&#125; ç„¶åå°±æ˜¯å®ç°è¯¥é¢˜ç›®åŠŸèƒ½çš„å‡½æ•°äº† anno_start&lt;-function(x,y)&#123; x_tmp&lt;-narrow(x,start=1,width = 1) res&lt;-findOverlaps(x_tmp,y,ignore.strand=T) jiaoji&lt;-x[queryHits(res)] mcols(jiaoji)$anno&lt;-mcols(y[subjectHits(res)])[[1]] ## assume that the first meta column should be anno info jiaoji&#125; å…¶å®å°±æ˜¯é€šè¿‡ç¼©çŸ­bedåŒºé—´åˆ°èµ·å§‹ä½ç½®1bpï¼Œç„¶åæ±‚äº¤é›†å³å¯ã€‚ ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•å®ç°ç™¾åˆ†æ¯”äº¤é›†æˆ‘ä»¬é€šå¸¸ä¸ä»…ä»…æƒ³çŸ¥é“äº¤é›†ï¼Œè¿˜æƒ³çŸ¥é“äº¤é›†ä¹‹é—´ç›¸äº¤éƒ¨åˆ† çš„é•¿åº¦å è‡ªèº«çš„ç™¾åˆ†æ¯”æ¥æ§åˆ¶ç»“æœçš„è¾“å‡ºã€‚ get_overlap_percentage&lt;-function(x,y,query.restrict=T,pct=0.2)&#123; hits &lt;- findOverlaps(x,y,ignore.strand=T) ints&lt;-pintersect(x[queryHits(hits)],y[subjectHits(hits)]) if(query.restrict==TRUE)&#123; int_p&lt;-width(ints)/width(x[queryHits(hits)]) &#125;else&#123; int_p&lt;-width(ints)/width(y[subjectHits(hits)]) &#125; hits &lt;- hits[int_p&gt;=pct] jiaoji&lt;-x[queryHits(hits)] mcols(jiaoji)$anno&lt;-mcols(y[subjectHits(hits)])[[1]] jiaoji&#125; è™½ç„¶ä¹Ÿä¸éš¾ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½å®ç°èµ·æ¥ï¼Œè¿˜æ˜¯æ¯”ç¬¬ä¸€ä¸ªé—®é¢˜è¦å¤æ‚çš„ï¼Œå› ä¸ºäº¤é›†ä¼šå­˜åœ¨ä¸€å¯¹å¤šçš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤æ¬¡æ±‚äº¤ï¼Œåˆ†åˆ«è®¡ç®—é•¿åº¦ä»¥åŠç™¾åˆ†æ¯”ï¼Œç„¶åæ§åˆ¶ç¬¬ä¸€æ¬¡çš„è¾“å‡ºã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"JuliaçŸ­å°ä»£ç æ‰¹é‡æ£€æµ‹BAMæ–‡ä»¶çš„å®Œæ•´æ€§","slug":"JuliaçŸ­å°ä»£ç æ‰¹é‡æ£€æµ‹BAMæ–‡ä»¶çš„å®Œæ•´æ€§","date":"2024-09-20T04:59:18.000Z","updated":"2024-10-18T05:33:50.310Z","comments":true,"path":"jl-bam-check/","permalink":"https://xiaohanys.top/jl-bam-check/","excerpt":"æˆ‘ä»¬åœ¨è¿è¡Œbwa memæ¯”å¯¹çš„æ—¶å€™ï¼Œç”±äºæŸäº›ä¸æ˜çš„åŸå› ä¼šé€ æˆç¨‹åºä¸­æ–­ï¼Œä¾‹å¦‚å†…å­˜è¶…äº†ï¼ŒIOé”™è¯¯ï¼Œè®¡ç®—èŠ‚ç‚¹å´©æºƒç­‰ï¼Œç„¶è€ŒBAMæ˜¯å¦å®Œæ•´å¾ˆéš¾å¯Ÿè§‰ï¼Œæœ€ç»ˆå¯¼è‡´åç»­æµç¨‹æ— æ³•è¿è¡Œã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¸€æ®µç®€çŸ­çš„ä»£ç æ¥æ£€æŸ¥BAMæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š","text":"æˆ‘ä»¬åœ¨è¿è¡Œbwa memæ¯”å¯¹çš„æ—¶å€™ï¼Œç”±äºæŸäº›ä¸æ˜çš„åŸå› ä¼šé€ æˆç¨‹åºä¸­æ–­ï¼Œä¾‹å¦‚å†…å­˜è¶…äº†ï¼ŒIOé”™è¯¯ï¼Œè®¡ç®—èŠ‚ç‚¹å´©æºƒç­‰ï¼Œç„¶è€ŒBAMæ˜¯å¦å®Œæ•´å¾ˆéš¾å¯Ÿè§‰ï¼Œæœ€ç»ˆå¯¼è‡´åç»­æµç¨‹æ— æ³•è¿è¡Œã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¸€æ®µç®€çŸ­çš„ä»£ç æ¥æ£€æŸ¥BAMæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š function check_eofs(fs::String) open(fs, &quot;r&quot;) do IO seekend(IO) eof_positions = position(IO) - 28 seek(IO, eof_positions) eof_markers = UInt8[0x1f, 0x8b, 0x08, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x06, 0x00, 0x42, 0x43, 0x02, 0x00, 0x1b, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00] actual_markers = Vector&#123;UInt8&#125;(undef, 28) read!(IO, actual_markers) if isequal(eof_markers, actual_markers) @info &quot;file have BGZF EOF Markers and is corrected!&quot; filename = fs else @warn &quot;file maybe truncted,please check your file!&quot; filename = fs end endendfunction main(ARGS) if length(ARGS) &gt; 1 check_eofs.(ARGS) else check_eofs(ARGS[1]) endendmain(ARGS) åŸç†å¾ˆç®€å•ï¼Œæ ¹æ®å®˜æ–¹å¯¹SAMæ–‡ä»¶çš„æè¿°ï¼Œå…¶ä½¿ç”¨äº†ä¸€ç§å…¼å®¹gzipçš„å‹ç¼©æ ¼å¼ï¼Œä½†æ˜¯è¿™ä¸ªæ ¼å¼å¯ä»¥é€šè¿‡å»ºç«‹ç´¢å¼•æœ€ç»ˆè¾¾åˆ°éšæœºè®¿é—®çš„ç›®çš„ï¼Œè€Œæ¯ä¸ªæ–‡ä»¶çš„æœ«å°¾éƒ½å­˜åœ¨EOF-marker, å…¶ä¸º1f 8b 08 04 00 00 00 00 00 ff 06 00 42 43 02 00 1b 00 03 00 00 00 00 00 00 00 00 00çš„28ä½æ¯”ç‰¹å­—ç¬¦ï¼Œæˆ‘ä»¬ç›´æ¥è¯»å–æ–‡ä»¶æœ«å°¾çš„28æ¯”ç‰¹å’Œè¯¥æ ‡å¿—ç¬¦å¯¹æ¯”å³å¯æ£€æŸ¥å…¶å®Œæ•´æ€§äº†ã€‚ ä½¿ç”¨æ–¹æ³• julia check_BGZF.jl BAM_1 BAM_2 BAM_3 ... åŒç†ï¼Œæ‰€æœ‰ä½¿ç”¨BGZFå‹ç¼©æ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥é‡‡ç”¨è¿™ä¸€æ–¹æ³•æ£€æŸ¥å®Œæ•´ï¼Œä¾‹å¦‚å‹ç¼©çš„vcfæ–‡ä»¶vcf.gzã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"juliaè®¡ç®—ä¸ºASCATåˆ›å»ºGCçŸ«æ­£æ–‡ä»¶","slug":"juliaè®¡ç®—ä¸ºASCATåˆ›å»ºGCçŸ«æ­£æ–‡ä»¶","date":"2024-09-20T04:58:23.000Z","updated":"2024-10-18T05:33:55.805Z","comments":true,"path":"jl-gc-correct/","permalink":"https://xiaohanys.top/jl-gc-correct/","excerpt":"å¦‚é¢˜ï¼Œå®˜æ–¹å·²ç»æä¾›äº†ä¸€ä¸ªRçš„ç‰ˆæœ¬createGCcontentFile.R ï¼Œä½†æ˜¯æ ¹æ®ä»£ç å°±èƒ½çœ‹å‡ºè¿™ä¸ªç‰ˆæœ¬éå¸¸å å†…å­˜äº†ï¼Œé¦–å…ˆè¦æŠŠåŸºå› ç»„æ•´ä¸ªåºåˆ—éƒ½loadå…¥å†…å­˜ä¸­å»ï¼Œæ¯æ¬¡è®¡ç®—å‡ºçš„çŸ«æ­£æ•°æ®ä¹Ÿæ˜¯å‚¨å­˜dataframeä¸­ã€‚ä¸ºäº†é™ä½å†…å­˜å ç”¨ï¼Œä¹Ÿä¸ºäº†æé«˜è®¡ç®—é€Ÿåº¦ï¼Œæˆ‘å†™äº†ä¸€ä¸ªjuliaç‰ˆæœ¬çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š","text":"å¦‚é¢˜ï¼Œå®˜æ–¹å·²ç»æä¾›äº†ä¸€ä¸ªRçš„ç‰ˆæœ¬createGCcontentFile.R ï¼Œä½†æ˜¯æ ¹æ®ä»£ç å°±èƒ½çœ‹å‡ºè¿™ä¸ªç‰ˆæœ¬éå¸¸å å†…å­˜äº†ï¼Œé¦–å…ˆè¦æŠŠåŸºå› ç»„æ•´ä¸ªåºåˆ—éƒ½loadå…¥å†…å­˜ä¸­å»ï¼Œæ¯æ¬¡è®¡ç®—å‡ºçš„çŸ«æ­£æ•°æ®ä¹Ÿæ˜¯å‚¨å­˜dataframeä¸­ã€‚ä¸ºäº†é™ä½å†…å­˜å ç”¨ï¼Œä¹Ÿä¸ºäº†æé«˜è®¡ç®—é€Ÿåº¦ï¼Œæˆ‘å†™äº†ä¸€ä¸ªjuliaç‰ˆæœ¬çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š using BioSequencesusing FASTXfunction cal(sequence::LongDNASeq) nGC = count(x -&gt; ((x == DNA_G) || (x == DNA_C)), sequence) nAT = count(x -&gt; ((x == DNA_A) || (x == DNA_T)), sequence) (nGC, nAT)endfunction getPosGCs(IO::IOStream, CHRseq::BioSequence, totalLen::Int64, Chr::SubString, POS::Int64, WINDOW::Vector&#123;Int64&#125;, THRESH::Int64, idx::SubString) print(IO, idx, &quot;\\t&quot;, Chr, &quot;\\t&quot;, POS, &quot;\\t&quot;) for window in WINDOW window = window % 2 == 0 ? window + 1 : window startPOS = POS - Int64(floor(window / 2)) tailPOS = POS + Int64(floor(window / 2)) tailPOS = tailPOS &gt; totalLen ? totalLen : tailPOS startPOS = startPOS &lt;= 0 ? 1 : startPOS gc, at = cal(CHRseq[startPOS:tailPOS]) if gc + at &gt; THRESH print(IO, round(gc / (gc + at); digits=6), &quot;\\t&quot;) else print(IO, &quot;NA&quot;, &quot;\\t&quot;) end end print(IO, &quot;\\n&quot;)endfunction main(snpLoci::String, fasta::String) open(&quot;GC_correct.file.txt&quot;, &quot;w&quot;) do io println(&quot;Loding reference genome!&quot;) Genome = open(FASTA.Reader, fasta, index=string(fasta, &quot;.fai&quot;)) WINDOWS = Int64[25, 50, 100, 200, 500, 1e3, 2e3, 5e3, 1e4, 2e4, 5e4, 1e5, 2e5, 5e5, 1e6] println(io, &quot;\\tChr\\tPosition\\t25bp\\t50bp\\t100bp\\t200bp\\t500bp\\t1kb\\t2kb\\t5kb\\t10kb\\t20kb\\t50kb\\t100kb\\t200kb\\t500kb\\t1Mb&quot;) chrMarker = &quot;&quot; seq = dna&quot;NNNNN&quot; totalLen = 0 for line in eachline(snpLoci) if startswith(line, &quot;\\t&quot;) continue else idx, chr, pos = split(line, &quot;\\t&quot;) pos = parse(Int64, pos) if chr != chrMarker seq = FASTA.sequence(Genome[chr]) totalLen = length(seq) println(&quot;processing chromosome &quot;, chr, &quot;...&quot;) end chrMarker = chr getPosGCs(io, seq, totalLen, chr, pos, WINDOWS, 20, idx) end end endendmain(ARGS[1], ARGS[2]) ä»£ç ä½¿ç”¨äº†Biojuliaä¸­çš„FASTX.jlåŒ…å¿«é€Ÿè¯»å–åŸºå› ç»„ï¼Œä½¿ç”¨BioSequences.jlä¸­çš„å‡½æ•°è®¡ç®—GCå«é‡å’Œç´¢å¼•åºåˆ—ã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªåŒ…éœ€è¦æå‰å®‰è£…å¥½ï¼Œç„¶åç”¨æ³•å°±å¾ˆç®€å•ï¼Œ julia createGCcontentFile.jl snp_loci.txt hg38.fa","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"ç”¨juliaè¯­è¨€è®¡ç®—æµ‹åºæ•°æ®çš„Insert Size?","slug":"ç”¨juliaè¯­è¨€è®¡ç®—æµ‹åºæ•°æ®çš„InsertSize","date":"2024-09-20T04:57:17.000Z","updated":"2024-10-18T05:33:16.777Z","comments":true,"path":"jl-insert-size/","permalink":"https://xiaohanys.top/jl-insert-size/","excerpt":"Juliaè¯»å–BAMçš„åº“æƒ³è¦è®¡ç®—Insert sizeï¼Œéœ€è¦æä¾›ä¸€ä¸ªåŸºå› ç»„æ¯”å¯¹åçš„æ–‡ä»¶ï¼Œsamä¹Ÿå¥½ï¼Œbamä¹Ÿç½¢ã€‚é‚£ä¹ˆï¼Œä½¿ç”¨juliaè¯­è¨€è®¡ç®—è¯¥å€¼çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯äº†è§£å¦‚ä½•è¯»å–å’Œè§£æBAMæ–‡ä»¶æ ¼å¼ã€‚","text":"Juliaè¯»å–BAMçš„åº“æƒ³è¦è®¡ç®—Insert sizeï¼Œéœ€è¦æä¾›ä¸€ä¸ªåŸºå› ç»„æ¯”å¯¹åçš„æ–‡ä»¶ï¼Œsamä¹Ÿå¥½ï¼Œbamä¹Ÿç½¢ã€‚é‚£ä¹ˆï¼Œä½¿ç”¨juliaè¯­è¨€è®¡ç®—è¯¥å€¼çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯äº†è§£å¦‚ä½•è¯»å–å’Œè§£æBAMæ–‡ä»¶æ ¼å¼ã€‚ æˆ‘ä»¬ä½¿ç”¨BioJuliaæä¾›çš„XAMåŒ…æ¥è¯»å–BAMæ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¦–å…ˆå®‰è£…è¯¥åŒ…ã€‚æ‰“å¼€juliaï¼Œè¾“å…¥]è¿›å…¥Pkgæ¨¡å¼ add XAM ä½¿ç”¨XAMè¯»å–å’Œè§£æBAMæ–‡ä»¶çš„ä¸€èˆ¬æ ¼å¼reader = open(BAM.Reader, &quot;data.bam&quot;)record = BAM.Record()while !eof(reader) empty!(record) read!(reader, record) # åšä¸€äº›äº‹æƒ…ï¼Œä¾‹å¦‚è§£æå’Œè®¡ç®—end ä¸Šé¢çš„æµç¨‹æ€»ä½“ä¸Šå°±æ˜¯ ä½¿ç”¨BAM.Readerè¯»å–æ–‡ä»¶ å®šä¹‰ä¸€ä¸ªç©ºçš„Recordå¯¹è±¡ ä»å¤´è‡³å°¾å¾ªç¯æ•´ä¸ªBAMfile å°†æ¯è¡Œbamè¯»å…¥Record è¿™æ ·çš„æ“ä½œæ–¹å¼å¯ä»¥èŠ‚çœå†…å­˜ï¼Œé¿å…å¾ªç¯å¾ˆå¤§çš„bamæ–‡ä»¶çˆ†å†…å­˜ã€‚ ä»€ä¹ˆæ˜¯Insert Sizeï¼Ÿé€šä¿—çš„è®²ï¼ŒInsert é•¿åº¦å°±æ˜¯æŒ‡åŒç«¯åºåˆ—æ¯”å¯¹åï¼Œæ¨¡ç‰ˆçš„é•¿åº¦ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è®¡ç®—éœ€è¦ä¿è¯å¦‚ä¸‹æ¡ä»¶ readsæ˜¯æˆå¯¹ï¼Œæœ€å¥½æ˜¯Proper paired åªéœ€è¦è®¡ç®—read1å³å¯ï¼Œä¸ç„¶å°±ç®—é‡äº† å³ä½¿Proper pairedä¹Ÿä¼šæœ‰è´Ÿçš„Insertï¼Œéœ€è¦ç§»é™¤ ä»£ç å¦‚ä¸‹ using XAMusing Statisticsfunction insert_size_dist(Reader::XAM.BAM.Reader) insert_length = Int64[] record = BAM.Record() while !eof(Reader) empty!(record) read!(Reader, record) if BAM.flag(record) &amp; 0x2 != 0 ## paired if BAM.flag(record) &amp; 0x40 != 0 ## first in pair t_len = BAM.templength(record) if t_len &gt; 0 push!(insert_length, t_len) end end end end (mean(insert_length), std(insert_length))end","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"juliaå¤šçº¿ç¨‹","slug":"juliaå¤šçº¿ç¨‹","date":"2024-09-20T04:56:28.000Z","updated":"2024-10-18T05:33:53.124Z","comments":true,"path":"jl-multiprocess/","permalink":"https://xiaohanys.top/jl-multiprocess/","excerpt":"juliaæœ¬èº«æ˜¯ä¸€é—¨å¾ˆå¿«é€Ÿçš„è¯­è¨€ï¼Œä½†æ˜¯ç°ä»£è®¡ç®—æœºå¾€å¾€å…·æœ‰å¤šæ ¸å¿ƒå¤šçº¿ç¨‹è®¾è®¡ï¼Œå› æ­¤ï¼Œå……åˆ†å‘æŒ¥ç¡¬ä»¶ï¼Œèƒ½è¿›ä¸€æ­¥æé«˜æ•ˆç‡","text":"juliaæœ¬èº«æ˜¯ä¸€é—¨å¾ˆå¿«é€Ÿçš„è¯­è¨€ï¼Œä½†æ˜¯ç°ä»£è®¡ç®—æœºå¾€å¾€å…·æœ‰å¤šæ ¸å¿ƒå¤šçº¿ç¨‹è®¾è®¡ï¼Œå› æ­¤ï¼Œå……åˆ†å‘æŒ¥ç¡¬ä»¶ï¼Œèƒ½è¿›ä¸€æ­¥æé«˜æ•ˆç‡ å¤šçº¿ç¨‹çš„å¯åŠ¨juliaä»1.5å¼€å§‹æ–°æ·»åŠ äº†å‘½ä»¤è¡Œå‚æ•°-t num_procsï¼Œä¾‹å¦‚ï¼Œä½ æƒ³å¯åŠ¨ä¸€ä¸ª10ä¸ªçº¿ç¨‹çš„juliaï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡Œï¼š julia -t 10 è¿›å…¥REPLåï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çº¿ç¨‹æ•°ï¼š Threads.nthreads()10 å¦‚ä½•å¤šçº¿ç¨‹ï¼Ÿjuliaæä¾›äº†ä¸€ä¸ªç®€å•çš„å®å‡½æ•°ï¼Œæ¥å¿«é€Ÿçš„åŒ…è£…forå¾ªç¯ï¼Œä½¿å…¶å¯ä»¥å°†ä»»åŠ¡æ‹†åˆ†ä¸ºnä»½ï¼Œæ¯åˆ†ç‹¬ç«‹æ‰§è¡Œ Threads.@threads ä¾‹å¦‚ï¼š a = zeros(10)Threads.@threads for i = 1:10 a[i] = Threads.threadid()end éå¸¸ç®€å•çš„ï¼Œå¯ä»¥å¿«é€Ÿå°†ä½ çš„å•çº¿ç¨‹å‡½æ•°è½¬åŒ–ä¸ºå¤šçº¿ç¨‹ã€‚ çº¿ç¨‹å®‰å…¨ä¸¾ä¸ªä¾‹å­ï¼š acc = Ref(0)@threads for i in 1:1000 acc[] += 1end æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥æµç¨‹è®¡ç®—çš„æ˜¯ä»ç´¯åŠ 1000ä¸ª1ï¼Œç»“æœåº”è¯¥æ˜¯1000æ‰å¯¹ï¼Œä½†æ˜¯å› ä¸ºå¤šçº¿ç¨‹è°ƒåº¦ï¼Œå¯¼è‡´accæœ€ç»ˆçš„ç»“æœå¹¶éä¸º1000ï¼Œå³å¾—åˆ°äº†é”™è¯¯çš„è®¡ç®—ç»“æœã€‚ ç¬¬ä¸€ä¸ªè§£å†³åŠæ³•æ˜¯ä½¿ç”¨åŸå­æ“ä½œ acc = Atomic&#123;Int64&#125;(0)@threads for i in 1:1000 atomic_add!(acc, 1)end å¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨å˜é‡ä¸Šæ·»åŠ çº¿ç¨‹é”ï¼Œä½¿å…¶åŒä¸€æ—¶é—´æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œè¯¥å˜é‡ acc = Ref(0)l = ReentrantLock()@threads for i=1:1000 lock(l) do acc[]+=1 endend å½“ç„¶ï¼Œä¸¾ä¾‹åªæ˜¯ä¸ºäº†è¯´æ˜å¤šçº¿ç¨‹çš„å®‰å…¨é—®é¢˜ï¼Œè¯¥å˜é‡çš„ç´¯ç§¯æ·»åŠ äº†çº¿ç¨‹é”åå…¶å®å’Œå•çº¿ç¨‹æ“ä½œæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåè€Œå› ä¸ºçº¿ç¨‹è°ƒåº¦å½±å“äº†æ€§èƒ½ã€‚å› æ­¤ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ä½ çš„é¡¹ç›®æ˜¯å¦éœ€è¦å¤šçº¿ç¨‹ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"åŸºäºJuliaè¯­è¨€çš„å¤šçº¿ç¨‹barcodeæ‹†åˆ†","slug":"åŸºäºJuliaè¯­è¨€çš„å¤šçº¿ç¨‹barcodeæ‹†åˆ†","date":"2024-09-20T04:55:29.000Z","updated":"2024-10-18T05:32:17.350Z","comments":true,"path":"jl-barcode-split/","permalink":"https://xiaohanys.top/jl-barcode-split/","excerpt":"æ‹†åˆ†åŸç† è½¯ä»¶çš„é€»è¾‘æ˜¯é¦–å…ˆè·å–barcodeåˆ—è¡¨ã€‚ç„¶åé‡‡ç”¨å¤šçº¿ç¨‹åˆ†åˆ«åœ¨fastqæ–‡ä»¶ä¸­å¹¶è¡Œæå–å¯¹åº”barcodeçš„readsã€‚ WGSçš„ä¸‹æœºæ•°æ®ç»å¸¸å‡ºç°åœ¨fastq2é‡Œã€‚æ‰€ä»¥ç¨‹åºä¼šä»fastqä¸­è‡ªåŠ¨æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”barcodeã€‚ ç¨‹åºå¯ä»¥è‡ªåŠ¨æ£€æµ‹barcodeå§‹äºå¼€å§‹è¿˜æ˜¯æœ«å°¾ï¼Œè®¡ç®—hanmingè·ç¦»ï¼Œè¿è¡Œ1bpçš„mismatchã€‚","text":"æ‹†åˆ†åŸç† è½¯ä»¶çš„é€»è¾‘æ˜¯é¦–å…ˆè·å–barcodeåˆ—è¡¨ã€‚ç„¶åé‡‡ç”¨å¤šçº¿ç¨‹åˆ†åˆ«åœ¨fastqæ–‡ä»¶ä¸­å¹¶è¡Œæå–å¯¹åº”barcodeçš„readsã€‚ WGSçš„ä¸‹æœºæ•°æ®ç»å¸¸å‡ºç°åœ¨fastq2é‡Œã€‚æ‰€ä»¥ç¨‹åºä¼šä»fastqä¸­è‡ªåŠ¨æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”barcodeã€‚ ç¨‹åºå¯ä»¥è‡ªåŠ¨æ£€æµ‹barcodeå§‹äºå¼€å§‹è¿˜æ˜¯æœ«å°¾ï¼Œè®¡ç®—hanmingè·ç¦»ï¼Œè¿è¡Œ1bpçš„mismatchã€‚ ç¨‹åºå¯ä»¥è‡ªåŠ¨æ£€æµ‹barcodeå§‹äºå¼€å§‹è¿˜æ˜¯æœ«å°¾ï¼Œè®¡ç®—hanmingè·ç¦»ï¼Œè¿è¡Œ1bpçš„mismatchã€‚ æ–¹æ³•julia -t number threads split_barcode.jl -b barcode list -r read2 file -l read1 file -o outpath ä»£ç ä¸¾ä¾‹using BioSequencesusing FASTXusing CodecZlibusing StringDistancesusing Base.Threadsusing Getoptfunction read_barcode(barcode_fs::String) labels = String[] barcodes = String[] if isfile(barcode_fs) for line in eachline(barcode_fs) label, sequence = split(line) push!(labels, label) push!(barcodes, sequence) end else println(&quot;no barcode file detected!&quot;) end labels, barcodesendfunction detective_barcode(seq::LongDNASeq, barcode::LongDNASeq) barcode_l = length(barcode) starter = seq[1:barcode_l] ender = seq[end-barcode_l:end] dist = Hamming()(starter, barcode) if dist == 0 || dist == 1 ## if barcode in title return 1, 1 else dist = Hamming()(ender, barcode)# calular hamming distance allow 1bp mismatch if dist == 0 || dist == 1 return 1, 2 else return -1, 0 end endendfunction process(fq_file_1::String, fq_file_2::String, barcode::LongDNASeq, label::String, outpath::String) reader_2 = FASTQ.Reader(GzipDecompressorStream(open(fq_file_2))) reader_1 = FASTQ.Reader(GzipDecompressorStream(open(fq_file_1))) wt_1 = FASTQ.Writer(open(&quot;$(outpath)/barcode_$(label)_1.fq&quot;, lock=true, &quot;a&quot;)) ## lock for multiple threads safety wt_2 = FASTQ.Writer(open(&quot;$(outpath)/barcode_$(label)_2.fq&quot;, lock=true, &quot;a&quot;)) for (record_1, record_2) in zip(reader_1, reader_2) fm, weizhi = detective_barcode(FASTQ.sequence(record_2), barcode) if fm == 1 write(wt_1, record_1) if weizhi == 1 write(wt_2, FASTQ.Record(FASTQ.identifier(record_2), FASTQ.sequence(record_2)[11:end], FASTQ.quality(record_2)[11:end])) elseif weizhi == 2 write(wt_2, FASTQ.Record(FASTQ.identifier(record_2), FASTQ.sequence(record_2)[1:100], FASTQ.quality(record_2)[1:100])) end end end close(reader_1) close(reader_2) close(wt_1) close(wt_2)endfunction split_barcode(barcodes_fs::String, fq_file_2::String, fq_file_1::String, outpath::String) labels, barcodes = read_barcode(barcodes_fs) barcodes = LongDNASeq.(barcodes) duiying = Dict(zip(barcodes, labels)) @threads for barcode in barcodes label = duiying[barcode] process(fq_file_1, fq_file_2, barcode, label, outpath) endendfunction Argparse() lst = Dict&#123;String,String&#125;() for (opt, arg) in getopt(ARGS, &quot;hb:r:l:o:&quot;, [&quot;help&quot;,&quot;barcodes=&quot;, &quot;read2=&quot;,&quot;read1=&quot;,&quot;output=&quot;]) opt = replace(opt, &quot;-&quot; =&gt; &quot;&quot;) arg = replace(arg, &quot;=&quot; =&gt; &quot;&quot;) if opt == &quot;help&quot; || opt == &quot;h&quot; println(&quot;this program is for spliting fastq file into different part according barcodes!&quot;) println(&quot;-h\\t--help\\tshow this message&quot;) println(&quot;-b\\t--barcodes\\tinput your barcodes file, should be negetive sequennce!&quot;) println(&quot;-r2\\t--read2\\tinput your fastq file read_2&quot;) println(&quot;-r1\\t--read1\\tinput your fastq file read_1&quot;) println(&quot;-o\\t--output\\tinput output file path&quot;) elseif opt == &quot;barcodes&quot; || opt == &quot;b&quot; lst[&quot;barcodes&quot;] = arg elseif opt == &quot;read2&quot; || opt == &quot;r&quot; lst[&quot;read2&quot;] = arg elseif opt == &quot;read1&quot; || opt == &quot;l&quot; lst[&quot;read1&quot;] = arg elseif opt == &quot;output&quot; || opt == &quot;o&quot; lst[&quot;output&quot;] = arg else println(&quot;please check your parameter!&quot;) end end lstendargs = Argparse()if length(args) &gt; 1 split_barcode(args[&quot;barcodes&quot;], args[&quot;read2&quot;], args[&quot;read1&quot;], args[&quot;output&quot;])end","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"Juliaè®¡ç®—ç›¸å…³æ€§æ£€éªŒ","slug":"Juliaè®¡ç®—ç›¸å…³æ€§æ£€éªŒ","date":"2024-09-20T04:54:29.000Z","updated":"2024-10-18T05:33:58.522Z","comments":true,"path":"jl-correlation/","permalink":"https://xiaohanys.top/jl-correlation/","excerpt":"ä¼—æ‰€å‘¨çŸ¥ï¼Œè®¡ç®—ç›¸å…³æ€§éå¸¸çš„ç®€å•ï¼Œå› ä¸ºR è¯­è¨€ä¸­æœ‰å‡½æ•°cor.test(),è¯¥å‡½æ•°å¯ä»¥è®¡ç®—å¤šç§æ–¹æ³•çš„ç›¸å…³æ€§æ£€éªŒï¼Œè¿”å›ç›¸å…³æ€§ï¼ŒPvalueç­‰æ£€éªŒå€¼ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åœ¨Juliaä¸­å¹¶ä¸å­˜åœ¨ï¼Œè®©Juliaä½œä¸ºä¸€é—¨ç§‘å­¦è®¡ç®—è¯­è¨€æ˜¾å¾—å¹¶ä¸å®Œç¾ã€‚","text":"ä¼—æ‰€å‘¨çŸ¥ï¼Œè®¡ç®—ç›¸å…³æ€§éå¸¸çš„ç®€å•ï¼Œå› ä¸ºR è¯­è¨€ä¸­æœ‰å‡½æ•°cor.test(),è¯¥å‡½æ•°å¯ä»¥è®¡ç®—å¤šç§æ–¹æ³•çš„ç›¸å…³æ€§æ£€éªŒï¼Œè¿”å›ç›¸å…³æ€§ï¼ŒPvalueç­‰æ£€éªŒå€¼ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åœ¨Juliaä¸­å¹¶ä¸å­˜åœ¨ï¼Œè®©Juliaä½œä¸ºä¸€é—¨ç§‘å­¦è®¡ç®—è¯­è¨€æ˜¾å¾—å¹¶ä¸å®Œç¾ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Rè¯­è¨€è®¡ç®—çº¿æ€§ç›¸å…³çš„ç»“æœæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ a&lt;-c(1,3,4,5,7)b&lt;-c(2,4,6,8,9)c&lt;-cor.test(a,b)c Pearson&#x27;s product-moment correlationdata: a and bt = 7.7771, df = 3, p-value = 0.004423alternative hypothesis: true correlation is not equal to 095 percent confidence interval: 0.6757774 0.9984873sample estimates: cor 0.976086 é¦–å…ˆï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸¤ä¸ªç¤ºä¾‹çš„å‘é‡ï¼Œè¿™ä¸¤ä¸ªå‘é‡å¿…é¡»ç­‰é•¿ ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨äº†cor.testï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯çš®å°”æ£®ï¼Œå› æ­¤æˆ‘ä»¬ä¸å†ä½¿ç”¨methodå‚æ•°ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿå¾ˆä¸°å¯Œã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬æ¯”è¾ƒJuliaå‘¢ï¼Ÿ é¦–å…ˆï¼Œjuliaæ ‡å‡†åº“å¹¶æ²¡æœ‰è®¡ç®—ç›¸å…³æ€§çš„å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨StatisticsåŒ…æ¥è®¡ç®—ç›¸å…³æ€§ a = [1,3,4,5,7]b = [2,4,6,8,9]using Statisticsc = cor(a,b)0.9760860118037878 ç„¶åï¼Œæˆ‘ä»¬å‚è€ƒR è¯­è¨€çš„å®šä¹‰è®¡ç®—p-valueå’Œ95%çš„ç½®ä¿¡åŒºé—´ã€‚ using Distributions ##è½½å…¥åŒ…ï¼Œç”¨æ¥è®¡ç®—Tç»Ÿè®¡å’Œtåˆ†å¸ƒçš„cdfå€¼using Statistics ##è®¡ç®—cor## æ ¹æ®rå’Œæ ·æœ¬é‡nè®¡ç®—ç½®ä¿¡åŒºé—´function interval(r::Float64, n::Int64) z = 0.5 * log(exp(1), (1 + r) / (1 - r)) s = 1 / (sqrt(n - 3)) zl = z - 1.96 * s zh = z + 1.96 * s low = (exp(2 * zl) - 1) / (exp(2 * zl) + 1) high = (exp(2 * zh) - 1) / (exp(2 * zh) + 1) (low, high)end## è¾“å…¥ä¸¤ä¸ªå‘é‡ï¼Œè¿”å›å„ä¸ªå‚æ•°function cor_test(x::AbstractVector, y::AbstractVector) if length(x) == length(y) r = cor(x, y) #ç›¸å…³æ€§å€¼ n = length(x) df = n - 2 ## è‡ªç”±åº¦ t = r * sqrt((df) / (1 - r^2)) ##Tç»Ÿè®¡é‡ tdist = cdf(TDist(df), t) ##tåˆ†å¸ƒçš„ç´¯è®¡ if r &gt; 0 pvalue = (1 - tdist) * 2 else pvalue = (tdist) * 2 end else println(&quot;è¯·è¾“å…¥ç­‰é•¿çš„ä¸¤ä¸ªå‘é‡&quot;) end fin = (r = r, pvalue = pvalue, df = df, t = t, cfi = interval(r, n))end æµ‹è¯•ä»¥ä¸‹å‡½æ•°çš„è¿”å›æ˜¯å¦å’ŒRè¯­è¨€ä¸€è‡´ cor_test(a,b)(r = 0.9760860118037878, pvalue = 0.004423314933107214, df = 3, t = 7.777137710478182, cfi = (0.6757635765936858, 0.9984873283114327))c = cor_test(a,b)c.r0.9760860118037878c.pvalue0.004423314933107214","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"ç”¨juliaå®ç°bedtoolsçš„intersect-bedåŠŸèƒ½","slug":"ç”¨juliaå®ç°bedtoolsçš„intersect-bedåŠŸèƒ½","date":"2024-09-20T04:53:40.000Z","updated":"2024-10-18T05:33:14.314Z","comments":true,"path":"jl-intersect/","permalink":"https://xiaohanys.top/jl-intersect/","excerpt":"å‰è¨€è‡ªå·±å†™çš„å¥½å‡ ç§ç®—æ³•ä¼å›¾å®ç°bedtoolsçš„åŠŸèƒ½ï¼Œè™½ç„¶juliaæ€§èƒ½è¶³å¤Ÿå¥½ï¼Œä½†éƒ½éš¾ä»¥åœ¨æ•ˆç‡ä¸Šè¾¾åˆ°bedtoolsçš„æ€§èƒ½ï¼Œäºæ˜¯æœ€ååªèƒ½å€ŸåŠ©è½®å­äº†ã€‚","text":"å‰è¨€è‡ªå·±å†™çš„å¥½å‡ ç§ç®—æ³•ä¼å›¾å®ç°bedtoolsçš„åŠŸèƒ½ï¼Œè™½ç„¶juliaæ€§èƒ½è¶³å¤Ÿå¥½ï¼Œä½†éƒ½éš¾ä»¥åœ¨æ•ˆç‡ä¸Šè¾¾åˆ°bedtoolsçš„æ€§èƒ½ï¼Œäºæ˜¯æœ€ååªèƒ½å€ŸåŠ©è½®å­äº†ã€‚ ä»£ç using CSVusing DataFramesusing Tablesusing GenomicFeaturesfunction fs2NameTuple(fs::String) query = DataFrame(CSV.File(fs, delim=&quot;\\t&quot;, header=0)) if size(query)[2] == 5 query = rename!(query, :Column1 =&gt; :Chromosome, :Column2 =&gt; :Start, :Column3 =&gt; :End, :Column4 =&gt; :Name, :Column5 =&gt; :Score) # query = sort!(query, [:Chromosome,:Start]) query = Tables.rowtable(query) result = IntervalCollection([Interval(qy.Chromosome, qy.Start, qy.End, &#x27;?&#x27;, qy.Name) for qy in query], true) result elseif size(query)[2] == 4 query = rename!(query, :Column1 =&gt; :Chromosome, :Column2 =&gt; :Start, :Column3 =&gt; :End, :Column4 =&gt; :Name) # query = sort!(query, [:Chromosome,:Start]) query = Tables.rowtable(query) result = IntervalCollection([Interval(qy.Chromosome, qy.Start, qy.End, &#x27;?&#x27;, qy.Name) for qy in query], true) result else println(&quot;please confirm your bed files&quot;) endendfunction getInterval(A::IntervalCollection, B::IntervalCollection) for i in eachoverlap(A, B) println(i[1].seqname, &quot;\\t&quot;, i[1].first, &quot;\\t&quot;, i[1].last, &quot;\\t&quot;, i[1].metadata, &quot;\\t&quot;, i[2].seqname, &quot;\\t&quot;, i[2].first, &quot;\\t&quot;, i[2].last, &quot;\\t&quot;, i[2].metadata) endendgetInterval(fs2NameTuple(&quot;test1.bed&quot;),fs2NameTuple(&quot;test2.bed&quot;)) åŸç†é¦–å…ˆé€šè¿‡CSVå°†bedæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œç„¶åå°†dataFrameè½¬åŒ–ä¸ºnametupleï¼Œæœ€ååœ¨è½¬åŒ–ä¸ºintervalCollectionã€‚é€šè¿‡å†…ç½®çš„overlapåŠŸèƒ½å¯ä»¥å‡ ä¹ç¬é—´è·å–æ‰€æœ‰çš„äº¤é›†ï¼Œæ€§èƒ½å·²ç»è¾¾åˆ°äº†cè¯­è¨€çš„ç¨‹åº¦ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"julia å…¥é—¨æŒ‡éš¾","slug":"juliaå…¥é—¨æŒ‡éš¾","date":"2024-09-20T04:52:36.000Z","updated":"2024-10-18T05:34:01.839Z","comments":true,"path":"jl-intro/","permalink":"https://xiaohanys.top/jl-intro/","excerpt":"å¦‚ä½•å®‰è£…Juliaæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…¶ä¸­æœ€ç®€å•çš„å°±æ˜¯å»å„å¤§æ™¯è±¡ç«™ç‚¹ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…ï¼Œä¾‹å¦‚ æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ åŒ—äº¬å¤–å›½è¯­å¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ ä¸Šæµ·äº¤é€šå¤§å­¦è½¯ä»¶æºé•œåƒæœåŠ¡ å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·jillä¸‹è½½å®‰è£…ï¼Œ","text":"å¦‚ä½•å®‰è£…Juliaæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…¶ä¸­æœ€ç®€å•çš„å°±æ˜¯å»å„å¤§æ™¯è±¡ç«™ç‚¹ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…ï¼Œä¾‹å¦‚ æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ åŒ—äº¬å¤–å›½è¯­å¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ ä¸Šæµ·äº¤é€šå¤§å­¦è½¯ä»¶æºé•œåƒæœåŠ¡ å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·jillä¸‹è½½å®‰è£…ï¼Œ å®‰è£…&#x2F;æ›´æ–° jillï¼š pip install jill --user -U (éœ€è¦ Python 3.6 æˆ–æ›´æ–°çš„ç‰ˆæœ¬) å®‰è£… Juliaï¼šjill install [VERSION] [--upstream UPSTREAM] [--confirm] æŸ¥è¯¢ç°å­˜çš„ä¸Šæ¸¸é•œåƒï¼šjill upstream å¸®åŠ©æ–‡æ¡£ï¼šjill [COMMAND] --help åˆ©ç”¨ jill å®‰è£…å®Œæˆåå³å¯é€šè¿‡åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ julia/julia-1/julia-1.4 æ¥å¯åŠ¨ä¸åŒç‰ˆæœ¬çš„ Julia å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ä»æºç æ„å»ºå®‰è£…ï¼Œä½†æ˜¯ä¼šå¾ˆæ…¢ï¼Œå¹¶ä¸æ¨èã€‚ å¦‚ä½•å®‰è£…åŒ…julia åŒ…ç®¡ç†å™¨ç±»ä¼¼äºRï¼Œå¯ä»¥è¿›å…¥REELä¸­ï¼Œç„¶åè¾“å…¥]ï¼Œæ­¤æ—¶è¿›å…¥äº†å®‰è£…åŒ…æ¨¡å¼ï¼Œè¾“å…¥add &#123;packages&#125;å³å¯å®Œæˆå®‰è£… å®‰è£…åŒ…çš„é€Ÿåº¦å¾ˆæ…¢ï¼Ÿå› ä¸ºJuliaçš„åŒ…æ‰˜ç®¡åœ¨githubä¸Šï¼Œæ…¢æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œæ­¤æ—¶ä½ éœ€è¦ä¸€ä»½é•œåƒä»£ç†ã€‚ å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒæ¸…åé•œåƒjuliaä½¿ç”¨æŒ‡å— å¦‚ä½•æŸ¥æ‰¾æœ‰å“ªäº›åŒ…ï¼Ÿæˆ‘åˆ—ä¸¾å‡ ä¸ªç½‘ç«™ï¼Œå¯ä»¥ä»è¿™äº›ç«™ç‚¹å¯»æ‰¾å·²ç»æ³¨å†Œçš„åŒ…ï¼Œå°ç™½ç”¨æˆ·å°±ä¸è¦è€ƒè™‘æœªæ³¨å†Œçš„åŒ…äº†ã€‚ julia-hub julia-observer julia-packages æœ‰æ²¡æœ‰æ¯”è¾ƒç³»ç»Ÿçš„æ•™ç¨‹ï¼Ÿæœ‰ï¼Œç½‘æ˜“äº‘è¯¾å ‚æœ‰å…è´¹çš„æ•™å­¦è§†é¢‘ï¼Œç›¸å¯¹å…¨é¢ä¸”æ–°æ‰‹å‹å¥½ï¼ç‰ˆæœ¬ä¹Ÿè¾ƒæ–° juliaå¯ä»¥ä½¿ç”¨jupyter notebook å—ï¼Ÿå¯ä»¥ï¼Œåœ¨juliaä¸­å®‰è£…IJuliaåŒ…å³å¯ å¯ä»¥ä¹°ä¹¦å­¦ä¹ å—ï¼Ÿä¸æ¨èï¼Œå› ä¸ºjuliaåœ¨1.0ç‰ˆæœ¬å‰å’Œç‰ˆæœ¬åå°±åƒä¸¤ä¸ªè¯­è¨€ï¼Œæœ‰å¾ˆå¤§çš„å˜åŒ–ï¼Œä¹°çš„ä¹¦å¾ˆå¯èƒ½ä¸èµ·ä½œç”¨åè€Œç»™ä½ å¸¦æ¥å›°æ‰°ã€‚å³ä½¿è¦ä¹°ï¼Œä¹Ÿè¦çœ‹å¥½ç‰ˆæœ¬ï¼Œå°½é‡é€‰æ‹©1.0ç‰ˆæœ¬åçš„ã€‚ juliaå¯ä»¥ç”¨æ¥åšç”Ÿä¿¡åˆ†æå—ï¼Ÿå®Œå…¨å¯ä»¥ï¼ŒBioJuliaäº†è§£ä¸€ä¸‹! ä½†æ˜¯ç›®å‰è½¬å½•ç»„çš„ç›¸å…³åŒ…è¿˜æ²¡æœ‰å‡ºç°ã€‚è½¬å½•ç»„è¿˜æ˜¯ç”¨RåŒ…å§ï¼ æœ‰é—®é¢˜å»å“ªé‡Œé—®ï¼Ÿjuliaæœ‰å®˜æ–¹ä¸­æ–‡è®ºå›ï¼Œå¯ä»¥å»é‚£é‡Œæé—®é—®é¢˜ï¼Œåœ°å€æ˜¯juliaä¸­æ–‡ç¤¾åŒºä½ ä¹Ÿå¯ä»¥åŠ å…¥å®˜æ–¹QQç¾¤ï¼š316628299 ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘è¦å­¦ä¹ Juliaå½“ä½ å†ä¹Ÿæ— æ³•å¿å—pythonçš„èœ—ç‰›é€Ÿåº¦ï¼Œè€Œä¸”æ— æ³•é€šè¿‡ç®—æ³•ä¼˜åŒ–æ¥æå‡æ€§èƒ½ï¼Œä½ å¯ä»¥æœæ–­å°è¯•Juliaï¼Œæˆ–è®¸ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„é€Ÿåº¦æå‡ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"}],"author":"Xiaoguang Pan"},{"title":"å†è¯´è½¬å½•ç»„æ•°æ®æ ‡å‡†åŒ–ï¼ˆTPMï¼ŒRPKMï¼ŒFPKMï¼‰","slug":"å†è¯´è½¬å½•ç»„æ•°æ®æ ‡å‡†åŒ–","date":"2024-09-20T04:51:44.000Z","updated":"2024-10-18T05:33:24.846Z","comments":true,"path":"transcriptome-normlize/","permalink":"https://xiaohanys.top/transcriptome-normlize/","excerpt":"åŸºç¡€æ¦‚å¿µè®²è§£åœ¨RNA-Seqçš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨RPKMã€FPKMå’ŒTPMä½œä¸ºè½¬å½•ç»„æ•°æ®å®šé‡çš„è¡¨ç¤ºæ–¹æ³•ã€‚ å®ƒä»¬éƒ½æ˜¯å¯¹è¡¨è¾¾é‡è¿›è¡Œæ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œä¸ºä½•ä¸ç›´æ¥ç”¨readæ•°è¡¨ç¤ºï¼Œè€Œé€‰æ ‡å‡†åŒ–å‘¢?","text":"åŸºç¡€æ¦‚å¿µè®²è§£åœ¨RNA-Seqçš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨RPKMã€FPKMå’ŒTPMä½œä¸ºè½¬å½•ç»„æ•°æ®å®šé‡çš„è¡¨ç¤ºæ–¹æ³•ã€‚ å®ƒä»¬éƒ½æ˜¯å¯¹è¡¨è¾¾é‡è¿›è¡Œæ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œä¸ºä½•ä¸ç›´æ¥ç”¨readæ•°è¡¨ç¤ºï¼Œè€Œé€‰æ ‡å‡†åŒ–å‘¢? å› ä¸ºè½åœ¨ä¸€ä¸ªåŸºå› åŒºåŸŸå†…çš„readæ•°ç›®å–å†³äºåŸºå› é•¿åº¦å’Œæµ‹åºæ·±åº¦ã€‚åŸºå› è¶Šé•¿readæ•°ç›®è¶Šå¤šï¼Œæµ‹åºæ·±åº¦è¶Šé«˜,åˆ™ä¸€ä¸ªåŸºå› å¯¹åº”çš„readæ•°ç›®ä¹Ÿç›¸å¯¹è¶Šå¤šã€‚æ‰€ä»¥å¿…é¡»è¦æ ‡å‡†åŒ–ï¼Œè€Œæ ‡å‡†åŒ–çš„å¯¹è±¡å°±æ˜¯åŸºå› é•¿åº¦ä¸æµ‹åºæ·±åº¦ã€‚ RPKM:Reads Per Kilobase of exon model per Million mapped reads (æ¯åƒä¸ªç¢±åŸºçš„è½¬å½•æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„reads)ï¼Œä¸»è¦ç”¨æ¥å¯¹å•ç«¯æµ‹åºï¼ˆsingle-end RNA-seqï¼‰è¿›è¡Œå®šé‡çš„æ–¹æ³•ã€‚ RPKM(æ¨èè½¯ä»¶ï¼ŒRange) çš„è®¡ç®—å…¬å¼ï¼š $$RPKM&#x3D;\\frac{total\\ exon\\ reads}{(mapped\\ reads\\ (Millions)\\ \\times\\ exon\\ length(Kb))}$$ total exon readsï¼šæŸä¸ªæ ·æœ¬mappingåˆ°ç‰¹å®šåŸºå› çš„å¤–æ˜¾å­ä¸Šçš„æ‰€æœ‰çš„readsï¼› mapped reads ( Millions ) :æŸä¸ªæ ·æœ¬çš„æ‰€æœ‰readsæ€»å’Œï¼› **exon length( KB )**ï¼šæŸä¸ªåŸºå› çš„é•¿åº¦ï¼ˆå¤–æ˜¾å­çš„é•¿åº¦çš„æ€»å’Œï¼Œä»¥KBä¸ºå•ä½ï¼‰ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªå…¬å¼è®¡ç®—åŸºå› ï¼Œå¤–æ˜¾å­ï¼Œè½¬å½•æœ¬çš„è¡¨è¾¾ï¼Œè¿™é‡Œä»¥åŸºå› çš„è¡¨è¾¾ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚åœ¨ä¸€ä¸ªæ ·æœ¬ä¸­ä¸€ä¸ªåŸºå› çš„RPKMç­‰äºè½åœ¨è¿™ä¸ªåŸºå› ä¸Šçš„æ€»çš„readæ•°(total exon reads)ä¸è¿™ä¸ªæ ·æœ¬çš„æ€»readæ•°(mapped reads (Millions))å’ŒåŸºå› é•¿åº¦(exon length( KB )) çš„ä¹˜ç§¯çš„æ¯”å€¼ã€‚ FPKM:Fragments Per Kilobase of exon model per Million mapped fragments (æ¯åƒä¸ªç¢±åŸºçš„è½¬å½•æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„fragments)ï¼Œä¸»è¦æ˜¯é’ˆå¯¹pair-endæµ‹åºè¡¨è¾¾é‡è¿›è¡Œè®¡ç®—ã€‚ FPKM (æ¨èè½¯ä»¶ï¼Œcufflinks) å’ŒRPKM çš„è®¡ç®—æ–¹æ³•åŸºæœ¬ä¸€è‡´ã€‚ FPKMå’ŒRPKMçš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ˜¯fragmentï¼Œä¸€ä¸ªæ˜¯readã€‚ å¯¹äºå•æœ«ç«¯æµ‹åºæ•°æ®ï¼Œç”±äºCufflinksè®¡ç®—çš„æ—¶å€™æ˜¯å°†ä¸€ä¸ªreadå½“åšä¸€ä¸ªfragmentæ¥ç®—çš„ï¼Œæ•…è€ŒFPKMç­‰åŒäºRPKMã€‚ å¯¹äºåŒæœ«ç«¯æµ‹åºè€Œè¨€ï¼Œå¦‚æœä¸€å¯¹paired-readéƒ½æ¯”å¯¹ä¸Šäº†ï¼Œé‚£ä¹ˆè¿™ä¸€å¯¹paired-readç§°ä¹‹ä¸ºä¸€ä¸ªfragmentï¼Œè€Œå¦‚æœä¸€å¯¹paired-Readä¸­åªæœ‰ä¸€ä¸ªæ¯”å¯¹ä¸Šäº†ï¼Œå¦å¤–ä¸€ä¸ªæ²¡æœ‰æ¯”å¯¹ä¸Šï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªæ¯”å¯¹ä¸Šçš„readç§°ä¹‹ä¸ºä¸€ä¸ªfragment.è€Œè®¡ç®—RPKMæ—¶ï¼Œå¦‚æœä¸€å¯¹paired-readéƒ½æ¯”å¯¹ä¸Šäº†ä¼šå½“æˆä¸¤ä¸ªreadè®¡ç®—ï¼Œè€Œå¦‚æœä¸€å¯¹paired-readä¸­åªæœ‰ä¸€ä¸ªæ¯”å¯¹ä¸Šäº†ï¼Œå¦å¤–ä¸€ä¸ªæ²¡æœ‰æ¯”å¯¹ä¸Šï¼Œé‚£ä¹ˆå°±è®¡readæ•°ä¸º1ã€‚ æ•…è€Œå³ä½¿æ˜¯ç†è®ºä¸Šå°†å„ä¸ªå‚æ•°éƒ½è®¾ç½®æˆä¸€æ ·çš„ï¼Œä¹Ÿå¹¶ä¸èƒ½è¯´FPKM&#x3D;2RPKMã€‚å¯¹äºå•æœ«ç«¯æµ‹åºï¼Œè™½ç„¶ç†è®ºä¸ŠFPKMç­‰åŒäºRPKM, ä½†æ˜¯å®é™…ä¸Šå³ä½¿æ˜¯ä½¿ç”¨åŒä¸€ä¸ªmappingè½¯ä»¶å¾—åˆ°çš„mappingç»“æœï¼Œç„¶åå†åˆ†åˆ«å»è®¡ç®—åŒä¸€ä¸ªåŸºå› çš„RPKM (è‡ªå·±äººå·¥è®¡ç®—ï¼Œæˆ–è€…ç”¨ç°æˆçš„ä¸€äº›è½¯ä»¶éƒ½èƒ½ç®—)å’ŒFPKM(ç”¨Cufflinksè®¡ç®—)ï¼Œç»“æœå´ä»ç„¶æ˜¯ä¸åŒï¼Œå› ä¸ºCufflinksæœ‰è‡ªå·±çš„æ¨¡å‹å’Œè‡ªå·±çš„ä¸€äº›å†…åœ¨ç®—æ³•ã€‚ RPM&#x2F;CPM:Reads&#x2F;Counts of exon model per Million mapped reads (æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„reads). RPMçš„è®¡ç®—å…¬å¼ï¼š $$RPM&#x3D;\\ \\frac{total\\ exon\\ reads}{\\ mapped\\ reads\\ (Millions)}$$ total exon readsï¼šæŸä¸ªæ ·æœ¬mappingåˆ°ç‰¹å®šåŸºå› çš„å¤–æ˜¾å­ä¸Šçš„æ‰€æœ‰çš„readsï¼› mapped reads (Millions) :æŸä¸ªæ ·æœ¬çš„æ‰€æœ‰readsæ€»å’Œï¼› è¿™å°±æ˜¯ä¸ªå æ¯”ç»Ÿè®¡ï¼Œå¿½è§†äº†è½¬å½•æœ¬é•¿åº¦çš„å½±å“ TPMï¼šTranscripts Per Kilobase of exonmodel per Million mapped reads (æ¯åƒä¸ªç¢±åŸºçš„è½¬å½•æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„Transcripts)ï¼Œä¼˜åŒ–çš„RPKMè®¡ç®—æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºåŒä¸€ç‰©ç§ä¸åŒç»„ç»‡çš„æ¯”è¾ƒã€‚ TPM (æ¨èè½¯ä»¶ï¼ŒRSEM) çš„è®¡ç®—å…¬å¼ï¼š $$TPM&#x3D;\\frac{N_i&#x2F;L_i*10^6}{sum(N_1&#x2F;L_1+N_2&#x2F;L_2+Â·Â·+N_n&#x2F;L_n)}$$ Niï¼šmappingåˆ°åŸºå› iä¸Šçš„readæ•°ï¼› Liï¼šåŸºå› içš„å¤–æ˜¾å­é•¿åº¦çš„æ€»å’Œã€‚ åœ¨ä¸€ä¸ªæ ·æœ¬ä¸­ä¸€ä¸ªåŸºå› çš„TPMï¼šå…ˆå¯¹æ¯ä¸ªåŸºå› çš„readæ•°ç”¨åŸºå› çš„é•¿åº¦è¿›è¡Œæ ¡æ­£ï¼Œä¹‹åå†ç”¨æ ¡æ­£åçš„è¿™ä¸ªåŸºå› readæ•°(Ni&#x2F;Li)ä¸æ ¡æ­£åçš„è¿™ä¸ªæ ·æœ¬çš„æ‰€æœ‰readæ•°ï¼ˆsum(Ni&#x2F;Li+â€¦â€¦..+ Nm&#x2F;Lm)ï¼‰æ±‚å•†ã€‚ç”±æ­¤å¯çŸ¥ï¼ŒTPMæ¦‚æ‹¬äº†åŸºå› çš„é•¿åº¦ã€è¡¨è¾¾é‡å’ŒåŸºå› æ•°ç›®ã€‚TPMå¯ä»¥ç”¨äºåŒä¸€ç‰©ç§ä¸åŒç»„ç»‡é—´çš„æ¯”è¾ƒï¼Œå› ä¸ºsumå€¼æ€»æ˜¯å”¯ä¸€çš„ã€‚ è¯¥é€‰æ‹©å“ªä¸ªä½œä¸ºæˆ‘çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼ŸTPMä¸€å®šæ˜¯ä¸‡é‡‘æ²¹ï¼Ÿä»æ¦‚å¿µä¸Šæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒRPKMå’ŒFPKMå¯ä»¥ä¼˜åŒ–æ ·æœ¬å†…çš„åŸºå› æ¯”è¾ƒï¼Œä½†æ˜¯åœ¨æ ·æœ¬ä¹‹é—´æ¯”è¾ƒæ—¶ï¼Œä¼šå­˜åœ¨å¾ˆå¤§çš„åè§ã€‚è¿™ä¸ªæ˜¾è€Œæ˜“è§ï¼Œå› ä¸ºä»–ä»¬åœ¨ä¸åŒæ ·æœ¬ä¹‹é—´çš„æ€»å’Œéƒ½ä¸ä¸€è‡´ã€‚ å› æ­¤ï¼Œä¸ºäº†å¯ä»¥åœ¨å¤šä¸ªæ ·æœ¬ä¹‹é—´æ¯”è¾ƒåŸºå› è¡¨è¾¾é‡çš„å·®å¼‚ï¼ŒTPMåº”è¿è€Œå‡ºï¼Œä½†æ˜¯TPMçœŸå°±æ˜¯ä¸‡èƒ½çš„å—ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æœ‰4ä¸ªåŸºå› ï¼Œé•¿åº¦éƒ½æ˜¯3bp,readcountsä¹Ÿéƒ½æ˜¯3ä¸ªï¼Œé‚£ä¹ˆï¼Œæ¯ä¸ªåŸºå› çš„TPM&#x3D;1&#x2F;4. å‡è®¾å¦ä¸€ä¸ªæ ·æœ¬ä¹Ÿæœ‰è¿™4ä¸ªåŸºå› ï¼Œä½†æ˜¯æœ€åä¸€ä¸ªåŸºå› ç”±äºè¡¨è¾¾é‡å‡é«˜è€Œå˜æˆäº†15ï¼Œé‚£ä¹ˆï¼Œå‰ä¸‰ä¸ªåŸºå› çš„TPM&#x3D;1&#x2F;8ï¼Œè€Œæœ€åä¸€ä¸ªå·®å¼‚åŸºå› çš„TPM&#x3D;5&#x2F;8. è¿™é‡Œå°±å¼•å…¥äº†ä¸€ä¸ªåè§ï¼Œå› ä¸ºTPMå€¼æ˜¯ç›¸å¯¹è¡¨è¾¾é‡ï¼Œæœ¬è´¨ä¸Šä»å±äºæ¯”ä¾‹çš„ä¸€ç§ï¼Œé‚£ä¹ˆè¿™ä¸ªç›¸å¯¹è¡¨è¾¾ä¼šåœ¨æ€»å€¼ï¼ˆåˆ†æ¯ï¼‰æ”¹å˜æ—¶å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å†æ¯”è¾ƒåŸºå› çš„æ—¶å€™ï¼Œå‘ç°è¿™å››ä¸ªåŸºå› éƒ½å‘ç”Ÿäº†è¡¨è¾¾é‡çš„æ”¹å˜ï¼Œè€Œå®é™…ä¸Šåªæœ‰æœ€åä¸€ä¸ªæ˜¯å·®å¼‚åŸºå› ã€‚ é‚£ä¸ºä»€ä¹ˆå¾ˆå¤šæ–‡çŒ®è¯´TPMå¯ä»¥ç”¨æ¥æ¯”è¾ƒå¤šä¸ªæ ·æœ¬ä¹‹é—´çš„å·®å¼‚å‘¢ï¼Ÿæˆ‘è®¤ä¸ºä»–ä»¬æ˜¯é»˜è®¤äº†æ ·æœ¬ä¹‹é—´ä¸å­˜åœ¨æ‰¹æ¬¡æ•ˆåº”ï¼Œå³æµ‹åºæ·±åº¦æ˜¯ä¸€è‡´çš„æˆ–è€…è¯´ç›¸è¿‘çš„ï¼Œè¿™æ ·ä¿è¯äº†åˆ†æ¯ä¸ä¼šæœ‰å·¨å¤§çš„å˜åŒ–ï¼Œé‚£ä¹ˆç›¸å¯¹è¡¨è¾¾å°±æ˜¯åœ¨æ ·æœ¬ä¹‹é—´æ¯”è¾ƒå·®å¼‚çš„é‡‘æ ‡å‡†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ ·æœ¬ä¹‹é—´å­˜åœ¨æµ‹åºæ·±åº¦çš„å·®å¼‚ï¼Œé‚£ä¹ˆä½¿ç”¨TPMæ¯”è¾ƒæ ·æœ¬å·®å¼‚å¿…ç„¶ä¼šå¼•å…¥åè§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆDeseq2ç­‰å·®å¼‚åˆ†æè½¯ä»¶ä¸ä¼šå»é€‰æ‹©TPMä½œä¸ºè¾“å…¥äº†ã€‚ æ ·æœ¬é—´çš„æ ‡å‡†åŒ–æ–¹æ³•å‡è®¾ç»„é—´å·®å¼‚æˆåˆ†å¾ˆå¤§ï¼Œæˆ–è€…å­˜åœ¨å¾ˆå¤§çš„æ‰¹æ¬¡æ•ˆåº”ã€‚æˆ‘ä»¬ä¸èƒ½ç”¨TPMå»æ¯”è¾ƒå·®å¼‚ï¼Œè€Œæˆ‘ä»¬çš„å·®å¼‚åˆ†æè½¯ä»¶å°±ä¼šå‡è®¾æˆ‘ä»¬çš„Raw Read Countsç¬¦åˆè´ŸäºŒé¡¹åˆ†å¸ƒçš„æ¨¡å¼ï¼Œå‡è®¾å¤§éƒ¨åˆ†åŸºå› éƒ½ä¸æ˜¯å·®å¼‚åŸºå› ï¼Œå·®å¼‚åŸºå› å‘ç”Ÿåœ¨å°‘æ•°åŸºå› èº«ä¸Šï¼Œå› æ­¤ï¼Œåªæœ‰readcountæ‰èƒ½ç¬¦åˆå‡è®¾ï¼Œæˆ‘ä»¬æ‰èƒ½ç”¨ç»„é—´çŸ«æ­£çš„æ–¹æ³•ä¾‹å¦‚edgeråŒ…çš„TMMæ–¹æ³•ã€‚ ä¸€ä¸ªç†æƒ³çš„æ–¹æ³•ä¾¿æ˜¯å¯¹TPMæ‰§è¡Œç»„é—´çŸ«æ­£ï¼Œä½†æ˜¯TPMæœ¬èº«å¹¶ä¸ç¬¦åˆè´ŸäºŒé¡¹åˆ†å¸ƒçš„æ¨¡å¼ï¼Œå› æ­¤ä¼šå¼•å…¥åè§ã€‚ TPMå¦‚ä½•è®¡ç®—ï¼Ÿ Resem Salmon FeatureCountsçš„å®šé‡ç»“æœå¦‚ä½•è®¡ç®—TPMï¼Ÿ ç­”æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å…¬å¼è®¡ç®—å³å¯ï¼Œä¾‹å¦‚è¿™æ ·ï¼š library(dplyr)df=tibble(gene=c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;),length=c(12,21,33,45), readCount=c(120,13,26,390))df&lt;-df%&gt;%mutate(Ratio=readCount/length)%&gt;% mutate(Sum=sum(Ratio),TPM=Ratio/Sum*1e6) è¿™æ ·å°±å¯ä»¥ç®€å•çš„è®¡ç®—TPMäº†ï¼Œä½†æ˜¯è¿™é‡Œçš„å¹¶éå‡†ç¡®çš„TPMå€¼ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦çš„TPMçš„lengthä¸ºæœ‰æ•ˆé•¿åº¦è€Œéè½¬å½•æœ¬çš„é•¿åº¦ï¼Œè€Œ $$EffLength&#x3D;feature Length - average fragment length +1$$ å½“ç„¶è¿™é‡Œçš„æœ‰æ•ˆé•¿åº¦ä¾ç„¶æ˜¯ä¼°è®¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨é¢å¤–çš„è½¯ä»¶å»è®¡ç®—æ’å…¥é•¿åº¦ï¼Œä»è€Œæ±‚å¾—ç‰‡æ®µé•¿åº¦ã€‚ä¾‹å¦‚picard æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä»æ¯”å¯¹åçš„BAMæ–‡ä»¶ç›´æ¥è·å–åŸºå› çš„å®šé‡TPMï¼Œé€šè¿‡TPMCalculatorè½¯ä»¶ æ–‡çŒ®ï¼šTPMCalculator: One-Step Software to Quantify mRNA Abundance of Genomic Featuresè„šæœ¬ï¼šGithub:TPMCalculator","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"},{"name":"è½¬å½•ç»„","slug":"è½¬å½•ç»„","permalink":"https://xiaohanys.top/tags/%E8%BD%AC%E5%BD%95%E7%BB%84/"}],"author":"Xiaoguang Pan"},{"title":"å•ç»†èƒæ•°æ®å¦‚ä½•æ··åˆäºšç±»å’Œå¤§ç±»åšç‚¹å›¾åˆ†æMarkeråŸºå› ","slug":"å•ç»†èƒæ•°æ®å¦‚ä½•æ··åˆäºšç±»å’Œå¤§ç±»åšç‚¹å›¾åˆ†æMarkeråŸºå› ","date":"2024-09-20T04:50:55.000Z","updated":"2024-10-18T05:32:06.207Z","comments":true,"path":"scrna-markplot/","permalink":"https://xiaohanys.top/scrna-markplot/","excerpt":"å•ç»†èƒæ•°æ®æ•°æ®é‡å¾ˆå¤§ï¼ŒåŠ é‡äº†åˆ†æçš„è´Ÿæ‹…ï¼Œä½†åªè¦æŒæ¡å¥½çš„æ–¹æ³•å’Œå·¥å…·ï¼Œå°±å¯ä»¥æ— å¾€è€Œä¸åˆ©ã€‚ä»Šå¹´è¦è¯´çš„è¿™ä¸ªå¦‚é¢˜ï¼Œæ˜¯å› ä¸ºåœ¨åŒºåˆ†äºšç±»çš„æ—¶å€™ï¼Œæå–äº†å¤§ç±»å‹å¹¶è°ƒæ•´åˆ†è¾¨ç‡é‡æ–°èšç±»è®¡ç®—çš„äºšç±»ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ","text":"å•ç»†èƒæ•°æ®æ•°æ®é‡å¾ˆå¤§ï¼ŒåŠ é‡äº†åˆ†æçš„è´Ÿæ‹…ï¼Œä½†åªè¦æŒæ¡å¥½çš„æ–¹æ³•å’Œå·¥å…·ï¼Œå°±å¯ä»¥æ— å¾€è€Œä¸åˆ©ã€‚ä»Šå¹´è¦è¯´çš„è¿™ä¸ªå¦‚é¢˜ï¼Œæ˜¯å› ä¸ºåœ¨åŒºåˆ†äºšç±»çš„æ—¶å€™ï¼Œæå–äº†å¤§ç±»å‹å¹¶è°ƒæ•´åˆ†è¾¨ç‡é‡æ–°èšç±»è®¡ç®—çš„äºšç±»ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ é—®é¢˜åˆ†æå…¶å®è¯¥é—®é¢˜å¯ä»¥ç®€åŒ–ä¸ºæŠŠæ¯ä¸ªäºšç±»çš„åˆ†ç±»ä¿¡æ¯æå–å‡ºæ¥å¹¶ç»™å¤§ç±»è¿›è¡Œèµ‹å€¼ï¼Œç„¶åä½¿ç”¨Seuratå†…ç½®çš„DotPlotåŠŸèƒ½è¿›è¡Œä½œå›¾ï¼Œæ ·å¼å¯ä»¥å¾®è°ƒã€‚ è§£å†³æ–¹æ³•æœ‰äº†æ–¹æ¡ˆï¼Œè§£å†³èµ·æ¥å°±ç®€å•äº†ï¼ é¦–å…ˆï¼ŒmarkersåŸºå› å…ˆè¾“å…¥ï¼Œç„¶åæŠŠå¤§ç±»è¯»å…¥å†…å­˜å¹¶æ“ä½œä¸€ä¸‹library(RColorBrewer)library(ggplot2)library(Seurat)markers&lt;-c(&quot;PDGFRB&quot;,&quot;DCN&quot;,&quot;LUM&quot;,&quot;DKK1&quot;,&quot;ESR1&quot;,&quot;PGR&quot;,&quot;NCAM1&quot;,&quot;ITGA1&quot;,&quot;FCGR3A&quot;,&quot;CD3E&quot;,&quot;TRAC&quot;,&quot;CD8A&quot;,&quot;ACTA2&quot;,&quot;RGS5&quot;,&quot;TAGLN&quot;,&quot;ADGRL4&quot;,&quot;DIPK2B&quot;,&quot;CD34&quot;,&quot;KDR&quot;,&quot;GP1BA&quot;,&quot;CD14&quot;,&quot;PROM1&quot;,&quot;MCAM&quot;,&quot;CD36&quot;,&quot;VCAM1&quot;,&quot;VWF&quot;,&quot;DEFB1&quot;,&quot;GPX3&quot;,&quot;FOXJ1&quot;,&quot;SNTN&quot;,&quot;CD14&quot;,&quot;CD68&quot;,&quot;CD4&quot;,&quot;CD163&quot;,&quot;CD19&quot;,&quot;IGKC&quot;,&quot;JCHAIN&quot;,&quot;CD1C&quot;,&quot;THBD&quot;,&quot;CLEC9A&quot;,&quot;CBR3&quot;)endo&lt;-readRDS(&quot;all_20_samples_after_cluster_0.09.rds&quot;)#è¿™é‡Œè¯»å–å¤§ç±»###ç»™å¤§ç±»é‡å‘½ånew.cluster.ids &lt;- c(&quot;Stroma Cell&quot;, &quot;NK and T Cell&quot;, &quot;Luminal Epithelial Cell&quot;, &quot;Macrophages and Dendritic&quot;, &quot;Progenitor Cell&quot;, &quot;Endothelial Cell&quot;, &quot;Smooth Muscle Cell&quot;, &quot;Ciliated Epithelial Cell&quot;)names(new.cluster.ids) &lt;- levels(endo)endo &lt;- RenameIdents(endo, new.cluster.ids)all_cell&lt;-Idents(endo)need&lt;-as.character(all_cell)names(need)&lt;-names(all_cell) ç„¶åï¼ŒæŠŠéœ€è¦çš„ä¸‰ä¸ªäºšç±»è¯»å…¥å†…å®¹å¹¶å¤„ç†äºšç±»å’Œå¤§ç±»ä¹‹é—´çš„æ˜ å°„å…³ç³»for (i in c(1,3,4))&#123; fs_name&lt;-paste0(&quot;./cluster_&quot;,i,&quot;/cluster_&quot;,i,&quot;.afterclu.rds&quot;) cls&lt;-readRDS(fs_name) cell.type&lt;-Idents(cls) cls_cluster&lt;-paste(new.cluster.ids[i+1],cell.type,sep=&quot;_&quot;) names(cls_cluster)&lt;-names(cell.type) need[which(need==new.cluster.ids[i+1])]&lt;-cls_cluster rm(cls)&#125; æŠŠæ–°çš„åˆ°çš„åˆ†ç»„ä¿¡æ¯ä¼ å…¥åˆ°å¤§ç±»ä¸­å¹¶è®¾ç½®å¥½å› å­é¡ºåºï¼Œå°†å…¶å®šä¹‰ä¸ºIdentsendo$new_group&lt;-needendo$new_group&lt;-factor(endo$new_group,levels=c(&quot;Stroma Cell&quot;,&quot;NK and T Cell_0&quot;,&quot;NK and T Cell_1&quot;,&quot;NK and T Cell_2&quot;,&quot;NK and T Cell_3&quot;,&quot;Smooth Muscle Cell&quot;,&quot;Endothelial Cell&quot;,&quot;Progenitor Cell_0&quot;,&quot;Progenitor Cell_1&quot;,&quot;Progenitor Cell_2&quot;,&quot;Progenitor Cell_3&quot;,&quot;Luminal Epithelial Cell&quot;,&quot;Ciliated Epithelial Cell&quot;,&quot;Macrophages and Dendritic_0&quot;,&quot;Macrophages and Dendritic_1&quot;,&quot;Macrophages and Dendritic_2&quot;,&quot;Macrophages and Dendritic_3&quot;))Idents(endo)&lt;-&quot;new_group&quot; æœ€åä½œå›¾å¾®è°ƒå¹¶ä¿å­˜DefaultAssay(endo)&lt;-&quot;RNA&quot;DotPlot(endo,features=unique(markers),cols=c(&quot;white&quot;,&quot;red&quot;))+ RotatedAxis()+ theme_test()+ theme(axis.text=element_text(size=6,face=&quot;bold&quot;),axis.title=element_blank(),legend.position=&quot;bottom&quot;,legend.text=element_text(size=5.5),legend.title=element_text(size=6,face=&quot;bold&quot;),axis.text.x=element_text(angle = 90, hjust = 1, vjust = .5)) å›¾å½¢å¦‚ä¸‹ï¼š å¦å¤–çš„å›¾ï¼Ÿé’ˆå¯¹ä»¥ä¸Šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªäºšç±»çš„å…³ç³»éƒ½æ˜ å°„åˆ°å¤§ç±»çš„umapå›¾ä¸Šï¼Œä»¥å°½é‡å±•ç¤ºæ‰€æœ‰çš„å…³ç³» library(RColorBrewer)library(ggplot2)library(Seurat)endo&lt;-readRDS(&quot;all_20_samples_after_cluster_0.09.rds&quot;)#è¿™é‡Œè¯»å–å¤§ç±»###ç»™å¤§ç±»é‡å‘½ånew.cluster.ids &lt;- c(&quot;Stroma Cell&quot;, &quot;NK and T Cell&quot;, &quot;Luminal Epithelial Cell&quot;, &quot;Macrophages and Dendritic&quot;, &quot;Progenitor Cell&quot;, &quot;Endothelial Cell&quot;, &quot;Smooth Muscle Cell&quot;, &quot;Ciliated Epithelial Cell&quot;)names(new.cluster.ids) &lt;- levels(endo)endo &lt;- RenameIdents(endo, new.cluster.ids)all_cell&lt;-Idents(endo)need&lt;-as.character(all_cell)names(need)&lt;-names(all_cell)for (i in c(1:7))&#123; fs_name&lt;-paste0(&quot;./cluster_&quot;,i,&quot;/cluster_&quot;,i,&quot;.afterclu.rds&quot;) cls3&lt;-readRDS(fs_name)#è¿™é‡Œè¯»å–äºšç±» cell.type&lt;-Idents(cls3) cls3_cluster&lt;-paste(new.cluster.ids[i+1],cell.type,sep=&quot;_&quot;) names(cls3_cluster)&lt;-names(cell.type) need[which(need2==new.cluster.ids[i+1])]&lt;-cls3_cluster rm(cls3)&#125;endo$new_id&lt;-needDimPlot(endo,reduction=&quot;umap&quot;,group.by=&quot;new_id&quot;,cols=colorRampPalette(brewer.pal(29,&quot;Set1&quot;))(29))+theme(legend.text=element_text(size=6))ggsave(&quot;dimplot_for_newlable.png&quot;,width=7,height=4,dpi=300)","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"ClusterProfiler:çœŸçš„ä¸åªæ˜¯å¯Œé›†åˆ†æ","slug":"ClusterProfilerçœŸçš„ä¸åªæ˜¯å¯Œé›†åˆ†æ","date":"2024-09-20T04:48:58.000Z","updated":"2024-10-18T05:33:32.114Z","comments":true,"path":"clusterprofiler-not-enrichment/","permalink":"https://xiaohanys.top/clusterprofiler-not-enrichment/","excerpt":"ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½åœ¨è®²Yå”çš„clusterprofileå¯Œé›†åˆ†æçš„æ•™ç¨‹ï¼Œä½†æ˜¯æŸ¥é˜…äº†å®˜æ–¹æ–‡æ¡£åæ‰çŸ¥é“ï¼Œè¿™ä¸ªåŒ…çœŸçš„ä¸ä»…ä»…åªæœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ã€‚","text":"ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½åœ¨è®²Yå”çš„clusterprofileå¯Œé›†åˆ†æçš„æ•™ç¨‹ï¼Œä½†æ˜¯æŸ¥é˜…äº†å®˜æ–¹æ–‡æ¡£åæ‰çŸ¥é“ï¼Œè¿™ä¸ªåŒ…çœŸçš„ä¸ä»…ä»…åªæœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ã€‚ åšIDè½¬æ¢IDè½¬æ¢åº”è¯¥æ˜¯åŸºå› ä¸‹æ¸¸åˆ†æçš„æ•²é—¨ç –äº†ï¼Œå› ä¸ºä¸€èˆ¬æ³¨é‡Šç”¨çš„æ˜¯ENSMEBL IDï¼Œä½†æ˜¯è¿™ä¸ªIDæ˜¯äººç±»æ— æ³•è¯†åˆ«çš„ä¸€ä¸²æ•°å­—ï¼Œä¸‹æ¸¸åˆ†æåŠŸèƒ½éƒ½éœ€è¦è½¬æ¢æˆåŸºå› åç§°æˆ–è€…åŸºå› IDï¼Œæœ‰è¿™ä¸ªbitråŠŸèƒ½å°±æ–¹ä¾¿äº†å¾ˆå¤šã€‚ x &lt;- c(&quot;GPX3&quot;, &quot;GLRX&quot;, &quot;LBP&quot;, &quot;CRYAB&quot;, &quot;DEFB1&quot;, &quot;HCLS1&quot;, &quot;SOD2&quot;, &quot;HSPA2&quot;, &quot;ORM1&quot;, &quot;IGFBP1&quot;, &quot;PTHLH&quot;, &quot;GPC3&quot;, &quot;IGFBP3&quot;,&quot;TOB1&quot;, &quot;MITF&quot;, &quot;NDRG1&quot;, &quot;NR1H4&quot;, &quot;FGFR3&quot;, &quot;PVR&quot;, &quot;IL6&quot;, &quot;PTPRM&quot;, &quot;ERBB2&quot;, &quot;NID2&quot;, &quot;LAMB1&quot;, &quot;COMP&quot;, &quot;PLS3&quot;, &quot;MCAM&quot;, &quot;SPP1&quot;, &quot;LAMC1&quot;, &quot;COL4A2&quot;, &quot;COL4A1&quot;, &quot;MYOC&quot;, &quot;ANXA4&quot;, &quot;TFPI2&quot;, &quot;CST6&quot;, &quot;SLPI&quot;, &quot;TIMP2&quot;, &quot;CPM&quot;, &quot;GGT1&quot;, &quot;NNMT&quot;, &quot;MAL&quot;, &quot;EEF1A2&quot;, &quot;HGD&quot;, &quot;TCN2&quot;, &quot;CDA&quot;, &quot;PCCA&quot;, &quot;CRYM&quot;, &quot;PDXK&quot;, &quot;STC1&quot;, &quot;WARS&quot;, &quot;HMOX1&quot;, &quot;FXYD2&quot;, &quot;RBP4&quot;, &quot;SLC6A12&quot;, &quot;KDELR3&quot;, &quot;ITM2B&quot;)eg = bitr(x, fromType=&quot;SYMBOL&quot;, toType=&quot;ENTREZID&quot;, OrgDb=&quot;org.Hs.eg.db&quot;)head(eg) ## SYMBOL ENTREZID## 1 GPX3 2878## 2 GLRX 2745## 3 LBP 3929## 4 CRYAB 1410## 5 DEFB1 1672## 6 HCLS1 3059 æƒ³çŸ¥é“ä½ å¯ä»¥è¿›è¡Œå“ªäº›ID è½¬æ¢ï¼Ÿ library(org.Hs.eg.db)keytypes(org.Hs.eg.db) ## [1] &quot;ACCNUM&quot; &quot;ALIAS&quot; &quot;ENSEMBL&quot; ## [4] &quot;ENSEMBLPROT&quot; &quot;ENSEMBLTRANS&quot; &quot;ENTREZID&quot; ## [7] &quot;ENZYME&quot; &quot;EVIDENCE&quot; &quot;EVIDENCEALL&quot; ## [10] &quot;GENENAME&quot; &quot;GO&quot; &quot;GOALL&quot; ## [13] &quot;IPI&quot; &quot;MAP&quot; &quot;OMIM&quot; ## [16] &quot;ONTOLOGY&quot; &quot;ONTOLOGYALL&quot; &quot;PATH&quot; ## [19] &quot;PFAM&quot; &quot;PMID&quot; &quot;PROSITE&quot; ## [22] &quot;REFSEQ&quot; &quot;SYMBOL&quot; &quot;UCSCKG&quot; ## [25] &quot;UNIGENE&quot; &quot;UNIPROT&quot; Noteï¼šè™½ç„¶GOåˆ†ææ”¯æŒå¾ˆå¤šIDï¼Œä¾‹å¦‚symbolå®Œå…¨å¯ä»¥ç›´æ¥è¿è¡Œï¼Œä½†è¿˜æ˜¯å»ºè®®éƒ½è½¬æ¢ä¸ºENTREZIDï¼Œæ¯•ç«Ÿï¼Œæˆ‘ä»¬å¾ˆå°‘ç›´æ¥å¾—åˆ°symbolå•Šã€‚ GSEAåˆ†æè¿˜åœ¨ä½¿ç”¨å®˜æ–¹çš„GSEA javaåŒ…è¿›è¡Œå¯Œé›†åˆ†æå—ï¼Œä½ éœ€è¦å‡†å¤‡gctæ–‡ä»¶ï¼ˆè¡¨è¾¾çŸ©é˜µï¼‰ï¼Œè¦è½¬æ¢ä¸ºsymbolæˆ–è€…entrezid,è¿˜è¦å‡†å¤‡clsæ–‡ä»¶ï¼ˆæ ·æœ¬ç‰¹å¾ï¼‰ï¼Œè¿˜è¦ä¸‹è½½å¥½gmtæ–‡ä»¶ï¼Œæœ€åå‡ºæ¥çš„åˆ†æç»“æœï¼Œå„ç§å›¾ç‰‡éƒ½æ˜¯ä¸å¥½çœ‹çš„ï¼Œå‡†ç¡®è¯´ä¸å¤Ÿçµæ´»ï¼Œç”¨RåŒ…å‘¢ï¼Ÿ GSEA_GO ego3 &lt;- gseGO(geneList = geneList, OrgDb = org.Hs.eg.db, ont = &quot;CC&quot;, nPerm = 1000, minGSSize = 100, maxGSSize = 500, pvalueCutoff = 0.05, verbose = FALSE) geneList æ˜¯ä»€ä¹ˆï¼Ÿ ç±»ä¼¼äºåšå¯Œé›†ï¼ˆè¿‡è¡¨è¾¾ï¼‰åˆ†æï¼ŒgeneListæ˜¯ä¸€åˆ—åŸºå› idï¼Œè€ŒGSEAåˆ†æä¸€èˆ¬éœ€è¦åŸºå› è¡¨è¾¾é‡æ¥è¡¡é‡å¯Œé›†åˆ†æ•°ï¼Œä½†æ˜¯ä»åŸç†ä¸Šæ¥è®²ï¼Œè¿˜æ˜¯æ ¹æ®è¡¨è¾¾é‡è®¡ç®—Fordchange,ç„¶åç»™ä»–æ’åºï¼Œçœ‹è¿™ä¸ªæ’åºåœ¨åŸºå› é›†ä¸­çš„å¯Œé›†ç¨‹åº¦ã€‚è¿™æ ·å°±ä¸ä¼šå› ä¸ºä¼ ç»Ÿåˆ†æä¸­å…ˆç­›é€‰å·®å¼‚åŸºå› è€Œè¿‡æ»¤æ‰çš„ä½å·®å¼‚åŸºå› ä¿¡æ¯ï¼ˆè¯¦æƒ…å‚è€ƒGSEAçš„åŸç†ï¼‰ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªåŸºå› åˆ—è¡¨æ˜¯æŒ‡ä¸€åˆ—æ’åºåçš„ä»¥åŸºå› åç§°ä¸ºåå­—çš„log2FCå€¼å‘é‡ã€‚ å‡è®¾ä½ æœ‰ä¸€ä¸ªä¸¤åˆ—çš„æ–‡ä»¶ï¼Œç¬¬ä¸€åˆ—ä¸ºåå­—ï¼Œç¬¬äºŒåˆ—ä¸ºlogFC,ä½ å¯ä»¥è¿™æ ·ï¼š d &lt;- read.csv(your_csv_file)##ç¬¬ä¸€åˆ—ä¸ºåŸºå› ID##ç¬¬äºŒåˆ—ä¸ºå·®å¼‚å€¼## è·å–log2FCgeneList &lt;- d[,2]## å‘½ånames(geneList) &lt;- as.character(d[,1])## é™åºgeneList &lt;- sort(geneList, decreasing = TRUE)head(geneList) å‰©ä½™éƒ½æ˜¯ä¸€äº›é™åˆ¶å‚æ•°ï¼Œè¯·æ‰§è¡Œ?clusterProfiler::gseGO ## 4312 8318 10874 55143 55388 991 ## 4.572613 4.514594 4.418218 4.144075 3.876258 3.677857 GSEA-KEGG kk2 &lt;- gseKEGG(geneList = geneList, organism = &#x27;hsa&#x27;, nPerm = 1000, minGSSize = 120, pvalueCutoff = 0.05, verbose = FALSE)head(kk2) ## ID Description setSize## hsa04510 hsa04510 Focal adhesion 188## hsa04151 hsa04151 PI3K-Akt signaling pathway 322## hsa03013 hsa03013 RNA transport 131## hsa05152 hsa05152 Tuberculosis 162## hsa04062 hsa04062 Chemokine signaling pathway 165## hsa04218 hsa04218 Cellular senescence 143## enrichmentScore NES pvalue p.adjust## hsa04510 -0.4188582 -1.706291 0.001430615 0.02322097## hsa04151 -0.3482755 -1.497042 0.002614379 0.02322097## hsa03013 0.4116488 1.735751 0.003095975 0.02322097## hsa05152 0.3745153 1.630500 0.003154574 0.02322097## hsa04062 0.3754101 1.633635 0.003184713 0.02322097## hsa04218 0.4153718 1.772207 0.003194888 0.02322097## qvalues rank leading_edge## hsa04510 0.01576976 2183 tags=27%, list=17%, signal=23%## hsa04151 0.01576976 1997 tags=23%, list=16%, signal=20%## hsa03013 0.01576976 3383 tags=40%, list=27%, signal=29%## hsa05152 0.01576976 2823 tags=34%, list=23%, signal=27%## hsa04062 0.01576976 1298 tags=21%, list=10%, signal=19%## hsa04218 0.01576976 1155 tags=17%, list=9%, signal=16%## core_enrichment## hsa04510 5595/5228/7424/1499/4636/83660/7059/5295/1288/23396/3910/3371/3082/1291/394/3791/7450/596/3685/1280/3675/595/2318/3912/1793/1278/1277/1293/10398/55742/2317/7058/25759/56034/3693/3480/5159/857/1292/3908/3909/63923/3913/1287/3679/7060/3479/10451/80310/1311/1101## hsa04151 627/2252/7059/92579/5563/5295/6794/1288/7010/3910/3371/3082/1291/4602/3791/1027/90993/3441/3643/1129/2322/1975/7450/596/3685/1942/2149/1280/4804/3675/595/2261/7248/2246/4803/3912/1902/1278/1277/2846/2057/1293/2247/55970/5618/7058/10161/56034/3693/4254/3480/4908/5159/1292/3908/2690/3909/8817/9223/4915/3551/2791/63923/3913/9863/3667/1287/3679/7060/3479/80310/1311/5105/2066/1101## hsa03013 10460/1978/55110/54913/9688/8894/11260/10799/9631/4116/5042/8761/6396/23165/8662/10248/55706/79833/9775/29107/23636/5905/9513/5901/10775/10557/4927/79902/1981/26986/11171/10762/8480/8891/11097/26019/10940/4686/9972/81929/10556/3646/9470/387082/1977/57122/8563/7514/79023/3837/9818/56000## hsa05152 820/51806/6772/64581/3126/3112/8767/3654/1054/1051/3458/1520/11151/1594/50617/54205/91860/8877/3329/637/3689/7096/2207/3929/4360/5603/929/533/3452/6850/7124/1509/3569/7097/1378/8772/64170/3119/843/2213/8625/3920/2215/3587/5594/3593/9103/3592/6300/9114/10333/3109/3108/1432/3552## hsa04062 3627/10563/6373/4283/6362/6355/2921/6364/3576/6352/10663/1230/6772/6347/6351/3055/1237/1236/4067/6354/114/3702/6361/1794/1234/6367/6375/6374/2919/409/4793/2792/6360/5880## hsa04218 ç»“æœé‡Œé¢åŒ…å«äº†æ‰€æœ‰GSEAè®¡ç®—çš„ç»“æœæ•°å€¼ setSize:åŸºå› é›†çš„å¤§å°enrichmentScore:å¯Œé›†æ‰“åˆ†NESï¼šæ ‡å‡†åŒ–åçš„å¯Œé›†æ‰“åˆ†pvalue,p.ajust.qvalues:å„ç§æ˜¾è‘—æ€§æ£€éªŒrank:log2FCçš„æ’åºä½ç½® æ ¹æ®å®˜æ–¹æä¾›çš„gmtæ–‡ä»¶æˆ–è€…è‡ªå·±åšgmtæ–‡ä»¶è¿›è¡Œåˆ†æ å‡è®¾ä½ ä»å®˜ç½‘ä¸‹è½½äº†HallmarkåŸºå› é›† wp2gene &lt;- read.gmt(&quot;h.all.v7.0.entrez.gmt&quot;)em2 &lt;- GSEA(geneList, TERM2GENE = wp2gene) è¿™æ ·å°±å¯ä»¥ç›´æ¥å¾—åˆ°å¯Œé›†åˆ†æçš„ç»“æœï¼Œéå¸¸æ–¹ä¾¿ å¦å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡msigdbråŒ…ç›´æ¥è·å–åŸºå› é›†ä¿¡æ¯ï¼Œä½†æ˜¯æ„Ÿè§‰çµæ´»æ€§ä¸é«˜ã€‚ å¯¹GSEAçš„ç»“æœå¯è§†åŒ–anno &lt;- edo2[1, c(&quot;NES&quot;, &quot;pvalue&quot;, &quot;p.adjust&quot;)]lab &lt;- paste0(names(anno), &quot;=&quot;, round(anno, 3), collapse=&quot;\\n&quot;)gseaplot2(edo2, geneSetID = 1, title = edo2$Description[1])+annotate(&quot;text&quot;, 0.7, edo2[i, &quot;enrichmentScore&quot;] * .9, label = lab, hjust=0, vjust=0) pp &lt;- lapply(1:3, function(i) &#123; anno &lt;- edo2[i, c(&quot;NES&quot;, &quot;pvalue&quot;, &quot;p.adjust&quot;)] lab &lt;- paste0(names(anno), &quot;=&quot;, round(anno, 3), collapse=&quot;\\n&quot;) gsearank(edo2, i, edo2[i, 2]) + xlab(NULL) +ylab(NULL) + annotate(&quot;text&quot;, 0, edo2[i, &quot;enrichmentScore&quot;] * .9, label = lab, hjust=0, vjust=0)&#125;)plot_grid(plotlist=pp, ncol=1) ä½¿ç»“æœå¯è¯»æ€§æå‡é’ˆå¯¹åˆ†æç»“æœï¼ŒGOå¯Œé›†å¯ä»¥è®¾ç½®å‚æ•°readable = TRUEï¼Œä½†æ˜¯å¯¹KEGGæ— æ³•ä½¿ç”¨ï¼Œå› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨setReadable library(org.Hs.eg.db)library(clusterProfiler)data(geneList, package=&quot;DOSE&quot;)de &lt;- names(geneList)[1:100]x &lt;- enrichKEGG(de)## The geneID column is ENTREZIDhead(x, 3) ## ID Description GeneRatio BgRatio## hsa04110 hsa04110 Cell cycle 8/48 124/7932## hsa04218 hsa04218 Cellular senescence 7/48 160/7932## hsa04114 hsa04114 Oocyte meiosis 6/48 128/7932## pvalue p.adjust qvalue## hsa04110 6.356283e-07 7.182599e-05 6.490099e-05## hsa04218 4.377944e-05 2.473538e-03 2.235055e-03## hsa04114 1.105828e-04 4.165285e-03 3.763695e-03## geneID Count## hsa04110 8318/991/9133/890/983/4085/7272/1111 8## hsa04218 2305/4605/9133/890/983/51806/1111 7## hsa04114 991/9133/983/4085/51806/6790 6 y &lt;- setReadable(x, OrgDb = org.Hs.eg.db, keyType=&quot;ENTREZID&quot;)## The geneID column is translated to symbolhead(y, 3) ## ID Description GeneRatio BgRatio## hsa04110 hsa04110 Cell cycle 8/48 124/7932## hsa04218 hsa04218 Cellular senescence 7/48 160/7932## hsa04114 hsa04114 Oocyte meiosis 6/48 128/7932## pvalue p.adjust qvalue## hsa04110 6.356283e-07 7.182599e-05 6.490099e-05## hsa04218 4.377944e-05 2.473538e-03 2.235055e-03## hsa04114 1.105828e-04 4.165285e-03 3.763695e-03## geneID## hsa04110 CDC45/CDC20/CCNB2/CCNA2/CDK1/MAD2L1/TTK/CHEK1## hsa04218 FOXM1/MYBL2/CCNB2/CCNA2/CDK1/CALML5/CHEK1## hsa04114 CDC20/CCNB2/CDK1/MAD2L1/CALML5/AURKA## Count## hsa04110 8## hsa04218 7## hsa04114 6 ä½ ç”šè‡³å¯ä»¥ç”¨å®ƒæ¥å¯¹å•ç»†èƒèšç±»ç»“æœè¿›è¡Œæ³¨é‡Šå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤§çš„ç»†èƒmarkeråº“ï¼Œç„¶åæˆ‘ä»¬æœ‰æ˜¾è‘—å·®å¼‚çš„åŸºå› marker,é‚£å¯»æ‰¾ç»†èƒç±»å‹å°±å’Œè¿‡è¡¨è¾¾åˆ†ææ˜¯ä¸€ç§æƒ…å†µäº†ï¼Œéƒ½æ˜¯é‡‡ç”¨è¶…å‡ ä½•åˆ†å¸ƒè®¡ç®—æ¦‚ç‡ï¼Œæ‰€ä»¥ï¼š cell_markers &lt;- vroom::vroom(&#x27;http://bio-bigdata.hrbmu.edu.cn/CellMarker/download/Human_cell_markers.txt&#x27;) %&gt;% tidyr::unite(&quot;cellMarker&quot;, tissueType, cancerType, cellName, sep=&quot;, &quot;) %&gt;% dplyr::select(cellMarker, geneID) %&gt;% dplyr::mutate(geneID = strsplit(geneID, &#x27;, &#x27;))cell_markers ä½ ç”šè‡³å¯ä»¥ä»cellmarkerå®˜ç½‘ç›´æ¥ä¸‹è½½æ‰€æœ‰çš„ç»†èƒmarker ## # A tibble: 2,868 x 2## cellMarker geneID ## &lt;chr&gt; &lt;list&gt; ## 1 Kidney, Normal, Proximal tubular cell &lt;chr [1â€¦## 2 Liver, Normal, Ito cell (hepatic stellate cell) &lt;chr [1â€¦## 3 Endometrium, Normal, Trophoblast cell &lt;chr [1â€¦## 4 Germ, Normal, Primordial germ cell &lt;chr [1â€¦## 5 Corneal epithelium, Normal, Epithelial cell &lt;chr [1â€¦## 6 Placenta, Normal, Cytotrophoblast &lt;chr [1â€¦## 7 Periosteum, Normal, Periosteum-derived progenitâ€¦ &lt;chr [4â€¦## 8 Amniotic membrane, Normal, Amnion epithelial ceâ€¦ &lt;chr [2â€¦## 9 Primitive streak, Normal, Primitive streak cell &lt;chr [2â€¦## 10 Adipose tissue, Normal, Stromal vascular fractiâ€¦ &lt;chr [1â€¦## # â€¦ with 2,858 more rows y &lt;- enricher(gene, TERM2GENE=cell_markers, minGSSize=1)DT::datatable(as.data.frame(y)) è¿™æ ·å°±æ‰¾åˆ°äº†ç»†èƒç±»å‹ï¼Œä½ å¯ä»¥è¿‡æ»¤å æ¯”æœ€é«˜ï¼Œä¸”på€¼æ˜¾è‘—çš„ç»“æœã€‚","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"python, perl å’Œjuliaçš„æ€§èƒ½å¯¹æ¯”","slug":"å’Œjuliaçš„æ€§èƒ½å¯¹æ¯”","date":"2024-09-20T04:44:08.000Z","updated":"2024-10-18T05:32:11.134Z","comments":true,"path":"jl-py-pr-compair/","permalink":"https://xiaohanys.top/jl-py-pr-compair/","excerpt":"åœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ç»å¸¸ç”¨åˆ°çš„è„šæœ¬è¯­è¨€ä¸»è¦æ˜¯pythonå’Œperlï¼Œä»–ä»¬è¢«ç”¨æ¥å¤„ç†æ–‡æœ¬ï¼Œå¤§é‡ç»Ÿè®¡ï¼Œæµç¨‹æ§åˆ¶ç­‰ç­‰ï¼Œå…¶è‡ªèº«ä¹Ÿæ˜¯å„æœ‰ä¼˜åŠ¿ã€‚æ¯”å¦‚è¯´perlå¤©ç”Ÿå°±ä¸ºäº†å¤„ç†æ–‡æœ¬è€Œç”Ÿï¼Œä½†æ˜¯pythonç¡®æ˜¯æœ‰åçš„èƒ¶æ°´è¯­è¨€ï¼Œç‰¹åˆ«åœ¨æ•´åˆCä»£ç æ—¶æ˜¾ç¤ºå‡ºå·¨å¤§çš„ä¼˜åŠ¿ï¼Œå…¶è¯­æ³•ç®€æ´æ˜“æ‡‚ï¼Œæ˜“äºç»´æŠ¤æ›´è®©å…¶æˆä¸ºä»…æ¬¡äºCå’ŒJAVAçš„ç¬¬ä¸‰å¤§è¯­è¨€ï¼Œä½†å…¶ç³Ÿç³•çš„æ€§èƒ½åœ¨å¤„ç†å¤§é‡å¾ªç¯æ—¶ä¼šè®©äººå¿ä¸ä½æŠ“ç‹‚ã€‚å› æ­¤ï¼ŒJuliaè¯­è¨€åº”è¿è€Œç”Ÿï¼Œå…¶æ§åˆ¶äº†pythonä¸­æ²¡å¿…è¦çš„åŠ¨æ€æ€§ï¼ŒåŠ ä¹‹ä½¿ç”¨JITæŠ€æœ¯è®©å…¶èƒ½å¤Ÿä¿æœ‰é«˜æ€§èƒ½çš„åŒæ—¶å…·å¤‡ç®€æ´çš„è¯­æ³•ã€‚","text":"åœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ç»å¸¸ç”¨åˆ°çš„è„šæœ¬è¯­è¨€ä¸»è¦æ˜¯pythonå’Œperlï¼Œä»–ä»¬è¢«ç”¨æ¥å¤„ç†æ–‡æœ¬ï¼Œå¤§é‡ç»Ÿè®¡ï¼Œæµç¨‹æ§åˆ¶ç­‰ç­‰ï¼Œå…¶è‡ªèº«ä¹Ÿæ˜¯å„æœ‰ä¼˜åŠ¿ã€‚æ¯”å¦‚è¯´perlå¤©ç”Ÿå°±ä¸ºäº†å¤„ç†æ–‡æœ¬è€Œç”Ÿï¼Œä½†æ˜¯pythonç¡®æ˜¯æœ‰åçš„èƒ¶æ°´è¯­è¨€ï¼Œç‰¹åˆ«åœ¨æ•´åˆCä»£ç æ—¶æ˜¾ç¤ºå‡ºå·¨å¤§çš„ä¼˜åŠ¿ï¼Œå…¶è¯­æ³•ç®€æ´æ˜“æ‡‚ï¼Œæ˜“äºç»´æŠ¤æ›´è®©å…¶æˆä¸ºä»…æ¬¡äºCå’ŒJAVAçš„ç¬¬ä¸‰å¤§è¯­è¨€ï¼Œä½†å…¶ç³Ÿç³•çš„æ€§èƒ½åœ¨å¤„ç†å¤§é‡å¾ªç¯æ—¶ä¼šè®©äººå¿ä¸ä½æŠ“ç‹‚ã€‚å› æ­¤ï¼ŒJuliaè¯­è¨€åº”è¿è€Œç”Ÿï¼Œå…¶æ§åˆ¶äº†pythonä¸­æ²¡å¿…è¦çš„åŠ¨æ€æ€§ï¼ŒåŠ ä¹‹ä½¿ç”¨JITæŠ€æœ¯è®©å…¶èƒ½å¤Ÿä¿æœ‰é«˜æ€§èƒ½çš„åŒæ—¶å…·å¤‡ç®€æ´çš„è¯­æ³•ã€‚ Codonæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„Pythonç¼–è¯‘å™¨ï¼Œå®ƒå°†Pythonä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ä»£ç ï¼Œè€Œä¸éœ€è¦ä»»ä½•è¿è¡Œæ—¶å¼€é”€ã€‚Pythonä¸Šçš„å…¸å‹åŠ é€Ÿåœ¨å•ä¸ªçº¿ç¨‹ä¸Šå¤§çº¦ä¸º10-100xæˆ–æ›´å¤šã€‚Codonçš„æ€§èƒ½é€šå¸¸ä¸C&#x2F;C++ä¸ç›¸ä¸Šä¸‹ã€‚ä¸Pythonä¸åŒï¼ŒCodonæ”¯æŒæœ¬æœºå¤šçº¿ç¨‹ï¼Œè¿™ä¼šå¯¼è‡´é€Ÿåº¦æé«˜å¾ˆå¤šå€ã€‚Codonå¯é€šè¿‡æ’ä»¶åŸºç¡€è®¾æ–½è¿›è¡Œæ‰©å±•ï¼Œä½¿æ‚¨èƒ½å¤Ÿåˆå¹¶æ–°çš„åº“ã€ç¼–è¯‘å™¨ä¼˜åŒ–ç”šè‡³å…³é”®å­—ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æµ‹è¯•codonæ˜¯å¦èƒ½ç»™pythonæé€Ÿï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä»¥ä¸‹pythonçš„ä»£ç  import sysdef calculateGC(sequence:str)-&gt;Tuple[int,int]: &quot;&quot;&quot;Calculate the GC content of a DNA sequence&quot;&quot;&quot; gc = 0 allnumber = 0 for i in sequence: if i != &#x27;N&#x27; and i != &#x27;n&#x27;: allnumber += 1 if i == &#x27;G&#x27; or i == &#x27;C&#x27; or i == &#x27;g&#x27; or i == &#x27;c&#x27;: gc += 1 return gc, allnumberdef main(file:str): &quot;&quot;&quot;Main function&quot;&quot;&quot; gcNum = 0 allNum = 0 with open(file,&#x27;r&#x27;) as f: for line in f: line=line.strip() if line.startswith(&#x27;&gt;&#x27;): continue else: gc, allnumber = calculateGC(line) gcNum += gc allNum += allnumber print(f&#x27;GC content is: &#123;gcNum/allNum:.3f&#125;&#x27;)main(sys.argv[1]) ç„¶åè¿è¡Œ codon build --release -o calGC calGC.py æœ€åé€Ÿåº¦ä¸ºï¼š time ./calGC ../../Project/DataBase/hg38.fa GC content is: 0.410./calGC ../../Project/DataBase/hg38.fa 22.30s user 2.75s system 111% cpu 22.421 total é€Ÿåº¦è¿˜ä¸é”™ï¼Œå·²ç»å¯ä»¥è¶…è¶Šä¸ç”¨BiojuliaåŒ…çš„juliaå‡½æ•°äº†ã€‚ 2022&#x2F;11&#x2F;14æ›´æ–°ï¼š æœ€è¿‘python3.11å‡ºæ¥äº†ï¼Œæ®è¯´æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡, ä¸€ä½å›½å¤–çš„å°å“¥(Dennis Bakhuis)é‡‡ç”¨ç®€å•çš„è’™ç‰¹å¡æ´›é¢„æµ‹åœ†å‘¨ç‡çš„æ–¹å¼æµ‹è¯•å¾ªç¯çš„æ€§èƒ½ï¼Œå‘ç°Python3.11æ€§èƒ½ç¡®å®æ˜¯çªé£çŒ›è¿›ï¼ŒåŒä¸€æ—¶é—´ï¼ŒJuliaä¹Ÿå·²ç»æ›´æ–°åˆ°V1.8äº†ï¼Œäºæ˜¯æˆ‘åœ¨ä»–çš„githubä¸‹è´¡çŒ®äº†juliaç‰ˆæœ¬çš„ä»£ç ï¼Œå¸Œæœ›ç»§ç»­æ¯”è¾ƒå¤šä¸ªè¯­è¨€çš„è®¡ç®—ç‰¹æ€§ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œè™½ç„¶pythonæ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä½†å’Œjuliaç›¸æ¯”ï¼Œé€Ÿåº¦ä¾æ—§ä¸å¤Ÿæ‰“ï¼Œ1000000ä¸ªå¾ªç¯ï¼Œpython3.11ç”¨æ—¶6ç§’ï¼Œè€Œjuliaä»…éœ€è¦0.033ç§’ã€‚å…·ä½“å¯ä»¥çœ‹githubhttps://github.com/dennisbakhuis/python3.11_speedtest åœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ç»å¸¸ç”¨åˆ°çš„è„šæœ¬è¯­è¨€ä¸»è¦æ˜¯pythonå’Œperlï¼Œä»–ä»¬è¢«ç”¨æ¥å¤„ç†æ–‡æœ¬ï¼Œå¤§é‡ç»Ÿè®¡ï¼Œæµç¨‹æ§åˆ¶ç­‰ç­‰ï¼Œå…¶è‡ªèº«ä¹Ÿæ˜¯å„æœ‰ä¼˜åŠ¿ã€‚æ¯”å¦‚è¯´perlå¤©ç”Ÿå°±ä¸ºäº†å¤„ç†æ–‡æœ¬è€Œç”Ÿï¼Œä½†æ˜¯pythonç¡®æ˜¯æœ‰åçš„èƒ¶æ°´è¯­è¨€ï¼Œç‰¹åˆ«åœ¨æ•´åˆCä»£ç æ—¶æ˜¾ç¤ºå‡ºå·¨å¤§çš„ä¼˜åŠ¿ï¼Œå…¶è¯­æ³•ç®€æ´æ˜“æ‡‚ï¼Œæ˜“äºç»´æŠ¤æ›´è®©å…¶æˆä¸ºä»…æ¬¡äºCå’ŒJAVAçš„ç¬¬ä¸‰å¤§è¯­è¨€ï¼Œä½†å…¶ç³Ÿç³•çš„æ€§èƒ½åœ¨å¤„ç†å¤§é‡å¾ªç¯æ—¶ä¼šè®©äººå¿ä¸ä½æŠ“ç‹‚ã€‚å› æ­¤ï¼ŒJuliaè¯­è¨€åº”è¿è€Œç”Ÿï¼Œå…¶æ§åˆ¶äº†pythonä¸­æ²¡å¿…è¦çš„åŠ¨æ€æ€§ï¼ŒåŠ ä¹‹ä½¿ç”¨JITæŠ€æœ¯è®©å…¶èƒ½å¤Ÿä¿æœ‰é«˜æ€§èƒ½çš„åŒæ—¶å…·å¤‡ç®€æ´çš„è¯­æ³•ã€‚ è¯´äº†é‚£ä¹ˆå¤šï¼Œåœ¨ç”Ÿç‰©ä¿¡æ¯ä¸Šæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†å¤§é‡çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚Fastaæ ¼å¼çš„åºåˆ—æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸‰è€…åˆæ˜¯è°å¿«å‘¢ï¼Ÿ ç‰ˆæœ¬æ§åˆ¶ python3 &#x3D; 3.8.3 perl &#x3D; 5.26.2 julia &#x3D; 1.5.0-beta system &#x3D; centos 8 è®¡ç®—å†…å®¹ä»UCSCä¸Šä¸‹è½½äººç±»å‚è€ƒåŸºå› ç»„ hg38.fa.gz å¹¶è§£å‹ï¼Œè®¡ç®—åŸºå› ç»„GCå«é‡ï¼ŒNç¢±åŸºä¸ç®—åœ¨æ€»é•¿ä¸­ã€‚ ä»£ç perl #!/usr/bin/perl -wuse strict;if(@ARGV &lt; 1)&#123; die &quot;Usage : perl $0 &lt;genome.fa&gt;\\n&quot;;&#125;my $input = shift @ARGV;my ($sum,$G_num,$C_num,$N_num)=(0,0,0,0);my $id;open IN, &quot;&lt; $input&quot; or die $!;while(my $line = &lt;IN&gt;)&#123; chomp $line; if($line =~ /&gt;([^\\s]+)/)&#123; $id = $1; &#125;else&#123; $sum += length($line); $G_num += ($line =~ tr/Gg/Gg/); $C_num += ($line =~ tr/Cc/Cc/); $N_num += ($line =~ tr/Nn/Nn/); &#125;&#125;close IN;my $GC_rate = ($G_num+$C_num)/($sum-$N_num);printf &quot;GC content: %.3f \\n&quot;,$GC_rate; julia function lineGC(seq::String) GCnumber=count(x-&gt;(x==&#x27;G&#x27;||x==&#x27;C&#x27;||x==&#x27;g&#x27;||x==&#x27;c&#x27;),seq) lineNum=count(x-&gt;(x!=&#x27;N&#x27; &amp;&amp; x!=&#x27;n&#x27;),seq) (GCnumber,lineNum)endfunction calGC(fs) GCnumber=zero(Int) lineNum=zero(Int) open(fs,&quot;r&quot;) do IOstream for line in eachline(IOstream) if startswith(line,&quot;&gt;&quot;) continue else GC,all=lineGC(line) GCnumber+=GC lineNum+=all end end end round(GCnumber/lineNum;digits=3)endprintln(&quot;GC content: &quot;,calGC(ARGS[1])) python import sysdef lineGC(seq): tmp=[base for base in seq if base ==&quot;G&quot; or base ==&quot;g&quot; or base == &quot;C&quot; or base == &quot;c&quot;] gcNumber=len(tmp) tmp2=[base for base in seq if base !=&quot;N&quot; and base !=&quot;n&quot;] allNumber=len(tmp2) return (gcNumber,allNumber)with open(sys.argv[1],&#x27;r&#x27;) as f: gcNum=0 allNum=0 for line in f: if line.startswith(&quot;&gt;&quot;): continue else: gc,alln=lineGC(line.strip(&quot;\\n&quot;)) gcNum=gcNum+gc allNum=allNum+allnprint(&quot;GC content: &#123;:.3f&#125;&quot;.format(gcNum/allNum)) è¿è¡Œæ—¶é—´æµ‹è¯•python julia perl æ€»ç»“ç»“æœä»¤äººå’‹èˆŒï¼Œå¯ä»¥ä»sysæ—¶é—´çœ‹å‡ºæ¥pythonå’Œperléƒ½æ˜¯ç«‹é©¬å¯åŠ¨ï¼Œè€Œjuliaåœ¨å‡½æ•°çš„å³æ—¶ç¼–è¯‘ä¸ŠèŠ±äº†ä¸€ç‚¹æ—¶é—´ï¼ˆä¸€åŠæ—¶é—´ï¼‰ã€‚ æ€»ä½“ç”¨æ—¶ä¸Šï¼Œjuliaä»…æ¯”perlå¿«äº†1ç§’ï¼Œè€Œpythonå´ç”¨äº†æƒŠäººçš„9åˆ†é’Ÿï¼ŒğŸ˜­ åè®°python ä¹Ÿä¸æ˜¯è¿™ä¹ˆä¸å ªï¼Œæƒ³è¦æé€Ÿè¿˜æ˜¯å¯ä»¥æœ‰å¾ˆå¤šåŠæ³•çš„ï¼Œæ¯”å¦‚åˆ‡æ¢pypy, æˆ–è€…ä¹Ÿç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š import sysimport redef lineGC(seq): pattern_1 = re.compile(r&quot;G|C&quot;,re.I) pattern_2 = re.compile(r&quot;N&quot;,re.I) gcNumber=len(pattern_1.findall(seq)) allNumber=len(seq)-len(pattern_2.findall(seq)) return (gcNumber,allNumber)with open(sys.argv[1],&#x27;r&#x27;) as f: gcNum=0 allNum=0 for line in f: if line.startswith(&quot;&gt;&quot;): continue else: gc,alln=lineGC(line.strip(&quot;\\n&quot;)) gcNum=gcNum+gc allNum=allNum+allnprint(&quot;GC content: &#123;:.3f&#125;&quot;.format(gcNum/allNum)) è¿™æ ·è®¡ç®—ä¸‹æ¥ï¼Œå¤§æ¦‚éœ€è¦6åˆ†20ç§’ï¼Œæé€Ÿäº†ä¸€åŠ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨NumPyçš„å‘é‡åŒ–è¿ç®—æ¥æé€Ÿ import sysfrom pyfaidx import Fastaimport numpy as npdef lineGC(seq): gc_number = np.where((seq==b&#x27;G&#x27;)|(seq==b&#x27;C&#x27;)|(seq==b&#x27;g&#x27;)|(seq==b&#x27;c&#x27;))[0].shape[0] n_number = np.where((seq==b&#x27;N&#x27;)|(seq==b&#x27;n&#x27;))[0].shape[0] allnumber = seq.shape[0] - n_number return (gc_number,allnumber)def calGC(fs): GC = 0 all = 0 hg38 = Fasta(fs) for record in hg38: seq = np.asarray(record) gc_number,all_number=lineGC(seq) GC = GC + gc_number all = all + all_number return (GC, all)if __name__ == &quot;__main__&quot;: gcNum, allNum = calGC(sys.argv[1]) print(&quot;GC content: &#123;:.3f&#125;&quot;.format(gcNum/allNum)) è¿™æ ·çš„è¯ï¼Œå°±åªéœ€è¦2åˆ†22ç§’äº†ï¼Œå·²ç»æ˜¯éå¸¸å¿«çš„äº†ï¼Œä½†æ˜¯å’Œperlè¿˜æ˜¯æœ‰å·®è·çš„ã€‚ æœ€åï¼Œéš¾é“juliaçœŸçš„é€Ÿåº¦å’Œperlå°±ç›¸å·®æ— å‡ å—? ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºjuliaè®¾è®¡æ˜¯ä¸ºäº†ç§‘å­¦è®¡ç®—çš„ï¼Œä½†æ˜¯å…¶å­—ç¬¦ä¸²çš„æ€§èƒ½å¹¶ç®—ä¸ä¸Šä¼˜ç§€ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨BioSequenceæ¥å¤„ç†ç”Ÿç‰©åºåˆ— using BioSequencesusing FASTXfunction lineGC(seq) GCnumber=count(x-&gt;(x==DNA_G||x==DNA_C),seq) lineNum=length(seq)-count(isambiguous,seq) GCnumber,lineNumendfunction calGC(fs) GCnumber=zero(Int) lineNum=zero(Int) reader=open(FASTA.Reader,fs) for record in reader GC,all=lineGC(FASTA.sequence(record)) GCnumber+=GC lineNum+=all end close(reader) round(GCnumber/lineNum;digits=3)endprintln(&quot;GC content: &quot;,calGC(ARGS[1])) è¿™æ ·å°±åªéœ€è¦11ç§’å°±å¯ä»¥è®¡ç®—å‡ºç­”æ¡ˆäº†","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"},{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"}],"author":"Xiaoguang Pan"},{"title":"ç”¨streamlitæ­å»ºæ•°æ®äº¤äº’å¼app","slug":"ç”¨streamlitæ­å»ºæ•°æ®äº¤äº’å¼app","date":"2024-09-20T01:50:21.000Z","updated":"2024-10-18T05:33:19.179Z","comments":true,"path":"streamlit-app/","permalink":"https://xiaohanys.top/streamlit-app/","excerpt":"streamlitçš„æœ‰è¶£ç‰¹ç‚¹ æ‰€æœ‰çš„ç¨‹åºï¼Œåªè¦æ˜¯å‰ç«¯äº¤äº’é¡µé¢å‘ç”Ÿå˜åŠ¨æˆ–è€…è¯´äº¤äº’ï¼Œä»£ç å°±ä¼šä»å¤´åˆ°å°¾æ‰§è¡Œä¸€é æä¾›äº†éå¸¸å¤šæ•°æ®äº¤äº’çš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¿”å›æ•°å€¼ï¼Œç”¨æ¥å’Œåˆ«çš„ç»„ä»¶äº¤æµ æœ‰ç‰¹æ®Šçš„ç¼“å­˜ç³»ç»Ÿï¼Œé˜²æ­¢é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºæˆä¸ºç“¶é¢ˆ å› ä¸ºç¨‹åºä»å¤´è‡³å°¾çš„é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥çš„æ”¯æŒè¾ƒå·®","text":"streamlitçš„æœ‰è¶£ç‰¹ç‚¹ æ‰€æœ‰çš„ç¨‹åºï¼Œåªè¦æ˜¯å‰ç«¯äº¤äº’é¡µé¢å‘ç”Ÿå˜åŠ¨æˆ–è€…è¯´äº¤äº’ï¼Œä»£ç å°±ä¼šä»å¤´åˆ°å°¾æ‰§è¡Œä¸€é æä¾›äº†éå¸¸å¤šæ•°æ®äº¤äº’çš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¿”å›æ•°å€¼ï¼Œç”¨æ¥å’Œåˆ«çš„ç»„ä»¶äº¤æµ æœ‰ç‰¹æ®Šçš„ç¼“å­˜ç³»ç»Ÿï¼Œé˜²æ­¢é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºæˆä¸ºç“¶é¢ˆ å› ä¸ºç¨‹åºä»å¤´è‡³å°¾çš„é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥çš„æ”¯æŒè¾ƒå·® æ­å»ºä¸€ä¸ªå°å‹demoä¸»é¡µ1 ä¸»é¡µ2 ä¸»è¦åŠŸèƒ½ä¸‹æœºæ•°æ®çš„æ–‡ä»¶åå­—å¾€å¾€éƒ½æ˜¯é€šè¿‡barcodeåŒºåˆ†çš„ï¼Œè€Œæˆ‘ä»¬åˆ†æçš„æ—¶å€™éœ€è¦æŒ‰ç…§æ ·æœ¬ä¸ºå…¶å‘½åï¼Œè¿™æ ·æ›´æ–¹ä¾¿ï¼Œä¹Ÿä¸å®¹æ˜“æé”™ã€‚ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•ä¾¿æ˜¯ç”¨åˆ—è¡¨ä¸­çš„æ ·æœ¬è‡ªåŠ¨ç”Ÿæˆæ–°çš„æ–‡ä»¶åï¼Œå¹¶è‡ªåŠ¨æä¾›æ•°æ®æ‹·è´æŒ‡ä»¤ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼šå¦‚æœåœ¨ä¸€ä¸ªlaneä¸Šæµ‹åºé‡ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°åŠ æµ‹çš„æƒ…å†µï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€ä¸ªæ ·æœ¬åä¼šå¯¹åº”å¤šä¸ªæ–‡ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œæ ·æœ¬ååˆ—æœ‰å†—ä½™ï¼Œéœ€è¦æˆ‘ä»¬æ³¨æ„ã€‚ æ‰€ä»¥æ­å»ºè¿™ä¸ªappçš„ç›®çš„æ˜¯ï¼šé€šè¿‡uploadä¸€ä¸ªåŒ…å«æµ‹åºä¸‹æœºè·¯å¾„æ•°æ®çš„excelè¡¨æ ¼ï¼Œè®¾ç½®éœ€è¦è·å–çš„ä¿¡æ¯æ‰€åœ¨çš„åˆ—ç´¢å¼•ï¼Œæœ¬appè‡ªåŠ¨æŠŠæå–åçš„æ•°æ®å±•ç¤ºåœ¨ç½‘é¡µè¡¨æ ¼ä¸­ã€‚ç„¶åï¼Œåœ¨ç¬¬äºŒä¸ªtabä¸­è‡ªåŠ¨æŠŠæ•°æ®æ‰€éœ€è¦çš„æ‹·è´æŒ‡ä»¤ç”Ÿæˆå‡ºæ¥ã€‚ è¿™é‡Œå¯¹å¾…å†—ä½™æ ·æœ¬ç”¨äº†å¾ˆç®€å•çš„é€»è¾‘ï¼Œæ—¢è‡ªåŠ¨ç”Ÿæˆ_1,_2â€¦åç¼€ã€‚ ç›´æ¥ä¸Šä»£ç ### streamlit_app/main.pyimport streamlit as stimport pandas as pdimport os st.set_page_config( page_title=&quot;Excel toolkits&quot;, layout=&quot;wide&quot;)@st.cache_datadef read_data(upload_file): # Read the uploaded file into a dataframe df = pd.read_excel(upload_file) # Rename the columns df.columns = [&quot;n&quot;+str(i+1) for i in range(df.shape[1])] # Fill missing values with empty string df = df.fillna(&#x27;&#x27;) return dfdef read_data2(upload_file): # Read the file into a Pandas dataframe duiying = pd.read_excel(upload_file) # Rename the columns duiying.columns = [&quot;sampleName&quot;,&quot;trueName&quot;] return duiying# This code makes sure that all of the names in the dataframe are unique by adding a number at the end of each name that is not unique.# The code also adds a number at the end of each name that is unique, but not the first one.def makenames(df,col): s=&#x27;_&#x27;+df.groupby(col).cumcount().add(1).astype(str) df.loc[:,col]+=s.mask(s==&quot;_1&quot;,&quot;&quot;) return df## Add a titlest.title(&quot;Excel tools for Glims&quot;)## Split the page into 2 columnscol1, col2 = st.columns([0.35,0.65],gap=&quot;medium&quot;)## è¿™ä¸ªæ˜¯å·¦è¾¹çš„æ ç›®with col1: ###ç»„ä»¶æ•°æ®äº¤äº’ upload_data = st.file_uploader(label=&quot;Excel file from Glims...&quot;, type=[&#x27;xlsx&#x27;,&#x27;xls&#x27;]) SM_index = st.number_input(label=&quot;Index for sampleName:&quot;, min_value=1, max_value=62, value=4) BC_index = st.number_input(label=&quot;Index for barcode:&quot;, min_value=1, max_value=62, value=23) CP_index = st.number_input(label=&quot;Index for chip:&quot;, min_value=1, max_value=62, value=27) LN_index = st.number_input(label=&quot;Index for lane:&quot;, min_value=1, max_value=62, value=28) Path_index = st.number_input(label=&quot;Index for DataPath:&quot;, min_value=1, max_value=62, value=48) Remote_path = st.text_input(label=&quot;Remote path:&quot;, value=&quot;10.2.100.1:/pakpox/pob8d1/&quot;, max_chars=1000) isSubmit = st.button(&quot;Submit!&quot;) st.divider() placeholder = st.empty() upload_data2 = st.file_uploader(label=&quot;Input Barcode with sampleName:&quot;, type=[&#x27;xlsx&#x27;,&#x27;xls&#x27;])### è¿™ä¸ªæ˜¯å³è¾¹çš„æ ç›®with col2: ### åˆ†ä¸¤ä¸ªtab tab1, tab2 = st.tabs([&quot;ViewData&quot;, &quot;Scipts&quot;]) tab21, tab22 = tab2.tabs([&quot;Script1&quot;, &quot;Script2&quot;]) ### containeræ˜¯å®¹å™¨å ä½ç¬¦ï¼Œä½œç”¨æ˜¯å¯ä»¥æŠŠåé¢è¿è¡Œçš„å‘½ä»¤å¾—åˆ°çš„ç»“æœæ”¾åˆ°ä¸€ä¸ªå®¹å™¨é‡Œé¢æ¸²æŸ“åœ¨å‰é¢å» upcontent = tab1.container() upcontent.subheader(&quot;View of the data:&quot;) if upload_data is not None: ###è¿™ä¸ªåˆ¤æ–­å¾ˆé‡è¦ï¼Œä¸ç„¶ä¼šæŠ¥é”™ ###è¿™æ˜¯ä¸€ä¸ªç¼“å­˜å‡½æ•° dataframes = read_data(upload_data) df = dataframes.iloc[:,[SM_index-1,BC_index-1,CP_index-1,LN_index-1,Path_index-1]] df.columns = [&quot;sampleName&quot;, &quot;barcode&quot;, &quot;chip&quot;, &quot;lane&quot;, &quot;dataPath&quot;] ## if sampleName is duplicated, fix the name if df.sampleName.duplicated().any(): tab1.warning(&quot;Duplicated sampleName found, fixing...&quot;) df = makenames(df,&quot;sampleName&quot;) ### upload2çš„ä½œç”¨æ˜¯ï¼Œæœ‰çš„excelæ–‡ä»¶å¹¶æ²¡æœ‰æ ·æœ¬ååˆ—ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ·æœ¬åå’Œbarcodeå¯¹åº”å…³ç³»ï¼Œéœ€è¦æˆ‘ä»¬æäº¤åå†æ¬¡ä¸Šä¼  if upload_data2 is not None: placeholder.info(&quot;After upload data, please click the button again!&quot;) df2 = read_data2(upload_data2) df = df.merge(df2,how=&quot;left&quot;,on=&quot;sampleName&quot;) df = df.drop(columns=[&quot;sampleName&quot;]) df = df.rename(columns=&#123;&quot;trueName&quot;:&quot;sampleName&quot;&#125;) df = df[~df[&quot;sampleName&quot;].isna()] ### è¿™ä¸ªåˆ¤æ–­å¯¼è‡´å»¶è¿Ÿæ‰§è¡Œï¼Œæ¯æ¬¡æ›´æ–°æ•°æ®åï¼Œåªæœ‰é‡æ–°ç‚¹å‡»æäº¤æŒ‰é’®æ‰ä¼šé‡æ–°æ‰§è¡Œ if isSubmit: upcontent.dataframe(df,hide_index=True,height=600) df = df.assign(filename1=df.apply(lambda row : &quot;_&quot;.join([row[&#x27;chip&#x27;],row[&#x27;lane&#x27;],str(row[&#x27;barcode&#x27;]),&quot;1.fq.gz&quot;]),axis=1)) df = df.assign(filename2=df.apply(lambda row : &quot;_&quot;.join([row[&#x27;chip&#x27;],row[&#x27;lane&#x27;],str(row[&#x27;barcode&#x27;]),&quot;2.fq.gz&quot;]),axis=1)) cmd1 = df.apply(lambda row: &quot;scp &quot; + os.path.join(row[&#x27;dataPath&#x27;],row[&#x27;filename1&#x27;]) + &quot; &quot; + os.path.join(Remote_path,row[&#x27;sampleName&#x27;] + &quot;_R1.fastq.gz&quot;),axis=1).tolist() cmd2 = df.apply(lambda row: &quot;scp &quot; + os.path.join(row[&#x27;dataPath&#x27;],row[&#x27;filename2&#x27;]) + &quot; &quot; + os.path.join(Remote_path,row[&#x27;sampleName&#x27;] + &quot;_R2.fastq.gz&quot;),axis=1).tolist() tab21.code(&quot;\\n&quot;.join(cmd1)) tab22.code(&quot;\\n&quot;.join(cmd2)) æ€»ç»“è¿™ä¸ªå°demoç”¨åˆ°äº†ä¸å°‘çŸ¥è¯†ç‚¹ å‡½æ•°å‰é¢åŠ @st.cache_dataå¯ä»¥èµ·åˆ°ç¼“å­˜ä½œç”¨ å› ä¸ºstreamlitæ˜¯ä»å¤´åˆ°å°¾çš„æ‰§è¡Œï¼Œæ‰€ä»¥ifåˆ¤æ–­å¾ˆé‡è¦ï¼Œä¾‹å¦‚upload2å…¶å®ä»é€»è¾‘ä¸Šæ˜¯æœ€åæ‰§è¡Œçš„ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªç‰¹æ€§åŠ åœ¨äº†ä»£ç å‰é¢ é€šå¸¸æˆ‘ä»¬åŠ è½½æ•°æ®åï¼Œéƒ½ä¼šæœ‰ä¿¡æ¯çš„æç¤ºï¼Œä¾‹å¦‚â€œæ•°æ®åŠ è½½æˆåŠŸâ€ï¼Œâ€œæ£€æµ‹åˆ°å†—ä½™ï¼â€ç­‰ã€‚ç„¶åstreamlitéš¾ä»¥å®ç°å¼‚æ­¥ï¼Œå¯¼è‡´è¦ä¹ˆè¯¥æç¤ºä¸€é—ªè€Œè¿‡ï¼Œè¦ä¹ˆå°±æ°¸ä¹…ç•™åœ¨é¡µé¢ä¸Šï¼Œä¸ç„¶ä¼šå¯¹åé¢è¿è¡Œçš„ç¨‹åºå¸¦æ¥å½±å“ã€‚æ‰€ä»¥containerå¯ä»¥å½“ä½œå ä½ç¬¦ï¼ŒæŠŠæƒ³è¦æ¸²æŸ“çš„ç»„ä»¶å…ˆäºé€»è¾‘æ”¾åœ¨å‰ç«¯ ä¸‹ä¸€ç¯‡é¢„å‘Šstreamlitæ˜¯ä¸€ä¸ªå¿«é€Ÿæ­å»ºç½‘é¡µå°ç¨‹åºçš„å·¥å…·ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°ï¼Œç›®å‰ä¸€ä¸ªå¾ˆç®€å•çš„éœ€æ±‚ï¼Œå®ç°èµ·æ¥éƒ½æœ‰é‡é‡é™åˆ¶ã€‚è€Œä¸”å…¶å¼‚æ­¥çš„éš¾ä»¥å®ç°æ›´æ˜¯è®©ç”¨æˆ·ä½“éªŒéå¸¸ç³Ÿç³•ã€‚ ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºäºnext.jså’ŒChakra UIçš„reflexæ¥å†æ¬¡æ­å»ºè¯¥ç½‘é¡µå°ç¨‹åºã€‚çœ‹çœ‹æ€§èƒ½ä¼šæœ‰æå‡ä¹ˆï¼Ÿ","categories":[{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://xiaohanys.top/tags/%E5%89%8D%E7%AB%AF/"}],"author":"Xiaoguang Pan"},{"title":"çŒªçš„stopæ•°æ®åº“èŠ¯ç‰‡æ„å»º","slug":"çŒªçš„stopæ•°æ®åº“èŠ¯ç‰‡æ„å»º","date":"2020-05-13T06:25:13.000Z","updated":"2024-10-18T05:33:29.700Z","comments":true,"path":"pig-stop-chip/","permalink":"https://xiaohanys.top/pig-stop-chip/","excerpt":"é¡¹ç›®ç›®çš„ åˆ©ç”¨CBEçš„ç¢±åŸºç¼–è¾‘èƒ½å°†æ­£å¸¸æ°¨åŸºé…¸å¯†ç å­è½¬æ¢æˆç»ˆæ­¢å¯†ç å­çš„æ€§èƒ½ï¼Œè®¾è®¡å‡ºé’ˆå¯¹äººç±»ã€çŒªã€å°é¼ çš„å…¨éƒ¨åŸºå› çš„CBE-STOPèŠ¯ç‰‡ã€‚é€šè¿‡TRAPç³»ç»Ÿçš„ç»†èƒå†…æµ‹è¯•ï¼Œæ£€æµ‹åˆ†ææ‰€æœ‰gRNAä»‹å¯¼çš„STOPæ•ˆç‡ï¼Œæœ€ç»ˆå»ºç«‹äººç±»ã€çŒªã€å°é¼ çš„CBE-STOPçš„gRNAæ•ˆç‡æ•°æ®åº“ï¼Œä¾›åšbase-editingç›¸å…³ç ”ç©¶çš„ç§‘ç ”äººå‘˜ä½¿ç”¨ã€‚","text":"é¡¹ç›®ç›®çš„ åˆ©ç”¨CBEçš„ç¢±åŸºç¼–è¾‘èƒ½å°†æ­£å¸¸æ°¨åŸºé…¸å¯†ç å­è½¬æ¢æˆç»ˆæ­¢å¯†ç å­çš„æ€§èƒ½ï¼Œè®¾è®¡å‡ºé’ˆå¯¹äººç±»ã€çŒªã€å°é¼ çš„å…¨éƒ¨åŸºå› çš„CBE-STOPèŠ¯ç‰‡ã€‚é€šè¿‡TRAPç³»ç»Ÿçš„ç»†èƒå†…æµ‹è¯•ï¼Œæ£€æµ‹åˆ†ææ‰€æœ‰gRNAä»‹å¯¼çš„STOPæ•ˆç‡ï¼Œæœ€ç»ˆå»ºç«‹äººç±»ã€çŒªã€å°é¼ çš„CBE-STOPçš„gRNAæ•ˆç‡æ•°æ®åº“ï¼Œä¾›åšbase-editingç›¸å…³ç ”ç©¶çš„ç§‘ç ”äººå‘˜ä½¿ç”¨ã€‚ ç®—æ³• æ‰¾å‡ºhumanã€pigã€mouseçš„æ‰€æœ‰å·²çŸ¥åŸºå› åŠå…¶å…¨é•¿åºåˆ—ï¼Œå»ºç«‹3ä¸ªåŸºå› æ•°æ®é›†ï¼ˆæ‰€æœ‰protein coding geneï¼Œä¸åŒ…å«éç¼–ç RNAåŸºå› ï¼‰,è¿™é‡Œç›´æ¥ä½¿ç”¨ç‰©ç§çš„exonåºåˆ—å³å¯ï¼› æå–æ‰€æœ‰åŸºå› çš„å‰3ä¸ªexonï¼Œå¦‚æœåªæœ‰1-3ä¸ªexonçš„ï¼Œä¿ç•™æ‰€æœ‰exon(éœ€è¦è¿‡æ»¤æ‰åœ¨UTRä¸Šçš„å¤–æ˜¾å­ï¼Œè¿˜éœ€è¦è¿‡æ»¤æ‰å¤–æ˜¾å­é•¿åº¦å°äº23bpçš„)ï¼› æ‰¾å‡ºå‰3ä¸ªå¤–æ˜¾å­ä¸­æ‰€æœ‰æ­£ä¹‰å’Œåä¹‰é“¾ä¸Šçš„gRNAï¼ˆ20 bpåºåˆ—). åšä¸€å®šç¨‹åº¦çš„è¿‡æ»¤ï¼š å»é™¤23bpä¸­æœ‰BsmBIï¼ˆ5â€˜-CGTCTC-3â€˜ï¼Œ5â€˜-GAGACG-3â€˜ï¼‰é…¶åˆ‡ä½ç‚¹çš„gRNA å»é™¤23bpä¸­æœ‰4ä¸ªåŠä»¥ä¸Šè¿ç»­Tçš„gRNA GC content(20bp)åœ¨40%~90%ä¹‹é—´ è®°å½•è„±é¶æ•°ç›® åœ¨æ¯æ¡å‰©ä½™çš„gRNAï¼ˆ4-8ï¼‰bpåºåˆ—ä¸Šå¯»æ‰¾CGAï¼ŒCAGï¼ŒCAAï¼ŒTGGï¼ˆåå‘äº’è¡¥ï¼‰ï¼Œå¹¶åˆ¤æ–­å…¶æ˜¯å¦ä¸ºæ½œåœ¨çš„ç»¼æ­¢å¯†ç å­ ç»„è£… å…·ä½“å®ç°æ­¥éª¤step_1è¿‡æ»¤å¤–æ˜¾å­,ä»Ensemblä¸Šè·å–æ‰€æœ‰ç¼–ç åŸºå› çš„æ‰€æœ‰å¤–æ˜¾å­åºeg:AllExonSeq.fa,å¤–æ˜¾å­ä¿¡æ¯eg:AllExonInfo.txté¦–å…ˆä»ä¿¡æ¯æ–‡ä»¶å…¥æ‰‹ï¼Œæ¯ä¸ªå¤–æ˜¾å­å»é™¤UTRéƒ¨åˆ†åŒæ—¶è¦ä¿è¯åºåˆ—é•¿åº¦æ˜¯å¤§äº23bpçš„å¹¶ä¸”åªä¿ç•™å‰3ä¸ªå¤–æ˜¾å­å¹¶å’Œåºåˆ—mergeåœ¨ä¸€èµ· é¦–å…ˆï¼Œç”¨Rç®€å•è¿‡æ»¤ä¿¡æ¯è¡¨æ ¼è¾ƒä¸ºæ–¹ä¾¿ library(readr)library(dplyr)exon &lt;- read_delim( &quot;AllExonInfo.txt&quot;, delim = &quot;\\t&quot;, col_names = FALSE, col_types = cols(&quot;n&quot;, &quot;n&quot;, &quot;c&quot;, &quot;n&quot;, &quot;n&quot;, &quot;c&quot;, &quot;n&quot;, &quot;n&quot;, &quot;c&quot;) )names(exon) &lt;- c( &quot;Exon region start (bp)&quot;, &quot;Exon region end (bp)&quot;, &quot;Gene name&quot;, &quot;5&#x27; UTR start&quot;, &quot;5&#x27; UTR end&quot;, &quot;Strand&quot;, &quot;3&#x27; UTR start&quot;, &quot;3&#x27; UTR end&quot;, &quot;Chromosome&quot; )##å…ˆå»æ‰UTR,åœ¨è¿‡æ»¤æ‰é•¿åº¦å°äº32bpçš„ï¼Œå»é‡ï¼ŒæŒ‰ç…§æ¯ä¸ªåŸºå› ä¿ç•™å‰3ä¸ªexonneed &lt;- exon %&gt;% filter(is.na(`5&#x27; UTR start`) | is.na(`3&#x27; UTR end`)) %&gt;% mutate( seqLength = `Exon region end (bp)` - `Exon region start (bp)` + 1, seqName = paste0( &quot;&gt;&quot;, `Gene name`, &quot;|&quot;, `Exon region start (bp)`, &quot;|&quot;, `Exon region end (bp)`, &quot;|&quot;, Strand ) ) %&gt;% filter(seqLength &gt; 32) %&gt;% distinct(seqName, .keep_all = TRUE) %&gt;% group_by(`Gene name`) %&gt;% slice(1:3) %&gt;% select(3, 9, 1, 2, 6, 11) %&gt;% arrange(Chromosome) %&gt;% ungroup()write.table( need, &quot;AllExonInfoTop3.txt&quot;, sep = &quot;\\t&quot;, row.names = FALSE, quote = FALSE) ç„¶åï¼Œç”¨pythonè„šæœ¬è¯»å–fastaåºåˆ—ï¼Œå¹¶åˆ©ç”¨pandasåº“å’Œä¿¡æ¯è¡¨æ•´åˆ import pandas as pdname_lst = []allseq_lst = []seq_lst = [&quot;test&quot;]with open(&quot;AllExonSeq.fa&quot;, &quot;r&quot;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): allseq_lst.append(&quot;&quot;.join(seq_lst)) seq_lst = [] name = line.strip(&quot;\\n&quot;) name_lst.append(name) else: seq_lst.append(line.strip(&quot;\\n&quot;))allseq_lst.remove(&quot;test&quot;)allseq_lst.append(seq_lst)df = pd.DataFrame(&#123;&quot;seqName&quot;: name_lst, &quot;sequence&quot;: allseq_lst&#125;)df2 = pd.read_csv(&quot;AllExonInfoTop3.txt&quot;, sep=&quot;\\t&quot;, header=0)df = df.set_index(&quot;seqName&quot;)df2 = df2.set_index(&quot;seqName&quot;)df3 = df2.join(df, how=&quot;inner&quot;)df3 = df3.reset_index()df3.drop_duplicates(&quot;seqName&quot;, keep=&quot;first&quot;, inplace=True)df3.to_csv(&quot;exonWithAnno.txt&quot;, sep=&quot;\\t&quot;, index=None)ss = df3[&quot;seqName&quot;].tolist()sn = df3[&quot;sequence&quot;].tolist()with open(&quot;AllGeneTop3Exon.fa&quot;, &quot;a&quot;) as l: for name, seq in zip(ss, sn): l.write(&quot;&#123;&#125;\\n&#123;&#125;\\n&quot;.format(name, seq)) step_2exonåºåˆ—å°è°ƒè¿™é‡Œè·å–çš„åºåˆ—å¦‚æœæ˜¯åå‘åºåˆ—çš„è¯ï¼Œå°±ä¼šé€ æˆåæœŸå¯»æ‰¾gRNAçš„ä¸ä¾¿ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰çš„exonåºåˆ—è½¬æ¢ä¸ºç»Ÿä¸€çš„æ–¹å‘ import pandas as pddef complement(seq): return seq.translate(str.maketrans(&quot;ACGT&quot;, &quot;TGCA&quot;))def revcomp(seq): return complement(seq)[::-1]df = pd.read_csv(&quot;exonWithAnno.txt&quot;, sep=&quot;\\t&quot;, header=0)df2 = df[df[&quot;Strand&quot;] &lt; 0]df1 = df[df[&quot;Strand&quot;] &gt; 0]df2[&quot;sequence&quot;] = df2[&quot;sequence&quot;].apply(revcomp)fin = pd.concat([df1, df2], axis=0, ignore_index=True)ss = fin[&quot;seqName&quot;].tolist()nn = fin[&quot;sequence&quot;].tolist()with open(&quot;allexoninzhengliantop3.fa&quot;, &quot;a&quot;) as f: for name, seq in zip(ss, nn): f.write(f&quot;&#123;name&#125;\\n&#123;seq&#125;\\n&quot;) æ¥ç€ï¼Œå¤–æ˜¾å­åºåˆ—æ•°ç›®å·¨å¤§ï¼Œå¾ˆéš¾æ”¾åœ¨ä¸€èµ·å¯»æ‰¾gRNAï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å…ˆå°†è¯¥åºåˆ—æ‹†åˆ†ï¼Œæ¯åˆ†ç•™6000æ¡åºåˆ— seqkit split2 allexoninzhengliantop3.fa -s 6000 -f äº‹å®è¯æ˜ï¼Œåšè¿™ä¸€æ­¥åè€Œè®©åé¢çš„åˆ†æå˜å¾—éº»çƒ¦äº† step_3è¿è¡ŒFlashFryè½¯ä»¶å‘ç°æ‰€æœ‰çš„gRNAå¹¶æ‰“åˆ†ï¼Œé¦–å…ˆï¼Œè¦åœ¨ENSEMBLä¸Šä¸‹è½½å®Œæ•´çš„HG38åŸºå› ç»„å¹¶æ„å»ºç´¢å¼• axel -n 50 ftp://ftp.ensembl.org/pub/release-100/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa.gzmv Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa.gz hg38.fajava -Xmx4g -jar /dellfsqd2/ST_LBI/USER/panxiaoguang/app/FlashFry/bin/flashfry \\ index \\ --tmpLocation ./GranTmp \\ --database hg38 \\ --reference ./hg38.fa \\ --enzyme spcas9ngg ç„¶åï¼Œåˆ†åˆ«å¯¹10ä»½åºåˆ—è®¾è®¡gRNAå¹¶æ‰“åˆ† java -Xmx10g -jar /dellfsqd2/ST_LBI/USER/panxiaoguang/app/FlashFry/bin/flashfry \\ discover \\ --database hg38 \\ --fasta ./test/allexoninzhengliantop3.fa.split/allexoninzhengliantop3.part_001.fa \\ --output hg38_exon.part_001.outjava -Xmx10g -jar /dellfsqd2/ST_LBI/USER/panxiaoguang/app/FlashFry/bin/flashfry \\ score \\ --input hg38_exon.part_001.out \\ --output hg38_exon.part_001.scored \\ --scoringMetrics doench2016cfd,moreno2015,rank,minot \\ --database hg38 step_4å¯¹æ‰“åˆ†ç»“æœåšåˆæ­¥è¿‡æ»¤ï¼Œä¸»è¦åŒ…æ‹¬GCå«é‡ï¼ŒBSMB1ä½ç‚¹ï¼Œ4ä¸ªä»¥ä¸Šè¿ç»­T ç”¨Rè¯­è¨€å†…ç½®å‡½æ•°å¯¹æ•°æ®è¡¨è¿‡æ»¤å¾ˆæ–¹ä¾¿,è¿™é‡Œé¢å¤–è·å–äº†gRNAçš„åŸºå› ï¼Œæ­£è´Ÿé“¾ä»¥åŠåœ¨åŸºå› ç»„ä¸Šçš„ä½ç½®ä¿¡æ¯ library(readr)library(dplyr)library(pystr)args = commandArgs(T)name_header&lt;-args[1]df &lt;- read_delim( pystr_format(&quot;&#123;1&#125;.scored&quot;,name_header), delim = &quot;\\t&quot;, col_types = cols( &quot;c&quot;, &quot;d&quot;, &quot;d&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot; ) )df2 &lt;- read_delim(&quot;./test/exonWithAnno.txt&quot;, delim = &quot;\\t&quot;)df2 &lt;- df2 %&gt;% select(`Gene name`, Chromosome) %&gt;% distinct(`Gene name`, .keep_all = TRUE)%&gt;%setNames(c(&quot;gene&quot;,&quot;chromosome&quot;))calGC &lt;- function(x) &#123; x &lt;- stringr::str_sub(x, 1, 20) stringr::str_count(x, &quot;[GC]&quot;) / 20&#125;df &lt;- df %&gt;% select(contig, start, stop, target, orientation, `0-1-2-3-4_mismatch`) %&gt;%##è®°å½•0-4bp mismatchtidyr::separate( `0-1-2-3-4_mismatch`, into = c(&quot;mis0&quot;, &quot;mis1&quot;, &quot;mis2&quot;, &quot;mis3&quot;, &quot;mis4&quot;), sep = &quot;,&quot; ) %&gt;%##è®¡ç®—gRNAåœ¨åŸºå› ç»„çš„èµ·å§‹å’Œç»“æŸä½ç‚¹mutate( genomestart = purrr::map_dbl(contig, function(x) as.numeric(unlist(strsplit( x, &quot;\\\\|&quot; ))[2])), genomestart = genomestart + start, genomeend = genomestart + 22 ) %&gt;%##æ ‡è®°æ­£è´Ÿé“¾mutate( strand = purrr::map_dbl(contig, function(x) as.numeric(unlist(strsplit( x, &quot;\\\\|&quot; ))[4])), strand = if_else(strand &gt; 0, &quot;+&quot;, &quot;-&quot;) ) %&gt;% mutate(gene = purrr::map_chr(contig, function(x) unlist(strsplit(x, &quot;\\\\|&quot;))[1])) %&gt;%##è®°å½•æ˜¯å¦å…·æœ‰BSMB1ä½ç‚¹mutate(bsmb1 = case_when( stringr::str_detect(target, &quot;CGTCTC&quot;) ~ TRUE, stringr::str_detect(target, &quot;GAGACG&quot;) ~ TRUE, TRUE ~ FALSE )) %&gt;%##è®°å½•æ˜¯å¦å…·æœ‰4ä¸ªä»¥ä¸Šçš„è¿ç»­Tmutate(nt = if_else(stringr::str_detect(target, &quot;TTTT+&quot;), TRUE, FALSE)) %&gt;%##è®°å½•GCå«é‡mutate(gcContent = purrr::map_dbl(target, function(x) calGC(x))) %&gt;% filter(bsmb1 == FALSE &amp; nt == FALSE &amp; gcContent &gt;= 0.4 &amp; gcContent &lt;= 0.9) %&gt;% select(-2, -3)df &lt;- df %&gt;% left_join(df2, by = &quot;gene&quot;)write.table( df, pystr_format(&quot;./tmp/&#123;1&#125;.first_filter.txt&quot;,name_header), sep = &quot;\\t&quot;, row.names = FALSE, quote = FALSE) step_5æœ€åä¸€æ­¥è¿‡æ»¤ï¼Œè¦æ±‚åœ¨gRNA4-8bpç©ºé—´å†…å…·æœ‰stopä½ç‚¹ï¼Œè¿™é‡Œé‡‡ç”¨pythonè„šæœ¬å»ä¸‹è½½å¥½çš„ATGå¼€å¤´çš„CDSåŸºå› é›†ä¸­åå‘MAPï¼Œæ­£åå‘ ** (è¿™é‡Œçš„æ­£åå‘ä¸æ˜¯åŸºå› çš„æ­£åå‘ï¼Œè€Œæ˜¯gRNAå’Œcdsæ–¹å‘çš„ä¸€è‡´æ€§ï¼Œå¦‚æœåŸºå› åœ¨æ­£é“¾ä¸Šï¼Œé‚£ä¹ˆgRNAæ­£å‘è®¾è®¡çš„ä¸ºé¡ºï¼Œåå‘è®¾è®¡ä¸ºé€†ï¼›å¦‚æœåŸºå› åœ¨è´Ÿé“¾ä¸Šï¼Œé‚£ä¹ˆgRNAæ­£å‘è®¾è®¡çš„ä¸ºé€†ï¼Œåå‘è®¾è®¡ä¸ºé¡º) ** gRNAè¦åˆ†åˆ«è¿ç®—ï¼Œæœ€åè·å–å¯ç”¨çš„gRNAå’Œå…¶å¯¹åº”çš„stop ä½ç‚¹ã€‚ä¸ºäº†åŠ é€Ÿæœ€åä¸€æ­¥è¿‡æ»¤ï¼Œåˆ†æˆä¸‰æ­¥å®Œæˆï¼Œæœ€æ ¸å¿ƒçš„ä¸€æ­¥é‡‡ç”¨pypy step_1.py import pandas as pdimport sysname_header = sys.argv[1]gRNA_filer = pd.read_csv(&quot;./tmp/&#123;&#125;.first_filter.txt&quot;.format(name_header), sep=&quot;\\t&quot;, header=0)gRNA_Z = gRNA_filer[((gRNA_filer[&quot;orientation&quot;] == &quot;FWD&quot;) &amp; (gRNA_filer[&quot;strand&quot;] == &quot;+&quot;)) | ((gRNA_filer[&quot;orientation&quot;] == &quot;RVS&quot;) &amp; (gRNA_filer[&quot;strand&quot;] == &quot;-&quot;))].reset_index()[[&#x27;gene&#x27;,&#x27;target&#x27;]]gRNA_F = gRNA_filer[((gRNA_filer[&quot;orientation&quot;] == &quot;RVS&quot;)&amp;(gRNA_filer[&quot;strand&quot;] == &quot;+&quot;)) | ((gRNA_filer[&quot;orientation&quot;] == &quot;FWD&quot;)&amp;(gRNA_filer[&quot;strand&quot;] == &quot;-&quot;))].reset_index()[[&#x27;gene&#x27;,&#x27;target&#x27;]]gRNA_Z.to_csv(&quot;./tmp/&#123;&#125;.part_1.txt&quot;.format(name_header), sep=&quot;\\t&quot;, index=None, header=None)gRNA_F.to_csv(&quot;./tmp/&#123;&#125;.part_2.txt&quot;.format(name_header), sep=&quot;\\t&quot;, index=None, header=None) step_2.py import reimport sysname_header = sys.argv[1]def read_cds(fs): name_lst = [] seq_lst=[] with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) name_lst.append(name) else: seq_lst.append(line.strip(&quot;\\n&quot;)) fin=[(key,value) for key,value in zip(name_lst,seq_lst) if &#x27;unavailable&#x27; not in value] return findef complement(seq): return seq.translate(str.maketrans(&#x27;ACGT&#x27;, &#x27;TGCA&#x27;))def revcomp(seq): return complement(seq)[::-1]def motif_Z(gRNA, site): if gRNA[:20][site: site + 3] == &quot;CAG&quot;: return &quot;CAG&quot; elif gRNA[:20][site: site + 3] == &quot;CGA&quot;: return &quot;CGA&quot; elif gRNA[:20][site: site + 3] == &quot;CAA&quot;: return &quot;CAA&quot; else: return 0def stop_test_for_Z(n, cds_lst, gRNA): new_cds_lst = [cds for cds in cds_lst if gRNA in cds] score_lst = [] if len(new_cds_lst) &gt; 0: for haha in new_cds_lst: m = haha.find(gRNA) + 1 score = (m - 1 + n - 1) score_lst.append(score) if len([new_score for new_score in score_lst if score % 3 == 0]) &gt; 0: return 1 else: return 0 else: return 0def motif_F(gRNA, site): if gRNA[:20][site: site + 3] == &quot;CCA&quot;: return 1 elif gRNA[:20][site-1: site + 2] == &quot;CCA&quot;: return 2 else: return 0def stop_test_for_F(n, cds_lst, gRNA): gRNA = revcomp(gRNA) new_cds_lst = [cds for cds in cds_lst if gRNA in cds] score_lst = [] if len(new_cds_lst) &gt; 0: for haha in new_cds_lst: m = haha.find(gRNA) + 1 - 1 + 23 score = (m - n) score_lst.append(score) if len([new_score for new_score in score_lst if score % 3 == 0]) &gt; 0: return 1 else: return 0 else: return 0def detective_Z(gRNA, Gene): #cds_lst=all_cds[all_cds[&#x27;Gene&#x27;]==Gene][&#x27;seq&#x27;].tolist() cds_lst=[value for (key,value) in all_cds if key==Gene] stopSitelst=[] for m in re.finditer(&quot;C&quot;, gRNA[:20]): if m.start() + 1 &gt;= 4 and m.start() + 1 &lt;= 8: if motif_Z(gRNA, m.start()): if stop_test_for_Z((m.start() + 1), cds_lst, gRNA): stopSitelst.append(str(m.start() + 1)) if len(stopSitelst) &gt; 0: fin=&quot;/&quot;.join(stopSitelst) else: fin=&quot;None&quot; return findef detective_F(gRNA, Gene): #cds_lst=all_cds[all_cds[&#x27;Gene&#x27;]==Gene][&#x27;seq&#x27;].tolist() cds_lst=[value for (key,value) in all_cds if key==Gene] stopSitelst=[] for m in re.finditer(&quot;C&quot;, gRNA[:20]): if m.start() + 1 &gt;= 4 and m.start() + 1 &lt;= 8: if motif_F(gRNA, m.start()): if stop_test_for_F(((gRNA[:20][m.start() - 1 : m.start() + 3]).find(&quot;CCA&quot;) + 1 + 2), cds_lst, gRNA): stopSitelst.append(str(m.start() + 1)) if len(stopSitelst) &gt; 0: fin=&quot;/&quot;.join(stopSitelst) else: fin=&quot;None&quot; return finall_cds = read_cds(&quot;AllGeneCDS2.fa&quot;)shunshi=[]with open(&quot;./tmp/&#123;&#125;.part_1.txt&quot;.format(name_header),&#x27;r&#x27;) as f: for line in f: gene,target=line.split(&quot;\\t&quot;) target=target.strip(&quot;\\n&quot;) shunshi.append((gene,target))new_lst=[(key,value,detective_Z(value,key)) for (key,value) in shunshi]with open(&quot;./tmp/&#123;&#125;.shunshi.out&quot;.format(name_header),&quot;a&quot;) as f: for (gene,target,site) in new_lst: f.write(&quot;&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\n&quot;.format(gene,target,site))fanshi=[]with open(&quot;./tmp/&#123;&#125;.part_2.txt&quot;.format(name_header),&#x27;r&#x27;) as f: for line in f: gene,target=line.split(&quot;\\t&quot;) target=target.strip(&quot;\\n&quot;) fanshi.append((gene,target))new_lst2=[(key,value,detective_F(value,key)) for (key,value) in fanshi]with open(&quot;./tmp/&#123;&#125;.fanshi.out&quot;.format(name_header),&quot;a&quot;) as f: for (gene,target,site) in new_lst2: f.write(&quot;&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\n&quot;.format(gene,target,site)) step_3.py import pandas as pdimport sysname_header = sys.argv[1]df1 = pd.read_csv(&quot;./tmp/&#123;&#125;.shunshi.out&quot;.format(name_header), sep=&quot;\\t&quot;, header=None)df2 = pd.read_csv(&quot;./tmp/&#123;&#125;.fanshi.out&quot;.format(name_header), sep=&quot;\\t&quot;, header=None)fin = pd.concat([df2, df1], ignore_index=True)fin.columns = [&#x27;gene&#x27;, &#x27;target&#x27;, &#x27;site&#x27;]fin2 = fin[fin[&#x27;site&#x27;] != &quot;None&quot;]fin2.to_csv(&quot;./tmp/&#123;&#125;.second_filter.txt&quot;.format(name_header),sep=&quot;\\t&quot;,index=None) æœ€åæ•´åˆçš„shellä¸ºï¼š #!/usr/bin/bash name_header=&quot;hg38_exon.part_001&quot;/dellfsqd2/ST_LBI/USER/panxiaoguang/app/miniconda3/envs/Rlibs2/bin/Rscript first_filter.R $name_headerecho &quot;first filter Done! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot; echo &quot;first step: cut into two groups! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot; /dellfsqd2/ST_LBI/USER/panxiaoguang/app/miniconda3/envs/pylibs/bin/python3 step_1.py $name_headerecho &quot;step1 done! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot;echo &quot;second step: filter stop condon site! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot; /dellfsqd2/ST_LBI/USER/panxiaoguang/app/miniconda3/envs/pypy/bin/pypy3 step_2.py $name_headerecho &quot;step2 done! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot;echo &quot;second step: merge data! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot; /dellfsqd2/ST_LBI/USER/panxiaoguang/app/miniconda3/envs/pylibs/bin/python3 step_3.py $name_headerecho &quot;ALL done! $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)&quot;csvtk -t join -f &quot;gene,target&quot; ./tmp/$&#123;name_header&#125;.second_filter.txt ./tmp/$&#123;name_header&#125;.first_filter.txt --left-join \\ |csvtk -t cut -f gene,target,site,strand,orientation,chromosome,genomestart,genomeend,mis0,mis1,mis2,mis3,mis4,gcContent \\ |csvtk pretty &gt; ./tmp/$&#123;name_header&#125;.finally.txt /dellfsqd2/ST_LBI/USER/panxiaoguang/app/miniconda3/envs/Rlibs2/bin/Rscript getbed.R $name_headerbedtools getfasta -fi hg38.fa -bed ./tmp/$&#123;name_header&#125;.bed -name -tab -s -fo ./tmp/$&#123;name_header&#125;.trap.fa ç»„è£…library(readr)library(dplyr)library(pystr)library(purrr)library(openxlsx)merge_data&lt;-function(x)&#123; name_header&lt;-pystr_format(&quot;hg38_exon.part_0&#123;1&#125;&quot;,x) df1&lt;-read_delim(pystr_format(&quot;&#123;1&#125;.finally.txt&quot;,name_header),delim=&quot;\\t&quot;) df2&lt;-read_delim(pystr_format(&quot;&#123;1&#125;.trap.fa&quot;,name_header),delim=&quot;\\t&quot;,col_names=FALSE) names(df2)&lt;-c(&quot;gene&quot;,&quot;trapSeq&quot;) fin&lt;-bind_cols(df1,df2[&#x27;trapSeq&#x27;])&#125;fs_lst&lt;-c(&quot;01&quot;,&quot;02&quot;,&quot;03&quot;,&quot;04&quot;,&quot;05&quot;,&quot;06&quot;,&quot;07&quot;,&quot;08&quot;,&quot;09&quot;,&quot;10&quot;)test&lt;-map_dfr(fs_lst,merge_data)wocao&lt;-test%&gt;% transmute(Gene=gene, Target=target, TrapSeq=trapSeq, GeneStrand=strand, gRNAstrand=orientation, Loc=paste0(&quot;chr&quot;,chromosome,&quot;:&quot;,genomestart,&quot;-&quot;,genomeend), `Mismatch(0-1-2-3-4)`=paste0(mis0,&quot;-&quot;,mis1,&quot;-&quot;,mis2,&quot;-&quot;,mis3,&quot;-&quot;,mis4), GCcontent=gcContent, StopSite=site)%&gt;% arrange(Gene)wb &lt;- createWorkbook(&quot;test&quot;)addWorksheet(wb, &quot;humanstop&quot;)writeData(wb, sheet = &quot;humanstop&quot;, wocao, rowNames = FALSE)saveWorkbook(wb, &quot;HumanStopCBE.xlsx&quot;, overwrite = TRUE)","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"CRISPR","slug":"CRISPR","permalink":"https://xiaohanys.top/tags/CRISPR/"}],"author":"Xiaoguang Pan"},{"title":"åŸºå› æ²‰é»˜æ•ˆç‡è®¡ç®—æ–¹æ³•","slug":"åŸºå› æ²‰é»˜æ•ˆç‡è®¡ç®—æ–¹æ³•","date":"2020-02-28T08:20:39.000Z","updated":"2024-10-18T05:32:14.274Z","comments":true,"path":"gene-stop-eff/","permalink":"https://xiaohanys.top/gene-stop-eff/","excerpt":"å‰è¨€CrispråŸºå› ç¼–è¾‘æ­£è¶Šæ¥è¶Šå¹¿æ³›çš„åº”ç”¨åœ¨å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬ç§‘ç ”ï¼ŒåŒ»ç–—ç­‰ç­‰ï¼Œé’ˆå¯¹ç»è¿‡ç­›é€‰çš„è¯ç‰©é¶å‘åŸºå› è®¾è®¡gRNAï¼Œä½¿å…¶ç”±åŸå§‹çš„åŸºå› åºåˆ—çªå˜ä¸ºç»ˆæ­¢å¯†ç å­ï¼Œä»è€Œæ— æ³•è¡¨è¾¾è›‹ç™½ï¼Œè¿›è€Œæ²»ç–—ç–¾ç—…æˆ–è€…æŠµæŠ—è¯ç‰©","text":"å‰è¨€CrispråŸºå› ç¼–è¾‘æ­£è¶Šæ¥è¶Šå¹¿æ³›çš„åº”ç”¨åœ¨å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬ç§‘ç ”ï¼ŒåŒ»ç–—ç­‰ç­‰ï¼Œé’ˆå¯¹ç»è¿‡ç­›é€‰çš„è¯ç‰©é¶å‘åŸºå› è®¾è®¡gRNAï¼Œä½¿å…¶ç”±åŸå§‹çš„åŸºå› åºåˆ—çªå˜ä¸ºç»ˆæ­¢å¯†ç å­ï¼Œä»è€Œæ— æ³•è¡¨è¾¾è›‹ç™½ï¼Œè¿›è€Œæ²»ç–—ç–¾ç—…æˆ–è€…æŠµæŠ—è¯ç‰© ç®—æ³• åˆæ­¥è¿‡æ»¤ï¼š å°†12ktrapä¸­ï¼ŒN1-N20å†…C&gt;TæˆåŠŸçš„trapæå–å‡ºæ¥(æ‰€æœ‰ç¼–è¾‘åçš„readsï¼Œä¸åštrapçš„å»é‡)ï¼Œå®šä¹‰ä¸ºdataset#1 å°†dataset#1åˆ†æˆ2éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯gRNAåœ¨åŸºå› çš„æ­£ä¹‰é“¾ï¼ˆ+ï¼‰ä¸Šï¼Œå®šä¹‰ä¸ºdataset#1ï¼ˆ+ï¼‰ï¼Œå¦ä¸€éƒ¨åˆ†åœ¨åä¹‰é“¾ï¼ˆ-ï¼‰ä¸Šï¼Œå®šä¹‰ä¸ºdataset#1ï¼ˆ-ï¼‰ï¼› æ­£ä¹‰é“¾çš„æƒ…å†µï¼ˆCAG/CGA/CAA &gt; TAG/TGA/TAAï¼‰ï¼š æ‰¾å‡ºdataset#1ï¼ˆ+ï¼‰N1-N20ä¸­ C&gt;TæˆåŠŸçš„ä½ç½®ï¼Œå¹¶å¾€åæ¨2ä¸ªç¢±åŸºï¼Œåˆ¤æ–­å…¶æ˜¯å¦ä¸ºCAGæˆ–CGAæˆ–CAAï¼ˆç¼–è¾‘å‰ï¼‰ ï¼Œæ»¡è¶³å…¶ä¸€å³æŠ½æå‡ºæ¥ï¼Œå®Œæˆåå®šä¹‰ä¸ºdataset#2ï¼ˆ+ï¼‰ï¼ŒåŒæ—¶æ ‡è®°å‡ºçªå˜ä½ç‚¹åœ¨gRNAä¸­çš„ä½ç½®ï¼Œè­¬å¦‚N&#x3D;5, N&#x3D;6ç­‰ï¼› å°†dataset#2ï¼ˆ+ï¼‰ä¸­çš„gRNAï¼ˆä¸åŒ…å«æˆ‘ä»¬äººå·¥æ·»åŠ çš„ç¬¬ä¸€ä¸ªç¢±åŸºGï¼‰mappingå›å¯¹åº”åŸºå› çš„CDSä¸­ï¼Œæ•°å‡ºä»ATGï¼ˆç¿»è¯‘èµ·å§‹ä½ç½®ï¼‰çš„Aåˆ°gRNAç¬¬ä¸€ä¸ªç¢±åŸºçš„ç¢±åŸºæ•°Mï¼Œéšåç®—å‡º (M-1+N-1)&#x2F;3, åˆ¤æ–­ç»“æœæ˜¯å¦ä¸ºæ•´æ•°ï¼Œå¦‚æœæ˜¯æ•´æ•°ï¼Œåˆ¤æ–­è¯¥åŸºå› è¢«stopæˆåŠŸï¼Œè¾“å‡ºâ€TRAP ID + gRNA sequence + strand (+/-) + C&gt;T position + C&gt;T efficiencyâ€; ä¸¾ä¾‹è¯´æ˜4ï¼‰ä¸­ç®—æ³•ï¼šå¦‚N&#x3D;6, M&#x3D;11, åˆ™è¯´æ˜çªå˜ä½ç‚¹çš„Cè·ç¦»ATGä½ç½®æ˜¯10+5&#x3D;15ä¸ªç¢±åŸºï¼Œå³15&#x2F;3&#x3D;5ä¸ªæ°¨åŸºé…¸ï¼Œåˆ°çªå˜ä½ç‚¹ï¼ˆå¦‚CAGï¼‰æ°å¥½æ˜¯3çš„æ•´æ•°å€ï¼Œè¯¥åŸºå› è¢«stopæˆåŠŸï¼› åä¹‰é“¾çš„æƒ…å†µ(CCA &gt; TCA (TGA) / CTA(TAG) / TTA (TAA))ï¼š æ‰¾å‡ºdataset#1ï¼ˆ-ï¼‰N1-N20ä¸­ C&gt;TæˆåŠŸçš„ä½ç½®ï¼Œå¹¶åˆ¤æ–­å…¶æ˜¯å¦åœ¨CCAè¿™æ ·çš„motifä¸­ï¼ˆç¼–è¾‘å‰ï¼‰ï¼Œå¦‚æœåœ¨ï¼Œè¾“å‡ºtrapæ”¾åˆ°dataset#2ï¼ˆ-ï¼‰ä¸­ï¼Œå¹¶æ ‡è®°å‡ºCCA motifä¸­Aæ‰€åœ¨gRNAä¸­çš„ä½ç½®Nï¼Œè­¬å¦‚N&#x3D;5, N&#x3D;6ç­‰ï¼› å°†dataset#2ï¼ˆ-ï¼‰ä¸­çš„gRNAæå–å‡ºæ¥ï¼ˆæ­¤æ—¶gRNAçš„åºåˆ—åº”è¯¥æ˜¯å’ŒCDSæ­£ä¹‰é“¾äº’è¡¥çš„ï¼‰ï¼Œæ•°å‡ºä»ATGï¼ˆç¿»è¯‘èµ·å§‹ä½ç½®ï¼‰çš„Aåˆ°gRNAç¬¬ä¸€ä¸ªç¢±åŸºçš„ç¢±åŸºæ•°M ï¼ˆæ³¨æ„æ­¤æ—¶gRNAä¸ºCCNN20ï¼ŒgRNAç¬¬ä¸€ä¸ªç¢±åŸºåœ¨æœ€å³ç«¯ï¼‰ï¼Œéšåç®—å‡º(M-N)&#x2F;3æ˜¯å¦ä¸ºæ•´æ•°ï¼Œå¦‚æœæ˜¯æ•´æ•°ï¼Œåˆ¤æ–­è¯¥åŸºå› è¢«stopæˆåŠŸï¼Œè¾“å‡ºâ€TRAP ID + gRNA sequence + strand (+/-) + C&gt;T position + C&gt;T efficiencyâ€; éœ€æ±‚æ˜¯ï¼š è·å–æ¯æ¡TRAPåºåˆ—æ‰€å¯¹åº”çš„stopæ•ˆç‡ï¼Œæ•ˆç‡çš„è®¡ç®—æ–¹æ³•æ˜¯é’ˆå¯¹ä¸€æ¡TRAPæ¥è¯´ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªä½ç‚¹èƒ½å¤ŸstopæˆåŠŸï¼Œé‚£ä¹ˆè¿™æ¡å¯¹åº”çš„readä¸ºæˆåŠŸä¸€æ¬¡ï¼Œä¸€æ¬¡ç±»æ¨ï¼Œæ—¢ä¸èƒ½é‡å¤è®¡æ•°ï¼Œä¹Ÿä¸èƒ½å°‘è®¡æ•° è·å–æ¯ä¸ªä½ç‚¹å¯¹åº”çš„stopæ•ˆç‡ï¼Œå¦‚ä¸ŠåŸç†æ‰€è¿° è·å–åŸºå› çš„stopç‡ï¼šstop-gene/all-gene æˆ‘ä½¿ç”¨çš„ä»£ç ä»£ç ä¸€ï¼šæ­¤ä»£ç ç”¨äºè¾“å‡ºæ‰€æœ‰é€šè¿‡çš„stop readså¹¶è®¡ç®—æ¯æ¡TRAPçš„stopæ•ˆç‡ # -*- coding=utf-8 -*-import redef complement(seq): return seq.translate(str.maketrans(&#x27;ACGT&#x27;, &#x27;TGCA&#x27;))# Obtain reverse complementary sequencedef revcomp(seq): return complement(seq)[::-1]# Input n site, all CDs sequences and trap37bp sequences, and check whether the site can stop# 1 for success, 0 for failuredef stop_test_for_Z(n, cds_lst, trap): new_cds_lst = [cds for cds in cds_lst if trap in cds] score_lst = [] if len(new_cds_lst) &gt; 0: for haha in new_cds_lst: m = haha.find(trap) + 1 + 10 score = (m - 1 + n - 1) score_lst.append(score) if len([new_score for new_score in score_lst if score % 3 == 0]) &gt; 0: return 1 else: return 0 else: return 0def stop_test_for_F(n, cds_lst, trap): trap = revcomp(trap) new_cds_lst = [cds for cds in cds_lst if trap in cds] score_lst = [] if len(new_cds_lst) &gt; 0: for haha in new_cds_lst: m = haha.find(trap) + 1 + 10 + 23 score = (m - n) score_lst.append(score) if len([new_score for new_score in score_lst if score % 3 == 0]) &gt; 0: return 1 else: return 0 else: return 0# Read all CDS files and return a dictionary. The key is gene and the value is CDS sequencedef read_cds(fs): fasta = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): seq_lst = [] name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) else: seq_lst.append(line.strip(&quot;\\n&quot;)) fasta[name] = &quot;&quot;.join(seq_lst) new_fasta = &#123;key: value for key, value in fasta.items() if &quot;unavailable&quot; not in value&#125; return new_fasta# Read all the trap sequences and return a dictionary. The key is trap label and the value is 37bpdef read_seq(fs): fasta = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): seq_lst = [] name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) else: seq_lst.append(line.strip(&quot;\\n&quot;)) fasta[name] = seq_lst return fasta# Read all reference sequences. The key is label and the value is 37bptrap sequencedef read_ref(fs): ref = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) else: ref[name] = line.strip(&quot;\\n&quot;)[118:155] return ref# Read the corresponding relationship between gene and label and return to the dictionarydef read_duiying(fs): duiying = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: lable, gene = line.split(&quot;\\t&quot;) duiying[lable.strip(&quot;\\n&quot;)] = gene.strip(&quot;\\n&quot;) return duiyingdef motif_Z(trap, site): if trap[10:30][site: site + 3] in [&quot;CAG&quot;, &quot;CGA&quot;, &quot;CAA&quot;]: return 1 else: return 0def motif_F(trap, site): if &quot;CCA&quot; in trap[10:30][site-2: site + 3]: return 1 else: return 0lable_map_gene = read_duiying(&quot;../duiying.txt&quot;)all_cds = read_cds(&quot;../mart_export.txt&quot;)all_ref = read_ref(&quot;ref.fa&quot;)all_trapseq = read_seq(&quot;new508.filter.fa&quot;)eff_lst = []for name, traps in all_ref.items(): gene = lable_map_gene[name] cds_lst = [vals for keys, vals in all_cds.items() if gene in keys] pass_lst = [] if name in list(all_trapseq.keys()): alltrap = len(all_trapseq[name]) seq_lst = all_trapseq[name] for m in re.finditer(&quot;C&quot;, traps[10:30]): if motif_Z(traps, m.start()): if stop_test_for_Z((m.start() + 1), cds_lst, traps): while seq_lst: gg=seq_lst.pop(0) if gg[10:30][m.start()] == &quot;T&quot;: pass_lst.append(gg) if len(pass_lst) &gt; 0: with open(&quot;pass_lst_z.fa&quot;, &#x27;a&#x27;) as wocao: wocao.write(&quot;&gt;&#123;&#125;\\n&quot;.format(name)) for nima in pass_lst: wocao.write(&quot;&#123;&#125;\\n&quot;.format(nima)) if alltrap &gt; 0: eff_lst.append([name, len(pass_lst) / alltrap]) else: print(name)for name, traps in all_ref.items(): gene = lable_map_gene[name] cds_lst = [vals for keys, vals in all_cds.items() if gene in keys] pass_lst = [] if name in list(all_trapseq.keys()): alltrap = len(all_trapseq[name]) seq_lst2 = all_trapseq[name] for m in re.finditer(&quot;C&quot;, traps[10:30]): if motif_F(traps, m.start()): if stop_test_for_F(((traps[10:30][m.start()-2: m.start() + 3]).find(&quot;CCA&quot;)+1+2), cds_lst, traps): while seq_lst2: gg=seq_lst2.pop(0) if gg[10:30][m.start()] == &quot;T&quot;: pass_lst.append(gg) if len(pass_lst) &gt; 0: with open(&quot;pass_lst_f.fa&quot;, &#x27;a&#x27;) as wocao: wocao.write(&quot;&gt;&#123;&#125;\\n&quot;.format(name)) for nima in pass_lst: wocao.write(&quot;&#123;&#125;\\n&quot;.format(nima)) if alltrap &gt; 0: eff_lst.append([name, len(pass_lst) / alltrap]) else: print(name)with open(&quot;trap_stop_eff.txt&quot;, &#x27;a&#x27;) as l: l.write(&quot;trap-lable\\ttrap-effective\\n&quot;) for lable, effctive in eff_lst: l.write(&quot;&#123;&#125;\\t&#123;&#125;\\n&quot;.format(lable, effctive)) ä»£ç äºŒï¼šè¯¥ä»£ç ç”¨äºè®¡ç®—éœ€æ±‚2 # -*- coding=utf-8 -*-import redef complement(seq): return seq.translate(str.maketrans(&#x27;ACGT&#x27;, &#x27;TGCA&#x27;))# è·å–åå‘äº’è¡¥åºåˆ—def revcomp(seq): return complement(seq)[::-1]# è¾“å…¥nä½ç‚¹ï¼Œå¯¹åº”çš„æ‰€æœ‰CDSåºåˆ—ä»¥åŠtrap37bpåºåˆ—ï¼Œæ£€æŸ¥è¯¥ä½ç‚¹èƒ½å¦stop# æˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0def stop_test_for_Z(n, cds_lst, trap): new_cds_lst = [cds for cds in cds_lst if trap in cds] score_lst = [] if len(new_cds_lst) &gt; 0: for haha in new_cds_lst: m = haha.find(trap) + 1 + 10 score = (m - 1 + n - 1) score_lst.append(score) if len([new_score for new_score in score_lst if score % 3 == 0]) &gt; 0: return 1 else: return 0 else: return 0def stop_test_for_F(n, cds_lst, trap): trap = revcomp(trap) new_cds_lst = [cds for cds in cds_lst if trap in cds] score_lst = [] if len(new_cds_lst) &gt; 0: for haha in new_cds_lst: m = haha.find(trap) + 1 + 10 + 23 score = (m - n) score_lst.append(score) if len([new_score for new_score in score_lst if score % 3 == 0]) &gt; 0: return 1 else: return 0 else: return 0# è¯»å–æ‰€æœ‰çš„cdsæ–‡ä»¶è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œé”®ä¸ºgeneï¼Œå€¼ä¸ºcdsåºåˆ—def read_cds(fs): fasta = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): seq_lst = [] name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) else: seq_lst.append(line.strip(&quot;\\n&quot;)) fasta[name] = &quot;&quot;.join(seq_lst) new_fasta = &#123;key: value for key, value in fasta.items() if &quot;unavailable&quot; not in value&#125; return new_fasta# è¯»å–æ‰€æœ‰çš„trapåºåˆ—è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œé”®ä¸ºtrap-lableï¼Œå€¼ä¸º37bpåˆ—è¡¨def read_seq(fs): fasta = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): seq_lst = [] name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) else: seq_lst.append(line.strip(&quot;\\n&quot;)) fasta[name] = seq_lst return fasta# è¯»å–æ‰€æœ‰çš„å‚è€ƒåºåˆ—ï¼Œé”®ä¸ºlable,å€¼ä¸º37bptrapåºåˆ—def read_ref(fs): ref = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: if line.startswith(&quot;&gt;&quot;): name = line.strip(&quot;\\n&quot;).replace(&quot;&gt;&quot;, &quot;&quot;) else: ref[name] = line.strip(&quot;\\n&quot;)[118:155] return ref# è¯»å–åŸºå› å’Œlableçš„å¯¹åº”å…³ç³»ï¼Œè¿”å›å­—å…¸def read_duiying(fs): duiying = &#123;&#125; with open(fs, &#x27;r&#x27;) as f: for line in f: lable, gene = line.split(&quot;\\t&quot;) duiying[lable.strip(&quot;\\n&quot;)] = gene.strip(&quot;\\n&quot;) return duiyingdef motif_Z(trap, site): if trap[10:30][site: site + 3] in [&quot;CAG&quot;, &quot;CGA&quot;, &quot;CAA&quot;]: return 1 else: return 0def motif_F(trap, site): if &quot;CCA&quot; in trap[10:30][site-2: site + 3]: return 1 else: return 0lable_map_gene = read_duiying(&quot;../duiying.txt&quot;)all_cds = read_cds(&quot;../mart_export.txt&quot;)all_ref = read_ref(&quot;ref.fa&quot;)all_trapseq = read_seq(&quot;new508.filter.fa&quot;)with open(&quot;pass_lst_f.txt&quot;, &#x27;a&#x27;) as wocao: wocao.write( &quot;TRAP ID\\tGene\\tgRNA sequence\\tstrand\\tC&gt;T position\\tC&gt;T efficiency\\n&quot;)with open(&quot;pass_lst_z.txt&quot;, &#x27;a&#x27;) as wocao: wocao.write( &quot;TRAP ID\\tGene\\tgRNA sequence\\tstrand\\tC&gt;T position\\tC&gt;T efficiency\\n&quot;)for name, traps in all_ref.items(): gene = lable_map_gene[name] cds_lst = [vals for keys, vals in all_cds.items() if gene in keys] pass_lst = [] for m in re.finditer(&quot;C&quot;, traps[10:30]): if motif_Z(traps, m.start()): if stop_test_for_Z((m.start() + 1), cds_lst, traps) and name in list(all_trapseq.keys()): i = 0 for gg in all_trapseq[name]: if gg[10:30][m.start()] == &quot;T&quot;: i = i + 1 eff = i/len(all_trapseq[name]) pass_lst.append( [name, traps[10:33], &quot;+&quot;, (m.start() + 1), eff]) if len(pass_lst) &gt; 0: with open(&quot;pass_lst_z.txt&quot;, &#x27;a&#x27;) as wocao: for nima in pass_lst: [trap_id, trap_seq, strand, ctposition, efftion] = nima wocao.write(&quot;&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\n&quot;.format( trap_id, gene, trap_seq, strand, ctposition, efftion))for name, traps in all_ref.items(): gene = lable_map_gene[name] cds_lst = [vals for keys, vals in all_cds.items() if gene in keys] pass_lst = [] for m in re.finditer(&quot;C&quot;, traps[10:30]): if motif_F(traps, m.start()): if stop_test_for_F(((traps[10:30][m.start()-2: m.start() + 3]).find(&quot;CCA&quot;)+1+2), cds_lst, traps) and name in list(all_trapseq.keys()): j = 0 for gg in all_trapseq[name]: if gg[10:30][m.start()] == &quot;T&quot;: j = j + 1 eff = j/len(all_trapseq[name]) pass_lst.append( [name, traps[10:33], &quot;-&quot;, (m.start() + 1), eff]) if len(pass_lst) &gt; 0: with open(&quot;pass_lst_f.txt&quot;, &#x27;a&#x27;) as wocao: for nima in pass_lst: [trap_id, trap_seq, strand, ctposition, efftion] = nima wocao.write(&quot;&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\t&#123;&#125;\\n&quot;.format( trap_id, gene, trap_seq, strand, ctposition, efftion)) è¯¥åšå®¢ä»…è®°å½•å·¥ä½œæµç¨‹ï¼Œä»¥ä½œä¸ºå¤‡å¿˜å½•ï¼Œè¯·å‹¿è¿‡åˆ†å€Ÿé‰´ï¼Œä¹Ÿä¸è¦è½¬è½½ï¼Œæ„Ÿè°¢ï¼","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"CRISPR","slug":"CRISPR","permalink":"https://xiaohanys.top/tags/CRISPR/"},{"name":"gRNA","slug":"gRNA","permalink":"https://xiaohanys.top/tags/gRNA/"}],"author":"Xiaoguang Pan"},{"title":"å¦‚ä½•æ‰¹é‡è®¡ç®—ç›¸å…³æ€§","slug":"å¦‚ä½•æ‰¹é‡è®¡ç®—ç›¸å…³æ€§","date":"2020-02-17T07:13:03.000Z","updated":"2024-10-18T05:32:20.439Z","comments":true,"path":"batch-correlate/","permalink":"https://xiaohanys.top/batch-correlate/","excerpt":"1.åªè®¡ç®—ç›¸å…³æ€§ï¼Œä¸è€ƒè™‘æ˜¾è‘—æ€§æ£€éªŒï¼šlibrary(corrr)library(dplyr)data(mtcars)mtcars%&gt;%correlate()%&gt;%rearrange()%&gt;%stretch()","text":"1.åªè®¡ç®—ç›¸å…³æ€§ï¼Œä¸è€ƒè™‘æ˜¾è‘—æ€§æ£€éªŒï¼šlibrary(corrr)library(dplyr)data(mtcars)mtcars%&gt;%correlate()%&gt;%rearrange()%&gt;%stretch() 2.è®¡ç®—ä¸¤ç§ç»“æœï¼šlibrary(dplyr)library(purrr)library(broom)library(tidyr)data(mtcars)pairs_names&lt;-t(combn(names(mtcars),2))%&gt;%as_tibble()%&gt;%setNames(c(&quot;x&quot;,&quot;y&quot;))pairs_names%&gt;%mutate(r.test=map2(x,y,~cor.test(mtcars[[.x]],mtcars[[.y]])),r.test=map(r.test,tidy))%&gt;%unnest(r.test) purrr åŒ…æŸ¥çœ‹å‰é¢çš„ä»£ç ï¼Œçœ‹åˆ°äº†æ¥è‡ªpurrråŒ…çš„map å’Œmap2å‡½æ•°ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è§£é‡Šè¿™ä¸¤ä¸ªå‡½æ•°çš„ä½¿ç”¨å‘¢ï¼Ÿ é¡¾åæ€ä¹‰ï¼Œmapå°±å’Œpythonä¸­çš„ä¸€æ ·ï¼Œå¯¹ä¸€ä¸ªå¯è¿­ä»£çš„åºåˆ—åšå‘é‡åŒ–çš„æ“ä½œï¼Œä¸¾ä¸ªpythonçš„ä¾‹å­: a=[1,2,3,4,5]list(map(lambda x:x+1,a)) [2, 3, 4, 5, 6] åœ¨Rä¸­ï¼Œmapå‡½æ•°åšçš„æ˜¯ç›¸åŒçš„æ“ä½œï¼Œåªä¸è¿‡å®ƒæ›´ç‰›ï¼Œä»–å¯ä»¥æ¥å—ä¸€æ•´ä¸ªæ•°æ®æ¡†æˆ–è€…tibble. library(purrr)data(&quot;mtcars&quot;)head(mtcars) mpg cyl disp hp drat wt qsec vs am gear carbMazda RX4 21.0 6 160 110 3.90 2.620 16.46 0 1 4 4Mazda RX4 Wag 21.0 6 160 110 3.90 2.875 17.02 0 1 4 4Datsun 710 22.8 4 108 93 3.85 2.320 18.61 1 1 4 1Hornet 4 Drive 21.4 6 258 110 3.08 3.215 19.44 1 0 3 1Hornet Sportabout 18.7 8 360 175 3.15 3.440 17.02 0 0 3 2Valiant 18.1 6 225 105 2.76 3.460 20.22 1 0 3 1 mtcars%&gt;%map(mean) $mpg[1] 20.09062$cyl[1] 6.1875$disp[1] 230.7219$hp[1] 146.6875$drat[1] 3.596563$wt[1] 3.21725$qsec[1] 17.84875$vs[1] 0.4375$am[1] 0.40625$gear[1] 3.6875$carb[1] 2.8125 map2å‡½æ•°åŒæ ·çš„ï¼Œå› ä¸ºæ˜¯2ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶å¯¹ä¸¤ä¸ªå‚æ•°åŒæ—¶è¿­ä»£ï¼š n&lt;-list(4,5,6)m&lt;-list(1,2,3)map2(m,n,&#x27;+&#x27;) [[1]][1] 5[[2]][1] 7[[3]][1] 9 å¦å¤–ï¼Œmapå‡½æ•°è¿˜å…·æœ‰å…¶ä»–çš„å½¢å¼ï¼Œä¾‹å¦‚ map:è¿”å›åˆ—è¡¨map_df:è¿”å›æ•°æ®æ¡†map_dbl: è¿”å›å‘é‡ æœ€åï¼ŒpurrråŒ…çš„å‡½æ•°å½¢å¼ä¾‹å¦‚~lm(x~y,data=.)ï¼Œè¿™ç§æ ¼å¼æ˜¯ä¸ºä¸€ç§ç®€å†™ï¼Œå®é™…ä¸Šä¸ºï¼Œå› æ­¤ï¼Œ.ä¸ºä¼ å…¥çš„æ•°æ®ã€‚ function(data) lm(data$x~data$y,data=data) å…¶ä½™çš„åŒ…broom::tidy è¿™ä¸ªå‡½æ•°ç”¨æ¥å¤„ç†æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†æ¨¡å‹è½¬åŒ–ä¸ºä¸€ç³»åˆ—tidyçš„æ•°æ®æ ¼å¼&#96;; tidyr::unnest è¿™ä¸ªå‡½æ•°å¯ä»¥å°†æ•°æ®æ¡†åµŒå¥—åˆ—è¡¨çš„å½¢å¼å±•å¼€ä¾¿äºè§‚å¯Ÿ base::combn æ¥è‡ªåŸºç¡€åŒ…çš„æ’åˆ—ç»„åˆå‡½æ•°ï¼Œæ¥å—ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªåˆ—è¡¨æˆ–è€…å‘é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°å­—ï¼Œä¸ºä»ä¸­å–å‡ºçš„ä¸ªæ•° %&gt;%ç®¡é“ç¬¦ï¼š æ¥è‡ªåŒ…dplyråŒ…ï¼Œç”¨äºæ–¹ä¾¿æ•°æ®çš„æµç¨‹åŒ–å¤„ç†","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"ä¸€æ–‡è¯»æ‡‚lncRNAåˆ†æ","slug":"ä¸€æ–‡è¯»æ‡‚lncRNAåˆ†æ","date":"2020-02-17T04:46:19.000Z","updated":"2024-10-18T05:33:11.723Z","comments":true,"path":"lncrna-analysis/","permalink":"https://xiaohanys.top/lncrna-analysis/","excerpt":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ 1:å¯¹æµ‹åºä¸‹æœºæ•°æ®è¿›è¡Œè´¨é‡æ£€æµ‹ï¼ˆQCï¼‰","text":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ 1:å¯¹æµ‹åºä¸‹æœºæ•°æ®è¿›è¡Œè´¨é‡æ£€æµ‹ï¼ˆQCï¼‰ ä½¿ç”¨è½¯ä»¶ï¼šfastqc å‘½ä»¤è¡Œå‚æ•°ï¼š -o --outdir:è¾“å‡ºè·¯å¾„--extractï¼šç»“æœæ–‡ä»¶è§£å‹ç¼©--noextractï¼šç»“æœæ–‡ä»¶å‹ç¼©-f --format:è¾“å…¥æ–‡ä»¶æ ¼å¼.æ”¯æŒbam,sam,fastqæ–‡ä»¶æ ¼å¼-t --threads:çº¿ç¨‹æ•°-c --contaminantsï¼šåˆ¶å®šæ±¡æŸ“åºåˆ—ã€‚æ–‡ä»¶æ ¼å¼ name[tab]sequence-a --adaptersï¼šæŒ‡å®šæ¥å¤´åºåˆ—ã€‚æ–‡ä»¶æ ¼å¼name[tab]sequence-k --kmersï¼šæŒ‡å®škmersé•¿åº¦ï¼ˆ2-10bp,é»˜è®¤7bpï¼‰-q --quietï¼š å®‰é™æ¨¡å¼ è¿è¡Œå‘½ä»¤ï¼š fastqc -f fastq -t 8 -o ./QCreport/ fastq1 fastq2 æ³¨æ„ï¼šå½“æ ·æœ¬æ•°é‡å¾ˆå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ multiqc è½¯ä»¶å°† fastqc è½¯ä»¶çš„ç»“æœè¿›è¡Œåˆå¹¶ multiqc ./*.zip 2.å¯¹ qc åçš„æ•°æ®è¿›è¡Œè¿‡æ»¤ä½¿ç”¨è½¯ä»¶ï¼šfastp å‘½ä»¤è¡Œå‚æ•°ï¼š usage: fastp -i &lt;in1&gt; -o &lt;out1&gt; [-I &lt;in1&gt; -O &lt;out2&gt;] [options...]options: # I/O options å³è¾“å…¥è¾“å‡ºæ–‡ä»¶è®¾ç½® -i, --in1 read1 input file name (string) -o, --out1 read1 output file name (string [=]) -I, --in2 read2 input file name (string [=]) -O, --out2 read2 output file name (string [=]) -6, --phred64 indicates the input is using phred64 scoring (it&#x27;ll be converted to phred33, so the output will still be phred33) -z, --compression compression level for gzip output (1 ~ 9). 1 is fastest, 9 is smallest, default is 2. (int [=2]) --reads_to_process specify how many reads/pairs to be processed. Default 0 means process all reads. (int [=0]) # adapter trimming options è¿‡æ»¤åºåˆ—æ¥å¤´å‚æ•°è®¾ç½® -A, --disable_adapter_trimming adapter trimming is enabled by default. If this option is specified, adapter trimming is disabled -a, --adapter_sequence the adapter for read1. For SE data, if not specified, the adapter will be auto-detected. For PE data, this is used if R1/R2 are found not overlapped. (string [=auto]) --adapter_sequence_r2 the adapter for read2 (PE data only). This is used if R1/R2 are found not overlapped. If not specified, it will be the same as &lt;adapter_sequence&gt; (string [=]) # global trimming options å‰ªé™¤åºåˆ—èµ·å§‹å’Œæœ«ç«¯çš„ä½è´¨é‡ç¢±åŸºæ•°é‡å‚æ•° -f, --trim_front1 trimming how many bases in front for read1, default is 0 (int [=0]) -t, --trim_tail1 trimming how many bases in tail for read1, default is 0 (int [=0]) -F, --trim_front2 trimming how many bases in front for read2. If it&#x27;s not specified, it will follow read1&#x27;s settings (int [=0]) -T, --trim_tail2 trimming how many bases in tail for read2. If it&#x27;s not specified, it will follow read1&#x27;s settings (int [=0]) # polyG tail trimming, useful for NextSeq/NovaSeq data polyGå‰ªè£ -g, --trim_poly_g force polyG tail trimming, by default trimming is automatically enabled for Illumina NextSeq/NovaSeq data --poly_g_min_len the minimum length to detect polyG in the read tail. 10 by default. (int [=10]) -G, --disable_trim_poly_g disable polyG tail trimming, by default trimming is automatically enabled for Illumina NextSeq/NovaSeq data # polyX tail trimming -x, --trim_poly_x enable polyX trimming in 3&#x27; ends. --poly_x_min_len the minimum length to detect polyX in the read tail. 10 by default. (int [=10]) # per read cutting by quality options åˆ’çª—è£å‰ª -5, --cut_by_quality5 enable per read cutting by quality in front (5&#x27;), default is disabled (WARNING: this will interfere deduplication for both PE/SE data) -3, --cut_by_quality3 enable per read cutting by quality in tail (3&#x27;), default is disabled (WARNING: this will interfere deduplication for SE data) -W, --cut_window_size the size of the sliding window for sliding window trimming, default is 4 (int [=4]) -M, --cut_mean_quality the bases in the sliding window with mean quality below cutting_quality will be cut, default is Q20 (int [=20]) # quality filtering options æ ¹æ®ç¢±åŸºè´¨é‡æ¥è¿‡æ»¤åºåˆ— -Q, --disable_quality_filtering quality filtering is enabled by default. If this option is specified, quality filtering is disabled -q, --qualified_quality_phred the quality value that a base is qualified. Default 15 means phred quality &gt;=Q15 is qualified. (int [=15]) -u, --unqualified_percent_limit how many percents of bases are allowed to be unqualified (0~100). Default 40 means 40% (int [=40]) -n, --n_base_limit if one read&#x27;s number of N base is &gt;n_base_limit, then this read/pair is discarded. Default is 5 (int [=5]) # length filtering options æ ¹æ®åºåˆ—é•¿åº¦æ¥è¿‡æ»¤åºåˆ— -L, --disable_length_filtering length filtering is enabled by default. If this option is specified, length filtering is disabled -l, --length_required reads shorter than length_required will be discarded, default is 15. (int [=15]) # low complexity filtering -y, --low_complexity_filter enable low complexity filter. The complexity is defined as the percentage of base that is different from its next base (base[i] != base[i+1]). -Y, --complexity_threshold the threshold for low complexity filter (0~100). Default is 30, which means 30% complexity is required. (int [=30]) # filter reads with unwanted indexes (to remove possible contamination) --filter_by_index1 specify a file contains a list of barcodes of index1 to be filtered out, one barcode per line (string [=]) --filter_by_index2 specify a file contains a list of barcodes of index2 to be filtered out, one barcode per line (string [=]) --filter_by_index_threshold the allowed difference of index barcode for index filtering, default 0 means completely identical. (int [=0]) # base correction by overlap analysis options é€šè¿‡overlapæ¥æ ¡æ­£ç¢±åŸº -c, --correction enable base correction in overlapped regions (only for PE data), default is disabled # UMI processing -U, --umi enable unique molecular identifer (UMI) preprocessing --umi_loc specify the location of UMI, can be (index1/index2/read1/read2/per_index/per_read, default is none (string [=]) --umi_len if the UMI is in read1/read2, its length should be provided (int [=0]) --umi_prefix if specified, an underline will be used to connect prefix and UMI (i.e. prefix=UMI, UMI=AATTCG, final=UMI_AATTCG). No prefix by default (string [=]) --umi_skip if the UMI is in read1/read2, fastp can skip several bases following UMI, default is 0 (int [=0]) # overrepresented sequence analysis -p, --overrepresentation_analysis enable overrepresented sequence analysis. -P, --overrepresentation_sampling One in (--overrepresentation_sampling) reads will be computed for overrepresentation analysis (1~10000), smaller is slower, default is 20. (int [=20]) # reporting options -j, --json the json format report file name (string [=fastp.json]) -h, --html the html format report file name (string [=fastp.html]) -R, --report_title should be quoted with &#x27; or &quot;, default is &quot;fastp report&quot; (string [=fastp report]) # threading options è®¾ç½®çº¿ç¨‹æ•° -w, --thread worker thread number, default is 3 (int [=3]) # output splitting options -s, --split split output by limiting total split file number with this option (2~999), a sequential number prefix will be added to output name ( 0001.out.fq, 0002.out.fq...), disabled by default (int [=0]) -S, --split_by_lines split output by limiting lines of each file with this option(&gt;=1000), a sequential number prefix will be added to output name ( 0001.out.fq, 0002.out.fq...), disabled by default (long [=0]) -d, --split_prefix_digits the digits for the sequential number padding (1~10), default is 4, so the filename will be padded as 0001.xxx, 0 to disable padding (int [=4]) # help -?, --help print this message è¿è¡Œå‘½ä»¤ï¼š fastp -c -i fastq1 -o ./cleandata/ -I fastq2 -O ./cleandata/ 3.å¯¹å¹²å‡€æ•°æ®å»é™¤ rRNA æ“ä½œï¼ˆå­˜ç–‘ï¼‰åœ¨ ncbi ä¸‹è½½ rRNA æ•°æ®ä¿å­˜ä¸º hg19_rRNA.fasta ä½¿ç”¨ bwa å»ºç«‹ç´¢å¼•æ–‡ä»¶ bwa index hg19_rRNA.fasta ä½¿ç”¨ bwa å°†æµ‹åºæ•°æ®æ¯”å¯¹åˆ° rRNA æ•°æ®åº“ï¼Œå»é™¤æ¯”å¯¹ä¸Šçš„æ•°æ®ï¼Œå¹¶æ¢å¤ä¸º fastq æ–‡ä»¶ bwa mem hg19_rRNA.fasta fastq1 fastq2 | samtools view -bf4 |samtools -c 9 -1 paired1.fq.gz -2 paired2.fq.gz - 4.å°†å»é™¤ rRNA çš„æ•°æ®æ¯”å¯¹åˆ° hg19|hg38 ä¸Šä½¿ç”¨è½¯ä»¶ï¼šsubread å»ºç«‹ç´¢å¼•ï¼š subread-buildindex -o hg19 ./database/hg19.fasta æ¯”å¯¹ï¼š subjunc -T 5 -i hg19 -r fastq1 -R fastq2 -o out.bam ç»Ÿè®¡ readcounts featureCounts -p -T 6 -t exon -g transcript_id -a all_lncRNA_know.gtf -o sample.lncRNA.readcount out.bam è¿™é‡Œéœ€è¦æ³¨æ„ï¼šå› ä¸ºä¸€ä¸ªåŸºå› ä¼šåŒ…å«å¤šä¸ªè½¬å½•æœ¬ï¼Œä¸€ä¸ªè½¬å½•æœ¬åˆåŒ…å«å¤šä¸ªå¤–æ˜¾å­å’Œå†…å«å­ï¼Œæ‰€ä»¥ä¸ºäº†ç²¾ç¡®æ¯”å¯¹ç»“æœï¼Œæˆ‘ä»¬éœ€è¦åŸºäºå¤–æ˜¾å­è¿›è¡Œæ¯”å¯¹-t exonï¼Œè½¯ä»¶ä¼šè‡ªåŠ¨æ ¹æ®æ³¨é‡Šæ–‡ä»¶è¿›è¡Œåˆå¹¶åŒä¸€ä¸ªè½¬å½•æœ¬çš„è®¡æ•°ç»“æœï¼Œå¹¶è®¡ç®—å‡ºè½¬å½•æœ¬çš„é•¿åº¦æ±‡æ€»åˆ°ç»“æœä¸­. å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­£å› ä¸ºå¯å˜å‰ªåˆ‡çš„å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•çš„è®¤ä¸ºè½¬å½•æœ¬çš„è®¡æ•°ç»“æœç›¸åŠ å³ä¸ºå¯¹åº”åŸºå› çš„è®¡æ•°ç»“æœï¼Œè¿™æ˜¯ä¸å‡†ç¡®çš„ï¼Œæ‰€ä»¥ï¼Œè¦æƒ³çŸ¥é“åŸºå› çš„è®¡æ•°ç»“æœï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å‚æ•°ï¼Œå¦è¡Œè®¡ç®—-g gene_id å°†è®¡æ•°çš„ç»“æœæå–å‡ºæ¥ï¼š awk -F &#x27;\\t&#x27; &#x27;&#123;print $1,$7&#125;&#x27; OFS=&#x27;\\t&#x27; sample.lncRNA.readcount &gt; ./tiqu/sample.counts æ³¨ï¼šå¯¹äºç»“æœä¸­çš„ lengthï¼Œæœ‰äººä»¥ä¸ºå°±æ˜¯æœ‰æ•ˆé•¿åº¦ï¼ˆeffctive length),ä½†äº‹å®æ˜¯ï¼Œè¿™ä¸ªé•¿åº¦ä»…ä»…åªæ˜¯ä¸€ä¸ªè½¬å½•æœ¬ä¸Šæ‰€æœ‰å¤–æ˜¾å­é•¿åº¦çš„åŠ å’Œè€Œå·²ï¼Œå› æ­¤ï¼Œå¹¶ä¸èƒ½ä½œä¸ºæœ‰æ•ˆé•¿åº¦ã€‚ç½‘ä¸Šæœ‰ä¼°ç®—æœ‰æ•ˆé•¿åº¦çš„å…¬å¼ï¼š efflength = transcripts_length - LFD +1 LFD æ˜¯æµ‹åºæ—¶çš„å¹³å‡ç‰‡æ®µé•¿åº¦ï¼Œè¿™ä¸ªå¯ä»¥ä¼°ç®—ï¼Œä½†ä¸å‡†ç¡®ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯è¯¢é—®æµ‹åºäººå‘˜è¿™ä¸ªæ•°å€¼ã€‚ 5.æ•´åˆæ‰€æœ‰æ ·æœ¬ä¿¡æ¯åˆ°è¡¨è¾¾çŸ©é˜µå¹¶è®¡ç®— TPMè®¡ç®—å®Œ readcountï¼Œè½¬å½•ç»„æµ‹åºçš„æ‰“åŸºç¡€è¿‡ç¨‹å·²ç»å®Œæ¯•ï¼Œåç»­çš„åˆ†æéƒ½æ˜¯åŸºäºæ­¤çš„ï¼Œä½†æ˜¯ï¼Œä¸ºäº†ä¸‹æ¸¸åˆ†æçš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å°†æ‰€æœ‰çš„æ•°æ®æ•´ç†åˆ°ä¸€ä¸ªè¡¨è¾¾çŸ©é˜µä¸­ã€‚ ä½¿ç”¨pythonæˆ–è€…Ræˆ–è€…shellï¼Œæˆ‘å»ºè®®ä½¿ç”¨ python,å› ä¸ºç®€å•å¿«é€Ÿæ˜“æ§ï¼š import pandas as pdimport glob#ä½¿ç”¨pandasé€Ÿåº¦è¦æ›´å¿«ï¼Œå…ˆé¢„è¯»ä¸€ä¸ªæ ·æœ¬ä½œä¸ºdataframeçš„èµ·å§‹æ¡†æ¶df=pd.read_csv(&quot;sample.lncRNA.trans.counts&quot;,sep=&quot;\\t&quot;,skiprows=1)#featurecountçš„è®¡ç®—ç»“æœæå–åé€šå¸¸æœ‰è¿™æ ·çš„è¡¨å¤´df=df[[&#x27;Geneid&#x27;,&#x27;LncRNA/bidui/normal/sample.subjunc.bam&#x27;]]df.columns=[&#x27;id&#x27;,&#x27;counts&#x27;]#éå†æ‰€æœ‰æ ·æœ¬ï¼Œä½¿ç”¨pd.joinæ•´åˆåˆ°ä¸€ä¸ªå¤§è¡¨for name in glob.glob(&quot;*.counts&quot;): sample=name.replace(&quot;.lncRNA.trans.counts&quot;,&quot;&quot;) df2=pd.read_csv(name,sep=&quot;\\t&quot;,skiprows=1) df2.columns=[&#x27;id&#x27;,&#x27;counts&#x27;,&#x27;ot&#x27;] df2=df2[[&#x27;counts&#x27;]] df2.columns=[sample] df=pd.concat([df,df2],axis=1)#åˆ é™¤é¢„è¯»æ ·æœ¬ä¿¡æ¯ï¼Œå¹¶å†™å…¥æ–‡ä»¶df.drop(&#x27;counts&#x27;,axis=1).set_index(&quot;id&quot;).to_csv(&quot;normal_lncRNA_trans_allcounts.csv&quot;,sep=&quot;\\t&quot;) ç›®å‰ä¸»æµçš„è¡¨è¾¾é‡æ ‡å‡†åŒ–æ–¹æ³•å¤šç§å¤šæ ·ï¼Œæœ‰ RPKMï¼ŒFPKMï¼ŒTPMï¼ŒCPM ç­‰ï¼Œä¸‹æ¸¸å·®å¼‚åˆ†æè½¯ä»¶ deseq2 ä¹Ÿæœ‰è‡ªå·±çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œä¸ºäº†ä¿è¯ç”Ÿç‰©å­¦æ„ä¹‰ï¼ŒåŒæ—¶åˆä¿è¯æ•°æ®çš„å¯æ¯”æ€§ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®é€‰æ‹© TPMã€‚ reads Countå®šä¹‰: é«˜é€šé‡æµ‹åºä¸­æ¯”å¯¹åˆ° exon ä¸Šçš„ reads æ•°ã€‚å¯ä½¿ç”¨ featureCount ç­‰è½¯ä»¶è¿›è¡Œè®¡ç®—ã€‚ ä¼˜ç‚¹ï¼šå¯æœ‰æ•ˆè¯´æ˜è¯¥åŒºåŸŸæ˜¯å¦çœŸçš„æœ‰è¡¨è¾¾åŠçœŸå®çš„è¡¨è¾¾ä¸°åº¦ã€‚èƒ½å¤Ÿè¿‘ä¼¼å‘ˆç°çœŸå®çš„è¡¨è¾¾æƒ…å†µã€‚æœ‰åˆ©äºå®éªŒéªŒè¯ã€‚ ç¼ºç‚¹ï¼šç”±äº exon é•¿åº¦ä¸åŒï¼Œéš¾ä»¥è¿›è¡Œä¸åŒ exon ä¸°åº¦æ¯”è¾ƒï¼›ç”±äºæµ‹åºæ€»æ•°ä¸åŒï¼Œéš¾ä»¥å¯¹ä¸åŒæµ‹åºæ ·æœ¬é—´è¿›è¡Œæ¯”è¾ƒã€‚ RPKM&#x2F;FPKMå®šä¹‰ï¼šRPKM: Reads Per Kilobase of exon model per Million mapped reads (æ¯åƒä¸ªç¢±åŸºçš„è½¬å½•æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„ reads)ï¼›FPKM: Fragments Per Kilobase of exon model per Million mapped fragments(æ¯åƒä¸ªç¢±åŸºçš„è½¬å½•æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„ fragments)å…¬å¼ï¼š $$RPKM &#x3D;\\frac{ExonMappedReads * 10^9 }{TotalMappedReads * ExonLength}$$ ä¸Šè¿°å…¬å¼å¯ä»ä¸‹é¢å…¬å¼æ¨å¯¼è€Œå‡ºï¼š$$RPKM&#x3D;\\frac{ExonMappedReads&#x2F;ExonLength*10^9}{TotalMappedreads&#x2F;GenomeLength}$$ è§£é‡Šï¼šExonMappedReads å³ä¸ºæ¯”å¯¹åˆ°è¯¥ exon ä¸Šçš„ reads countï¼› TotalMappedReads å³ä¸ºæ¯”å¯¹åˆ°åŸºå› ç»„ä¸Šæ‰€æœ‰ reads count çš„æ€»å’Œï¼›ExonLength ä¸ºè¯¥ Exon çš„é•¿åº¦ï¼›GenomeLength å³ä¸ºåŸºå› ç»„å…¨é•¿ï¼Œå› ä¸ºæ˜¯ç›¸åŒåŸºå› ç»„ï¼Œæ‰€ä»¥è¯¥æ•°å€¼å¯æ¶ˆé™¤ã€‚ ä¼˜ç‚¹ï¼štophat-cufflinks æµç¨‹å›ºå®šï¼Œåº”ç”¨èŒƒå›´å¹¿ã€‚ç†è®ºä¸Šï¼Œå¯å¼¥è¡¥ reads Count çš„ç¼ºç‚¹ï¼Œæ¶ˆé™¤æ ·æœ¬é—´å’ŒåŸºå› é—´å·®å¼‚ã€‚ è®¨è®ºï¼šæœ‰äººè¯´ RPKM&#x2F;FPKM æ ‡å‡†åŒ–ç‰¹åˆ«ä¸åˆç†ï¼Œçœ‹ç€æ˜¯ä¸ªå¤§ç‰› YellowTreeã€‚å…¬å¼ 2 ä¸­ï¼ŒTotalMappedReads&#x2F;GenomeLength ä¸ºæµ‹åºæ·±åº¦ï¼ŒExonMappedReads &#x2F; ExonLength å¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯è¯¥ Exon ä¸Šçš„â€œæµ‹åºæ·±åº¦â€ã€‚ä¸¤è€…ç›¸é™¤ï¼Œå°±å¾—å‡ºè¯¥ Exon ä¾æ®æµ‹åºæ·±åº¦è€Œè¿›è¡Œçš„æ ‡å‡†åŒ–ï¼Œé‚£ä¹ˆå›  Exon é•¿çŸ­ã€æµ‹åºæ·±åº¦é€ æˆçš„æ ·æœ¬é—´é€ æˆçš„åå·®ï¼Œéƒ½å¯ä»¥æ¶ˆé™¤ã€‚å› ä¸€èˆ¬æ˜¯ç›¸åŒç‰©ç§ï¼ŒåŸºå› ç»„ä¸€èˆ¬ç›¸åŒï¼Œæ‰€ä»¥å…¬å¼ 2 æ¢ç®—å¹¶æ¶ˆå» GenomeLengthï¼Œå°±æˆä¸ºå…¬å¼ 1 çš„å½¢å¼äº†ã€‚ä¸çŸ¥é“å“ªé‡Œé”™äº†ï¼Œæ–—èƒ†æå‡ºè´¨ç–‘ï¼šRPKM&#x2F;FPKM æ€ä¹ˆå°±ä¸èƒ½æ¶ˆé™¤ä¸¤ç§ç±»å‹çš„ biasï¼Ÿä¸è¿‡æœ‰è®ºæ–‡é™ˆè¿°è¯´ RPKM çš„ç»“æœéš¾ä»¥æ¶ˆé™¤ç»„é—´æµ‹åºé€ æˆçš„å·®å¼‚ï¼Œå¯èƒ½æœªé‡‡ç”¨æ¯”å¯¹åˆ°åŸºå› ç»„ä¸Šæ‰€æœ‰çš„ reads æ•°ï¼Œè€Œæ˜¯é‡‡ç”¨äº†æ¯”å¯¹åˆ°æ‰€æœ‰ Exon çš„ reads æ•°ä½œä¸º TotalMappedReads å§ã€‚ä¸æ˜¯å¾ˆç¡®å®šã€‚ FPKMï¼šä¸ RPKM è®¡ç®—è¿‡ç¨‹ç±»ä¼¼ã€‚åªæœ‰ä¸€ç‚¹å·®å¼‚ï¼šRPKM è®¡ç®—çš„æ˜¯ readsï¼ŒFPKM è®¡ç®—çš„æ˜¯ fragmentsã€‚single-end&#x2F;paired-end æµ‹åºæ•°æ®å‡å¯è®¡ç®— reads countï¼Œfragments count åªèƒ½é€šè¿‡ paired-end æµ‹åºæ•°æ®è®¡ç®—ã€‚paired-end æµ‹åºæ•°æ®æ—¶ï¼Œä¸¤ç«¯çš„ reads æ¯”å¯¹åˆ°ç›¸åŒåŒºåŸŸï¼Œä¸”æ–¹å‘ç›¸åï¼Œå³è®¡æ•° 1 ä¸ª fragmentsï¼›å¦‚æœåªæœ‰å•ç«¯ reads æ¯”å¯¹åˆ°è¯¥åŒºåŸŸï¼Œåˆ™ä¸€ä¸ª reads å³è®¡æ•° 1 ä¸ª fragmentsã€‚æ‰€ä»¥ fragments count æ¥è¿‘ä¸”å°äº 2 * reads countã€‚ RPMå®šä¹‰ï¼šRPM&#x2F;CPM: Reads&#x2F;Counts of exon model per Million mapped reads (æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„ reads) å…¬å¼ï¼š $$RPM &#x3D; \\frac{ExonMappedReads * 10^6}{TotalMappedReads}$$ ä¼˜ç‚¹ï¼šåˆ©äºè¿›è¡Œæ ·æœ¬é—´æ¯”è¾ƒã€‚æ ¹æ®æ¯”å¯¹åˆ°åŸºå› ç»„ä¸Šçš„æ€» reads countï¼Œè¿›è¡Œæ ‡å‡†åŒ–ã€‚å³ï¼šä¸è®ºæ¯”å¯¹åˆ°åŸºå› ç»„ä¸Šçš„æ€» reads count æ˜¯å¤šå°‘ï¼Œéƒ½å°†æ€» reads count æ ‡å‡†åŒ–ä¸º 10^6ã€‚ ç¼ºç‚¹ï¼šæœªæ¶ˆé™¤ exon é•¿åº¦é€ æˆçš„è¡¨è¾¾å·®å¼‚ï¼Œéš¾ä»¥è¿›è¡Œæ ·æœ¬å†… exon å·®å¼‚è¡¨è¾¾çš„æ¯”è¾ƒã€‚ TPMå®šä¹‰ï¼šTPM: Transcripts Per Kilobase of exon model per Million mapped reads (æ¯åƒä¸ªç¢±åŸºçš„è½¬å½•æ¯ç™¾ä¸‡æ˜ å°„è¯»å–çš„ Transcripts) å…¬å¼ï¼š $$TPM&#x3D;\\frac{N_i&#x2F;L_i*10^6}{sum(N_1&#x2F;L_1+N_2&#x2F;L_2+Â·Â·+N_n&#x2F;L_n)}$$ è§£é‡Šï¼šNi ä¸ºæ¯”å¯¹åˆ°ç¬¬ i ä¸ª exon çš„ reads æ•°ï¼› Li ä¸ºç¬¬ i ä¸ª exon çš„é•¿åº¦ï¼›sum(N1&#x2F;L1+N2&#x2F;L2 + â€¦ + Nn&#x2F;Ln)ä¸ºæ‰€æœ‰ (n ä¸ª)exon æŒ‰é•¿åº¦è¿›è¡Œæ ‡å‡†åŒ–ä¹‹åæ•°å€¼çš„å’Œã€‚ è®¡ç®—è¿‡ç¨‹ï¼šé¦–å…ˆå¯¹æ¯ä¸ª exon è®¡ç®— Pi&#x3D;Ni&#x2F;Liï¼Œå³æŒ‰é•¿åº¦å¯¹ reads count è¿›è¡Œæ ‡å‡†åŒ–ï¼›éšåè®¡ç®—è¿‡ç¨‹ç±»ä¼¼ RPM (å°† Pi ä½œä¸ºæ­£å¸¸çš„ ExonMappedReadsï¼Œç„¶åä»¥ RPM çš„å…¬å¼è®¡ç®— TPM)ã€‚ ä¼˜ç‚¹ï¼šé¦–å…ˆæ¶ˆé™¤ exon é•¿åº¦é€ æˆçš„å·®å¼‚ï¼Œéšåæ¶ˆé™¤æ ·æœ¬é—´æµ‹åºæ€» reads count ä¸åŒé€ æˆçš„å·®å¼‚ã€‚ ç¼ºç‚¹ï¼šå› ä¸ºä¸æ˜¯é‡‡ç”¨æ¯”å¯¹åˆ°åŸºå› ç»„ä¸Šçš„æ€» reads countï¼Œæ‰€ä»¥ç‰¹æ®Šæƒ…å†µä¸‹ä¸å¤Ÿå‡†ç¡®ã€‚ä¾‹å¦‚ï¼šæŸçªå˜ä½“å¯¹ exon é€ æˆæ•´ä½“å½±å“æ—¶ï¼Œéš¾ä»¥æ‰¾å‡ºå·®å¼‚ã€‚ ç›¸äº’å…³ç³»è¯„ä»·ï¼šä»¥ä¸Šå‡ ç§è®¡ç®— exon è¡¨è¾¾ä¸°åº¦çš„æ–¹æ³•ï¼Œå·®å¼‚ä¸æ˜¯éå¸¸å¤§ã€‚å¦‚æœç»“æœæ˜¯æ˜¾è‘—çš„ï¼Œé‚£ä¹ˆé‡‡ç”¨ä¸Šé¢ä»»ä¸€è®¡ç®—æ–¹æ³•å¤§å¤šå‡å¯æ‰¾å‡ºæ˜¾è‘—ç»“æœã€‚ä½†æ˜¯å½“è¡¨è¾¾é£åº¦å·®å¼‚ä¸æ˜¯é‚£ä¹ˆæ˜¾è‘—æ—¶ï¼Œä¸æ˜“åŒºåˆ†ä¸åŒç±»åˆ«ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€è¦é€‰æ‹©å¯¹åº”çš„æ ‡å‡†åŒ–æ–¹æ³•ã€‚ æ³¨æ„ï¼šä»¥ä¸Š TotalMappedReads æ¨èé¦–é€‰æ¯”å¯¹åˆ°åŸºå› ç»„ä¸Šçš„æ€» reads æ•°ï¼Œè€Œä¸æ˜¯æ¯”å¯¹åˆ° exon æˆ–è€… gene ä¸Šæ€» reads æ•°ã€‚è¿™åŒæ ·éœ€è¦æ ¹æ®å®é™…æƒ…å†µè€Œç¡®å®šã€‚ å¦‚ä½•æ ¹æ® counts è®¡ç®— TPMï¼Ÿè¿™é‡Œæ‘˜å–ä¸€æ®µç½‘ç»œä»£ç ï¼š countToTpm &lt;- function(counts, effLen)&#123; rate &lt;- log(counts) - log(effLen) denom &lt;- log(sum(exp(rate))) exp(rate - denom + log(1e6))&#125;countToFpkm &lt;- function(counts, effLen)&#123; N &lt;- sum(counts) exp( log(counts) + log(1e9) - log(effLen) - log(N) )&#125;fpkmToTpm &lt;- function(fpkm)&#123; exp(log(fpkm) - log(sum(fpkm)) + log(1e6))&#125;countToEffCounts &lt;- function(counts, len, effLen)&#123; counts * (len / effLen)&#125;################################################################################# An example################################################################################cnts &lt;- c(4250, 3300, 200, 1750, 50, 0)lens &lt;- c(900, 1020, 2000, 770, 3000, 1777)countDf &lt;- data.frame(count = cnts, length = lens)# assume a mean(FLD) = 203.7countDf$effLength &lt;- countDf$length - 203.7 + 1countDf$tpm &lt;- with(countDf, countToTpm(count, effLength))countDf$fpkm &lt;- with(countDf, countToFpkm(count, effLength))with(countDf, all.equal(tpm, fpkmToTpm(fpkm)))countDf$effCounts &lt;- with(countDf, countToEffCounts(count, length, effLength)) æ˜¾è€Œæ˜“è§ï¼Œè¦æƒ³é€šè¿‡ counts è®¡ç®— TPMï¼Œå¿…é¡»çŸ¥é“ count,efflength,ä½†æœ€éš¾çš„ä¹Ÿæ˜¯è¿™ä¸ªæœ‰æ•ˆé•¿åº¦ what is effective length of the feature?I traced back to this paper by Lior pachter group Transcript assembly and quantification by RNA-Seq reveals unannotated transcripts and isoform switching during cell differentiation. It is quite mathematical, but the general idea is: If we take the fragment length to be fixed, then the effective length is how many fragments can occur in the transcript. This turns out to be length - frag_len +1. The number of fragments coming from a transcript will be proportional to this number, regardless of whether you sequenced one or both ends of the fragment. In turn, when it comes to probabilistically assigning reads to transcripts the effective length plays a similar role again. Thus for short transcripts, there can be quite a difference between two fragment lengths. To go back to your example if you have transcript of length 310, your effective length is 10 (if fragment length is 300) or 160 (if fragment length is 150) in either case, which explains the discrepancy you see. From @Rob The effective length is computed by using the fragment length distribution to determine the effective number of positions that can be sampled on each transcript. You can think of this as convolving the fragment length distribution with the characteristic function (the function that simply takes a value of 1) over the transcript. For example if we observe fragments of length 50 â€” 1000, a position more than 1000 bases from the end of the transcript will contribute a value of 1 to the effective length, while a position 150 bases will contribute a value of F(150), where F is the cumulative distribution function of the fragment length distribution. For single end data, where we canâ€™t learn an empirical FLD, we use a gaussian whose mean and standard deviation can be set with â€“fldMean and â€“fldSD respectively. From Harold Pimentelâ€™s post above. He is in Lior Pachterâ€™s group. Effective length refers to the number of possible start sites a feature could have generated a fragment of that particular length. In practice, the effective length is usually computed as: where uFDL is the mean of the fragment length distribution which was learned from the aligned read. If the abundance estimation method youâ€™re using incorporates sequence bias modeling (such as eXpress or Cufflinks), the bias is often incorporated into the effective length by making the feature shorter or longer depending on the effect of the bias. æ‰€ä»¥è¯´ï¼Œè‡ªå·±è®¡ç®— efflength ç›¸å½“éº»çƒ¦è€Œä¸”å¯èƒ½å‡ºé”™ï¼Œæœ‰æ²¡æœ‰ç®€å•çš„æ–¹æ³•å‘¢ï¼Ÿ æœ‰ï¼š ä½¿ç”¨ salmon è½¯ä»¶ä¼šè¿›è¡Œä¼ªæ¯”å¯¹è®¡ç®— TPM å’Œ count åŒæ—¶ä¼šå¾—åˆ°å¯¹åº”è½¬å½•æœ¬çš„æœ‰æ•ˆé•¿åº¦ï¼Œå°†å…¶è®¡ç®—ç»“æœä¸­æœ‰æ•ˆé•¿åº¦æå–å‡ºæ¥å³å¯ã€‚ é¦–å…ˆï¼Œæå–å¯¹åº”æœ‰æ•ˆé•¿åº¦ç»™ fc è®¡ç®—ç»“æœï¼š import pandas as pdimport os,globfc_dir=&quot;lncRNA/normal/tiqu_trans&quot;sm_dir=&quot;LncRNA/salmon/normal/lncRNA&quot;fc=glob.glob(os.path.join(fc_dir,&quot;*.lncRNA.trans.counts&quot;))for fs in fc: sample_name=fs.replace(&quot;lncRNA/normal/tiqu_trans/&quot;,&quot;&quot;).replace(&quot;.lncRNA.trans.counts&quot;,&quot;&quot;) df=pd.read_csv(fs,sep=&quot;\\t&quot;,header=0,skiprows=1).iloc[:,[0,1]].set_index(&quot;Geneid&quot;) df.columns=[&#x27;count&#x27;] df2=pd.read_csv(os.path.join(sm_dir,&quot;&#123;&#125;_quant&quot;.format(sample_name),&quot;quant.sf&quot;),sep=&quot;\\t&quot;,header=0).set_index(&quot;Name&quot;) df1=df.join(df2[[&#x27;EffectiveLength&#x27;]]) df1.to_csv(os.path.join(fc_dir,&quot;&#123;&#125;.lncRNA.trans_eff.counts&quot;.format(sample_name)),sep=&quot;\\t&quot;) ç„¶åè®¡ç®— TPMï¼š options(scipen = 200)options(digits = 3)for (name in Sys.glob(&quot;*.lncRNA.trans_eff.counts&quot;))&#123; countdata&lt;-read.table(name,sep=&quot;\\t&quot;,header = TRUE,row.names = &quot;Geneid&quot;) countToTpm &lt;- function(counts, effLen)&#123; rate &lt;- log(counts) - log(effLen) denom &lt;- log(sum(exp(rate))) exp(rate - denom + log(1e6)) &#125; countdata&lt;-na.omit(countdata) countdata$TPM&lt;-with(countdata,countToTpm(countdata$count,countdata$EffectiveLength)) id&lt;-unlist(strsplit(name,&quot;[.]&quot;))[1] write.table(countdata,paste(id,&quot;.lncRNA.trans.TPM&quot;,sep = &quot;&quot;),quote = FALSE,sep=&quot;\\t&quot;)&#125; ç„¶åï¼Œå°†æ‰€æœ‰çš„ TPM å†æ¬¡æ•´åˆåˆ°è¡¨è¾¾çŸ©é˜µä¸­ï¼š import pandas as pdimport globdf=pd.read_csv(&quot;sample.lncRNA.trans.TPM&quot;,sep=&quot;\\t&quot;)df=df[[&#x27;TPM&#x27;]]for name in glob.glob(&quot;*.TPM&quot;): sample=name.replace(&quot;.lncRNA.trans.TPM&quot;,&quot;&quot;) df2=pd.read_csv(name,sep=&quot;\\t&quot;) df2=df2[[&#x27;TPM&#x27;]] df2.columns=[sample] df=df.join(df2)df.drop([&#x27;TPM&#x27;],axis=1).to_csv(&quot;normal_lncRNA_trans_TPM.csv&quot;,sep=&quot;\\t&quot;) ç°åœ¨ï¼Œåˆæœ‰ä¸€ä¸ªé—®é¢˜äº†ã€‚â€¦â€¦åŸºå› çš„è¡¨è¾¾é‡æ€ä¹ˆç®—å‘¢ï¼ŒåŸºå› çš„æœ‰æ•ˆé•¿åº¦æ²¡æ³•ç®—å•Šï¼Œå› ä¸º salmon åªèƒ½è®¡ç®—è½¬å½•æœ¬çš„è¡¨è¾¾é‡å•Šã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬å½•æœ¬æ¨ç®—åŸºå› æœ‰æ•ˆé•¿åº¦ï¼š import argparseimport pandas as pdimport numpy as npimport sysdef main(args): gtable = pd.read_csv(args.ginput,skiprows=1,sep=&quot;\\t&quot;).set_index(&#x27;Geneid&#x27;) gtable = gtable.iloc[:,0:1] gtable.columns = [&#x27;Count&#x27;] ttable = pd.read_table(args.tinput).set_index(&#x27;Name&#x27;) tgmap = pd.read_table(args.tgmap, names=[&#x27;t&#x27;, &#x27;g&#x27;]).set_index(&#x27;t&#x27;) gene_lengths = &#123;&#125; j = 0 # Map over all gene groups (a gene and its associated transcripts) for g, txps in tgmap.groupby(&#x27;g&#x27;).groups.iteritems(): if j % 500 == 1: print(&quot;Processed &#123;&#125; genes&quot;.format(j)) j += 1 # The set of transcripts present in our salmon index tset = [] for t in txps: if t in ttable.index: tset.append(t) # If at least one of the transcripts was present if len(tset) &gt; 0: # The denominator is the sum of all TPMs totlen = ttable.loc[tset,&#x27;TPM&#x27;].sum() # Turn the relative TPMs into a proper partition of unity if totlen &gt; 0: tpm_fracs = ttable.loc[tset, &#x27;TPM&#x27;].values / ttable.loc[tset,&#x27;TPM&#x27;].sum() else: tpm_fracs = np.ones(len(tset)) / float(len(tset)) # Compute the gene&#x27;s effective length as the abundance-weight # sum of the transcript lengths elen = 0.0 for i,t in enumerate(tset): elen += tpm_fracs[i] * ttable.loc[t, &#x27;EffectiveLength&#x27;] gene_lengths[g] = elen # Give the table an effective length field gtable[&#x27;EffectiveLength&#x27;] = gtable.apply(lambda r : gene_lengths[r.name] if r.name in gene_lengths else 1.0, axis=1) # Write it to the output file gtable.to_csv(args.output, sep=&#x27;\\t&#x27;, index_label=&#x27;Name&#x27;)if __name__ == &quot;__main__&quot;: parser = argparse.ArgumentParser(description=&quot;Compute gene-level effective lengths&quot;) parser.add_argument(&#x27;--ginput&#x27;, type=str, help=&#x27;gene level input table&#x27;) parser.add_argument(&#x27;--tinput&#x27;, type=str, help=&#x27;transcript level input table&#x27;) parser.add_argument(&#x27;--tgmap&#x27;, type=str, help=&#x27;transcript -&gt; gene mapping&#x27;) parser.add_argument(&#x27;--output&#x27;, type=str, help=&#x27;output table with extra column&#x27;) args = parser.parse_args() main(args) python inferlength.py --ginput sample.lncRNA.counts --tinput sample.quant.sf --tgmap lnc_tx2gene.txt --output sample.eff.lnc.counts ç„¶åï¼Œè€åŠæ³•è®¡ç®— TPM,ç„¶åæ•´åˆã€‚ 6.å·®å¼‚åˆ†æå·®å¼‚åˆ†ææœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ç»„é—´å·®å¼‚ï¼Œä¸€ç§æ˜¯æ ·æœ¬é—´å·®å¼‚ï¼Œç»„é—´å·®å¼‚çš„æ„æ€å°±æ˜¯ï¼Œæœ‰ä¸¤ç»„æ ·æœ¬åšæ¯”è¾ƒï¼Œæ¯ç»„æ ·æœ¬é»˜è®¤å…¶éƒ½æ˜¯é‡å¤æ€§å®éªŒï¼Œå³ä¸¤ç»„è¿›è¡Œæ¯”è¾ƒï¼›è€Œæ ·æœ¬é—´å·®å¼‚æ„æ€å°±æ˜¯è™½ç„¶ä¹Ÿæ˜¯ä¸¤ä¸ªç»„è¿›è¡Œæ¯”è¾ƒï¼Œä½†æ˜¯æ¯ä¸ªç»„å†…çš„æ ·æœ¬æ˜¯ç‹¬ç«‹çš„ï¼Œä¹‹é—´ä¹Ÿæ˜¯æœ‰å·®å¼‚çš„ã€‚ å¯¹äºä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ¨èç»„é—´å·®å¼‚åˆ†æä½¿ç”¨deseq2;æ ·æœ¬é—´å·®å¼‚åˆ†æä½¿ç”¨degseq é€šå¸¸æƒ…å†µä¸‹å°±æ˜¯ï¼Œä½¿ç”¨ deseq2 æ•è·ä¸åˆ°çš„å·®å¼‚ï¼Œä¼šè¢« degseq å¾—åˆ°ï¼Œä½†æ˜¯å¦ç¬¦åˆå¿ƒä¸­é¢„æœŸï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥è¡¡é‡ï¼Œä¸€èˆ¬è¦åšçƒ­å›¾çš„è¯ï¼Œdegseq å¾—åˆ°çš„å·®å¼‚åŸºå› å¾ˆéš¾å½¢æˆçº¢ç™½å¯¹ç…§ï¼Œèšç±»çš„è¯ï¼Œæ ·æœ¬å’Œç»„å¾ˆéš¾èšåœ¨ä¸€èµ·ã€‚ Deseq2:library(DESeq2)path=getwd()normal&lt;-read.table(paste(path,&quot;/&quot;,&quot;normal_lncRNA_smcounts.csv&quot;,sep = &quot;&quot;),header = TRUE,row.names = &quot;Name&quot;,check.names=FALSE)sick&lt;-read.table(paste(path,&quot;/&quot;,&quot;sick_lncRNA_smcounts.csv&quot;,sep = &quot;&quot;),header = TRUE,row.names = &quot;Name&quot;,check.names=FALSE)mydata&lt;-cbind(normal,sick)sample&lt;-colnames(mydata)group_lst=c(rep(&quot;normal&quot;,length(colnames(normal))),rep(&quot;sick&quot;,length(colnames(sick))))colData &lt;- data.frame(row.names=sample,group_list=group_lst)dds &lt;- DESeqDataSetFromMatrix(countData = round(mydata),colData = colData,design = ~ group_list)register(MulticoreParam(4))dds2&lt;-DESeq(dds,parallel=TRUE)saveRDS(dds2,paste(path,&quot;/&quot;,&quot;lncRNA_normlized_by_deseq2_sm.rds&quot;,sep = &quot;&quot;))#suppressMessages(dds2)res &lt;- results(dds2, contrast=c(&quot;group_list&quot;,&quot;normal&quot;,&quot;sick&quot;))resOrdered &lt;- res[order(res$padj),]resOrdered=as.data.frame(resOrdered)diff_gene_deseq &lt;-subset(res, padj &lt; 0.05 &amp; abs(log2FoldChange) &gt; 1)write.table(diff_gene_deseq,file = paste(path,&quot;/&quot;,&quot;lncRNA_top_diff2_sm.txt&quot;,sep = &quot;&quot;),quote = FALSE,sep=&quot;\\t&quot;)plotdata&lt;-counts(dds2, normalized = TRUE)write.table(plotdata,file = paste(path,&quot;/&quot;,&quot;lncRNA_normlized_by_deseq2_sm.txt&quot;,sep = &quot;&quot;),quote = FALSE,sep=&quot;\\t&quot;) Degseq:library(qvalue)library(samr)library(impute)library(matrixStats)library(&quot;DEGseq&quot;)path=getwd()normal&lt;-read.table(paste(path,&quot;/&quot;,&quot;normal_lncRNA_smcounts.csv&quot;,sep = &quot;&quot;),header = TRUE,row.names = &quot;Name&quot;,check.names=FALSE)sick&lt;-read.table(paste(path,&quot;/&quot;,&quot;sick_lncRNA_smcounts.csv&quot;,sep = &quot;&quot;),header = TRUE,row.names = &quot;Name&quot;,check.names=FALSE)mydata&lt;-cbind(normal,sick)write.table(mydata,paste(path,&quot;/&quot;,&quot;lncRNA_all_smcounts.txt&quot;,sep = &quot;&quot;),quote=FALSE,sep=&quot;\\t&quot;)matrix1 &lt;- readGeneExp(paste(path,&quot;/&quot;,&quot;lncRNA_all_smcounts.txt&quot;,sep = &quot;&quot;), geneCol=1, valCol=c(2:83))matrix2 &lt;- readGeneExp(paste(path,&quot;/&quot;,&quot;lncRNA_all_smcounts.txt&quot;,sep = &quot;&quot;), geneCol=1, valCol=c(84:207))DEGexp(geneExpMatrix1=matrix1, geneCol1=1, expCol1=c(2:83), groupLabel1=&quot;nomal&quot;, geneExpMatrix2=matrix2, geneCol2=1, expCol2=c(2:125), groupLabel2=&quot;sick&quot;, pValue=1e-3, zScore=4, qValue=1e-3, foldChange=2, thresholdKind=5, method=&quot;MARS&quot;, outputDir=path) åˆå¹¶ caseï¼Œcontrol çš„ TPM åˆ°ä¸€ä¸ªçŸ©é˜µï¼špath=getwd()normal&lt;-read.table(paste(path,&quot;/&quot;,&quot;normal_mRNA_smTPM.csv&quot;,sep = &quot;&quot;),row.names=&quot;Name&quot;,header = TRUE,check.names=FALSE)sick&lt;-read.table(paste(path,&quot;/&quot;,&quot;sick_mRNA_smTPM.csv&quot;,sep = &quot;&quot;),row.names=&quot;Name&quot;,header = TRUE,check.names=FALSE)mydata&lt;-cbind(normal,sick)write.table(mydata,&quot;mRNA.salmon.TPM.txt&quot;,sep=&quot;\\t&quot;,quote=FALSE) å°†è¡¨è¾¾é‡ä¸º 0 çš„è¿‡æ»¤æ‰ï¼špath=getwd()mydata&lt;-read.table(paste(path,&quot;mRNA.salmon.TPM.txt&quot;,sep=&quot;/&quot;),header=TRUE)#è¿™é‡Œä¹Ÿå¯ä»¥åœ¨read.tableé‡Œé¢æ·»åŠ check.names=FALSEcolnames(mydata)&lt;-gsub(&quot;X&quot;,&quot;&quot;,colnames(mydata))top_m&lt;-read.table(paste(path,&quot;top_mRNA_degseq_fliter.csv&quot;,sep=&quot;/&quot;),header=TRUE,sep=&quot;\\t&quot;)top_m_TPM&lt;-mydata[top_m$GeneNames,]top_m_filter&lt;-top_m_TPM[apply(top_m_TPM,1,mean)&gt;0,]write.table(top_m_filter,&quot;top_m_filter.txt&quot;,sep=&quot;\\t&quot;,quote=FALSE) 7.å¯¹è·å–åˆ°çš„å·®å¼‚è½¬å½•æœ¬åš GO PATHWAY å¯Œé›†åˆ†æä¸æ¨èä½¿ç”¨ Y å”çš„clusterprofile,è¿™ä¸ªè½¯ä»¶è™½ç„¶æ˜“ç”¨ï¼Œä½†æ˜¯æ³¨é‡Šä¿¡æ¯éå¸¸æœ‰é™ï¼ŒåŠŸèƒ½ä¹Ÿä¸å®Œå–„ï¼Œåšå¯Œé›†åˆ†æå’Œæ³¨é‡Šï¼Œè¿˜æ˜¯éœ€è¦ä½¿ç”¨åœ¨çº¿çš„æ•°æ®åº“æ³¨é‡Šï¼Œè¿™é‡Œæ¨èå‡ ä¸ªéå¸¸å¥½çš„ç½‘ç«™ï¼š DAVID metascape webgestalt BioDbNet DAVIDè¿™ä¸ªç½‘ç«™è¢«è¯Ÿç—…è®¸ä¹…ï¼Œå¤§å®¶éƒ½åœ¨åæ§½å®ƒæ›´æ–°ç¼“æ…¢çš„æ•°æ®åº“ï¼Œä½†æ˜¯ç”¨èµ·æ¥è¿˜æ˜¯çœŸé¦™ï¼Œæ»‘ç¨½ã€‚ metascapeæ˜¯æˆ‘ç”¨è¿‡çš„è¿„ä»Šä¸ºæ­¢æœ€å¥½ç”¨çš„ç½‘ç«™ï¼Œå®ƒå¯ä»¥æ¥å—å‡ ä¹æ‰€æœ‰çš„ idï¼Œåšçš„åˆ†ææœ‰ä¸€èˆ¬åˆ†æå’Œè‡ªå®šä¹‰åˆ†æï¼Œè‡ªå®šä¹‰åˆ†æé‡Œé¢å¯ä»¥å¸®åŠ©æŒ‘é€‰å‡ºæˆ‘ä»¬æƒ³è¦çš„é€šè·¯ï¼Œå¾—åˆ°å…¶å¯¹åº”çš„åŸºå› ï¼Œè¿™ä¸ªçœŸçš„éå¸¸å¥½ç”¨ï¼Œè€Œä¸”å®ƒæœ‰ä¸€ä¸ª excel æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨ Excel é‡Œé¢è¿è¡Œï¼Œ webgestaltè¿™ä¸ªå¯èƒ½æˆ‘è¿˜æ²¡å‘è§‰å®ƒçœŸæ­£çš„åŠŸèƒ½ï¼Œæˆ‘ç”¨ç€ä¸å¥½ç”¨ï¼Œå¯Œé›†ä¸å…¨ï¼Œä½†æ˜¯å›¾åšçš„å¥½ï¼Œè¿™ä¸ªæ²¡å¾—é»‘ã€‚ BioDbNetè¿™ä¸ªç½‘ç«™ç®€ç›´å…¨èƒ½ï¼Œå¯ä»¥åš id è½¬æ¢ï¼Œè¿˜å¯ä»¥åšå…¨æ³¨é‡Šï¼Œå¼ºæ— æ•Œï¼ï¼ï¼ å¯¹ LncRNA çš„æ³¨é‡Šï¼Œå¯ä»¥ä½¿ç”¨ R åŒ…LncPathï¼Œè¿™ä¸ªåŒ…ç”¨æ³•ç®€å•ï¼Œä½†æœ€å¥½éœ€è¦é…åˆWGCNAä½¿ç”¨ 8.å¯¹å¾—åˆ°çš„å·®å¼‚åŸºå› åšå¯è§†åŒ–ç›®å‰æˆ‘æ‰€åšçš„å¯è§†åŒ–æ— éä¸¤ç§ï¼Œä¸€ç§æ˜¯èšç±»çƒ­å›¾ï¼Œå¦ä¸€ç§æ˜¯ç®±çº¿å›¾æˆ–è€…å°æç´å›¾ï¼Œä¸€ç§åº”ç”¨äºå¤§é‡åŸºå› ï¼Œå¦ä¸€ç§æ˜¯å°‘é‡åŸºå› çš„æƒ…å†µã€‚ çƒ­å›¾å¾ˆç®€å•ï¼Œç›´æ¥ç”¨è¡¨è¾¾çŸ©é˜µå’Œåˆ†ç»„ä¿¡æ¯åšå°±å¯ä»¥äº†ï¼Œé»˜è®¤å‚æ•°ï¼Œæ•°æ®æœ€å¥½ log2(n+1) ç®±çº¿å›¾åŒç†ï¼Œggplot2 å°±å¯ä»¥åšäº† å¦å¤–ä¸€ç§å›¾æ˜¯ç½‘ç»œäº¤äº’å›¾ï¼Œä½¿ç”¨ igraph 9.å¯»æ‰¾ lncRNA çš„é¶åŸºå› é’ˆå¯¹ lncRNA ç ”ç©¶ï¼Œå…¶ä¸­æ¯”è¾ƒå…³é”®çš„ç‚¹æ˜¯ç¡®å®š lncRNA çš„é¶åŸºå› ï¼Œå¦‚æœèƒ½å¤Ÿæœ‰æ–¹æ³•é¢„æµ‹åˆ° lncRNA çš„é¶åŸºå› ï¼Œä¼šå‡è½»æˆ‘ä»¬çš„å·¥ä½œé‡ã€‚è€Œå¦‚ä½•å»æµ‹ lncRNA çš„é¶åŸºå› ï¼Œå¯ä»¥ä» lncRNA ä¸åŒçš„ä½œç”¨æ¨¡å¼å…¥æ‰‹ã€‚ lncRNAs ä½œç”¨èŒƒå›´å¹¿æ³›ï¼Œæœºåˆ¶éå¸¸å¤æ‚ã€‚æ ¹æ® lncRNA ä¸åŒçš„ä½œç”¨æ¨¡å¼æ¯”å¦‚é¡ºå¼ï¼ˆcisï¼‰å’Œåå¼ï¼ˆtransï¼‰ä¹‹åˆ†ï¼Œæ¯”å¦‚ Signalï¼ŒDecoyï¼ŒDuideï¼ŒScaffoldï¼Œä¹Ÿå¯ä»¥æ ¹æ® lncRNA ä¸ä¸åŒçš„åˆ†å­åˆ†ä¸º DNAã€RNA å’Œè›‹ç™½ï¼Œæ€»ä½“ä¸ŠåŒ…æ‹¬äº†è½¬å½•å’Œè½¬å½•åæ°´å¹³ã€‚ æ ¹æ®é¡ºå¼ï¼ˆcisï¼‰å’Œåå¼ï¼ˆtransï¼‰çš„ä½œç”¨æ¨¡å¼æ¥é¢„æµ‹RNA èšåˆé…¶è½¬å½•å¾—åˆ°ä¸€ä¸ªä¸è°ƒæ§è›‹ç™½ç›¸å…³çš„ LncRNA ä»è€Œå½±å“é™„è¿‘åŒºåŸŸçš„ç¼–ç åŸºå› ã€‚ cis ä½œç”¨é¶åŸºå› é¢„æµ‹ï¼Œè®¤ä¸º LncRNA çš„åŠŸèƒ½ä¸å…¶åæ ‡ä¸´è¿‘çš„è›‹ç™½ç¼–ç åŸºå› ç›¸å…³ï¼Œä½äºç¼–ç è›‹ç™½ä¸Šä¸‹æ¸¸çš„ LncRNA å¯èƒ½ä¸å¯åŠ¨å­æˆ–è€…å…±è¡¨è¾¾åŸºå› çš„å…¶ä»–é¡ºå¼ä½œç”¨å…ƒä»¶æœ‰äº¤é›†ï¼Œä»è€Œåœ¨è½¬å½•æˆ–è€…è½¬å½•åæ°´å¹³å¯¹åŸºå› çš„è¡¨è¾¾è¿›è¡Œè°ƒæ§ã€‚åˆ¤æ–­ä¸€ä¸ª LncRNA å…·æœ‰ Cis è°ƒæ§ä½œç”¨é€šå¸¸è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š é™„è¿‘çš„åŸºå› è¡¨è¾¾æƒ…å†µä¸å…¶ä¿æŒä¸€è‡´ï¼› è¯¥åŸºå› å¤±æ´»åä¼šå½±å“å‘¨å›´åŸºå› çš„è¡¨è¾¾ï¼› ä¼šå½±å“é™„è¿‘åŒä¸€ä½ç‚¹çš„åŸºå› è¡¨è¾¾ã€‚ å¯¹äºæ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ LncRNAï¼Œé¦–å…ˆæ‰¾å‡ºä½äºå…¶ä¸Šæ¸¸æˆ–è€…ä¸‹æ¸¸é™„è¿‘ï¼ˆ10Kï¼‰çš„ç¼–ç è›‹ç™½åŸºå› ï¼Œé€šè¿‡å¯¹ç¼–ç è›‹ç™½çš„åŠŸèƒ½å¯Œé›†åˆ†æï¼Œä»è€Œé¢„æµ‹ LncRNA çš„ä¸»è¦åŠŸèƒ½ï¼Œä¸ºåç»­ Cis ä½œç”¨åˆ†ææ‰“ä¸‹åŸºç¡€ã€‚ LncRNA ä¸ DNA ç»“åˆè›‹ç™½ç›¸å…³è”ï¼Œå¹¶è°ƒæ§ç›¸å…³é¶åŸºå› çš„è¡¨è¾¾ã€‚ Trans ä½œç”¨é¶åŸºå› é¢„æµ‹åŸºæœ¬åŸç†è®¤ä¸º LncRNA çš„åŠŸèƒ½è·Ÿç¼–ç åŸºå› çš„ä½ç½®å…³ç³»æ²¡æœ‰å…³ç³»ï¼Œè€Œä¸å…¶å…±è¡¨è¾¾çš„è›‹ç™½ç¼–ç åŸºå› ç›¸å…³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ LncRNA ä¸ä¸€äº›è·ç¦»è¾ƒè¿œçš„åŸºå› åœ¨è¡¨è¾¾é‡ä¸Šå­˜åœ¨æ­£ç›¸å…³æˆ–è´Ÿç›¸å…³çš„æƒ…å†µæ—¶ï¼Œå°±å¯ä»¥é€šè¿‡æ ·æœ¬é—´ lncRNA ä¸è›‹ç™½ç¼–ç åŸºå› çš„è¡¨è¾¾é‡ç›¸å…³æ€§åˆ†ææˆ– WGCNA å…±è¡¨è¾¾åˆ†ææ¥é¢„æµ‹å…¶é¶åŸºå› ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒlncRNA çš„ Trans ä½œç”¨é¶åŸºå› é¢„æµ‹åªé€‚åˆäºæ ·æœ¬é‡å¤§çš„æƒ…å†µï¼Œå¦‚æœæ ·æœ¬é‡å¤ªå°‘ï¼ˆå¦‚ 6 ä¸ªä»¥ä¸‹ï¼‰ï¼Œåˆ†æå°†ä¸å¯é ã€‚ æ‰€ä»¥ï¼Œæˆ‘çš„åˆ†ææ–¹æ³•æ˜¯ï¼Œé¦–å…ˆåˆ†æç›¸å…³æ€§ï¼Œä½¿ç”¨ p å€¼ï¼ˆFDRï¼‰å’Œç›¸å…³æ€§å‚æ•°ç¡®å®šç›¸å…³æ€§è¾ƒå¼ºçš„åŸºå› ä½œä¸ºå¤‡é€‰ ç„¶åï¼Œåˆ†æ mRNA ä¸Šæ¸¸ 10K å’Œä¸‹æ¸¸ 20K çš„ lncRNA ä½œä¸º cisï¼›ä¸åœ¨èŒƒå›´å†…çš„ä½¿ç”¨ RNAplex è®¡ç®—ç»“åˆèƒ½ï¼Œç»“åˆèƒ½å°äº-30 ä½œä¸º trans è®¡ç®—ç›¸å…³æ€§ï¼š library(&quot;fdrtool&quot;)base&lt;-getwd()mydata&lt;-read.table(paste(base,&quot;top_m_filter.txt&quot;,sep=&quot;/&quot;),header=TRUE,check.names=FALSE)mydata&lt;-as.data.frame(t(mydata))chayi&lt;-read.table(paste(base,&quot;top_lnc_filter.txt&quot;,sep=&quot;/&quot;),header=TRUE,check.names=FALSE)chayi&lt;-as.data.frame(t(chayi))core&lt;-function(x,y)&#123; cor.test(x,y)$estimate&#125;pval&lt;-function(x,y)&#123; cor.test(x,y)$p.value&#125;fdr&lt;-function(x)&#123; fdr&lt;-fdrtool(x,statistic=&quot;pvalue&quot;) fdr$qval&#125;mycor&lt;-data.frame(test=rep(0,length(colnames(mydata))))for (i in 1:length(colnames(chayi)))&#123; haha&lt;-0 for (j in 1:length(colnames(mydata)))&#123; xiangguan&lt;-core(chayi[,i],mydata[,j]) haha&lt;-c(haha,xiangguan) &#125; mycor&lt;-cbind(mycor,as.data.frame(haha)[-1,])&#125;mycor&lt;-mycor[,-1]colnames(mycor)&lt;-colnames(chayi)rownames(mycor)&lt;-colnames(mydata)write.table(mycor,paste(base,&quot;correlation2.txt&quot;,sep=&quot;/&quot;),quote=FALSE)myp&lt;-data.frame(test=rep(0,length(colnames(mydata))))for (i in 1:length(colnames(chayi)))&#123; haha&lt;-0 for (j in 1:length(colnames(mydata)))&#123; xiangguan&lt;-pval(chayi[,i],mydata[,j]) haha&lt;-c(haha,xiangguan) &#125; myp&lt;-cbind(myp,as.data.frame(haha)[-1,])&#125;myp&lt;-myp[,-1]colnames(myp)&lt;-colnames(chayi)rownames(myp)&lt;-colnames(mydata)mfdr&lt;-apply(myp,2,fdr)write.table(mfdr,paste(base,&quot;p_values(FDR)2.txt&quot;,sep=&quot;/&quot;),quote=FALSE)##guolvhaha&lt;-data.frame(&quot;correlation&quot;=0,&quot;mRNA&quot;=0,&quot;lncRNA&quot;=0)xiangguan&lt;-read.table(paste(base,&quot;correlation2.txt&quot;,sep=&quot;/&quot;),header = TRUE)for (i in colnames(xiangguan))&#123; if (length(row.names(subset(xiangguan,abs(xiangguan[,i])&gt;0.6,select = i)))==0)&#123; next &#125;else&#123; xiang&lt;-subset(xiangguan,abs(xiangguan[,i])&gt;0.6,select = i) colnames(xiang)&lt;-&quot;correlation&quot; xiang$mRNA&lt;-rownames(xiang) xiang$lncRNA&lt;-i rownames(xiang)&lt;-NULL haha&lt;-rbind(haha,xiang) &#125;&#125;heihei&lt;-data.frame(&#x27;p_values(FDR)&#x27;=0,&quot;mRNA&quot;=0,&quot;lncRNA&quot;=0)colnames(heihei)[1]&lt;-&quot;p_values(FDR)&quot;xiangguan&lt;-read.table(paste(base,&quot;p_values(FDR)2.txt&quot;,sep=&quot;/&quot;),header = TRUE)for (i in colnames(xiangguan))&#123; if (length(row.names(subset(xiangguan,xiangguan[,i]&lt;0.05,select = i)))==0)&#123; next &#125;else&#123; xiang&lt;-subset(xiangguan,xiangguan[,i]&lt;0.05,select = i) colnames(xiang)&lt;-&quot;p_values(FDR)&quot; xiang$mRNA&lt;-rownames(xiang) xiang$lncRNA&lt;-i rownames(xiang)&lt;-NULL heihei&lt;-rbind(heihei,xiang) &#125;&#125;haha&lt;-haha[-1,]heihei&lt;-heihei[-1,]fin&lt;-merge(haha,heihei,by.x = c(&quot;lncRNA&quot;,&quot;mRNA&quot;),by.y = c(&quot;lncRNA&quot;,&quot;mRNA&quot;))write.table(fin,paste(base,&quot;xiangguanxing2.txt&quot;,sep=&quot;/&quot;),quote = FALSE,row.names = FALSE) note: è¿™é‡Œè®¡ç®—çš„æ–¹æ³•æ˜¯ä½¿ç”¨ for å¾ªç¯è¿­ä»£ç»“ç®—ï¼Œæ•ˆç‡è¾ƒä½ï¼Œä¸é€‚åˆä¸å¤§é‡æ•°æ®ï¼Œè€Œä¸”è¿™é‡Œä¸¤ä¸ªæ•°æ®è¡¨ä¸€å®šè¦æœ‰ç›¸åŒçš„æ ·æœ¬é¡ºåºï¼Œä¸ç„¶è®¡ç®—çš„ç›¸å…³æ€§å’Œ P å€¼ä¼šæœ‰æ˜¾è‘—çš„ä¸åŒã€‚æœ€åï¼Œå¯¹äº FDR çŸ«æ­£ï¼Œè¿™é‡Œåªæ˜¯é’ˆå¯¹ä¸€ä¸ª lncRNA å’Œå¤šä¸ª mRNA çš„ P å€¼åšäº†çŸ«æ­£ã€‚ library(Hmisc)library(reshape2)library(fdrtool)lncRNA&lt;-read.table(&quot;lncRNA_difference.txt&quot;,header = TRUE,check.names = FALSE,stringsAsFactors = FALSE,sep=&quot;\\t&quot;)mRNA&lt;-read.table(&quot;mRNA_difference.txt&quot;,header = TRUE,check.names = FALSE,stringsAsFactors = FALSE,sep=&quot;\\t&quot;)n_lnc&lt;-nrow(lncRNA)n_mRNA&lt;-nrow(mRNA)alldata&lt;-rbind(lncRNA,mRNA)mydata&lt;-as.matrix(t(alldata))p&lt;-rcorr(mydata)cor&lt;-p[[&quot;r&quot;]][1:n_lnc,(n_lnc+1):nrow(alldata)]pvalue&lt;-p[[&quot;P&quot;]][1:n_lnc,(n_lnc+1):nrow(alldata)]cor&lt;-cbind(rownames(cor),cor)colnames(cor)[1]&lt;-&quot;LncRNA&quot;pvalue&lt;-cbind(rownames(pvalue),pvalue)colnames(pvalue)[1]&lt;-&quot;LncRNA&quot;new_cor&lt;-melt(as.data.frame(cor),id.vars=&quot;LncRNA&quot;,variable.name = &quot;mRNA&quot;,value.name = &quot;correlation&quot;)new_p&lt;-melt(as.data.frame(pvalue),id.vars=&quot;LncRNA&quot;,variable.name = &quot;mRNA&quot;,value.name = &quot;p.value&quot;)jiaozheng&lt;-function(x)&#123;fdrtool(x,statistic = &quot;pvalue&quot;,plot = FALSE,verbose = FALSE)$qval&#125;all_cor&lt;-merge(new_cor, new_p, by.x=c(&quot;LncRNA&quot;,&quot;mRNA&quot;), by.y=c(&quot;LncRNA&quot;,&quot;mRNA&quot;))all_cor&lt;-na.omit(all_cor)all_cor$p.value&lt;-as.numeric(all_cor$p.value)all_cor$correlation&lt;-as.numeric(all_cor$correlation)all_cor$p.asjust&lt;-jiaozheng(all_cor$p.value)all_fli&lt;-subset(all_cor,abs(all_cor$correlation)&gt;0.6&amp;all_cor$p.asjust&lt;0.05)write.table(all_fli,&quot;xiangguanxing.txt&quot;,quote=FALSE,row.names=FALSE) è¿™ä¸ªè„šæœ¬å¯ä»¥è§£å†³è¿­ä»£é—®é¢˜ï¼Œè€Œä¸”é¿å…äº†æ ·æœ¬ä¸ä¸€è‡´çš„æƒ…å†µã€‚è®¡ç®— cis é¦–å…ˆï¼Œè·å– bed æ–‡ä»¶ anno_m&lt;-read.table(&quot;LncRNA/readscounts/gene_hit/hg19_all_transcript.bed&quot;,sep = &quot;\\t&quot;,header = FALSE)anno_lnc&lt;-read.table(&quot;LncRNA/readscounts/gene_hit/NONCODE.bed&quot;,sep = &quot;\\t&quot;,header = FALSE)chayi&lt;-read.table(&quot;xiangguanxing2.txt&quot;,header = TRUE)lncRNA&lt;-subset(anno_lnc,V4%in%chayi$lncRNA)mRNA&lt;-subset(anno_m,V4%in%chayi$mRNA)write.table(lncRNA,&quot;lncRNA.bed&quot;,sep = &quot;\\t&quot;,row.names = FALSE,col.names = FALSE,quote = FALSE)write.table(mRNA,&quot;mRNA.bed&quot;,sep = &quot;\\t&quot;,row.names = FALSE,col.names = FALSE,quote = FALSE) æ‰€æœ‰åŸºå› çš„ bed æ–‡ä»¶ noncode.bed å’Œ hg19.bed å¯ä»¥åœ¨ç½‘ä¸Šä¸‹è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå·±åšï¼Œè‡ªå·±åšçš„è¯ä½¿ç”¨ python çš„ gtf_parse åŒ…å¯¹ gtf æ–‡ä»¶è¿›è¡Œè§£æï¼Œç„¶ååšä¸€ä¸ªå°±è¡Œäº† ç„¶åï¼Œä½¿ç”¨ bedtools è®¡ç®—ä½ç½®ä¿¡æ¯ï¼š windowBed -a mRNA.bed -b LncRNA.bed -l 10240 -r 20480 -sm &gt; cis.txt è®¡ç®— trans ç»“åˆèƒ½ï¼Œéœ€è¦é¦–å…ˆè·å–è½¬å½•ç»„åºåˆ—ï¼Œç„¶åè¿è¡Œ RNAplex import pandas as pdimport subprocess,os,refrom Bio import SeqIOhg19=&quot;LncRNA/testdir/all_mRNA_know.fa&quot;noncode=&quot;LncRNA/testdir/all_lncRNA_know.fa&quot;base=&quot;LncRNA/readscounts/salmon/gene_hit&quot;hg19_fasta=&#123;seq_record.id:str(seq_record.seq) for seq_record in SeqIO.parse(hg19,&#x27;fasta&#x27;)&#125;lnc_fasta=&#123;seq_record.id:str(seq_record.seq) for seq_record in SeqIO.parse(noncode,&#x27;fasta&#x27;)&#125;def get_energy(lncRNA,mRNA): fa=&quot;lnc_tmp.fasta&quot; fa2=&quot;mRNA_tmp.fasta&quot; with open(fa2,&#x27;w&#x27;) as f: f.write(&quot;&gt;&#123;&#125;\\n&#123;&#125;&quot;.format(mRNA,hg19_fasta[mRNA])) with open(fa,&#x27;w&#x27;) as l: l.write(&quot;&gt;&#123;&#125;\\n&#123;&#125;&quot;.format(lncRNA,lnc_fasta[lncRNA])) get_energy=[&#x27;app/RNAplex-0.2/RNAplex/bin/RNAplex&#x27;,&#x27;-t&#x27;,fa2,&#x27;-q&#x27;,fa] cm3=subprocess.Popen(get_energy,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE) out,err=cm3.communicate() ans=0 for line in out.decode(&quot;utf-8&quot;).splitlines(): if not line.startswith(&quot;&gt;&quot;): ans=re.findall(&quot;\\(-?\\w+.?\\w+\\)&quot;,line)[0].replace(&quot;(&quot;,&quot;&quot;).replace(&quot;)&quot;,&quot;&quot;) #print(ans) os.remove(fa2) os.remove(fa) return answith open(&quot;xiangguanxing2.txt&quot;) as f: for line2 in f: if line2.startswith(&quot;NONH&quot;): lncRNA,mRNA,*ot=line2.split(&quot; &quot;) print(&quot;&#123;&#125;--&#123;&#125;:&quot;.format(lncRNA,mRNA),get_energy(lncRNA,mRNA)) æ³¨æ„ï¼šè¿™é‡Œæƒ³è¦è·å–è½¬å½•æœ¬åºåˆ—ï¼Œåƒä¸‡ä¸è¦ä½¿ç”¨ bedtools getfastï¼Œå› ä¸ºè¿™æ ·è·å–çš„æ˜¯æ•´ä¸ªè½¬å½•æœ¬çš„åŸºå› ç»„åºåˆ—ï¼ŒåŒ…å«å†…å«å­ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ cufflinks è½¯ä»¶ä¸­ gffread å‘½ä»¤æ¥è·å–è½¬å½•æœ¬åºåˆ— gffread -w out.fa -g hg19.fa in.gtf æ ¹æ® lncRNA ç»“åˆçš„æ ¸é…¸åºåˆ—æ¥é¢„æµ‹å®é™…ä¸Šè¿™ç§æ–¹å¼æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼Œå› ä¸º lncRNA æ˜¯æ ¸é…¸ï¼Œè€Œæ ¸é…¸ä¸æ ¸é…¸ä¹‹é—´æ˜¯æœ‰ç¢±åŸºäº’è¡¥é…å¯¹çš„ï¼Œä¸ç®¡æ˜¯ lncRNA ä¸ RNAï¼ˆæ¯”å¦‚ microRNAï¼ŒmRNAï¼‰ä¹‹é—´è¿˜æ˜¯ lncRNA ä¸ DNA ä¹‹é—´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®äº’è¡¥é…å¯¹è¿™ä¸€ç‰¹æ€§è¿›è¡Œé¢„æµ‹ã€‚è¿™é‡Œæˆ‘ä»¬å±•å¼€ä¸¾ä¸‰ä¸ªä¾‹å­ï¼š Aã€lncRNA-microRNA-mRNA microRNA å¯¹ mRNA é¶åŸºå› é¢„æµ‹çš„æ–¹å¼å¯ä»¥åè¿‡æ¥ç”¨äº lncRNA é¶åŸºå› é¢„æµ‹ï¼Œè¿™é‡Œé€‚ç”¨çš„æ¨¡å¼å°±æ˜¯ lncRNA ä½œä¸º microRNA sponge å¸é™„ microRNAï¼Œæˆ–è€…è¿›ä¸€æ­¥é€šè¿‡ ceRNA çš„ä½œç”¨æœºåˆ¶è°ƒæ§é¶åŸºå› ï¼ŒåŸç†éƒ½æ˜¯ microRNA ä¸ lncRNA å’Œ mRNA çš„åºåˆ—ç»“åˆï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯ç°åœ¨é¢„æµ‹é¶åŸºå› ç”¨çš„æœ€å¤šçš„ï¼Œæ¯”å¦‚ç½‘ç«™ï¼šstarbaseï¼ˆhttp://starbase.sysu.edu.cn/ï¼‰ã€‚ Bã€lncRNA-mRNA åœ¨ä¸Šé¢è¿™ç§æ¨¡å¼é‡Œï¼ŒlncRNA å¯¹é¶åŸºå›  mRNA çš„è°ƒæ§æ˜¯é€šè¿‡ microRNA æ¥ä»‹å¯¼çš„ï¼Œå½“ç„¶ lncRNA ä¸ mRNA ä¹‹é—´çš„ç›´æ¥äº’è¡¥ä¹Ÿèƒ½å¸®æˆ‘ä»¬é¢„æµ‹é¶åŸºå› ï¼Œè¿™ç§æ¨¡å¼æˆ‘ä»¬ä»¥å‰è¯´è¿‡ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯åä¹‰ lncRNAï¼ˆAntisense lncRNAï¼‰é€šè¿‡ä¸ mRNA ç»“åˆå½¢æˆ RNA äºŒèšä½“https://www.jianshu.com/p/92451bd7c030ï¼Œä¿æŠ¤ mRNA ä½¿ä¹‹æ›´éš¾è¢« RNA é…¶é™è§£ã€‚å› æ­¤è¿™ç§æ¨¡å¼æ¥é¢„æµ‹é¶åŸºå› çš„åŸç†æ˜¯é¢„æµ‹ lncRNA åºåˆ—ä¸ mRNA åºåˆ—ç»“åˆçš„è‡ªç”±èƒ½ï¼Œè‡ªç”±èƒ½è¶Šå°ï¼Œè¶Šå®¹æ˜“ç»“åˆã€‚è¿™ç§æ¨¡å¼çš„åœ¨çº¿å·¥å…·æœ‰ lncRNATargetsï¼ˆhttp://www.herbbol.org:8001/lrt/ï¼‰ Cã€lncRNA-DNA åœ¨ä»¥å‰æ–‡ç« ä¸­æˆ‘ä»¬ä¹Ÿä»‹ç»è¿‡ lncRNA é€šè¿‡ç»“åˆå•é“¾ DNA å‘æŒ¥è°ƒæ§ä½œç”¨çš„ï¼š å› æ­¤ï¼ŒåŸºäºåŒæ ·çš„åŸç†ï¼Œç†è®ºä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œé¢„æµ‹ï¼Œè¿™ç§é¢„æµ‹å·¥å…· lncRNATargets åŒæ ·å¯å®ç°ã€‚ æ ¹æ®è›‹ç™½çš„ç»“åˆç‰¹æ€§æ¥é¢„æµ‹:lncRNA æ ¸é…¸ä¸æ ¸é…¸ç»“åˆä¾æ®çš„æ˜¯ç¢±åŸºé…å¯¹åŸç†ï¼ŒåŒæ ·æŸäº›è›‹ç™½ä¸æ ¸é…¸çš„ç»“åˆä¹Ÿæœ‰ä¸€å®šè§„å¾‹ï¼Œæ¯”å¦‚ RNA ç»“åˆè›‹ç™½ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ®è¿™äº›è§„å¾‹é¢„æµ‹ lncRNA çš„ç»“åˆè›‹ç™½ï¼Œæ¯”å¦‚å·¥å…·åŒ…æ‹¬ RBPDBï¼ˆhttp://rbpdb.ccbr.utoronto.ca/index.phpï¼‰ã€RNAcommenderï¼ˆhttp://rnacommender.disi.unitn.it/ï¼‰ç­‰ã€‚","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"},{"name":"è½¬å½•ç»„","slug":"è½¬å½•ç»„","permalink":"https://xiaohanys.top/tags/%E8%BD%AC%E5%BD%95%E7%BB%84/"}],"author":"Xiaoguang Pan"},{"title":"æ•™ç¨‹ï¼šæ•´åˆåˆºæ¿€æ€§å’Œå¯¹ç…§æ€§PBMCæ•°æ®é›†ï¼Œä»¥å­¦ä¹ ç»†èƒç±»å‹ç‰¹å¼‚æ€§ååº”","slug":"æ•´åˆåˆºæ¿€æ€§å’Œå¯¹ç…§æ€§PBMCæ•°æ®é›†","date":"2019-10-20T05:02:08.000Z","updated":"2024-10-18T05:33:27.315Z","comments":true,"path":"scrna-diff/","permalink":"https://xiaohanys.top/scrna-diff/","excerpt":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ æœ¬æ•™ç¨‹ä»‹ç»äº†Kangç­‰äººï¼ˆ2017)çš„ä¸¤ç»„PBMCçš„å¯¹é½æ–¹å¼ã€‚åœ¨è¯¥å®éªŒä¸­ï¼Œå°†PBMCåˆ†ä¸ºåˆºæ¿€ç»„å’Œå¯¹ç…§ç»„ï¼Œå¹¶ç”¨å¹²æ‰°ç´ Î²æ²»ç–—åˆºæ¿€ç»„ã€‚å¯¹å¹²æ‰°ç´ çš„ååº”å¼•èµ·ç»†èƒç±»å‹ç‰¹å¼‚æ€§åŸºå› è¡¨è¾¾çš„å˜åŒ–ï¼Œè¿™ä½¿å¾—å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œè”åˆåˆ†æå˜å¾—å›°éš¾ï¼Œå¹¶ä¸”ç»†èƒæŒ‰åˆºæ¿€æ¡ä»¶å’Œç»†èƒç±»å‹èšç±»ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¯æ˜äº†æˆ‘ä»¬çš„æ•´åˆç­–ç•¥ï¼Œå¦‚Stuartå’ŒButlerç­‰äººï¼ˆ2018å¹´ï¼‰æ‰€è¿°ï¼Œç”¨äºæ‰§è¡Œæ•´åˆåˆ†æä»¥ä¿ƒè¿›å¸¸è§ç»†èƒç±»å‹çš„é‰´å®šå¹¶è¿›è¡Œæ¯”è¾ƒåˆ†æã€‚å°½ç®¡æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ä¸¤ä¸ªæ•°æ®é›†ï¼ˆæ¡ä»¶ï¼‰çš„é›†æˆï¼Œä½†è¿™äº›æ–¹æ³•å·²æ‰©å±•åˆ°å¤šä¸ªæ•°æ®é›†ã€‚è¿™ä¸ªå·¥ä½œæµç¨‹æä¾›äº†æ•´åˆå››ä¸ªèƒ°å²›æ•°æ®é›†çš„ç¤ºä¾‹ã€‚","text":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ æœ¬æ•™ç¨‹ä»‹ç»äº†Kangç­‰äººï¼ˆ2017)çš„ä¸¤ç»„PBMCçš„å¯¹é½æ–¹å¼ã€‚åœ¨è¯¥å®éªŒä¸­ï¼Œå°†PBMCåˆ†ä¸ºåˆºæ¿€ç»„å’Œå¯¹ç…§ç»„ï¼Œå¹¶ç”¨å¹²æ‰°ç´ Î²æ²»ç–—åˆºæ¿€ç»„ã€‚å¯¹å¹²æ‰°ç´ çš„ååº”å¼•èµ·ç»†èƒç±»å‹ç‰¹å¼‚æ€§åŸºå› è¡¨è¾¾çš„å˜åŒ–ï¼Œè¿™ä½¿å¾—å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œè”åˆåˆ†æå˜å¾—å›°éš¾ï¼Œå¹¶ä¸”ç»†èƒæŒ‰åˆºæ¿€æ¡ä»¶å’Œç»†èƒç±»å‹èšç±»ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¯æ˜äº†æˆ‘ä»¬çš„æ•´åˆç­–ç•¥ï¼Œå¦‚Stuartå’ŒButlerç­‰äººï¼ˆ2018å¹´ï¼‰æ‰€è¿°ï¼Œç”¨äºæ‰§è¡Œæ•´åˆåˆ†æä»¥ä¿ƒè¿›å¸¸è§ç»†èƒç±»å‹çš„é‰´å®šå¹¶è¿›è¡Œæ¯”è¾ƒåˆ†æã€‚å°½ç®¡æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ä¸¤ä¸ªæ•°æ®é›†ï¼ˆæ¡ä»¶ï¼‰çš„é›†æˆï¼Œä½†è¿™äº›æ–¹æ³•å·²æ‰©å±•åˆ°å¤šä¸ªæ•°æ®é›†ã€‚è¿™ä¸ªå·¥ä½œæµç¨‹æä¾›äº†æ•´åˆå››ä¸ªèƒ°å²›æ•°æ®é›†çš„ç¤ºä¾‹ã€‚ æ•´åˆç›®æ ‡ä»¥ä¸‹æ•™ç¨‹æ—¨åœ¨æ¦‚è¿°ä½¿ç”¨Seuraté›†æˆè¿‡ç¨‹å¯èƒ½è¿›è¡Œçš„å¤æ‚ç»†èƒç±»å‹çš„æ¯”è¾ƒåˆ†æã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è§£å†³äº†ä¸‰ä¸ªä¸»è¦ç›®æ ‡ï¼š è¯†åˆ«ä¸¤ä¸ªæ•°æ®é›†ä¸­éƒ½å­˜åœ¨çš„å•å…ƒæ ¼ç±»å‹ è·å¾—åœ¨å¯¹ç…§å’Œåˆºæ¿€ç»†èƒä¸­å‡ä¿å®ˆçš„ç»†èƒç±»å‹æ ‡è®° æ¯”è¾ƒæ•°æ®é›†ä»¥æ‰¾åˆ°å¯¹åˆºæ¿€çš„ç»†èƒç±»å‹ç‰¹å¼‚æ€§ååº” è®¾ç½®Seuratå¯¹è±¡ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬é€šè¿‡SeuratDataè½¯ä»¶åŒ…åˆ†å‘æ­¤æ•°æ®é›†ã€‚ library(Seurat)library(SeuratData)library(cowplot)InstallData(&quot;ifnb&quot;)data(&quot;ifnb&quot;)ifnb.list &lt;- SplitObject(ifnb, split.by = &quot;stim&quot;)ifnb.list &lt;- lapply(X = ifnb.list, FUN = function(x) &#123; x &lt;- NormalizeData(x) x &lt;- FindVariableFeatures(x, selection.method = &quot;vst&quot;, nfeatures = 2000)&#125;) æ‰§è¡Œæ•´åˆç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨FindIntegrationAnchorså‡½æ•°æ¥è¯†åˆ«é”šç‚¹ï¼Œè¯¥å‡½æ•°å°†Seuratå¯¹è±¡çš„åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä½¿ç”¨è¿™äº›é”šç‚¹å°†ä¸¤ä¸ªæ•°æ®é›†ä¸é›†æˆåœ¨ä¸€èµ·ã€‚ immune.anchors &lt;- FindIntegrationAnchors(object.list = ifnb.list, dims = 1:20)immune.combined &lt;- IntegrateData(anchorset = immune.anchors, dims = 1:20) è¿›è¡Œç»¼åˆåˆ†æç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰å•å…ƒä¸Šè¿è¡Œå•ä¸ªé›†æˆåˆ†æï¼ DefaultAssay(immune.combined) &lt;- &quot;integrated&quot;# Run the standard workflow for visualization and clusteringimmune.combined &lt;- ScaleData(immune.combined, verbose = FALSE)immune.combined &lt;- RunPCA(immune.combined, npcs = 30, verbose = FALSE)# t-SNE and Clusteringimmune.combined &lt;- RunUMAP(immune.combined, reduction = &quot;pca&quot;, dims = 1:20)immune.combined &lt;- FindNeighbors(immune.combined, reduction = &quot;pca&quot;, dims = 1:20)immune.combined &lt;- FindClusters(immune.combined, resolution = 0.5)# Visualizationp1 &lt;- DimPlot(immune.combined, reduction = &quot;umap&quot;, group.by = &quot;stim&quot;)p2 &lt;- DimPlot(immune.combined, reduction = &quot;umap&quot;, label = TRUE)plot_grid(p1, p2) ä¸ºäº†å¹¶æ’å¯è§†åŒ–è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨split.byå‚æ•°æ¥æ˜¾ç¤ºæ¯ä¸ªä»¥èšç±»ç€è‰²çš„æ¡ä»¶ã€‚ DimPlot(immune.combined, reduction = &quot;umap&quot;, split.by = &quot;stim&quot;) è¯†åˆ«ä¿å®ˆçš„ç»†èƒç±»å‹æ ‡è®°ä¸ºäº†ç¡®å®šè·¨æ¡ä»¶ä¿å®ˆçš„è§„èŒƒç»†èƒç±»å‹æ ‡è®°åŸºå› ï¼Œæˆ‘ä»¬æä¾›äº†è¯¥FindConservedMarkersåŠŸèƒ½ã€‚æ­¤åŠŸèƒ½å¯¹æ¯ä¸ªæ•°æ®é›†&#x2F;ç»„æ‰§è¡Œå·®å¼‚åŸºå› è¡¨è¾¾æµ‹è¯•ï¼Œå¹¶ä½¿ç”¨MetaDERè½¯ä»¶åŒ…ä¸­çš„èŸèƒåˆ†ææ–¹æ³•ç»„åˆpå€¼ã€‚ä¾‹å¦‚ï¼Œæ— è®ºç°‡7ä¸­çš„åˆºæ¿€æ¡ä»¶å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è®¡ç®—å‡ºä¿å®ˆæ ‡è®°çš„åŸºå› ï¼ˆNKç»†èƒï¼‰ã€‚ DefaultAssay(immune.combined) &lt;- &quot;RNA&quot;nk.markers &lt;- FindConservedMarkers(immune.combined, ident.1 = 7, grouping.var = &quot;stim&quot;, verbose = FALSE)head(nk.markers)## CTRL_p_val CTRL_avg_logFC CTRL_pct.1 CTRL_pct.2 CTRL_p_val_adj## SNHG12 1.059703e-193 1.3678805 0.335 0.019 1.489200e-189## HSPH1 2.552539e-139 2.0586178 0.553 0.100 3.587083e-135## NR4A2 8.671555e-136 1.5545769 0.296 0.023 1.218614e-131## SRSF2 1.556024e-113 1.6410606 0.704 0.220 2.186680e-109## BATF 1.573042e-09 0.5991204 0.116 0.042 2.210596e-05## CD69 1.188324e-122 1.8357378 0.525 0.096 1.669952e-118## STIM_p_val STIM_avg_logFC STIM_pct.1 STIM_pct.2 STIM_p_val_adj## SNHG12 8.090842e-159 1.054494 0.256 0.015 1.137006e-154## HSPH1 4.097380e-89 1.580183 0.471 0.114 5.758049e-85## NR4A2 3.130700e-78 1.009556 0.172 0.015 4.399572e-74## SRSF2 1.829674e-128 1.625081 0.675 0.182 2.571241e-124## BATF 9.234006e-126 1.354443 0.305 0.031 1.297655e-121## CD69 3.733167e-78 1.677068 0.688 0.291 5.246220e-74## max_pval minimump_p_val## SNHG12 8.090842e-159 2.119406e-193## HSPH1 4.097380e-89 5.105078e-139## NR4A2 3.130700e-78 1.734311e-135## SRSF2 1.556024e-113 3.659348e-128## BATF 1.573042e-09 1.846801e-125## CD69 3.733167e-78 2.376649e-122 æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªç°‡æ¢ç´¢è¿™äº›æ ‡è®°åŸºå› ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬å°†æˆ‘ä»¬çš„ç°‡æ³¨é‡Šä¸ºç‰¹å®šçš„ç»†èƒç±»å‹ã€‚ FeaturePlot(immune.combined, features = c(&quot;CD3D&quot;, &quot;SELL&quot;, &quot;CREM&quot;, &quot;CD8A&quot;, &quot;GNLY&quot;, &quot;CD79A&quot;, &quot;FCGR3A&quot;, &quot;CCL2&quot;, &quot;PPBP&quot;), min.cutoff = &quot;q9&quot;) immune.combined &lt;- RenameIdents(immune.combined, `0` = &quot;CD14 Mono&quot;, `1` = &quot;CD4 Naive T&quot;, `2` = &quot;CD4 Memory T&quot;, `3` = &quot;CD16 Mono&quot;, `4` = &quot;B&quot;, `5` = &quot;CD8 T&quot;, `6` = &quot;T activated&quot;, `7` = &quot;NK&quot;, `8` = &quot;DC&quot;, `9` = &quot;B Activated&quot;, `10` = &quot;Mk&quot;, `11` = &quot;pDC&quot;, `12` = &quot;Eryth&quot;, `13` = &quot;Mono/Mk Doublets&quot;)DimPlot(immune.combined, label = TRUE) DotPlotå¸¦æœ‰split.byå‚æ•°çš„å‡½æ•°å¯ç”¨äºæŸ¥çœ‹å„ç§æ¡ä»¶ä¸‹ä¿å®ˆçš„ç»†èƒç±»å‹æ ‡è®°ï¼Œæ˜¾ç¤ºè¡¨è¾¾æ°´å¹³å’Œè¡¨è¾¾ä»»ä½•ç»™å®šåŸºå› çš„ç°‡ä¸­ç»†èƒçš„ç™¾åˆ†æ¯”ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸º13ä¸ªç°‡ä¸­çš„æ¯ä¸ªç°‡ç»˜åˆ¶2-3ä¸ªå¼ºæ ‡è®°åŸºå› ã€‚ Idents(immune.combined) &lt;- factor(Idents(immune.combined), levels = c(&quot;Mono/Mk Doublets&quot;, &quot;pDC&quot;, &quot;Eryth&quot;, &quot;Mk&quot;, &quot;DC&quot;, &quot;CD14 Mono&quot;, &quot;CD16 Mono&quot;, &quot;B Activated&quot;, &quot;B&quot;, &quot;CD8 T&quot;, &quot;NK&quot;, &quot;T activated&quot;, &quot;CD4 Naive T&quot;, &quot;CD4 Memory T&quot;))markers.to.plot &lt;- c(&quot;CD3D&quot;, &quot;CREM&quot;, &quot;HSPH1&quot;, &quot;SELL&quot;, &quot;GIMAP5&quot;, &quot;CACYBP&quot;, &quot;GNLY&quot;, &quot;NKG7&quot;, &quot;CCL5&quot;, &quot;CD8A&quot;, &quot;MS4A1&quot;, &quot;CD79A&quot;, &quot;MIR155HG&quot;, &quot;NME1&quot;, &quot;FCGR3A&quot;, &quot;VMO1&quot;, &quot;CCL2&quot;, &quot;S100A9&quot;, &quot;HLA-DQA1&quot;, &quot;GPR183&quot;, &quot;PPBP&quot;, &quot;GNG11&quot;, &quot;HBA2&quot;, &quot;HBB&quot;, &quot;TSPAN13&quot;, &quot;IL3RA&quot;, &quot;IGJ&quot;)DotPlot(immune.combined, features = rev(markers.to.plot), cols = c(&quot;blue&quot;, &quot;red&quot;), dot.scale = 8, split.by = &quot;stim&quot;) + RotatedAxis() è·¨æ¡ä»¶é‰´å®šå·®å¼‚è¡¨è¾¾åŸºå› ç°åœ¨æˆ‘ä»¬å·²ç»æ’åˆ—äº†åˆºæ¿€ç»†èƒå’Œå¯¹ç…§ç»†èƒï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿›è¡Œæ¯”è¾ƒåˆ†æï¼Œå¹¶è§‚å¯Ÿåˆºæ¿€å¼•èµ·çš„å·®å¼‚ã€‚å¹¿æ³›è§‚å¯Ÿè¿™äº›å˜åŒ–çš„ä¸€ç§æ–¹æ³•æ˜¯ç»˜åˆ¶å—åˆºæ¿€ç»†èƒå’Œå¯¹ç…§ç»†èƒçš„å¹³å‡è¡¨è¾¾ï¼Œå¹¶åœ¨æ•£ç‚¹å›¾ä¸Šå¯»æ‰¾è§†è§‰å¼‚å¸¸å€¼çš„åŸºå› ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨å—åˆºæ¿€çš„å’Œå¯¹ç…§çš„åŸå§‹Tç»†èƒå’ŒCD14å•æ ¸ç»†èƒç¾¤ä½“çš„å¹³å‡è¡¨è¾¾ï¼Œå¹¶ç”Ÿæˆæ•£ç‚¹å›¾ï¼Œçªå‡ºæ˜¾ç¤ºå¯¹å¹²æ‰°ç´ åˆºæ¿€è¡¨ç°å‡ºæˆå‰§æ€§ååº”çš„åŸºå› ã€‚ library(ggplot2)library(cowplot)theme_set(theme_cowplot())t.cells &lt;- subset(immune.combined, idents = &quot;CD4 Naive T&quot;)Idents(t.cells) &lt;- &quot;stim&quot;avg.t.cells &lt;- log1p(AverageExpression(t.cells, verbose = FALSE)$RNA)avg.t.cells$gene &lt;- rownames(avg.t.cells)cd14.mono &lt;- subset(immune.combined, idents = &quot;CD14 Mono&quot;)Idents(cd14.mono) &lt;- &quot;stim&quot;avg.cd14.mono &lt;- log1p(AverageExpression(cd14.mono, verbose = FALSE)$RNA)avg.cd14.mono$gene &lt;- rownames(avg.cd14.mono)genes.to.label = c(&quot;ISG15&quot;, &quot;LY6E&quot;, &quot;IFI6&quot;, &quot;ISG20&quot;, &quot;MX1&quot;, &quot;IFIT2&quot;, &quot;IFIT1&quot;, &quot;CXCL10&quot;, &quot;CCL8&quot;)p1 &lt;- ggplot(avg.t.cells, aes(CTRL, STIM)) + geom_point() + ggtitle(&quot;CD4 Naive T Cells&quot;)p1 &lt;- LabelPoints(plot = p1, points = genes.to.label, repel = TRUE)p2 &lt;- ggplot(avg.cd14.mono, aes(CTRL, STIM)) + geom_point() + ggtitle(&quot;CD14 Monocytes&quot;)p2 &lt;- LabelPoints(plot = p2, points = genes.to.label, repel = TRUE)plot_grid(p1, p2) å¦‚æ‚¨æ‰€è§ï¼Œè®¸å¤šç›¸åŒçš„åŸºå› åœ¨è¿™ä¸¤ç§ç»†èƒç±»å‹ä¸­å‡è¢«ä¸Šè°ƒï¼Œå¯èƒ½ä»£è¡¨ä¿å®ˆçš„å¹²æ‰°ç´ åº”ç­”é€”å¾„ã€‚ å› ä¸ºæˆ‘ä»¬æœ‰ä¿¡å¿ƒåœ¨å„ç§æƒ…å†µä¸‹éƒ½èƒ½è¯†åˆ«å‡ºå¸¸è§çš„ç»†èƒç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯¢é—®ç›¸åŒç±»å‹çš„ç»†èƒåœ¨ä¸åŒæ¡ä»¶ä¸‹ä¼šæ”¹å˜å“ªäº›åŸºå› ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨meta.dataæ’æ§½ä¸­åˆ›å»ºä¸€åˆ—ï¼Œä»¥ä¿å­˜ç»†èƒç±»å‹å’Œåˆºæ¿€ä¿¡æ¯ï¼Œå¹¶å°†å½“å‰æ ‡è¯†åˆ‡æ¢åˆ°è¯¥åˆ—ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒFindMarkersæ¥æ‰¾åˆ°å—åˆºæ¿€çš„Bç»†èƒå’Œå¯¹ç…§Bç»†èƒä¹‹é—´ä¸åŒçš„åŸºå› ã€‚è¯·æ³¨æ„ï¼Œæ­¤å¤„æ˜¾ç¤ºçš„è®¸å¤šé¡¶çº§åŸºå› ä¸æˆ‘ä»¬ä¹‹å‰ç»˜åˆ¶çš„æ ¸å¿ƒå¹²æ‰°ç´ åº”ç­”åŸºå› ç›¸åŒã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„è¯¸å¦‚CXCL10çš„åŸºå› å¯¹å•æ ¸ç»†èƒå’ŒBç»†èƒå¹²æ‰°ç´ çš„ååº”ä¹Ÿå…·æœ‰ç‰¹å¼‚æ€§ï¼Œåœ¨è¯¥åˆ—è¡¨ä¸­ä¹Ÿæ˜¾ç¤ºå‡ºå¾ˆé«˜çš„æ„ä¹‰ã€‚ immune.combined$celltype.stim &lt;- paste(Idents(immune.combined), immune.combined$stim, sep = &quot;_&quot;)immune.combined$celltype &lt;- Idents(immune.combined)Idents(immune.combined) &lt;- &quot;celltype.stim&quot;b.interferon.response &lt;- FindMarkers(immune.combined, ident.1 = &quot;B_STIM&quot;, ident.2 = &quot;B_CTRL&quot;, verbose = FALSE)head(b.interferon.response, n = 15)## p_val avg_logFC pct.1 pct.2 p_val_adj## ISG15 9.008631e-168 3.2061225 0.998 0.235 1.265983e-163## IFIT3 1.566158e-161 3.1240285 0.961 0.049 2.200921e-157## ISG20 1.206176e-158 2.0549983 1.000 0.662 1.695038e-154## IFI6 1.544804e-158 2.9139826 0.959 0.077 2.170914e-154## IFIT1 1.531805e-144 2.8529052 0.899 0.031 2.152645e-140## MX1 3.490304e-129 2.2712525 0.902 0.113 4.904924e-125## LY6E 3.320706e-127 2.1767293 0.897 0.146 4.666588e-123## TNFSF10 2.108526e-114 2.5996223 0.773 0.021 2.963111e-110## IFIT2 7.373988e-113 2.5114519 0.781 0.035 1.036267e-108## B2M 1.570724e-101 0.4194467 1.000 1.000 2.207338e-97## PLSCR1 8.204551e-101 1.9635626 0.792 0.115 1.152986e-96## IRF7 1.517587e-100 1.8203577 0.837 0.181 2.132665e-96## CXCL10 7.783861e-92 3.6869595 0.660 0.012 1.093866e-87## UBE2L6 1.659777e-88 1.4951634 0.855 0.296 2.332484e-84## EPSTI1 1.324448e-82 1.7540298 0.717 0.103 1.861247e-78 å¯è§†åŒ–åŸºå› è¡¨è¾¾ä¸­è¿™äº›å˜åŒ–çš„å¦ä¸€ç§æœ‰ç”¨æ–¹æ³•æ˜¯split.byé€‰æ‹©FeaturePlotæˆ–VlnPlotåŠŸèƒ½ã€‚è¿™å°†æ˜¾ç¤ºç»™å®šåŸºå› åˆ—è¡¨çš„FeaturePlotsï¼Œå¹¶æŒ‰åˆ†ç»„å˜é‡ï¼ˆæ­¤å¤„ä¸ºåˆºæ¿€æ¡ä»¶ï¼‰è¿›è¡Œåˆ’åˆ†ã€‚è¯¸å¦‚CD3Då’ŒGNLYä¹‹ç±»çš„åŸºå› æ˜¯å…¸å‹çš„ç»†èƒç±»å‹æ ‡è®°ï¼ˆå¯¹äºTç»†èƒå’ŒNK &#x2F; CD8 Tç»†èƒï¼‰ï¼Œå®é™…ä¸Šä¸å—å¹²æ‰°ç´ åˆºæ¿€çš„å½±å“ï¼Œå¹¶ä¸”åœ¨å¯¹ç…§ç»„å’Œå—åˆºæ¿€ç»„ä¸­æ˜¾ç¤ºå‡ºç›¸ä¼¼çš„åŸºå› è¡¨è¾¾æ¨¡å¼ã€‚å¦ä¸€æ–¹é¢ï¼ŒIFI6å’ŒISG15æ˜¯æ ¸å¿ƒå¹²æ‰°ç´ åº”ç­”åŸºå› ï¼Œå› æ­¤åœ¨æ‰€æœ‰ç»†èƒç±»å‹ä¸­å‡è¢«ä¸Šè°ƒã€‚æœ€åï¼ŒCD14å’ŒCXCL10æ˜¯æ˜¾ç¤ºç»†èƒç±»å‹ç‰¹å¼‚æ€§å¹²æ‰°ç´ åº”ç­”çš„åŸºå› ã€‚CD14å•æ ¸ç»†èƒå—åˆºæ¿€åï¼ŒCD14è¡¨è¾¾ä¸‹é™ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨æœ‰ç›‘ç£çš„åˆ†ææ¡†æ¶ä¸­è¿›è¡Œé”™è¯¯åˆ†ç±»ï¼Œä»è€Œå¼ºè°ƒäº†æ•´åˆåˆ†æçš„ä»·å€¼ã€‚ FeaturePlot(immune.combined, features = c(&quot;CD3D&quot;, &quot;GNLY&quot;, &quot;IFI6&quot;), split.by = &quot;stim&quot;, max.cutoff = 3, cols = c(&quot;grey&quot;, &quot;red&quot;)) plots &lt;- VlnPlot(immune.combined, features = c(&quot;LYZ&quot;, &quot;ISG15&quot;, &quot;CXCL10&quot;), split.by = &quot;stim&quot;, group.by = &quot;celltype&quot;, pt.size = 0, combine = FALSE)CombinePlots(plots = plots, ncol = 1)","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"Seurat3.1çš„çµæ´»æ“ä½œæŒ‡å—","slug":"Seurat3-1çš„çµæ´»æ“ä½œæŒ‡å—","date":"2019-10-20T04:47:57.000Z","updated":"2024-10-18T05:34:12.793Z","comments":true,"path":"seurat3-operate/","permalink":"https://xiaohanys.top/seurat3-operate/","excerpt":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ ä¸‹é¢æ¼”ç¤ºäº†ä¸€äº›ä¸Seuratå¯¹è±¡è¿›è¡Œäº¤äº’çš„æœ‰ç”¨åŠŸèƒ½ã€‚å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åœ¨ç¬¬ä¸€ä¸ªæŒ‡å¯¼æ•™ç¨‹ä¸­åˆ›å»ºçš„2700 PBMCå¯¹è±¡ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½é¢„å…ˆè®¡ç®—çš„å¯¹è±¡ã€‚ä¸ºäº†æ¨¡æ‹Ÿæœ‰ä¸¤ä¸ªé‡å¤çš„æƒ…å†µï¼Œå°†ä¸€åŠå‘½åä¸ºâ€œrep1â€,å¦ä¸€åŠå‘½åä¸ºâ€rep2â€","text":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ ä¸‹é¢æ¼”ç¤ºäº†ä¸€äº›ä¸Seuratå¯¹è±¡è¿›è¡Œäº¤äº’çš„æœ‰ç”¨åŠŸèƒ½ã€‚å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åœ¨ç¬¬ä¸€ä¸ªæŒ‡å¯¼æ•™ç¨‹ä¸­åˆ›å»ºçš„2700 PBMCå¯¹è±¡ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½é¢„å…ˆè®¡ç®—çš„å¯¹è±¡ã€‚ä¸ºäº†æ¨¡æ‹Ÿæœ‰ä¸¤ä¸ªé‡å¤çš„æƒ…å†µï¼Œå°†ä¸€åŠå‘½åä¸ºâ€œrep1â€,å¦ä¸€åŠå‘½åä¸ºâ€rep2â€ å®˜ç½‘3.1ç‰ˆæœ¬å·²ç»æ— æ³•æ‰¾åˆ°è¯¥æŒ‡å—çš„é“¾æ¥ï¼Œå…¶å®è¿˜æ˜¯æœ‰çš„ï¼Œç½‘å€ï¼šhttps://satijalab.org/seurat/v3.1/interaction_vignette.html è½½å…¥æ•°æ®ä¸‹é¢æ¼”ç¤ºäº†ä¸€äº›ä¸Seuratå¯¹è±¡è¿›è¡Œäº¤äº’çš„æœ‰ç”¨åŠŸèƒ½ã€‚å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åœ¨ç¬¬ä¸€ä¸ªæŒ‡å¯¼æ•™ç¨‹ä¸­åˆ›å»ºçš„2700 PBMCå¯¹è±¡ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½é¢„å…ˆè®¡ç®—çš„å¯¹è±¡ã€‚ä¸ºäº†æ¨¡æ‹Ÿæœ‰ä¸¤ä¸ªé‡å¤çš„æƒ…å†µï¼Œå°†ä¸€åŠå‘½åä¸ºâ€œrep1â€,å¦ä¸€åŠå‘½åä¸ºâ€rep2â€ library(Seurat)pbmc &lt;- readRDS(file = &quot;../data/pbmc3k_final.rds&quot;)### éšæœºè®¾ç½®ä¸¤ä¸ªé‡å¤set.seed(42)pbmc$replicate &lt;- sample(c(&quot;rep1&quot;, &quot;rep2&quot;), size = ncol(pbmc), replace = TRUE) ä»ç»†èƒèšç±»å’Œæ ·æœ¬é‡å¤ä¸­åˆ‡æ¢Idents# é»˜è®¤ç”»çš„æ˜¯object@ident)DimPlot(pbmc, reduction = &quot;umap&quot;) # æŠŠç»†èƒåˆ†ç±»å› å­å…ˆå‚¨å­˜åˆ°å¯¹è±¡ä¸­pbmc$CellType &lt;- Idents(pbmc)# åˆ‡æ¢IdentsIdents(pbmc) &lt;- &quot;replicate&quot;DimPlot(pbmc, reduction = &quot;umap&quot;) # alternately : DimPlot(pbmc, reduction = &#x27;umap&#x27;, group.by = &#x27;replicate&#x27;) you can pass the# shape.by to label points by both replicate and cell type# Switch back to cell type labelsIdents(pbmc) &lt;- &quot;CellType&quot; åˆ†åˆ«æˆ–åŒæ—¶ç»Ÿè®¡ä¸åŒèšç±»æˆ–è€…ä¸åŒæ ·æœ¬æ¥æºçš„ç»†èƒæ•°ç›®# æ¯ä¸ªèšç±»åŒ…å«å¤šå°‘ç»†èƒï¼Ÿtable(Idents(pbmc)) ## ## Naive CD4 T Memory CD4 T CD14+ Mono B CD8 T ## 697 483 480 344 271 ## FCGR3A+ Mono NK DC Platelet ## 162 155 32 14 # æ¯ç»„é‡å¤åŒ…å«å¤šå°‘ç»†èƒï¼Ÿtable(pbmc$replicate) ## ## rep1 rep2 ## 1348 1290 # æ¯ä¸ªèšç±»ç»†èƒæ•°å æ¯”prop.table(table(Idents(pbmc))) ## ## Naive CD4 T Memory CD4 T CD14+ Mono B CD8 T ## 0.264215315 0.183093252 0.181956027 0.130401820 0.102729340 ## FCGR3A+ Mono NK DC Platelet ## 0.061410159 0.058756634 0.012130402 0.005307051 # æ ·æœ¬åˆ†ç»„å’Œç»†èƒèšç±»ä¸€èµ·ç»Ÿè®¡table(Idents(pbmc), pbmc$replicate) ## ## rep1 rep2## Naive CD4 T 354 343## Memory CD4 T 249 234## CD14+ Mono 232 248## B 173 171## CD8 T 154 117## FCGR3A+ Mono 81 81## NK 81 74## DC 18 14## Platelet 6 8 prop.table(table(Idents(pbmc), pbmc$replicate), margin = 2) ## ## rep1 rep2## Naive CD4 T 0.262611276 0.265891473## Memory CD4 T 0.184718101 0.181395349## CD14+ Mono 0.172106825 0.192248062## B 0.128338279 0.132558140## CD8 T 0.114243323 0.090697674## FCGR3A+ Mono 0.060089021 0.062790698## NK 0.060089021 0.057364341## DC 0.013353116 0.010852713## Platelet 0.004451039 0.006201550 æå–ç‰¹å®šçš„Seuratå­é›†åšäºšå‹åˆ†æ# What are the cell names of all NK cells?WhichCells(pbmc, idents = &quot;NK&quot;) ## [1] &quot;AAACCGTGTATGCG&quot; &quot;AAATTCGATTCTCA&quot; &quot;AACCTTACGCGAGA&quot; &quot;AACGCCCTCGTACA&quot;## [5] &quot;AACGTCGAGTATCG&quot; &quot;AAGATTACCTCAAG&quot; &quot;AAGCAAGAGCTTAG&quot; &quot;AAGCAAGAGGTGTT&quot;## [9] &quot;AAGTAGGATACAGC&quot; &quot;AATACTGAATTGGC&quot; &quot;AATCCTTGGTGAGG&quot; &quot;AATCTCTGCTTTAC&quot;## [13] &quot;ACAAATTGTTGCGA&quot; &quot;ACAACCGAGGGATG&quot; &quot;ACAATTGATGACTG&quot; &quot;ACACCCTGGTGTTG&quot;## [17] &quot;ACAGGTACTGGTGT&quot; &quot;ACCTGGCTAAGTAG&quot; &quot;ACGAACACCTTGTT&quot; &quot;ACGATCGAGGACTT&quot;## [21] &quot;ACGCAATGGTTCAG&quot; &quot;ACGCTGCTGTTCTT&quot; &quot;ACGGAACTCAGATC&quot; &quot;ACGTGATGTGACAC&quot;## [25] &quot;ACGTTGGAGCCAAT&quot; &quot;ACTGCCACTCCGTC&quot; &quot;ACTGGCCTTCAGTG&quot; &quot;ACTTCAACGTAGGG&quot;## [29] &quot;AGAACAGAAATGCC&quot; &quot;AGATATACCCGTAA&quot; &quot;AGATTCCTGTTCAG&quot; &quot;AGCCTCTGCCAATG&quot;## [33] &quot;AGCGATTGAGATCC&quot; &quot;AGGATGCTTTAGGC&quot; &quot;AGGGACGAGTCAAC&quot; &quot;AGTAATACATCACG&quot;## [37] &quot;AGTCACGATGAGCT&quot; &quot;AGTTTGCTACTGGT&quot; &quot;ATACCACTGCCAAT&quot; &quot;ATACTCTGGTATGC&quot;## [41] &quot;ATCCCGTGCAGTCA&quot; &quot;ATCTTTCTTGTCCC&quot; &quot;ATGAAGGACTTGCC&quot; &quot;ATGATAACTTCACT&quot;## [45] &quot;ATGATATGGTGCTA&quot; &quot;ATGGACACGCATCA&quot; &quot;ATGGGTACATCGGT&quot; &quot;ATTAACGATGAGAA&quot;## [49] &quot;ATTCCAACTTAGGC&quot; &quot;CAAGGTTGTCTGGA&quot; &quot;CAATCTACTGACTG&quot; &quot;CACCACTGGCGAAG&quot;## [53] &quot;CACGGGTGGAGGAC&quot; &quot;CAGATGACATTCTC&quot; &quot;CAGCAATGGAGGGT&quot; &quot;CAGCGGACCTTTAC&quot;## [57] &quot;CAGCTCTGTGTGGT&quot; &quot;CAGTTTACACACGT&quot; &quot;CATCAGGACTTCCG&quot; &quot;CATCAGGATAGCCA&quot;## [61] &quot;CATGAGACGTTGAC&quot; &quot;CATTACACCAACTG&quot; &quot;CATTTCGAGATACC&quot; &quot;CCTCGAACACTTTC&quot;## [65] &quot;CGACCACTAAAGTG&quot; &quot;CGACCACTGCCAAT&quot; &quot;CGAGGCTGACGCTA&quot; &quot;CGCCGAGAGCTTAG&quot;## [69] &quot;CGGCGAACGACAAA&quot; &quot;CGGCGAACTACTTC&quot; &quot;CGGGCATGTCTCTA&quot; &quot;CGTACCTGGCATCA&quot;## [73] &quot;CGTGTAGACGATAC&quot; &quot;CGTGTAGAGTTACG&quot; &quot;CGTGTAGATTCGGA&quot; &quot;CTAAACCTCTGACA&quot;## [77] &quot;CTAACGGAACCGAT&quot; &quot;CTACGCACTGGTCA&quot; &quot;CTACTCCTATGTCG&quot; &quot;CTAGTTACGAAACA&quot;## [81] &quot;CTATACTGCTACGA&quot; &quot;CTATACTGTCTCAT&quot; &quot;CTCGACTGGTTGAC&quot; &quot;CTGAGAACGTAAAG&quot;## [85] &quot;CTTTAGTGACGGGA&quot; &quot;GAACCAACTTCCGC&quot; &quot;GAAGTGCTAAACGA&quot; &quot;GAATGCACCTTCGC&quot;## [89] &quot;GAATTAACGTCGTA&quot; &quot;GACGGCACACGGGA&quot; &quot;GAGCGCTGAAGATG&quot; &quot;GAGGTACTGACACT&quot;## [93] &quot;GAGGTGGATCCTCG&quot; &quot;GATAGAGAAGGGTG&quot; &quot;GATCCCTGACCTTT&quot; &quot;GCACACCTGTGCTA&quot;## [97] &quot;GCACCACTTCCTTA&quot; &quot;GCACTAGAGTCGTA&quot; &quot;GCAGGGCTATCGAC&quot; &quot;GCCGGAACGTTCTT&quot;## [101] &quot;GCCTACACAGTTCG&quot; &quot;GCGCATCTTGCTCC&quot; &quot;GCGCGATGGTGCAT&quot; &quot;GGAAGGTGGCGAGA&quot;## [105] &quot;GGACGCTGTCCTCG&quot; &quot;GGAGGCCTCGTTGA&quot; &quot;GGCAAGGAAAAAGC&quot; &quot;GGCATATGCTTATC&quot;## [109] &quot;GGCCGAACTCTAGG&quot; &quot;GGCTAAACACCTGA&quot; &quot;GGGTTAACGTGCAT&quot; &quot;GGTGGAGAAACGGG&quot;## [113] &quot;GTAGTGTGAGCGGA&quot; &quot;GTCGACCTGAATGA&quot; &quot;GTGATTCTGGTTCA&quot; &quot;GTGTATCTAGTAGA&quot;## [117] &quot;GTTAAAACCGAGAG&quot; &quot;GTTCAACTGGGACA&quot; &quot;GTTGACGATATCGG&quot; &quot;TAACTCACTCTACT&quot;## [121] &quot;TAAGAGGACTTGTT&quot; &quot;TAATGCCTCGTCTC&quot; &quot;TACGGCCTGGGACA&quot; &quot;TACTACTGATGTCG&quot;## [125] &quot;TACTCTGAATCGAC&quot; &quot;TACTGTTGAGGCGA&quot; &quot;TAGCATCTCAGCTA&quot; &quot;TAGCCCACAGCTAC&quot;## [129] &quot;TAGGGACTGAACTC&quot; &quot;TAGTGGTGAAGTGA&quot; &quot;TAGTTAGAACCACA&quot; &quot;TATGAATGGAGGAC&quot;## [133] &quot;TATGGGTGCATCAG&quot; &quot;TATTTCCTGGAGGT&quot; &quot;TCAACACTGTTTGG&quot; &quot;TCAGACGACGTTAG&quot;## [137] &quot;TCCCGAACACAGTC&quot; &quot;TCCTAAACCGCATA&quot; &quot;TCGATTTGCAGCTA&quot; &quot;TCTAACACCAGTTG&quot;## [141] &quot;TGATAAACTCCGTC&quot; &quot;TGCACAGACGACAT&quot; &quot;TGCCACTGCGATAC&quot; &quot;TGCTGAGAGAGCAG&quot;## [145] &quot;TGGAACACAAACAG&quot; &quot;TGGTAGACCCTCAC&quot; &quot;TGTAATGACACAAC&quot; &quot;TGTAATGAGGTAAA&quot;## [149] &quot;TTACTCGATCTACT&quot; &quot;TTAGTCTGCCAACA&quot; &quot;TTCCAAACTCCCAC&quot; &quot;TTCCCACTTGAGGG&quot;## [153] &quot;TTCTAGTGGAGAGC&quot; &quot;TTCTGATGGAGACG&quot; &quot;TTGTCATGGACGGA&quot; # æå–NKç»†èƒçš„è¡¨è¾¾çŸ©é˜µnk.raw.data &lt;- as.matrix(GetAssayData(pbmc, slot = &quot;counts&quot;)[, WhichCells(pbmc, ident = &quot;NK&quot;)])# è·å–åŸºå› è¡¨è¾¾é‡å¤§äº1çš„å¯¹è±¡subset(pbmc, subset = MS4A1 &gt; 1) ## An object of class Seurat ## 13714 features across 414 samples within 1 assay ## Active assay: RNA (13714 features)## 2 dimensional reductions calculated: pca, umap subset(pbmc, subset = replicate == &quot;rep2&quot;) ## An object of class Seurat ## 13714 features across 1290 samples within 1 assay ## Active assay: RNA (13714 features)## 2 dimensional reductions calculated: pca, umap # é€‰æ‹©ä¸¤ä¸ªç»†èƒç±»å‹subset(pbmc, idents = c(&quot;NK&quot;, &quot;B&quot;)) ## An object of class Seurat ## 13714 features across 499 samples within 1 assay ## Active assay: RNA (13714 features)## 2 dimensional reductions calculated: pca, umap # æ’é™¤æ‰æŸäº›ç»†èƒç±»å‹subset(pbmc, idents = c(&quot;NK&quot;, &quot;B&quot;), invert = TRUE) ## An object of class Seurat ## 13714 features across 2139 samples within 1 assay ## Active assay: RNA (13714 features)## 2 dimensional reductions calculated: pca, umap # note that if you wish to perform additional rounds of clustering after subsetting we recommend# re-running FindVariableFeatures() and ScaleData() è®¡ç®—åŸºå› çš„å¹³å‡è¡¨è¾¾é‡# è®¡ç®—å¹³å‡è¡¨è¾¾é‡cluster.averages &lt;- AverageExpression(pbmc)head(cluster.averages[[&quot;RNA&quot;]][, 1:5]) Native CD4 T Memory CD4 T CD14+Mono B CD8 T AL627309.1 0.0061287 0.0059273 0.0485434 0.0000000 0.0205459 AP006222.2 0.0000000 0.0082061 0.0108847 0.0000000 0.0119149 RP11-206L10.2 0.0074531 0.0000000 0.0000000 0.0206503 0.0000000 RP11-206L10.9 0.0000000 0.0000000 0.0105012 0.0000000 0.0000000 LINC00115 0.0191189 0.0246905 0.0375374 0.0388854 0.0194828 NOC2L 0.4974632 0.3598115 0.2725375 0.5865349 0.5570490 # è¿”å›Seuratå¯¹è±¡ç”¨äºä¸‹æ¸¸åˆ†æorig.levels &lt;- levels(pbmc)Idents(pbmc) &lt;- gsub(pattern = &quot; &quot;, replacement = &quot;_&quot;, x = Idents(pbmc))orig.levels &lt;- gsub(pattern = &quot; &quot;, replacement = &quot;_&quot;, x = orig.levels)levels(pbmc) &lt;- orig.levelscluster.averages &lt;- AverageExpression(pbmc, return.seurat = TRUE)cluster.averages ## An object of class Seurat ## 13714 features across 9 samples within 1 assay ## Active assay: RNA (13714 features) # How can I plot the average expression of NK cells vs. CD8 T cells? Pass do.hover = T for an# interactive plot to identify gene outliersCellScatter(cluster.averages, cell1 = &quot;NK&quot;, cell2 = &quot;CD8_T&quot;) # How can I calculate expression averages separately for each replicate?cluster.averages &lt;- AverageExpression(pbmc, return.seurat = TRUE, add.ident = &quot;replicate&quot;)CellScatter(cluster.averages, cell1 = &quot;CD8_T_rep1&quot;, cell2 = &quot;CD8_T_rep2&quot;) # You can also plot heatmaps of these &#x27;in silico&#x27; bulk datasets to visualize agreement between# replicatesDoHeatmap(cluster.averages, features = unlist(TopFeatures(pbmc[[&quot;pca&quot;]], balanced = TRUE)), size = 3, draw.lines = FALSE)","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"ä½¿ç”¨Monocle3å¯¹å¤šæ ·æœ¬å•ç»†èƒæ•°æ®è¿›è¡Œä¼ªæ—¶é—´åˆ†æ","slug":"ä½¿ç”¨Monocle3å¯¹å¤šæ ·æœ¬å•ç»†èƒæ•°æ®è¿›è¡Œä¼ªæ—¶é—´åˆ†æ","date":"2019-09-20T04:50:01.000Z","updated":"2024-10-18T05:32:54.311Z","comments":true,"path":"scrna-monocle/","permalink":"https://xiaohanys.top/scrna-monocle/","excerpt":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ ç®€ä»‹åœ¨å‘è‚²è¿‡ç¨‹ä¸­ï¼Œç»†èƒå¯¹åˆºæ¿€ä½œå‡ºååº”ï¼Œå¹¶åœ¨æ•´ä¸ªç”Ÿå‘½è¿‡ç¨‹ä¸­ï¼Œä»ä¸€ç§åŠŸèƒ½â€œçŠ¶æ€â€è¿‡æ¸¡åˆ°å¦ä¸€ç§åŠŸèƒ½â€œçŠ¶æ€â€ã€‚ä¸åŒçŠ¶æ€çš„ç»†èƒè¡¨è¾¾ä¸åŒçš„åŸºå› ï¼Œäº§ç”Ÿè›‹ç™½è´¨å’Œä»£è°¢ç‰©çš„åŠ¨æ€é‡å¤åºåˆ—ï¼Œä»è€Œå®Œæˆå®ƒä»¬çš„å·¥ä½œã€‚å½“ç»†èƒåœ¨çŠ¶æ€ä¹‹é—´ç§»åŠ¨æ—¶ï¼Œå®ƒä»¬ç»å†ä¸€ä¸ªè½¬å½•é‡ç»„çš„è¿‡ç¨‹ï¼Œä¸€äº›åŸºå› è¢«æ²‰é»˜ï¼Œå¦ä¸€äº›åŸºå› è¢«æ¿€æ´»ã€‚è¿™äº›ç¬æ—¶çŠ¶æ€é€šå¸¸å¾ˆéš¾æè¿°ï¼Œå› ä¸ºåœ¨æ›´ç¨³å®šçš„ç«¯ç‚¹çŠ¶æ€ä¹‹é—´çº¯åŒ–ç»†èƒå¯èƒ½æ˜¯å›°éš¾çš„æˆ–ä¸å¯èƒ½çš„ã€‚å•ç»†èƒRNA-Seqå¯ä»¥ä½¿æ‚¨åœ¨ä¸éœ€è¦çº¯åŒ–çš„æƒ…å†µä¸‹çœ‹åˆ°è¿™äº›çŠ¶æ€ã€‚ç„¶è€Œï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šæ¯ä¸ªcellåœ¨å¯èƒ½çš„çŠ¶æ€èŒƒå›´å†…çš„ä½ç½®ã€‚","text":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ ç®€ä»‹åœ¨å‘è‚²è¿‡ç¨‹ä¸­ï¼Œç»†èƒå¯¹åˆºæ¿€ä½œå‡ºååº”ï¼Œå¹¶åœ¨æ•´ä¸ªç”Ÿå‘½è¿‡ç¨‹ä¸­ï¼Œä»ä¸€ç§åŠŸèƒ½â€œçŠ¶æ€â€è¿‡æ¸¡åˆ°å¦ä¸€ç§åŠŸèƒ½â€œçŠ¶æ€â€ã€‚ä¸åŒçŠ¶æ€çš„ç»†èƒè¡¨è¾¾ä¸åŒçš„åŸºå› ï¼Œäº§ç”Ÿè›‹ç™½è´¨å’Œä»£è°¢ç‰©çš„åŠ¨æ€é‡å¤åºåˆ—ï¼Œä»è€Œå®Œæˆå®ƒä»¬çš„å·¥ä½œã€‚å½“ç»†èƒåœ¨çŠ¶æ€ä¹‹é—´ç§»åŠ¨æ—¶ï¼Œå®ƒä»¬ç»å†ä¸€ä¸ªè½¬å½•é‡ç»„çš„è¿‡ç¨‹ï¼Œä¸€äº›åŸºå› è¢«æ²‰é»˜ï¼Œå¦ä¸€äº›åŸºå› è¢«æ¿€æ´»ã€‚è¿™äº›ç¬æ—¶çŠ¶æ€é€šå¸¸å¾ˆéš¾æè¿°ï¼Œå› ä¸ºåœ¨æ›´ç¨³å®šçš„ç«¯ç‚¹çŠ¶æ€ä¹‹é—´çº¯åŒ–ç»†èƒå¯èƒ½æ˜¯å›°éš¾çš„æˆ–ä¸å¯èƒ½çš„ã€‚å•ç»†èƒRNA-Seqå¯ä»¥ä½¿æ‚¨åœ¨ä¸éœ€è¦çº¯åŒ–çš„æƒ…å†µä¸‹çœ‹åˆ°è¿™äº›çŠ¶æ€ã€‚ç„¶è€Œï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šæ¯ä¸ªcellåœ¨å¯èƒ½çš„çŠ¶æ€èŒƒå›´å†…çš„ä½ç½®ã€‚ Monocleä»‹ç»äº†åˆ©ç”¨RNA-Seqè¿›è¡Œå•ç»†èƒè½¨è¿¹åˆ†æçš„ç­–ç•¥ã€‚Monocleä¸æ˜¯é€šè¿‡å®éªŒå°†ç»†èƒçº¯åŒ–æˆç¦»æ•£çŠ¶æ€ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ç§ç®—æ³•æ¥å­¦ä¹ æ¯ä¸ªç»†èƒå¿…é¡»ç»å†çš„åŸºå› è¡¨è¾¾å˜åŒ–åºåˆ—ï¼Œä½œä¸ºåŠ¨æ€ç”Ÿç‰©å­¦è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ä¸€æ—¦å®ƒäº†è§£äº†åŸºå› è¡¨è¾¾å˜åŒ–çš„æ•´ä½“â€œè½¨è¿¹â€ï¼ŒMonocleå°±å¯ä»¥å°†æ¯ä¸ªç»†èƒç½®äºè½¨è¿¹ä¸­çš„é€‚å½“ä½ç½®ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Monocleçš„å¾®åˆ†åˆ†æå·¥å…·åŒ…æ¥æŸ¥æ‰¾åœ¨è½¨è¿¹è¿‡ç¨‹ä¸­å—åˆ°è°ƒæ§çš„åŸºå› ï¼Œå¦‚æŸ¥æ‰¾ä½œä¸ºä¼ªæ—¶é—´å‡½æ•°å˜åŒ–çš„åŸºå› ä¸€èŠ‚æ‰€è¿°ã€‚å¦‚æœè¿™ä¸ªè¿‡ç¨‹æœ‰å¤šä¸ªç»“æœï¼ŒMonocleå°†é‡å»ºä¸€ä¸ªâ€œåˆ†æ”¯â€è½¨è¿¹ã€‚è¿™äº›åˆ†æ”¯ä¸ç»†èƒçš„â€œå†³ç­–â€ç›¸å¯¹åº”ï¼ŒMonocleæä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥è¯†åˆ«å—å®ƒä»¬å½±å“çš„åŸºå› ï¼Œå¹¶å‚ä¸è¿™äº›åŸºå› çš„å½¢æˆã€‚åœ¨åˆ†æå•ç»†èƒè½¨è¿¹ä¸­çš„åˆ†æ”¯çš„å°èŠ‚ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å¦‚ä½•åˆ†æåˆ†æ”¯ã€‚ monocle èƒ½åšçš„ä¸åªæ˜¯æ‹Ÿæ—¶åˆ†æï¼Œæˆ–è€…è¯´ä¸ºäº†åšæ‹Ÿæ—¶åˆ†æä»–ä¹Ÿåšäº†sc-rna-seqçš„åŸºæœ¬åˆ†ææµç¨‹ï¼šæ•°æ®è¯»å…¥ï¼Œå‡ä¸€åŒ–ï¼Œé™ç»´ï¼ˆPCAï¼Œumap,tsne,ï¼‰ï¼Œèšç±»ï¼ŒmarkeråŸºå› ç­›é€‰ä»¥åŠå¯è§†åŒ–å‡½æ•°ã€‚åœ¨æ–°çš„å­¦ä¹ ä¸­æˆ‘ä»¬å‘ç°monocleèƒ½åšçš„è¿œä¸åªè¿™äº›ï¼Œä¾‹å¦‚ç”¨shinyå¼€å‘äº†webç¨‹åºï¼Œæ›´åŠ ç”¨æˆ·å‹å¥½ï¼›å€ŸåŠ©garnettåŒ…å¯ä»¥åšç»†èƒå®šä¹‰â€”â€“monocleå·²ç»æ˜¯ä¸€ä¸ªsc-rna-seqæ•°æ®åˆ†æçš„å·¥å…·ç®±ã€‚ Monocelå¯¹è±¡çš„ç”ŸæˆMonocleçš„cdså¯¹è±¡å…¶å®åœ¨ä¸€å®šç¨‹åº¦ä¸Šéå¸¸ç±»ä¼¼äºSeuratï¼Œåªä¸è¿‡è¡¨ç¤ºæ–¹æ³•ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„ä»Seuratä¸­å–å‡ºéœ€è¦çš„æ•°æ®è½½å…¥Monocle3 å…·ä½“æ–¹æ³•å¯ä»¥å‚è€ƒç®€ä¹¦:scRNA-seqæ•°æ®åˆ†æ || Monocle3 ä½†æ˜¯ï¼Œmonocleè½¯ä»¶æœ‰è‡ªå·±çš„ä¸€å¥—æµç¨‹ï¼Œå›Šæ‹¬äº†æ ‡å‡†åŒ–ï¼Œå½’ä¸€åŒ–ï¼Œé™ç»´ï¼Œèšç±»ç­‰ç­‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æä¾›åŸå§‹çš„æœªç»å¤„ç†çš„è¡¨è¾¾çŸ©é˜µï¼Œä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬æ˜¯æ•´åˆäº†å¤šæ ·æœ¬çš„ç»“æœï¼Œè€Œæˆ‘ä»¬åˆä¸æƒ³ä½¿ç”¨monocleçš„æ‰¹æ¬¡æ•ˆåº”å»é™¤æ–¹æ³•ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆå¯¼å…¥å‘¢ï¼Ÿ æ–¹æ³•å°±æ˜¯æˆ‘ä»¬å¯¼å…¥Seuratå¤šæ ·æœ¬æ•´åˆå¹¶æ ‡å‡†åŒ–çš„ç»“æœçŸ©é˜µï¼Œç„¶åï¼Œåœ¨åé¢çš„é¢„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå–æ¶ˆæ‰æ ‡å‡†åŒ–ã€‚ library(Seurat)library(monocle3)endo&lt;-readRDS(&quot;DC.rds&quot;)DefaultAssay(endo)&lt;-&quot;integrated&quot;data &lt;- endo@assays$integrated@datapd &lt;- endo@meta.data#the metadata have many rubbish info,we delete itnew_pd&lt;-select(pd,stim,nCount_RNA,nFeature_RNA,percent.mt)new_pd$Cell.type&lt;-Idents(endo)head(new_pd) stim nCount_RNA nFeature_RNA percent.mtAAACCTGGTATCAGTC-1_1 CTRL 4835 1383 3.536711AACCGCGCATTCCTGC-1_1 CTRL 4029 1230 2.655746AACGTTGAGCCCAATT-1_1 CTRL 2576 918 3.377329AAGACCTGTGGTTTCA-1_1 CTRL 2841 1044 5.455825AAGTCTGCATGAAGTA-1_1 CTRL 3731 1213 3.886358ACAGCCGCATCGGACC-1_1 CTRL 5915 1918 3.043111 Cell.typeAAACCTGGTATCAGTC-1_1 DC2AACCGCGCATTCCTGC-1_1 MDSCAACGTTGAGCCCAATT-1_1 MDSCAAGACCTGTGGTTTCA-1_1 Dendritic.cells.activatedAAGTCTGCATGAAGTA-1_1 MDSCACAGCCGCATCGGACC-1_1 Dendritic.cells.activatedfData &lt;- data.frame(gene_short_name = row.names(data), row.names = row.names(data))#create new cds objcds &lt;- new_cell_data_set(data,cell_metadata = new_pd,gene_metadata = fData) é¢„å¤„ç†æ•°æ®scaleå¹¶é‡‡ç”¨PCAé™çº¬ #we use normalized data,so we do not normalize itcds &lt;- preprocess_cds(cds, num_dim = 30,norm_method = &quot;none&quot;) å¦‚æœä½ éè¦ä½¿ç”¨Monocleçš„æ‰¹æ¬¡æ•ˆåº”åŠŸèƒ½ï¼Œå¯ä»¥å°è¯•,batchåˆ—å¿…é¡»åœ¨ä½ çš„pDataé‡Œé¢ cds &lt;- align_cds(cds, alignment_group = &quot;batch&quot;) é‡‡ç”¨umapçš„æ–¹æ³•è¿è¡Œéçº¿æ€§é™ç»´ #umapcds &lt;- reduce_dimension(cds,umap.n_neighbors = 20L)#color by seurat clusterplot_cells(cds,label_groups_by_cluster=FALSE,color_cells_by = &quot;cell.type&quot;) ç»†èƒèšç±» #clustercds &lt;- cluster_cells(cds,resolution = 0.5)#color by monocle clusterplot_cells(cds, color_cells_by = &quot;partition&quot;,label_groups_by_cluster=FALSE) ä¼ªæ—¶é—´æ„å»ºå…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯åŸºäºå›¾å½¢ä»¥åŠè¡¨è¾¾é‡çš„å˜åŒ–å…³ç³»ï¼Œæ„å»ºä¸€ä¸ªä¸ªåŸºäºèµ·å§‹è¡¨è¾¾çš„è¿›åŒ–çº¿æˆ–è€…è¯´æ˜¯åˆ†æ”¯ï¼Œè¿™é‡Œé¢è‚¯å®šæ—¢æœ‰èŠ‚ç‚¹åˆæœ‰åˆ†æã€‚ cds &lt;- learn_graph(cds) ç”»å›¾å±•ç¤ºï¼š plot_cells(cds,color_cells_by = &quot;Cell.type&quot;,label_groups_by_cluster=FALSE,label_leaves=TRUE,label_branch_points=TRUE) å®šä¹‰èµ·å§‹èŠ‚ç‚¹&amp;&amp;ä¼ªæ—¶é—´åˆ†æèµ·å§‹èŠ‚ç‚¹å¯ä»¥åŸºäºç°æœ‰çš„çŸ¥è¯†ï¼Œæ¯”å¦‚ä½ å·²ç»å°†ç»†èƒç±»å‹æ³¨é‡Šå¥½äº†ï¼Œå…¶ä¸­æŸç§ç»†èƒå°±æ˜¯èµ·å§‹çš„æ—©æœŸç»†èƒï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒä½œä¸ºroot,å¦‚æœä¸çŸ¥é“ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨1åœ¨çš„ç»†èƒç¾¤ä½œä¸ºèµ·å§‹äº† ä¸€ä¸ªæœ‰ç”¨çš„å®šä¹‰æ ¹èŠ‚ç‚¹çš„å‡½æ•° get_earliest_principal_node &lt;- function(cds, time_bin=&quot;Dendritic.cells.activated&quot;)&#123; cell_ids &lt;- which(colData(cds)[, &quot;Cell.type&quot;] == time_bin) closest_vertex &lt;- cds@principal_graph_aux[[&quot;UMAP&quot;]]$pr_graph_cell_proj_closest_vertex closest_vertex &lt;- as.matrix(closest_vertex[colnames(cds), ]) root_pr_nodes &lt;- igraph::V(principal_graph(cds)[[&quot;UMAP&quot;]])$name[as.numeric(names (which.max(table(closest_vertex[cell_ids,]))))] root_pr_nodes&#125; å®šä¹‰æ ¹èŠ‚ç‚¹ #order cellcds &lt;- order_cells(cds, root_pr_nodes=get_earliest_principal_node(cds))#pseudotime analysisplot_cells(cds,color_cells_by = &quot;pseudotime&quot;,label_cell_groups=FALSE,label_leaves=FALSE,label_branch_points=FALSE,graph_label_size=1.5) åœ¨åŸºå› å±‚é¢æ¢ç´¢ä¼ªæ—¶é—´å¯»æ‰¾éšæ—¶é—´å˜å¼‚çš„åŸºå›  diff_gene &lt;- graph_test(cds, neighbor_graph=&quot;principal_graph&quot;, cores=4)id &lt;- row.names(subset(diff_gene, q_value &lt; 0.05))head(id)[1] &quot;CD74&quot; &quot;CXCL14&quot; &quot;HLA-DRA&quot; &quot;GAST&quot; &quot;C1QB&quot; &quot;HBA1&quot; åœ¨cdså¯¹è±¡ä¸­å¯»æ‰¾åŸºå› å¹¶ä½œå›¾ï¼Œä¸ºäº†çœ‹å‡ºå˜åŒ–ï¼Œå¯ä»¥é€‰æ‹©caseç»„ä¸­çš„è¡¨è¾¾é‡ CASE_genes &lt;- c(&quot;CD74&quot;, &quot;CXCL14&quot;, &quot;HLA-DRA&quot;)CASE_lineage_cds &lt;- cds[rowData(cds)$gene_short_name %in% AFD_genes,colData(cds)$stim %in% c(&quot;CASE&quot;)]#plot genesplot_genes_in_pseudotime(AFD_lineage_cds,color_cells_by=&quot;Cell.type&quot;) æ•™ç¨‹åˆ°æ­¤ç»“æŸï¼ŒåŸåˆ›ç¦æ­¢è½¬è½½æ–‡ä¸­å›¾ç‰‡å¤§éƒ¨åˆ†å–è‡ªå®˜ç½‘ï¼Œä»…ä½œä¸ºç¤ºä¾‹ã€‚","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"},{"title":"ä¸€æ–‡è¯»æ‡‚å•ç»†èƒæµ‹åºåˆ†ææµç¨‹","slug":"ä¸€æ–‡è¯»æ‡‚å•ç»†èƒæµ‹åºåˆ†ææµç¨‹","date":"2019-04-16T04:42:30.000Z","updated":"2024-10-18T05:33:08.808Z","comments":true,"path":"scRNA-seurat/","permalink":"https://xiaohanys.top/scRNA-seurat/","excerpt":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ æ‘˜è¦ä¸€æ–‡ä»‹ç»å•ç»†èƒæµ‹åºç”Ÿç‰©ä¿¡æ¯åˆ†æå®Œæ•´æµç¨‹ï¼Œè¿™å¯èƒ½æ˜¯æœ€æ–°ä¹Ÿæ˜¯æœ€å…¨çš„æµç¨‹","text":"æ–‡ç« å·²ç»è¿‡æ—¶ï¼Œè¯·å»å®˜ç½‘æŸ¥é˜…ç›¸å…³æ–‡æ¡£ æ‘˜è¦ä¸€æ–‡ä»‹ç»å•ç»†èƒæµ‹åºç”Ÿç‰©ä¿¡æ¯åˆ†æå®Œæ•´æµç¨‹ï¼Œè¿™å¯èƒ½æ˜¯æœ€æ–°ä¹Ÿæ˜¯æœ€å…¨çš„æµç¨‹ åŸºç¡€æµç¨‹ï¼ˆcellrangerï¼‰ cellranger æ•°æ®æ‹†åˆ†cellranger mkfastq å¯ç”¨äºå°†å•ç»†èƒæµ‹åºè·å¾—çš„ BCL æ–‡ä»¶æ‹†åˆ†ä¸ºå¯ä»¥è¯†åˆ«çš„ fastq æµ‹åºæ•°æ® cellranger makefastq --run=[ ] --samplesheet=[sample.csv] --jobmode=local --localcores=20 --localmem=80 -â€“run ï¼šæ˜¯ä¸‹æœºæ•°æ® BCL æ‰€åœ¨çš„è·¯å¾„ï¼›-â€“samplesheet ï¼šæ ·å“ä¿¡æ¯åˆ—è¡¨â€“å…±ä¸‰åˆ—ï¼ˆlane id ,sample name ,index name)æ³¨æ„è¦æ§åˆ¶å¥½æ ¸å¿ƒæ•°å’Œå†…å­˜æ•° è¿è¡Œäº§å‡ºç»“æœå­˜åœ¨äº out ç›®å½•ä¸­ cellranger æ•°æ®ç»Ÿè®¡cellranger countæ˜¯ cellranger æœ€ä¸»è¦ä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½ï¼šå®Œæˆç»†èƒå’ŒåŸºå› çš„å®šé‡ï¼Œä¹Ÿå°±æ˜¯äº§ç”Ÿäº†æˆ‘ä»¬ç”¨æ¥åšå„ç§åˆ†æçš„åŸºå› è¡¨è¾¾çŸ©é˜µã€‚ cellranger count \\-â€“id=sample345 \\-â€“transcriptome=/opt/refdata-cellranger-GRCh38-1.2.0/GRCh38 \\-â€“fastqs=/home/jdoe/runs/HAWT7ADXX/outs/fastq_path \\-â€“indices=SI-3A-A1 \\â€“-cells=1000 id ï¼šäº§ç”Ÿçš„ç»“æœéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå¯ä»¥å–å‡ å·æ ·å“ï¼ˆå¦‚ sample345ï¼‰ï¼› fastqs ï¼šç”± cellranger mkfastq äº§ç”Ÿçš„ fastqs æ–‡ä»¶å¤¹æ‰€åœ¨çš„è·¯å¾„ï¼›fastqs ï¼šç”± cellranger mkfastq äº§ç”Ÿçš„ fastqs æ–‡ä»¶å¤¹æ‰€åœ¨çš„è·¯å¾„ï¼› indicesï¼šsample indexï¼šSI-3A-A1ï¼› transcriptomeï¼šå‚è€ƒè½¬å½•ç»„æ–‡ä»¶è·¯å¾„ï¼› cellsï¼šé¢„æœŸå›å¤çš„ç»†èƒæ•°ï¼› ä¸‹æ¸¸åˆ†æcellranger count è®¡ç®—çš„ç»“æœåªèƒ½ä½œä¸ºåˆæ­¥è§‚æµ‹çš„ç»“æœï¼Œå¦‚æœéœ€è¦è¿›ä¸€æ­¥åˆ†æèšç±»ç»†èƒï¼Œè¿˜éœ€è¦è¿›è¡Œä¸‹æ¸¸åˆ†æï¼Œè¿™é‡Œä½¿ç”¨å®˜æ–¹æ¨è R åŒ…ï¼ˆSeurat 3.1ï¼‰ æµç¨‹å‚è€ƒå®˜æ–¹ï¼ˆå¤–å‘¨è¡€åˆ†ææ ‡å‡†æµç¨‹ï¼‰ è½¯ä»¶å®‰è£…install.packages(&#x27;Seurat&#x27;)library(Seurat) ç”Ÿæˆ Seruat å¯¹è±¡library(dplyr)library(Seurat)# Load the PBMC datasetpbmc.data &lt;- Read10X(data.dir = &quot;../data/pbmc3k/filtered_gene_bc_matrices/hg19/&quot;)# Initialize the Seurat object with the raw (non-normalized data).pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = &quot;pbmc3k&quot;, min.cells = 3, min.features = 200)pbmc ## An object of class Seurat## 13714 features across 2700 samples within 1 assay## Active assay: RNA (13714 features) è¿™é‡Œè¯»å–çš„æ˜¯å•ç»†èƒ count ç»“æœä¸­çš„çŸ©é˜µç›®å½•ï¼›åœ¨å¯¹è±¡ç”Ÿæˆçš„è¿‡ç¨‹ä¸­ï¼Œåšäº†åˆæ­¥çš„è¿‡æ»¤ï¼›ç•™ä¸‹æ‰€æœ‰åœ¨&gt;&#x3D;3 ä¸ªç»†èƒä¸­è¡¨è¾¾çš„åŸºå›  min.cells &#x3D; 3ï¼›ä¸ºäº†é™¤å»ä¸€äº›è´¨é‡å·®çš„ç»†èƒ,ç•™ä¸‹æ‰€æœ‰æ£€æµ‹åˆ°&gt;&#x3D;200 ä¸ªåŸºå› çš„ç»†èƒ min.genes &#x3D; 200ã€‚ æ ‡å‡†é¢„å¤„ç†æµç¨‹# The [[ operator can add columns to object metadata. This is a great place to stash QC statspbmc[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(object = pbmc, pattern = &quot;^MT-&quot;) è¿™ä¸€æ­¥ mit-å¼€å¤´çš„ä¸ºçº¿ç²’ä½“åŸºå› ï¼Œè¿™é‡Œå°†å…¶è¿›è¡Œæ ‡è®°å¹¶ç»Ÿè®¡å…¶åˆ†å¸ƒé¢‘ç‡ # Visualize QC metrics as a violin plotVlnPlot(object = pbmc, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;), ncol = 3) å¯¹ pbmc å¯¹è±¡åšå°æç´å›¾ï¼Œåˆ†åˆ«ä¸ºåŸºå› æ•°ï¼Œç»†èƒæ•°å’Œçº¿ç²’ä½“å æ¯” pbmc &lt;- subset(x = pbmc, subset = nFeature_RNA &gt; 200 &amp; nFeature_RNA &lt; 2500 &amp; percent.mt &lt; 5) æ¥ä¸‹æ¥ï¼Œæ ¹æ®å›¾ç‰‡ä¸­åŸºå› æ•°å’Œçº¿ç²’ä½“æ•°ï¼Œåˆ†åˆ«è®¾ç½®è¿‡æ»¤å‚æ•°ï¼Œè¿™é‡ŒåŸºå› æ•° 200-2500ï¼Œçº¿ç²’ä½“ç™¾åˆ†æ¯”ä¸ºå°äº 5% æ•°æ®æ ‡å‡†åŒ–pbmc &lt;- NormalizeData(object = pbmc, normalization.method = &quot;LogNormalize&quot;, scale.factor = 10000)pbmc &lt;- NormalizeData(object = pbmc) é‰´å®šé«˜åº¦å˜åŒ–åŸºå› pbmc &lt;- FindVariableFeatures(object = pbmc, selection.method = &quot;vst&quot;, nfeatures = 2000)# Identify the 10 most highly variable genestop10 &lt;- head(x = VariableFeatures(object = pbmc), 10)# plot variable features with and without labelsplot1 &lt;- VariableFeaturePlot(object = pbmc)plot2 &lt;- LabelPoints(plot = plot1, points = top10, repel = TRUE)CombinePlots(plots = list(plot1, plot2)) æ•°æ®å½’ä¸€åŒ–all.genes &lt;- rownames(x = pbmc)pbmc &lt;- ScaleData(object = pbmc, features = all.genes) è¿™é‡Œè®¾ç½®å¯¹æ‰€æœ‰çš„åŸºå› éƒ½åšäº†scale,ä½†æ˜¯éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå…¶å®åç»­çš„åˆ†æéƒ½æ˜¯åŸºäºé«˜å˜åŸºå› çš„ï¼Œå› æ­¤ï¼Œä½¿ç”¨é»˜è®¤å‚æ•°å°±å¯ä»¥äº†ï¼Œè€Œä¸”æå‡æ•ˆç‡ã€‚ pbmc &lt;- ScaleData(object = pbmc) çº¿å½¢é™ç»´pbmc &lt;- RunPCA(object = pbmc, features = VariableFeatures(object = pbmc)) è¿™é‡Œæœ‰å¤šç§æ–¹æ³•å±•ç¤º pca ç»“æœï¼Œæœ¬æ–‡é‡‡ç”¨æœ€ç®€å•çš„æ–¹æ³• DimPlot(object = pbmc, reduction = &quot;pca&quot;) é‰´å®šæ•°æ®é›†çš„å¯ç”¨ç»´åº¦pbmc &lt;- JackStraw(object = pbmc, num.replicate = 100)pbmc &lt;- ScoreJackStraw(object = pbmc, dims = 1:20)JackStrawPlot(object = pbmc, dims = 1:15) è™šçº¿ä»¥ä¸Šçš„ä¸ºå¯ç”¨ç»´åº¦ï¼Œä½ ä¹Ÿå¯ä»¥è°ƒæ•´ dims å‚æ•°ï¼Œç”»å‡ºæ‰€æœ‰ pca æŸ¥çœ‹ å¦å¤–ä¸€ç§é‰´å®šæ‰‹æ®µæ˜¯ç»˜åˆ¶æ‰€æœ‰ PC çš„åˆ†å¸ƒç‚¹å›¾ ElbowPlot(pbmc) å¤§å¤šæ•°è½¯ä»¶éƒ½æ˜¯é€šè¿‡æ‹¾å–æ‹ç‚¹å¤„çš„ pc ä½œä¸ºé€‰å®šæ•°ç›® ç»†èƒèšç±»pbmc &lt;- FindNeighbors(object = pbmc, dims = 1:10)pbmc &lt;- FindClusters(object = pbmc, resolution = 0.5) è¿™é‡Œçš„ dims ä¸ºä¸Šä¸€æ­¥è®¡ç®—æ‰€ç”¨çš„ç»´åº¦æ•°ï¼Œè€Œ resolution å‚æ•°æ§åˆ¶èšç±»çš„æ•°ç›®ï¼Œé’ˆå¯¹ 3K çš„ç»†èƒæ•°ç›®ï¼Œæœ€å¥½çš„èŒƒå›´æ˜¯0.4-1.2 head(Idents(pbmc), 5) ## AAACATACAACCAC AAACATTGAGCTAC AAACATTGATCAGC AAACCGTGCTTCCG AAACCGTGTATGCG## 1 3 1 2 6## Levels: 0 1 2 3 4 5 6 7 8 æ‰§è¡Œéçº¿æ€§é™ç»´è¿™é‡Œæ³¨æ„ï¼Œè¿™ä¸€æ­¥èšç±»æœ‰ä¸¤ç§èšç±»æ–¹æ³•(umap&#x2F;tSNE)ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†ä¸è¦æ··ç”¨ï¼Œè¿™æ ·ï¼Œåé¢çš„ç»“ç®—ç»“æœä¼šå°†å…ˆå‰çš„èšç±»è¦†ç›–æ‰ï¼Œåªèƒ½ä¿ç•™ä¸€ä¸ªæœ¬æ–‡é‡‡ç”¨åŸºäº umap çš„èšç±»æ–¹æ³• pbmc &lt;- RunUMAP(object = pbmc, dims = 1:10)DimPlot(object = pbmc, reduction = &quot;umap&quot;) å®Œæˆèšç±»åï¼Œä¸€å®šè¦è®°ä½ä¿å­˜æ•°æ®ï¼Œä¸ç„¶é‡æ–°è®¡ç®—å¯è¦å¤´ç–¼äº† saveRDS(pbmc, file = &quot;../output/pbmc_tutorial.rds&quot;) å¯»æ‰¾æ¯ä¸ªèšç±»ä¸­æ˜¾è‘—è¡¨è¾¾çš„åŸºå› cluster1.markers &lt;- FindMarkers(object = pbmc, ident.1 = 1, min.pct = 0.25)head(x = cluster1.markers, n = 5) è¿™æ ·æ˜¯å¯»æ‰¾å•ä¸ªèšç±»ä¸­çš„æ˜¾è‘—åŸºå›  cluster5.markers &lt;- FindMarkers(object = pbmc, ident.1 = 5, ident.2 = c(0, 3), min.pct = 0.25)head(x = cluster5.markers, n = 5) è¿™æ ·å¯»æ‰¾æ‰€æœ‰èšç±»ä¸­æ˜¾è‘—åŸºå› ï¼Œè®¡ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œéœ€è¦ç­‰å¾… å¦å¤–ï¼Œæˆ‘ä»¬æœ‰å¤šç§æ–¹æ³•ç»Ÿè®¡åŸºå› çš„æ˜¾è‘—æ€§ FeaturePlot(object = pbmc, features = c(&quot;MS4A1&quot;, &quot;GNLY&quot;, &quot;CD3E&quot;, &quot;CD14&quot;, &quot;FCER1A&quot;, &quot;FCGR3A&quot;, &quot;LYZ&quot;, &quot;PPBP&quot;, &quot;CD8A&quot;)) top10 &lt;- pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = 10, wt = avg_logFC)DoHeatmap(object = pbmc, features = top10$gene) + NoLegend() å‰©ä¸‹çš„ä¾¿æ˜¯å¯»æ‰¾åŸºå›  marker å¹¶å¯¹ç»†èƒç±»å‹è¿›è¡Œæ³¨é‡Š ä½ å¯èƒ½æƒ³è¦çŸ¥é“å¦‚ä½•å¯¹å¤šæ ·æœ¬è¿›è¡Œæ•´åˆåˆ†æï¼Œè¯·å‚è€ƒæ•™ç¨‹ï¼šæ•´åˆåˆºæ¿€æ€§å’Œå¯¹ç…§æ€§ PBMC æ•°æ®é›†ï¼Œä»¥å­¦ä¹ ç»†èƒç±»å‹ç‰¹å¼‚æ€§ååº” ä½ å¯èƒ½æƒ³äº†è§£å¦‚ä½•çµæ´»æ“ä½œ Seurat çš„ S4 å¯¹è±¡ï¼Œä»¥ä¾¿è½»æ¾çš„æå–è¡¨è¾¾çŸ©é˜µï¼›äº¦æˆ–è€…æƒ³è¦åšä¸€äº›ä¸ä¸€æ ·çš„å¯è§†åŒ–æ•ˆæœï¼Œä¾‹å¦‚é‡‡ç”¨å¹³å‡è¡¨è¾¾é‡åšçƒ­å›¾å±•ç¤ºç­‰ï¼Œè¯·å‚è€ƒSeurat3.1 çš„çµæ´»æ“ä½œæŒ‡å— ä½ å¯èƒ½æƒ³å¯¹å•ç»†èƒæ•°æ®åšè¿›ä¸€æ­¥åˆ†æï¼Œä¾‹å¦‚åŠŸèƒ½åˆ†æï¼Œè¯·å‚è€ƒ10X å•ç»†èƒæ•°æ®é’ˆå¯¹ç»†èƒåŠå…¶äºšå‹çš„åŸºå› é›†åŠŸèƒ½åˆ†æå’Œè½¬å½•è°ƒæ§åˆ†æ å…¨è‡ªåŠ¨ç»†èƒç±»å‹æ³¨é‡Šä¼—æ‰€å‘¨çŸ¥ï¼Œç»†èƒç±»å‹çš„æ³¨é‡Šæ˜¯æœ€å›°éš¾çš„ä¸€æ­¥ï¼Œé™¤éä½ æœ‰å¾ˆå¼ºçš„å¯¹ç»†èƒåŸºå› çš„æ•æ„Ÿåº¦ï¼Œä¸ç„¶å¾ˆéš¾è¯†åˆ«ç»†èƒç±»å‹ã€‚ é€šå¸¸è¯†åˆ«ç»†èƒç±»å‹çš„æ–¹æ³•ä¸»è¦æœ‰ä¸‰ç§ æ ¹æ® Marker åŸºå› ï¼Œé‡‡ç”¨CellMarkeræˆ–è€…panglaoDBæ•°æ®åº“ï¼Œè¿›è¡Œç»†èƒæ³¨é‡Š,å¯ä»¥é‡‡ç”¨è¶…å‡ ä½•åˆ†å¸ƒç®—æ³•æ¥è¿›è¡Œç²¾ç¡®æ€§éªŒè¯ï¼Œæ–¹æ³•å‚è€ƒClusterProfiler:çœŸçš„ä¸åªæ˜¯å¯Œé›†åˆ†æ ä»æ–‡çŒ®ä¸­è·å–å·²ç»éªŒè¯çš„ Marker é‡‡ç”¨ä¸€äº›è‡ªåŠ¨åŒ–æ³¨é‡Šçš„è½¯ä»¶ï¼Œä¾‹å¦‚SingleR,Garnett,celarefç­‰ è¿™é‡Œç®€å•ä»‹ç»ä¸‹SingleR SingleR:ä¸€ä¸ªå…¨è‡ªåŠ¨ç»†èƒæ³¨é‡Šçš„ R åŒ…ï¼Œç”¨æ³•å¾ˆç®€å• è½¯ä»¶å®‰è£…BiocManager::install(&quot;SingleR&quot;)browseVignettes(&quot;SingleR&quot;) åˆ›å»º SingleR å¯¹è±¡ä»å¤´é¢„æµ‹çš„æ–¹æ³•è¯·å‚è€ƒå®˜æ–¹æ•™ç¨‹ å› ä¸ºæˆ‘ä»¬åˆšåˆšä» Seurat è¿‡æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å¾ˆæƒ³çŸ¥é“ Seurat cluster çš„ç»†èƒæ³¨é‡Šç»“æœï¼Œå› æ­¤ï¼Œå¯¹ Seurat çš„ç»“æœè¿›è¡Œæ³¨é‡Š æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ä¸¤ä¸ªäººç±»çš„å‚è€ƒé›†å»åšç»†èƒæ³¨é‡Š library(Seurat)library(SingleR)library(dplyr)library(tibble)hpca.se &lt;- HumanPrimaryCellAtlasData()bpe.se &lt;- BlueprintEncodeData() è¯»å…¥Seuratå¯¹è±¡è½¬æ¢ä¸ºSingleCellæ”¯æŒçš„å¯¹è±¡ seurat.obj &lt;- readRDS(&quot;../output/pbmc_tutorial.rds&quot;)seurat.obj@meta.data$cell.type &lt;- Idents(seurat.obj)test &lt;- as.SingleCellExperiment(seurat.obj) é‡‡ç”¨ä¸¤ä¸ªå‚è€ƒé›†ä¸€èµ·è¿›è¡Œæ³¨é‡Šï¼Œ Anno &lt;- SingleR(test = test, ref = list(HP = hpca.se , BP = bpe.se), labels = list(hpca.se$label.main , bpe.se$label.main), method = &quot;cluster&quot;, cluster = test$cell.type) æå–éœ€è¦çš„ç»†èƒåˆ†ç±»ä¿¡æ¯ Anno$cluster &lt;- rownames(Anno)fin &lt;- Anno %&gt;% dplyr::tbl_df() %&gt;% dplyr::select(cluster,labels) ä½ ä¹Ÿå¯ä»¥å°†ç»†èƒæ³¨é‡Šä¿¡æ¯é‡æ–°æ·»åŠ åˆ°Seuratå¯¹è±¡ä¸­å» new.cluster.ids &lt;- fin$labelsnames(new.cluster.ids) &lt;- levels(seurat.obj)seurat.obj &lt;- RenameIdents(seurat.obj, new.cluster.ids) ä¼ªæ—¶é—´åˆ†æä¼ªæ—¶é—´åˆ†æå»ºè®®é‡‡ç”¨ monocle3.0 è½¯ä»¶ è½¯ä»¶å®‰è£…##å®‰è£…ä¾èµ–BiocManager::install(c(&#x27;BiocGenerics&#x27;, &#x27;DelayedArray&#x27;, &#x27;DelayedMatrixStats&#x27;, &#x27;limma&#x27;, &#x27;S4Vectors&#x27;, &#x27;SingleCellExperiment&#x27;, &#x27;SummarizedExperiment&#x27;, &#x27;batchelor&#x27;))##å®‰è£…monocle3devtools::install_github(&#x27;cole-trapnell-lab/leidenbase&#x27;)devtools::install_github(&#x27;cole-trapnell-lab/monocle3&#x27;)library(monocle3) æ ‡å‡†åˆ†ææµlibrary(Seurat)library(monocle3)endo&lt;-readRDS(&quot;../output/pbmc_tutorial.rds&quot;)data &lt;- endo@assays$RNA@countspd &lt;- endo@meta.data ä¸è¦ç›´æ¥æŠŠmeta.dataæ”¾å…¥pdä¸­å»ï¼Œå¤ªå¤šæ²¡ç”¨çš„ä¿¡æ¯äº†ï¼Œå…ˆæ¸…ç†ä¸‹ new_pd&lt;-select(pd,nCount_RNA,nFeature_RNA,percent.mt)new_pd$Cell.type&lt;-Idents(endo)head(new_pd) nCount_RNA nFeature_RNA percent.mtAAACCTGGTATCAGTC-1_1 4835 1383 3.536711AACCGCGCATTCCTGC-1_1 4029 1230 2.655746AACGTTGAGCCCAATT-1_1 2576 918 3.377329AAGACCTGTGGTTTCA-1_1 2841 1044 5.455825AAGTCTGCATGAAGTA-1_1 3731 1213 3.886358ACAGCCGCATCGGACC-1_1 5915 1918 3.043111 Cell.typeAAACCTGGTATCAGTC-1_1 DC2AACCGCGCATTCCTGC-1_1 MDSCAACGTTGAGCCCAATT-1_1 MDSCAAGACCTGTGGTTTCA-1_1 Dendritic.cells.activatedAAGTCTGCATGAAGTA-1_1 MDSCACAGCCGCATCGGACC-1_1 Dendritic.cells.activatedfData &lt;- data.frame(gene_short_name = row.names(data), row.names = row.names(data)) ç”Ÿæˆmonocleçš„cdså¯¹è±¡ cds &lt;- new_cell_data_set(data,cell_metadata = new_pd,gene_metadata = fData) è¿è¡Œä¸‹æ¸¸æ ‡å‡†æµç¨‹ï¼Œæ— è®ºå¦‚ä½•éƒ½å¾—è·‘ï¼Œæ˜¯å¿…é¡»çš„é»˜è®¤æµç¨‹ cds &lt;- preprocess_cds(cds, num_dim = 30)#umapcds &lt;- reduce_dimension(cds,umap.n_neighbors = 20L)#color by seurat clusterplot_cells(cds,label_groups_by_cluster=FALSE,color_cells_by = &quot;Cell.type&quot;) #clustercds &lt;- cluster_cells(cds,resolution = 0.5)#color by monocle clusterplot_cells(cds, color_cells_by = &quot;partition&quot;,label_groups_by_cluster=FALSE) cds &lt;- learn_graph(cds)plot_cells(cds,color_cells_by = &quot;Cell.type&quot;,label_groups_by_cluster=FALSE,label_leaves=TRUE,label_branch_points=TRUE) å®šä¹‰æ—¶é—´å¼€å§‹èŠ‚ç‚¹&amp;&amp;ä¼ªæ—¶é—´åˆ†æ##ä¸€ä¸ªæœ‰ç”¨çš„å¯»æ‰¾èµ·æºèŠ‚ç‚¹çš„å‡½æ•°get_earliest_principal_node &lt;- function(cds, time_bin=&quot;Dendritic.cells.activated&quot;)&#123; cell_ids &lt;- which(colData(cds)[, &quot;Cell.type&quot;] == time_bin) closest_vertex &lt;- cds@principal_graph_aux[[&quot;UMAP&quot;]]$pr_graph_cell_proj_closest_vertex closest_vertex &lt;- as.matrix(closest_vertex[colnames(cds), ]) root_pr_nodes &lt;- igraph::V(principal_graph(cds)[[&quot;UMAP&quot;]])$name[as.numeric(names (which.max(table(closest_vertex[cell_ids,]))))] root_pr_nodes&#125;#order cellcds &lt;- order_cells(cds, root_pr_nodes=get_earliest_principal_node(cds))#pseudotime analysisplot_cells(cds,color_cells_by = &quot;pseudotime&quot;,label_cell_groups=FALSE,label_leaves=FALSE,label_branch_points=FALSE,graph_label_size=1.5) PS:å¯¹å¤šæ ·æœ¬è¿›è¡Œä¼ªæ—¶é—´åˆ†æï¼Œè¯·å‚è€ƒä½¿ç”¨ Monocle3 å¯¹å¤šæ ·æœ¬å•ç»†èƒæ•°æ®è¿›è¡Œä¼ªæ—¶é—´åˆ†æ æœ¬æ–‡çº¯å±åŸåˆ›ï¼Œéƒ¨åˆ†æ•°æ®é‡‡ç”¨å®˜æ–¹æ•™ç¨‹ï¼Œè½¬è½½éœ€æ ‡æ˜å‡ºå¤„ æ•™ç¨‹é“¾æ¥ï¼š æ•™ç¨‹ï¼šæ•´åˆåˆºæ¿€æ€§å’Œå¯¹ç…§æ€§ PBMC æ•°æ®é›†ï¼Œä»¥å­¦ä¹ ç»†èƒç±»å‹ç‰¹å¼‚æ€§ååº” Seurat3.1 çš„çµæ´»æ“ä½œæŒ‡å— 10X å•ç»†èƒæ•°æ®é’ˆå¯¹ç»†èƒåŠå…¶äºšå‹çš„åŸºå› é›†åŠŸèƒ½åˆ†æå’Œè½¬å½•è°ƒæ§åˆ†æ ClusterProfiler:çœŸçš„ä¸åªæ˜¯å¯Œé›†åˆ†æ ä½¿ç”¨ Monocle3 å¯¹å¤šæ ·æœ¬å•ç»†èƒæ•°æ®è¿›è¡Œä¼ªæ—¶é—´åˆ†æ","categories":[{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"}],"author":"Xiaoguang Pan"}],"categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"https://xiaohanys.top/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"},{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"},{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://xiaohanys.top/tags/AI/"},{"name":"ç½‘ç«™åˆ†äº«","slug":"ç½‘ç«™åˆ†äº«","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E5%88%86%E4%BA%AB/"},{"name":"Python","slug":"Python","permalink":"https://xiaohanys.top/tags/Python/"},{"name":"ç½‘ç«™æ­å»º","slug":"ç½‘ç«™æ­å»º","permalink":"https://xiaohanys.top/tags/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://xiaohanys.top/tags/%E5%89%8D%E7%AB%AF/"},{"name":"ç”Ÿç‰©ä¿¡æ¯","slug":"ç”Ÿç‰©ä¿¡æ¯","permalink":"https://xiaohanys.top/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/"},{"name":"Rè¯­è¨€","slug":"Rè¯­è¨€","permalink":"https://xiaohanys.top/tags/R%E8%AF%AD%E8%A8%80/"},{"name":"åç«¯","slug":"åç«¯","permalink":"https://xiaohanys.top/tags/%E5%90%8E%E7%AB%AF/"},{"name":"julia","slug":"julia","permalink":"https://xiaohanys.top/tags/julia/"},{"name":"å•ç»†èƒæµ‹åº","slug":"å•ç»†èƒæµ‹åº","permalink":"https://xiaohanys.top/tags/%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F/"},{"name":"è½¬å½•ç»„","slug":"è½¬å½•ç»„","permalink":"https://xiaohanys.top/tags/%E8%BD%AC%E5%BD%95%E7%BB%84/"},{"name":"CRISPR","slug":"CRISPR","permalink":"https://xiaohanys.top/tags/CRISPR/"},{"name":"gRNA","slug":"gRNA","permalink":"https://xiaohanys.top/tags/gRNA/"}]}