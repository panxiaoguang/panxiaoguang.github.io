<!DOCTYPE html>
<html lang="zh-CN">
    <head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/#6.0.0-alpha.1'>
  <meta name="generator" content="Hexo 7.3.0">
  <meta name="Volantis" content="6.0.0-alpha.1">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
  <link rel="canonical" href="https://blog.xiaohanys.xyz/undefined/"/>
  <!-- 渲染优化 -->
    <meta http-equiv='x-dns-prefetch-control' content='on' />
      <link rel='dns-prefetch' href='https://unpkg.com'>
      <link rel="preconnect" href="https://unpkg.com" crossorigin>
      <link rel='dns-prefetch' href='https://cdn.bootcdn.net'>
      <link rel="preconnect" href="https://cdn.bootcdn.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Content-Security-Policy" content=" default-src 'self' https:; block-all-mixed-content; base-uri 'self' https:; form-action 'self' https:; worker-src 'self' https:; connect-src 'self' https: *; img-src 'self' data: https: *; media-src 'self' https: *; font-src 'self' data: https: *; frame-src 'self' https: *; manifest-src 'self' https: *; child-src https:; script-src 'self' https: 'unsafe-inline' *; style-src 'self' https: 'unsafe-inline' *; ">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <!-- import head_begin begin -->
      <link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/panxiaoguang/nuxt-blog-guang/assets/bitbug_favicon.ico">
  <!-- import head_begin end -->
  <!-- Custom Files headBegin begin-->
  
  <!-- Custom Files headBegin end-->
  <link rel="preload" href="/css/style.css" as="style">
  <link rel="preload" href="https://unpkg.com/volantis-static@0.0.1660614606622/media/fonts/VarelaRound/VarelaRound-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
<link rel="preload" href="https://unpkg.com/volantis-static@0.0.1660614606622/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <!-- feed -->
  <!-- 页面元数据 -->
  <title>16S rRNA基因扩增子分析 - XiaoHanys</title>
  <meta name="keywords" content="生物信息,R语言,生物信息知识库,编程,前端,Python,网站搭建,人工智能">
  <meta desc name="description" content="在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。 - XiaoGuang - XiaoHanys">
  
<meta property="og:type" content="article">
<meta property="og:title" content="16S rRNA基因扩增子分析">
<meta property="og:url" content="https://blog.xiaohanys.xyz/undefined/index.html">
<meta property="og:site_name" content="XiaoHanys">
<meta property="og:description" content="在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png">
<meta property="article:published_time" content="2024-09-20T05:10:07.000Z">
<meta property="article:modified_time" content="2024-10-18T03:36:37.525Z">
<meta property="article:author" content="XiaoGuang">
<meta property="article:tag" content="生物信息">
<meta property="article:tag" content="R语言">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png">
  <style>
    /* 首屏样式 */
    #safearea {
  display: none;
}
:root {
  --color-site-body: #f4f4f4;
  --color-site-bg: #f4f4f4;
  --color-site-inner: #fff;
  --color-site-footer: #666;
  --color-card: #fff;
  --color-text: #444;
  --color-block: #f6f6f6;
  --color-inlinecode: #c74f00;
  --color-codeblock: #fff7ea;
  --color-h1: #3a3a3a;
  --color-h2: #3a3a3a;
  --color-h3: #333;
  --color-h4: #444;
  --color-h5: #555;
  --color-h6: #666;
  --color-p: #444;
  --color-list: #666;
  --color-list-hl: #30ad91;
  --color-meta: #888;
  --color-read-bkg: #e0d8c8;
  --color-read-post: #f8f1e2;
  --color-copyright-bkg: #f5f5f5;
  --link-color: #00323c;
}
* {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  outline: none;
  margin: 0;
  padding: 0;
}
*::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
*::-webkit-scrollbar-track-piece {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: #3dd9b6;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
html {
  color: var(--color-text);
  width: 100%;
  height: 100%;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  font-size: 16px;
}
html >::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
html >::-webkit-scrollbar-track-piece {
  background: transparent;
}
html >::-webkit-scrollbar-thumb {
  background: #3dd9b6;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
html >::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
body {
  background-color: var(--color-site-body);
  text-rendering: optimizelegibility;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  line-height: 1.6;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}
body.modal-active {
  overflow: hidden;
}
@media screen and (max-width: 680px) {
  body.modal-active {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
a {
  color: #2092ec;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
a:hover {
  color: #ff5722;
}
a:active,
a:hover {
  outline: 0;
}
ul,
ol {
  padding-left: 0;
}
ul li,
ol li {
  list-style: none;
}
header {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
img {
  border: 0;
  background: none;
  max-width: 100%;
}
svg:not(:root) {
  overflow: hidden;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  height: 0;
  border: 0;
  border-radius: 1px;
  -webkit-border-radius: 1px;
  border-bottom: 1px solid rgba(68,68,68,0.1);
}
button,
input {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
  text-transform: none;
  -webkit-appearance: button;
  cursor: pointer;
}
@supports (backdrop-filter: blur(20px)) {
  .blur {
    background: rgba(255,255,255,0.9) !important;
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.shadow {
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.shadow.floatable {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.shadow.floatable:hover {
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
}
#l_cover {
  min-height: 64px;
}
.cover-wrapper {
  top: 0;
  left: 0;
  max-width: 100%;
  height: 100vh;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  align-self: center;
  align-content: center;
  color: var(--color-site-inner);
  padding: 0 16px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  position: relative;
  overflow: hidden;
  margin-bottom: -100px;
}
.cover-wrapper .cover-bg {
  position: absolute;
  width: 100%;
  height: 100%;
  background-position: center;
  background-size: cover;
  -webkit-background-size: cover;
  -moz-background-size: cover;
}
.cover-wrapper .cover-bg.lazyload:not(.loaded) {
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
}
.cover-wrapper .cover-bg.lazyload.loaded {
  animation-delay: 0s;
  animation-duration: 0.5s;
  animation-fill-mode: forwards;
  animation-timing-function: ease-out;
  animation-name: fadeIn;
}
@-moz-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  z-index: 1;
  position: relative;
  width: 100%;
  height: 100%;
}
.cover-wrapper#full {
  height: calc(100vh + 100px);
  padding-bottom: 100px;
}
.cover-wrapper#half {
  max-height: 640px;
  min-height: 400px;
  height: calc(36vh - 64px + 200px);
}
.cover-wrapper #scroll-down {
  width: 100%;
  height: 64px;
  position: absolute;
  bottom: 100px;
  text-align: center;
  cursor: pointer;
}
.cover-wrapper #scroll-down .scroll-down-effects {
  color: #fff;
  font-size: 24px;
  line-height: 64px;
  position: absolute;
  width: 24px;
  left: calc(50% - 12px);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  animation: scroll-down-effect 1.5s infinite;
  -webkit-animation: scroll-down-effect 1.5s infinite;
  -khtml-animation: scroll-down-effect 1.5s infinite;
  -moz-animation: scroll-down-effect 1.5s infinite;
  -o-animation: scroll-down-effect 1.5s infinite;
  -ms-animation: scroll-down-effect 1.5s infinite;
}
@-moz-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  margin-top: 64px;
  margin-bottom: 100px;
}
.cover-wrapper .cover-body,
.cover-wrapper .cover-body .top,
.cover-wrapper .cover-body .bottom {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  max-width: 100%;
}
.cover-wrapper .cover-body .bottom {
  margin-top: 32px;
}
.cover-wrapper .cover-body .title {
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
  font-size: 3.125rem;
  line-height: 1.2;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.cover-wrapper .cover-body .subtitle {
  font-size: 20px;
}
.cover-wrapper .cover-body .logo {
  max-height: 120px;
  max-width: calc(100% - 4 * 16px);
}
@media screen and (min-height: 1024px) {
  .cover-wrapper .cover-body .title {
    font-size: 3rem;
  }
  .cover-wrapper .cover-body .subtitle {
    font-size: 1.05rem;
  }
  .cover-wrapper .cover-body .logo {
    max-height: 150px;
  }
}
.cover-wrapper .cover-body .m_search {
  position: relative;
  max-width: calc(100% - 16px);
  width: 320px;
  vertical-align: middle;
}
.cover-wrapper .cover-body .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  width: 100%;
}
.cover-wrapper .cover-body .m_search .icon,
.cover-wrapper .cover-body .m_search .input {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.cover-wrapper .cover-body .m_search .icon {
  position: absolute;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  line-height: 2.5rem;
  width: 32px;
  top: 0;
  left: 5px;
  color: rgba(68,68,68,0.75);
}
.cover-wrapper .cover-body .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  height: 2.5rem;
  width: 100%;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  font-size: 0.875rem;
  -webkit-appearance: none;
  padding-left: 36px;
  border-radius: 1.4rem;
  -webkit-border-radius: 1.4rem;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(10px);
  border: none;
  color: var(--color-text);
}
@media screen and (max-width: 500px) {
  .cover-wrapper .cover-body .m_search .input {
    padding-left: 36px;
  }
}
.cover-wrapper .cover-body .m_search .input:hover {
  background: rgba(255,255,255,0.8);
}
.cover-wrapper .cover-body .m_search .input:focus {
  background: #fff;
}
.cover-wrapper .list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  flex-wrap: wrap;
  -webkit-flex-wrap: wrap;
  -khtml-flex-wrap: wrap;
  -moz-flex-wrap: wrap;
  -o-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  align-items: stretch;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.cover-wrapper .list-h a {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 0;
  -ms-flex: 1 0;
  flex: 1 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  font-weight: 600;
}
.cover-wrapper .list-h a img {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  border-radius: 2px;
  -webkit-border-radius: 2px;
  margin: 4px;
  min-width: 40px;
  max-width: 44px;
}
@media screen and (max-width: 768px) {
  .cover-wrapper .list-h a img {
    min-width: 36px;
    max-width: 40px;
  }
}
@media screen and (max-width: 500px) {
  .cover-wrapper .list-h a img {
    margin: 2px 4px;
    min-width: 32px;
    max-width: 36px;
  }
}
@media screen and (max-width: 375px) {
  .cover-wrapper .list-h a img {
    min-width: 28px;
    max-width: 32px;
  }
}
.cover-wrapper {
  max-width: 100%;
}
.cover-wrapper.search .bottom .menu {
  margin-top: 16px;
}
.cover-wrapper.search .bottom .menu .list-h a {
  white-space: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  align-items: baseline;
  padding: 2px;
  margin: 4px;
  color: var(--color-site-inner);
  opacity: 0.75;
  -webkit-opacity: 0.75;
  -moz-opacity: 0.75;
  text-shadow: 0 1px 2px rgba(0,0,0,0.05);
  border-bottom: 2px solid transparent;
}
.cover-wrapper.search .bottom .menu .list-h a i {
  margin-right: 4px;
}
.cover-wrapper.search .bottom .menu .list-h a p {
  font-size: 0.9375rem;
}
.cover-wrapper.search .bottom .menu .list-h a:hover,
.cover-wrapper.search .bottom .menu .list-h a.active,
.cover-wrapper.search .bottom .menu .list-h a:active {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
  border-bottom: 2px solid var(--color-site-inner);
}
.cover-wrapper.dock .menu,
.cover-wrapper.featured .menu,
.cover-wrapper.focus .menu {
  border-radius: 6px;
  -webkit-border-radius: 6px;
}
.cover-wrapper.dock .menu .list-h a,
.cover-wrapper.featured .menu .list-h a,
.cover-wrapper.focus .menu .list-h a {
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  padding: 12px;
  line-height: 24px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  border-bottom: none;
  text-align: center;
  align-content: flex-end;
  color: rgba(68,68,68,0.7);
  font-size: 1.5rem;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h a,
  .cover-wrapper.featured .menu .list-h a,
  .cover-wrapper.focus .menu .list-h a {
    padding: 12px 8px;
  }
}
.cover-wrapper.dock .menu .list-h a i,
.cover-wrapper.featured .menu .list-h a i,
.cover-wrapper.focus .menu .list-h a i {
  margin: 8px;
}
.cover-wrapper.dock .menu .list-h a p,
.cover-wrapper.featured .menu .list-h a p,
.cover-wrapper.focus .menu .list-h a p {
  font-size: 0.875rem;
}
.cover-wrapper.dock .menu .list-h a.active,
.cover-wrapper.featured .menu .list-h a.active,
.cover-wrapper.focus .menu .list-h a.active {
  background: var(--color-card);
  backdrop-filter: none;
}
.cover-wrapper.dock .menu .list-h a.active i,
.cover-wrapper.featured .menu .list-h a.active i,
.cover-wrapper.focus .menu .list-h a.active i,
.cover-wrapper.dock .menu .list-h a.active i+p,
.cover-wrapper.featured .menu .list-h a.active i+p,
.cover-wrapper.focus .menu .list-h a.active i+p {
  color: #3dd9b6;
}
.cover-wrapper.dock .menu .list-h a.active img+p,
.cover-wrapper.featured .menu .list-h a.active img+p,
.cover-wrapper.focus .menu .list-h a.active img+p {
  color: var(--color-text);
}
.cover-wrapper.dock .menu .list-h a:hover,
.cover-wrapper.featured .menu .list-h a:hover,
.cover-wrapper.focus .menu .list-h a:hover {
  background: var(--color-card);
}
.cover-wrapper.dock .top {
  margin-bottom: 48px;
}
.cover-wrapper.dock .menu {
  background: rgba(255,255,255,0.5);
  position: absolute;
  bottom: 0;
  max-width: 100%;
}
.cover-wrapper.dock .menu .list-h {
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  margin: 4px;
}
.cover-wrapper.dock .menu .list-h a+a {
  margin-left: 4px;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h {
    overflow-x: scroll;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar {
    height: 0;
    width: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-track-piece {
    background: transparent;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb {
    background: #3dd9b6;
    cursor: pointer;
    border-radius: 0;
    -webkit-border-radius: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb:hover {
    background: #ff5722;
  }
}
@supports (backdrop-filter: blur(20px)) {
  .cover-wrapper.dock .menu {
    background: rgba(255,255,255,0.5);
    backdrop-filter: saturate(200%) blur(20px);
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --color-mode: 'dark';
  }
  :root:not([color-scheme]) {
    --color-site-body: #121212;
    --color-read-bkg: #1f1f1f;
    --color-read-post: #262626;
    --color-site-bg: #1f1f1f;
    --color-site-inner: rgba(238,238,238,0.871);
    --color-site-footer: rgba(170,170,170,0.871);
    --color-card: #262626;
    --color-text: rgba(238,238,238,0.871);
    --color-block: #434343;
    --color-codeblock: #1f1f1f;
    --color-inlinecode: #d56d28;
    --color-h1: rgba(255,255,255,0.871);
    --color-h2: rgba(255,255,255,0.871);
    --color-h3: rgba(255,255,255,0.6);
    --color-h4: rgba(255,255,255,0.6);
    --color-h5: rgba(255,255,255,0.6);
    --color-h6: rgba(255,255,255,0.6);
    --color-p: rgba(217,217,217,0.871);
    --color-list: rgba(217,217,217,0.871);
    --color-list-hl: #63e0c4;
    --color-meta: rgba(191,191,191,0.871);
    --color-link: rgba(191,191,191,0.871);
    --color-copyright-bkg: #21252b;
    --link-color: #e4e4e4;
  }
  :root:not([color-scheme]) img {
    filter: brightness(70%) !important;
  }
  :root:not([color-scheme]) .blur {
    background: rgba(31,31,31,0.9) !important;
  }
  :root:not([color-scheme]) .white-box.blur {
    background: rgba(38,38,38,0.9) !important;
  }
  :root:not([color-scheme]) .nav-main .u-search-input {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a:hover {
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) .article blockquote {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .article-title a {
    color: var(--color-h1) !important;
  }
  :root:not([color-scheme]) details>summary {
    color: var(--color-p) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) details {
    border: 1px solid var(--color-site-bg) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) #u-search .modal,
  :root:not([color-scheme]) #u-search .modal-header,
  :root:not([color-scheme]) #u-search .modal-body {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #u-search .modal-body .modal-results .result:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:focus {
    background: var(--color-site-body) !important;
  }
}
[color-scheme='dark'] {
  --color-site-body: #121212;
  --color-read-bkg: #1f1f1f;
  --color-read-post: #262626;
  --color-site-bg: #1f1f1f;
  --color-site-inner: rgba(238,238,238,0.871);
  --color-site-footer: rgba(170,170,170,0.871);
  --color-card: #262626;
  --color-text: rgba(238,238,238,0.871);
  --color-block: #434343;
  --color-codeblock: #1f1f1f;
  --color-inlinecode: #d56d28;
  --color-h1: rgba(255,255,255,0.871);
  --color-h2: rgba(255,255,255,0.871);
  --color-h3: rgba(255,255,255,0.6);
  --color-h4: rgba(255,255,255,0.6);
  --color-h5: rgba(255,255,255,0.6);
  --color-h6: rgba(255,255,255,0.6);
  --color-p: rgba(217,217,217,0.871);
  --color-list: rgba(217,217,217,0.871);
  --color-list-hl: #63e0c4;
  --color-meta: rgba(191,191,191,0.871);
  --color-link: rgba(191,191,191,0.871);
  --color-copyright-bkg: #21252b;
  --link-color: #e4e4e4;
}
[color-scheme='dark'] img {
  filter: brightness(70%) !important;
}
[color-scheme='dark'] .blur {
  background: rgba(31,31,31,0.9) !important;
}
[color-scheme='dark'] .white-box.blur {
  background: rgba(38,38,38,0.9) !important;
}
[color-scheme='dark'] .nav-main .u-search-input {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a {
  background: var(--color-block) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a:hover {
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] .article blockquote {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .article-title a {
  color: var(--color-h1) !important;
}
[color-scheme='dark'] details>summary {
  color: var(--color-p) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] details {
  border: 1px solid var(--color-site-bg) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] #u-search .modal,
[color-scheme='dark'] #u-search .modal-header,
[color-scheme='dark'] #u-search .modal-body {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #u-search .modal-body .modal-results .result:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:focus {
  background: var(--color-site-body) !important;
}
@media screen and (max-width: 500px) {
  [color-scheme='dark'] .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}
[color-scheme='dark'] .friend-card.color-bk-dark {
  filter: brightness(0.8);
}
@font-face {
  font-family: 'UbuntuMono';
  src: url("https://unpkg.com/volantis-static@0.0.1660614606622/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
@font-face {
  font-family: 'Varela Round';
  src: url("https://unpkg.com/volantis-static@0.0.1660614606622/media/fonts/VarelaRound/VarelaRound-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
.l_header {
  position: fixed;
  z-index: 1000;
  top: 0;
  width: 100%;
  height: 64px;
  background: var(--color-card);
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.l_header.auto {
  transition: opacity 0.4s ease;
  -webkit-transition: opacity 0.4s ease;
  -khtml-transition: opacity 0.4s ease;
  -moz-transition: opacity 0.4s ease;
  -o-transition: opacity 0.4s ease;
  -ms-transition: opacity 0.4s ease;
  visibility: hidden;
}
.l_header.auto.show {
  opacity: 1 !important;
  -webkit-opacity: 1 !important;
  -moz-opacity: 1 !important;
  visibility: visible;
}
.l_header .container {
  margin-left: 16px;
  margin-right: 16px;
}
.l_header #wrapper {
  height: 100%;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.l_header #wrapper .nav-main,
.l_header #wrapper .nav-sub {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  justify-content: space-between;
  -webkit-justify-content: space-between;
  -khtml-justify-content: space-between;
  -moz-justify-content: space-between;
  -o-justify-content: space-between;
  -ms-justify-content: space-between;
  align-items: center;
}
.l_header #wrapper .nav-main {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.l_header #wrapper.sub .nav-main {
  transform: translateY(-64px);
  -webkit-transform: translateY(-64px);
  -khtml-transform: translateY(-64px);
  -moz-transform: translateY(-64px);
  -o-transform: translateY(-64px);
  -ms-transform: translateY(-64px);
}
.l_header #wrapper .nav-sub {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
  height: 64px;
  width: calc(100% - 2 * 16px);
  position: absolute;
}
.l_header #wrapper .nav-sub ::-webkit-scrollbar {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (min-width: 2048px) {
  .l_header #wrapper .nav-sub {
    max-width: 55vw;
    margin: auto;
  }
}
.l_header #wrapper.sub .nav-sub {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
}
.l_header #wrapper .title {
  position: relative;
  color: var(--color-text);
  padding-left: 24px;
  max-height: 64px;
}
.l_header #wrapper .nav-main .title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-shrink: 0;
  line-height: 64px;
  padding: 0 24px;
  font-size: 1.25rem;
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
}
.l_header #wrapper .nav-main .title img {
  height: 64px;
}
.l_header .nav-sub {
  max-width: 1080px;
  margin: auto;
}
.l_header .nav-sub .title {
  font-weight: bold;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  line-height: 1.2;
  max-height: 64px;
  white-space: normal;
  flex-shrink: 1;
}
.l_header .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  line-height: 64px;
  align-items: center;
}
.l_header .switcher .s-toc {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (max-width: 768px) {
  .l_header .switcher .s-toc {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
  }
}
.l_header .switcher >li {
  height: 48px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  margin: 2px;
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li {
    margin: 0 1px;
    height: 48px;
  }
}
.l_header .switcher >li >a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  align-items: center;
  width: 48px;
  height: 48px;
  padding: 0.85em 1.1em;
  border-radius: 100px;
  -webkit-border-radius: 100px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  color: #3dd9b6;
}
.l_header .switcher >li >a:hover {
  border: none;
}
.l_header .switcher >li >a.active,
.l_header .switcher >li >a:active {
  border: none;
  background: var(--color-site-bg);
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li >a {
    width: 36px;
    height: 48px;
  }
}
.l_header .nav-sub .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
}
.l_header .m_search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  height: 64px;
  width: 240px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (max-width: 1024px) {
  .l_header .m_search {
    width: 44px;
    min-width: 44px;
  }
  .l_header .m_search input::placeholder {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
  }
  .l_header .m_search:hover {
    width: 240px;
  }
  .l_header .m_search:hover input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (min-width: 500px) {
  .l_header .m_search:hover .input {
    width: 100%;
  }
  .l_header .m_search:hover .input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search {
    min-width: 0;
  }
  .l_header .m_search input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.l_header .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  width: 100%;
  align-items: center;
}
.l_header .m_search .icon {
  position: absolute;
  width: 36px;
  left: 5px;
  color: var(--color-meta);
}
@media screen and (max-width: 500px) {
  .l_header .m_search .icon {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
.l_header .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding-top: 8px;
  padding-bottom: 8px;
  line-height: 1.3;
  width: 100%;
  color: var(--color-text);
  background: #fafafa;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  padding-left: 40px;
  font-size: 0.875rem;
  border-radius: 8px;
  -webkit-border-radius: 8px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (min-width: 500px) {
  .l_header .m_search .input:focus {
    box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
    -webkit-box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search .input {
    background: var(--color-block);
    padding-left: 8px;
    border: none;
  }
  .l_header .m_search .input:hover,
  .l_header .m_search .input:focus {
    border: none;
  }
}
@media (max-width: 500px) {
  .l_header .m_search {
    left: 0;
    width: 0;
    overflow: hidden;
    position: absolute;
    background: #fff;
    transition: all 0.28s ease;
    -webkit-transition: all 0.28s ease;
    -khtml-transition: all 0.28s ease;
    -moz-transition: all 0.28s ease;
    -o-transition: all 0.28s ease;
    -ms-transition: all 0.28s ease;
  }
  .l_header .m_search .input {
    border-radius: 32px;
    -webkit-border-radius: 32px;
    margin-left: 16px;
    padding-left: 16px;
  }
  .l_header.z_search-open .m_search {
    width: 100%;
  }
  .l_header.z_search-open .m_search .input {
    width: calc(100% - 120px);
  }
}
ul.m-pc >li>a {
  color: inherit;
  border-bottom: 2px solid transparent;
}
ul.m-pc >li>a:active,
ul.m-pc >li>a.active {
  border-bottom: 2px solid #3dd9b6;
}
ul.m-pc li:hover >ul.list-v,
ul.list-v li:hover >ul.list-v {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.nav-list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  align-items: stretch;
}
ul.nav-list-h>li {
  position: relative;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  height: 100%;
  line-height: 2.4;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
ul.nav-list-h>li >a {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 600;
}
ul.list-v {
  z-index: 1;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: absolute;
  background: var(--color-card);
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  margin-top: -6px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  padding: 8px 0;
}
ul.list-v.show {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.list-v hr {
  margin-top: 8px;
  margin-bottom: 8px;
}
ul.list-v >li {
  white-space: nowrap;
  word-break: keep-all;
}
ul.list-v >li.header {
  font-size: 0.78125rem;
  font-weight: bold;
  line-height: 2em;
  color: var(--color-meta);
  margin: 8px 16px 4px;
}
ul.list-v >li.header i {
  margin-right: 8px;
}
ul.list-v >li ul {
  margin-left: 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: -40px;
}
ul.list-v .aplayer-container {
  min-height: 64px;
  padding: 6px 16px;
}
ul.list-v >li>a {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  color: var(--color-list);
  font-size: 0.875rem;
  font-weight: bold;
  line-height: 36px;
  padding: 0 20px 0 16px;
  text-overflow: ellipsis;
  margin: 0 4px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
@media screen and (max-width: 1024px) {
  ul.list-v >li>a {
    line-height: 40px;
  }
}
ul.list-v >li>a >i {
  margin-right: 8px;
}
ul.list-v >li>a:active,
ul.list-v >li>a.active {
  color: var(--color-list-hl);
}
ul.list-v >li>a:hover {
  color: var(--color-list-hl);
  background: var(--color-site-bg);
}
.l_header .menu >ul>li>a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding: 0 8px;
}
.l_header .menu >ul>li>a >i {
  margin-right: 4px;
}
.l_header ul.nav-list-h>li {
  color: var(--color-list);
  line-height: 64px;
}
.l_header ul.nav-list-h>li >a {
  max-height: 64px;
  overflow: hidden;
  color: inherit;
}
.l_header ul.nav-list-h>li >a:active,
.l_header ul.nav-list-h>li >a.active {
  color: #3dd9b6;
}
.l_header ul.nav-list-h>li:hover>a {
  color: var(--color-list-hl);
}
.l_header ul.nav-list-h>li i.music {
  animation: rotate-effect 1.5s linear infinite;
  -webkit-animation: rotate-effect 1.5s linear infinite;
  -khtml-animation: rotate-effect 1.5s linear infinite;
  -moz-animation: rotate-effect 1.5s linear infinite;
  -o-animation: rotate-effect 1.5s linear infinite;
  -ms-animation: rotate-effect 1.5s linear infinite;
}
@-moz-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-webkit-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-o-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
.menu-phone li ul.list-v {
  right: calc(100% - 0.5 * 16px);
}
.menu-phone li ul.list-v ul {
  right: calc(100% - 0.5 * 16px);
}
#wrapper {
  max-width: 1080px;
  margin: auto;
}
@media screen and (min-width: 2048px) {
  #wrapper {
    max-width: 55vw;
  }
}
#wrapper .menu {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 1;
  -ms-flex: 1 1;
  flex: 1 1;
  margin: 0 16px 0 0;
}
#wrapper .menu .list-v ul {
  left: calc(100% - 0.5 * 16px);
}
.menu-phone {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: 16px;
  right: 8px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.menu-phone ul {
  right: calc(100% - 0.5 * 16px);
}
@media screen and (max-width: 500px) {
  .menu-phone {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: block;
  }
}
.l_header {
  max-width: 65vw;
  left: calc((100% - 65vw) * 0.5);
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
@media screen and (max-width: 2048px) {
  .l_header {
    max-width: 1112px;
    left: calc((100% - 1112px) * 0.5);
  }
}
@media screen and (max-width: 1112px) {
  .l_header {
    left: 0;
    border-radius: 0;
    -webkit-border-radius: 0;
    max-width: 100%;
  }
}
@media screen and (max-width: 500px) {
  .l_header .container {
    margin-left: 0;
    margin-right: 0;
  }
  .l_header #wrapper .nav-main .title {
    padding-left: 16px;
    padding-right: 16px;
  }
  .l_header #wrapper .nav-sub {
    width: 100%;
  }
  .l_header #wrapper .nav-sub .title {
    overflow-y: scroll;
    margin-top: 2px;
    padding: 8px 16px;
  }
  .l_header #wrapper .switcher {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
    margin-right: 8px;
  }
  .l_header .menu {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
@media screen and (max-width: 500px) {
  .list-v li {
    max-width: 270px;
  }
}
#u-search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 60px 20px;
  z-index: 1001;
}
@media screen and (max-width: 680px) {
  #u-search {
    padding: 0px;
  }
}
@media screen and (prefers-color-scheme: dark) and (max-width: 500px) {
  .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}

  </style>
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
    <script>
      let userColorScheme=localStorage.getItem("color-scheme")
      if(userColorScheme){
        document.documentElement.setAttribute("color-scheme", userColorScheme);
      }
    </script>
  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
    '.kill-t{'+
      'font-size: 2rem;'+
    '}'+
    '.kill-c{'+
      'font-size: 1.2rem;'+
    '}'+
		'#l_header,#l_body{'+
			'display: none;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        `<span class="kill-t"><b>抱歉，您的浏览器无法访问本站</b></span><br/>`+
        `<span class="kill-c">微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</span><br/>`+
        `<a target="_blank" rel="noopener" href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/"><strong>了解详情 ></strong></a>`+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
    .kill-t{
      font-size: 2rem;
    }
    .kill-c{
      font-size: 1.2rem;
    }
		#l_header,#l_body{
			display: none;
		}
	</style>
    <div class="kill-noscript">
        <span class="kill-t"><b>抱歉，您的浏览器无法访问本站</b></span><br/>
        <span class="kill-c">本页面需要浏览器支持（启用）JavaScript</span><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a>
    </div>
</noscript>


  <script>
  /************这个文件存放不需要重载的全局变量和全局函数*********/
  window.volantis = {}; // volantis 全局变量
  volantis.debug = "env"; // 调试模式
  volantis.dom = {}; // 页面Dom see: /source/js/app.js etc.
  /******************** volantis.dom.$ ********************************/
  // 注：这里没有选择器，也没有forEach一次只处理一个dom，这里重新封装主题常用的dom方法，返回的是dom对象，对象包含了以下方法，同时保留dom的原生API
  function volantisDom(ele) {
    if (!ele) ele = document.createElement("div")
    this.ele = ele;
    // ==============================================================
    this.ele.find = (c) => {
      let q = this.ele.querySelector(c)
      if (q)
        return new volantisDom(q)
    }
    // ==============================================================
    this.ele.hasClass = (c) => {
      return this.ele.className.match(new RegExp('(\\s|^)' + c + '(\\s|$)'));
    }
    this.ele.addClass = (c) => {
      this.ele.classList.add(c);
      return this.ele
    }
    this.ele.removeClass = (c) => {
      this.ele.classList.remove(c);
      return this.ele
    }
    this.ele.toggleClass = (c) => {
      if (this.ele.hasClass(c)) {
        this.ele.removeClass(c)
      } else {
        this.ele.addClass(c)
      }
      return this.ele
    }
    // ==============================================================
    this.ele.on = (c, f) => {
      this.ele.addEventListener(c, f, false)
      return this.ele
    }
    this.ele.click = (f, r) => {
      this.ele.on("click", f, r)
      return this.ele
    }
    this.ele.scroll = (f, r) => {
      this.ele.on("scroll", f, r)
      return this.ele
    }
    // ==============================================================
    this.ele.html = (c) => {
      // if(c=== undefined){
      //   return this.ele.innerHTML
      // }else{
      this.ele.innerHTML = c
      return this.ele
      // }
    }
    // ==============================================================
    this.ele.hide = (c) => {
      this.ele.style.display = "none"
      return this.ele
    }
    this.ele.show = (c) => {
      this.ele.style.display = "block"
      return this.ele
    }
    // ==============================================================
    return this.ele
  }
  volantis.dom.$ = (ele) => {
    return !!ele ? new volantisDom(ele) : null;
  }
  /******************** RunItem ********************************/
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          volantis.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }
  /******************** RightMenu ********************************/
  // volantis.rightmenu.handle(callBack[,"callBackName"]) 外部菜单项控制
  // 可在 volantis.mouseEvent 处获取右键事件
  volantis.rightmenu = {};
  volantis.rightmenu.method = {
    handle: new RunItem(),
  }
  volantis.rightmenu = Object.assign(volantis.rightmenu, {
    handle: volantis.rightmenu.method.handle.push,
  });
  /********************  Dark Mode  ********************************/
  // /layout/_partial/scripts/darkmode.ejs
  // volantis.dark.mode 当前模式 dark or light
  // volantis.dark.toggle() 暗黑模式触发器
  // volantis.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  volantis.dark = {};
  volantis.dark.method = {
    toggle: new RunItem(),
  };
  volantis.dark = Object.assign(volantis.dark, {
    push: volantis.dark.method.toggle.push,
  });
  /********************  Message  ********************************/
  // VolantisApp.message
  /********************  isMobile  ********************************/
  // /source/js/app.js
  // volantis.isMobile
  // volantis.isMobileOld
  /********************脚本动态加载函数********************************/
  // volantis.js(src, cb)  cb 可以传入onload回调函数 或者 JSON对象 例如: volantis.js("src", ()=>{}) 或 volantis.js("src", {defer:true,onload:()=>{}})
  // volantis.css(src)

  // 返回Promise对象，如下方法同步加载资源，这利于处理文件资源之间的依赖关系，例如：APlayer 需要在 MetingJS 之前加载
  // (async () => {
  //     await volantis.js("...theme.plugins.aplayer.js.aplayer...")
  //     await volantis.js("...theme.plugins.aplayer.js.meting...")
  // })();

  // 已经加入了setTimeout
  volantis.js = (src, cb) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }
  volantis.css = (src) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  }
  /********************按需加载的插件********************************/
  // volantis.import.jQuery().then(()=>{})
  volantis.import = {
    jQuery: () => {
      if (typeof jQuery == "undefined") {
        return volantis.js("https://unpkg.com/jquery@3.7.1/dist/jquery.min.js")
      } else {
        return new Promise(resolve => {
          resolve()
        });
      }
    }
  }
  /********************** requestAnimationFrame ********************************/
  // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
  // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
  volantis.requestAnimationFrame = (fn) => {
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
    }
    window.requestAnimationFrame(fn)
  }
  /************************ layoutHelper *****************************************/
  volantis.layoutHelper = (helper, html, opt) => {
    opt = Object.assign({ clean: false}, opt)
    function myhelper(helper, html, clean) {
      volantis.tempDiv = document.createElement("div");
      volantis.tempDiv.innerHTML = html;
      let layoutHelper = document.querySelector("#layoutHelper-" + helper)
      if (layoutHelper) {
        if (clean) {
          layoutHelper.innerHTML = ""
        }
        layoutHelper.append(volantis.tempDiv);
      }
    }
    myhelper(helper, html, opt.clean)
  }
  /****************************** 滚动事件处理 ****************************************/
  volantis.scroll = {
    engine: new RunItem(),
    unengine: new RunItem(),
  };
  volantis.scroll = Object.assign(volantis.scroll, {
    push: volantis.scroll.engine.push,
  });
  // 滚动条距离顶部的距离
  volantis.scroll.getScrollTop = () => {
    let scrollPos;
    if (window.pageYOffset) {
      scrollPos = window.pageYOffset;
    } else if (document.compatMode && document.compatMode != 'BackCompat') {
      scrollPos = document.documentElement.scrollTop;
    } else if (document.body) {
      scrollPos = document.body.scrollTop;
    }
    return scrollPos;
  }
  volantis.scroll.scrollHeight = function () {
    return Math.max(
      document.body.scrollHeight,
      document.documentElement.scrollHeight,
    )
  }
  volantis.scroll.offsetHeight = function () {
    return Math.max(
      document.body.offsetHeight,
      document.documentElement.offsetHeight,
      document.body.clientHeight,
      document.documentElement.clientHeight
    )
  }
  volantis.scroll.progress = function () {
    return volantis.scroll.getScrollTop() / (volantis.scroll.scrollHeight() - volantis.scroll.offsetHeight())
  }
  // 使用 requestAnimationFrame 处理滚动事件
  // `volantis.scroll.del` 中存储了一个数值, 该数值检测一定时间间隔内滚动条滚动的位移, 数值的检测频率是浏览器的刷新频率. 数值为正数时, 表示向下滚动. 数值为负数时, 表示向上滚动.
  volantis.scroll.handleScrollEvents = () => {
    volantis.scroll.lastScrollTop = volantis.scroll.getScrollTop()
    function loop() {
      const scrollTop = volantis.scroll.getScrollTop();
      if (volantis.scroll.lastScrollTop !== scrollTop) {
        volantis.scroll.del = scrollTop - volantis.scroll.lastScrollTop;
        volantis.scroll.lastScrollTop = scrollTop;
        // if (volantis.scroll.del > 0) {
        //   console.log("向下滚动");
        // } else {
        //   console.log("向上滚动");
        // }
        // 注销过期的unengine未滚动事件
        volantis.scroll.unengine.list = []
        volantis.scroll.engine.start();
      } else {
        volantis.scroll.unengine.start();
      }
      volantis.requestAnimationFrame(loop)
    }
    volantis.requestAnimationFrame(loop)
  }
  volantis.scroll.handleScrollEvents()
  volantis.scroll.ele = null;
  // 触发页面滚动至目标元素位置
  volantis.scroll.to = (ele, option = {}) => {
    if (!ele) return;
    volantis.scroll.ele = ele;
    // 默认配置
    opt = {
      top: ele.getBoundingClientRect().top + document.documentElement.scrollTop,
      behavior: "smooth"
    }
    // 定义配置
    if ("top" in option) {
      opt.top = option.top
    }
    if ("behavior" in option) {
      opt.behavior = option.behavior
    }
    if ("addTop" in option) {
      opt.top += option.addTop
    }
    if (!("observerDic" in option)) {
      option.observerDic = 100
    }
    // 滚动
    window.scrollTo(opt);
    // 监视器
    // 监视并矫正元素滚动到指定位置
    // 用于处理 lazyload 引起的 cls 导致的定位失败问题
    // option.observer = false
    if (option.observer) {
      setTimeout(() => {
        if (volantis.scroll.ele != ele) {
          return
        }
        volantis.scroll.unengine.push(() => {
          let me = ele.getBoundingClientRect().top
          if (!(me >= -option.observerDic && me <= option.observerDic)) {
            volantis.scroll.to(ele, option)
          }
          volantis.scroll.unengine.remove("unengineObserver")
        }, "unengineObserver")
      }, 1000)
    }
  }
  /********************** Content Visibility ********************************/
  // 见 source/css/first.styl 如果遇到任何问题 删除 .post-story 即可
  // 一个元素被声明 content-visibility 属性后 如果元素不在 viewport 中 浏览器不会计算其后代元素样式和属性 从而节省 Style & Layout 耗时
  // content-visibility 的副作用: 锚点失效 等等(实验初期 暂不明确), 使用此方法清除样式
  volantis.cleanContentVisibility = () => {
    if (document.querySelector(".post-story")) {
      console.log("cleanContentVisibility");
      document.querySelectorAll(".post-story").forEach(e => {
        e.classList.remove("post-story")
      })
    }
  }
  /******************************************************************************/
  /******************************************************************************/
  /******************************************************************************/
  //图像加载出错时的处理
  function errorImgAvatar(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/avatar/round/3442075.svg";
    img.onerror = null;
  }
  function errorImgCover(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/cover/76b86c0226ffd.svg";
    img.onerror = null;
  }
  /******************************************************************************/
</script>

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  pdata.commentConfig={};
  volantis.GLOBAL_CONFIG ={
    root: '/',
    debug: "env",
    default: {"avatar":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/avatar/round/3442075.svg","link":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/link/8f277b4ee0ecd.svg","cover":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/cover/76b86c0226ffd.svg","image":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/image/2659360.svg"},
    lastupdate: new Date(1747645642319),
    cdn: {
      izitoast_css: 'https://unpkg.com/izitoast@1.4.0/dist/css/iziToast.min.css',
      izitoast_js: 'https://unpkg.com/izitoast@1.4.0/dist/js/iziToast.min.js',
      fancybox_css: 'https://unpkg.com/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css',
      fancybox_js: 'https://unpkg.com/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js'
    },
    sidebar: {
      for_page: ["blogger","category","tagcloud","webinfo"],
      for_post: ["toc"],
      webinfo: {
        lastupd: {
          enable: true,
          friendlyShow: true
        },
        runtime: {
          data: "2018/08/02",
          unit: "天"
        }
      }
    },
    plugins: {
      message: {"enable":true,"icon":{"default":"fa-solid fa-info-circle light-blue","quection":"fa-solid fa-question-circle light-blue"},"time":{"default":5000,"quection":20000},"position":"topRight","transitionIn":"bounceInLeft","transitionOut":"fadeOutRight","titleColor":"var(--color-text)","messageColor":"var(--color-text)","backgroundColor":"var(--color-card)","zindex":2147483647,"copyright":{"enable":true,"title":"知识共享许可协议","message":"请遵守 CC BY-NC-SA 4.0 协议。","icon":"far fa-copyright light-blue"},"aplayer":{"enable":true,"play":"fa-solid fa-play","pause":"fa-solid fa-pause"},"rightmenu":{"enable":true,"notice":true}},
      
      
    },
    search: {
      

      
        dataPath: (("/" || "/").endsWith("/") ? "/" || "/" : "//" || "/") + "content.json",
      

      
    },
    languages: {
      
        search: {
          hits_empty: "找不到您查询的内容：${query}",
          hits_stats: "找到 ${hits} 条结果，用时 ${time} 毫秒",
        }
      
    }
  }
</script>
  <!-- import head_end begin -->
  <!-- import head_end end -->
  <!-- Custom Files headEnd begin-->
  
  <!-- Custom Files headEnd end-->
</head>
  <body itemscope itemtype="https://schema.org.cn/WebPage">
    <!-- import body_begin begin-->
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    
    <!-- Custom Files bodyBegin end-->
    <header itemscope itemtype="https://schema.org.cn/WPHeader" id="l_header" class="l_header auto shadow floatable blur show" style='opacity: 0' >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone'>
        <li><a id="s-comment" class="fa-solid fa-comments fa-fw" target="_self" title="comment"></a></li>
        
          <li><a id="s-toc" class="s-toc fa-solid fa-list fa-fw" target="_self" title="toc"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
            <i class='fa-solid fa-truck'></i>
          
          
            Xiaohanys
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="博客"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fa-solid fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="分类"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fa-solid fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/tags/" title="标签"
                  
                  
                  
                    active-action="action-tags"
                  >
                  <i class='fa-solid fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="归档"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fa-solid fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/gallery/" title="AI绘图"
                  
                  
                  
                    active-action="action-gallery"
                  >
                  <i class='fas fa-image fa-fw'></i>AI绘图
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>主题
                </a>
              <li>
            
          
          
				</ul>
			</div>
      
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fa-solid fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>
      

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fa-solid fa-search fa-fw" target="_self" title="search"></a></li>
				
				<li>
          <a class="s-menu fa-solid fa-bars fa-fw" target="_self" title="menu"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="博客"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fa-solid fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="分类"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fa-solid fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/tags/" title="标签"
                  
                  
                  
                    active-action="action-tags"
                  >
                  <i class='fa-solid fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="归档"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fa-solid fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/gallery/" title="AI绘图"
                  
                  
                  
                    active-action="action-gallery"
                  >
                  <i class='fas fa-image fa-fw'></i>AI绘图
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>主题
                </a>
              <li>
            
          
            
          </ul>
        </li>
			</ul>

      <!-- Custom Files header begin -->
      
      <!-- Custom Files header end -->
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
</div>

      <div id="safearea">
        <div class="body-wrapper">
          
<div id="l_main" class=''>
  <article itemscope itemtype="https://schema.org.cn/Article" class="article post white-box reveal md shadow floatable blur article-type-post" id="post" itemscope itemprop="blogPost">
  <link itemprop="mainEntityOfPage" href="https://blog.xiaohanys.xyz/undefined/">
  <span hidden itemprop="publisher" itemscope itemtype="https://schema.org.cn/Organization">
    <meta itemprop="name" content="XiaoHanys">
  </span>
  <span hidden itemprop="post" itemscope itemtype="https://schema.org.cn/Post">
    <meta itemprop="name" content="XiaoHanys">
    <meta itemprop="description" content="生物信息知识库, 编程, 前端, 网站搭建, 人工智能, AI">
  </span>
  


  
    <span hidden>
      <meta itemprop="image" content="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png">
    </span>
  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title" itemprop="name headline">
        16S rRNA基因扩增子分析
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author' itemprop="author" itemscope itemtype="https://schema.org.cn/Person">
  <a itemprop="url" class='author' href="/" rel="nofollow">
    <img itemprop="image" src="https://gcore.jsdelivr.net/gh/panxiaoguang/nuxt-blog-guang/assets/bitbug_favicon.ico" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/panxiaoguang/nuxt-blog-guang/assets/bitbug_favicon.ico" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
    <p itemprop="name">潘晓光</p>
  </a>
</div>

          
        
          
            
  
  
  
  <div class='new-meta-item category'>
    <i class="fa-solid fa-folder-open fa-fw" aria-hidden="true"></i>
    <a class="category-link" href="/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/">生物信息</a>
    
      <span hidden itemprop="about" itemscope itemtype="https://schema.org.cn/Thing">
        <a href="/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/" itemprop="url"><span itemprop="name">生物信息</span></a>
      </span>
    
  </div>
  



          
        
          
            <div class="new-meta-item date" itemprop="dateCreated datePublished" datetime="2024-09-20T13:10:07+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2024年9月20日</p>
  </a>
</div>

          
        
          
            



          
        
        <!-- Custom Files topMeta begin-->
        
        <!-- Custom Files topMeta end-->
      </div>
    
  </div>


  <div id="layoutHelper-page-plugins"></div>
  <div id="post-body" itemprop="articleBody">
    <p>在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。</p>
<span id="more"></span>


<h3 id="Qiime2中的步骤"><a href="#Qiime2中的步骤" class="headerlink" title="Qiime2中的步骤"></a>Qiime2中的步骤</h3><h4 id="1-制作清单文件。"><a href="#1-制作清单文件。" class="headerlink" title="1. 制作清单文件。"></a>1. 制作清单文件。</h4><p>该文件对于将原始读数导入 Qiime2 非常重要。该文件只是一个制表符分隔的文本，有两列（如果我们有双端读取）；正向绝对文件路径和反向绝对文件路径。每列包含正向和反向通道每次读取的绝对路径。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#path to forward</span></span><br><span class="line"><span class="built_in">ls</span> -f ~/microbiome_analysis_ku/data/*_R1_001.fastq.gz | <span class="built_in">sort</span> -V &gt; r1path</span><br><span class="line"><span class="comment">#path to reverse</span></span><br><span class="line"><span class="built_in">ls</span> -f ~/microbiome_analysis_ku/data/*_R2_001.fastq.gz | <span class="built_in">sort</span> -V &gt; r2path</span><br><span class="line"></span><br><span class="line"><span class="comment">#checking if we have all pairs of forward and reverse reads</span></span><br><span class="line">diff -s &lt;(<span class="built_in">cat</span> r1path | <span class="built_in">cut</span> -d_ -f4) &lt;(<span class="built_in">cat</span> r2path | <span class="built_in">cut</span> -d_ -f4) <span class="comment">#if the outcome is &quot;identical&quot;, then we good :)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Cutting sample IDs from the path file (from either is good)</span></span><br><span class="line"><span class="built_in">cut</span> -d_ -f4 r1path &gt; SampleID</span><br><span class="line"></span><br><span class="line"><span class="comment">#adding sample ids to paths</span></span><br><span class="line"><span class="built_in">paste</span> SampleID r1path r2path &gt; manifest</span><br><span class="line"></span><br><span class="line"><span class="comment">#Binning ids and forward reverse columns together with tab-delimited seperation</span></span><br><span class="line">sed -i $<span class="string">&#x27;1 i\\\nsampleid \t forward-absolute-filepath \t reverse-absolute-filepath&#x27;</span> manifest</span><br></pre></td></tr></table></figure>

<p>一些数据的推理调查</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Exploring the reads</span></span><br><span class="line">zcat ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">zcat ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz | grep ^@FS10000714| <span class="built_in">cut</span> -d <span class="string">&quot;:&quot;</span> -f1 | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="built_in">wc</span> -l ./data/*_R1_001.fastq.gz | awk <span class="string">&#x27;&#123;$1=$1&#125;;1&#x27;</span>| <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1|datamash min 1</span><br><span class="line"><span class="built_in">wc</span> -l ./data/*_R1_001.fastq.gz | awk <span class="string">&#x27;&#123;$1=$1&#125;;1&#x27;</span>| <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1|<span class="built_in">head</span> -n -1|datamash max 1</span><br><span class="line"><span class="built_in">wc</span> -l ./data/*_R1_001.fastq.gz | awk <span class="string">&#x27;&#123;$1=$1&#125;;1&#x27;</span>| <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1|<span class="built_in">head</span> -n -1|datamash mean 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#reverse</span></span><br><span class="line"><span class="built_in">wc</span> -l ./data/*_R2_001.fastq.gz| awk <span class="string">&#x27;&#123;$1=$1&#125;;1&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f1|datamash min 1</span><br><span class="line"><span class="built_in">wc</span> -l ./data/*_R2_001.fastq.gz| awk <span class="string">&#x27;&#123;$1=$1&#125;;1&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f1|datamash max 1</span><br><span class="line"><span class="built_in">wc</span> -l ./data/*_R2_001.fastq.gz| awk <span class="string">&#x27;&#123;$1=$1&#125;;1&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f1|datamash mean 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#searching for primers</span></span><br><span class="line"></span><br><span class="line">zcat ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz | <span class="built_in">head</span></span><br><span class="line">zgrep <span class="string">&#x27;^CCTACGGG.GGC.GCAG&#x27;</span> ./data/MAC2022_iSeq001_S1_L001_R2_001.fastq.gz | <span class="built_in">wc</span> -l</span><br><span class="line">zgrep <span class="string">&#x27;^GACTAC..GGGTATCTAATCC&#x27;</span> ./data/MAC2022_iSeq001_S1_L001_R2_001.fastq.gz | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment">#Eventually you can use Seqkit package</span></span><br><span class="line"></span><br><span class="line">seqkit stats ./data/MAC2023_iSeq001_S1_L001_R2_001.fastq.gz</span><br></pre></td></tr></table></figure>

<h4 id="2-使用创建的清单文件将读取导入-Qiime2"><a href="#2-使用创建的清单文件将读取导入-Qiime2" class="headerlink" title="2. 使用创建的清单文件将读取导入 Qiime2"></a>2. 使用创建的清单文件将读取导入 Qiime2</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> activate qiime2.X</span><br><span class="line">qiime tools import \</span><br><span class="line">  --<span class="built_in">type</span> <span class="string">&quot;SampleData[PairedEndSequencesWithQuality]&quot;</span> \</span><br><span class="line">  --input-format PairedEndFastqManifestPhred33V2 \</span><br><span class="line">  --input-path ~/MAC2023/manifest.tsv \                    <span class="comment"># link to the folder in which my manifest file is located</span></span><br><span class="line">  --output-path ~/MAC2023/demuxed_MAC23.qza                 <span class="comment"># link to the path where I want my demultiplexed data to be exported in</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-可视化解复用读取的推论统计"><a href="#3-可视化解复用读取的推论统计" class="headerlink" title="3. 可视化解复用读取的推论统计"></a>3. 可视化解复用读取的推论统计</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime demux summarize \</span><br><span class="line">  --i-data ./demuxed_mac23.qza \</span><br><span class="line">  --o-visualization ./demuxed_mac23.qzv</span><br></pre></td></tr></table></figure>

<h4 id="4-qiime2中DADA2包的过滤、去重复、样本推断、嵌合体识别、双端读段合并。"><a href="#4-qiime2中DADA2包的过滤、去重复、样本推断、嵌合体识别、双端读段合并。" class="headerlink" title="4. qiime2中DADA2包的过滤、去重复、样本推断、嵌合体识别、双端读段合并。"></a>4. qiime2中DADA2包的过滤、去重复、样本推断、嵌合体识别、双端读段合并。</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime dada2 denoise-paired \</span><br><span class="line">--i-demultiplexed-seqs ~/demuxed_mac23.qza \         <span class="comment">#the input file for denoising is our demultiplexed pairedEnd reads that was generated in the previous step.</span></span><br><span class="line">--p-trim-left-f 17 \                                        <span class="comment">#length of my forward primer (17 nt) </span></span><br><span class="line">--p-trim-left-r 21 \                                        <span class="comment">#length of my reverse primer (21 nt)</span></span><br><span class="line">--p-trunc-len-f 260 \                                       <span class="comment">#truncation length for forward reads. I.e. we truncate reads over 260 base since their quality started dropping from this point onwards. </span></span><br><span class="line">--p-trunc-len-r 220 \                                       <span class="comment">#truncation length for reverse reads. I.e. we truncate reads over 220 base since their quality started dropping from this point onwards. </span></span><br><span class="line">--o-table ~/count_table.qza \                      <span class="comment">#the ASV count table</span></span><br><span class="line">--o-representative-sequences ~/repseqs.qza \ <span class="comment">#the representative sequences for in each read</span></span><br><span class="line">--o-denoising-stats ~/denoising_stats.qza \  <span class="comment">#the status of the denoising process in a full catalogue</span></span><br><span class="line">--p-n-threads 10</span><br></pre></td></tr></table></figure>

<h5 id="4-1-可视化计数表"><a href="#4-1-可视化计数表" class="headerlink" title="4.1. 可视化计数表"></a>4.1. 可视化计数表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime feature-table summarize --i-table ~/count_table.qza \ <span class="comment">#The ASV table as the input</span></span><br><span class="line">--m-sample-metadata-file ~/metadataA.tsv \           <span class="comment">#The metadata as the input</span></span><br><span class="line">--o-visualization ./table.qzv                         <span class="comment">#The qzv format of our ASV table</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-可视化代表性序列"><a href="#4-2-可视化代表性序列" class="headerlink" title="4.2. 可视化代表性序列"></a>4.2. 可视化代表性序列</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime feature-table tabulate-seqs \</span><br><span class="line">--i-data ~/repseqs.qza \</span><br><span class="line">--o-visualization ~/repseqs.qzv</span><br></pre></td></tr></table></figure>

<h4 id="4-3-可视化去噪统计数据"><a href="#4-3-可视化去噪统计数据" class="headerlink" title="4.3. 可视化去噪统计数据"></a>4.3. 可视化去噪统计数据</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime metadata tabulate \</span><br><span class="line">--m-input-file ./denoising_stats.qza \</span><br><span class="line">--o-visualization ./denoising_stats.qzv</span><br></pre></td></tr></table></figure>

<h4 id="5-通过朴素贝叶斯方法训练基于引物的区域特异性分类器（在-Qiime2-中）"><a href="#5-通过朴素贝叶斯方法训练基于引物的区域特异性分类器（在-Qiime2-中）" class="headerlink" title="5. 通过朴素贝叶斯方法训练基于引物的区域特异性分类器（在 Qiime2 中）"></a>5. 通过朴素贝叶斯方法训练基于引物的区域特异性分类器（在 Qiime2 中）</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime feature-classifier fit-classifier-naive-bayes \   <span class="comment"># here you can train your classifier based on a Naive-Bayes method</span></span><br><span class="line">--i-reference-reads ~/derepseqs-uniq-341f-805r.qza \    <span class="comment"># Dereplicated sequences based on the primer set as input</span></span><br><span class="line">--i-reference-taxonomy ~/dereptaxa-uniq-341f-805r.qza\  <span class="comment"># Dereplicated taxonomic annotations based on the primer set as input</span></span><br><span class="line"> --o-classifier ~/silva-classifier-primered4.qza  </span><br><span class="line"></span><br><span class="line"><span class="comment"># Running the classifier</span></span><br><span class="line">qiime feature-classifier classify-sklearn \                               <span class="comment"># Sklearn package for classification</span></span><br><span class="line">--i-reads ~/repseqs.qza \                                        <span class="comment"># Representative sequences as the (input)</span></span><br><span class="line">--i-classifier ~/classifier/silva138-classifier-341f-805r.qza \  <span class="comment"># Our costumized SILVA 138 classifier (input)</span></span><br><span class="line">--o-classification ~/taxonomy.qza \                     <span class="comment"># The taxonomic annotation linked to the repseqs (output)</span></span><br><span class="line">--p-n-jobs 10                                                             <span class="comment"># The number of cores/jobs</span></span><br></pre></td></tr></table></figure>

<h5 id="5-1-可视化分类表"><a href="#5-1-可视化分类表" class="headerlink" title="5.1. 可视化分类表"></a>5.1. 可视化分类表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime metadata tabulate \</span><br><span class="line">--m-input-file ~/Taxonomy/taxonomy.qza \</span><br><span class="line">--o-visualization ~/Taxonomy/taxonomy.qzv</span><br></pre></td></tr></table></figure>

<h4 id="6-使用支持-SATE-的系统发育放置-SEPP-方法创建系统发育树以进行多样性分析"><a href="#6-使用支持-SATE-的系统发育放置-SEPP-方法创建系统发育树以进行多样性分析" class="headerlink" title="6. 使用支持 SATE 的系统发育放置 (SEPP) 方法创建系统发育树以进行多样性分析"></a>6. 使用支持 SATE 的系统发育放置 (SEPP) 方法创建系统发育树以进行多样性分析</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qiime fragment-insertion sepp \                             <span class="comment"># The package for generating the phylogenetic tree</span></span><br><span class="line">--i-representative-sequences ~/repseqs.qza \                <span class="comment"># Our representative sequences (input)</span></span><br><span class="line">--i-reference-database ~/epp-ref-gg-13-8.qza \              <span class="comment"># The SEPP sequence dataset (input)</span></span><br><span class="line">--o-tree ~/tree.qza \                                       <span class="comment"># The rooted tree (output)</span></span><br><span class="line">--o-placements ~/dss/tree-placements.qza \</span><br><span class="line">--p-threads 10  </span><br></pre></td></tr></table></figure>

<h3 id="R-中的步骤"><a href="#R-中的步骤" class="headerlink" title="R 中的步骤"></a>R 中的步骤</h3><h4 id="1-安装和加载库"><a href="#1-安装和加载库" class="headerlink" title="1.安装和加载库"></a>1.安装和加载库</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Update R</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&#x27;installr&#x27;</span><span class="punctuation">)</span></span><br><span class="line">installr<span class="operator">::</span>updateR<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">github.pkg <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;jfukuyama/phyloseqGraphTest&quot;</span><span class="punctuation">,</span> <span class="string">&quot;jbisanz/qiime2R&quot;</span><span class="punctuation">)</span> </span><br><span class="line">bioc.pkg <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;phyloseq&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DESeq2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;MicrobiotaProcess&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggtree&quot;</span><span class="punctuation">,</span> <span class="string">&quot;vsn&quot;</span><span class="punctuation">)</span></span><br><span class="line">cran.pkg <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;tidyverse&quot;</span><span class="punctuation">,</span> <span class="string">&quot;readr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ape&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pacman&quot;</span><span class="punctuation">,</span> <span class="string">&quot;picante&quot;</span><span class="punctuation">,</span> <span class="string">&quot;glue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;vegan&quot;</span><span class="punctuation">,</span> <span class="string">&quot;devtools&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggrepel&quot;</span><span class="punctuation">,</span> <span class="string">&quot;reshape2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BiocManager&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;ggnetwork&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DT&quot;</span><span class="punctuation">,</span> <span class="string">&quot;VennDiagram&quot;</span><span class="punctuation">,</span> <span class="string">&quot;lsmeans&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pheatmap&quot;</span><span class="punctuation">,</span> <span class="string">&quot;phyloseqGraphTest&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">inst.pkg <span class="operator">&lt;-</span> cran.pkg <span class="operator">%in%</span> installed.packages<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;ggtree&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">any</span><span class="punctuation">(</span><span class="operator">!</span>inst.pkg<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span> install.packages<span class="punctuation">(</span>cran.pkg<span class="punctuation">[</span><span class="operator">!</span>inst.pkg<span class="punctuation">]</span><span class="punctuation">,</span>repos <span class="operator">=</span> <span class="string">&quot;http://cran.rstudio.com/&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span> </span><br><span class="line"> </span><br><span class="line">inst.pkg <span class="operator">&lt;-</span> github.pkg <span class="operator">%in%</span> installed.packages<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">any</span><span class="punctuation">(</span><span class="operator">!</span>inst.pkg<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span> devtools<span class="operator">::</span>install_github<span class="punctuation">(</span>github.pkg<span class="punctuation">[</span><span class="operator">!</span>inst.pkg<span class="punctuation">]</span><span class="punctuation">,</span> force <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">inst.pkg <span class="operator">&lt;-</span> bioc.pkg <span class="operator">%in%</span> installed.packages<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">any</span><span class="punctuation">(</span><span class="operator">!</span>inst.pkg<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span> BiocManager<span class="operator">::</span>install<span class="punctuation">(</span>bioc.pkg<span class="punctuation">[</span><span class="operator">!</span>inst.pkg<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">pkg <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;tidyverse&quot;</span><span class="punctuation">,</span> <span class="string">&quot;phyloseq&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DESeq2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;qiime2R&quot;</span> <span class="punctuation">,</span> <span class="string">&quot;gridExtra&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BiocManager&quot;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="string">&quot;vegan&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggtree&quot;</span><span class="punctuation">,</span> <span class="string">&quot;devtools&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggrepel&quot;</span><span class="punctuation">,</span> <span class="string">&quot;reshape2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggnetwork&quot;</span><span class="punctuation">,</span> <span class="string">&quot;igraph&quot;</span><span class="punctuation">,</span> <span class="string">&quot;biomformat&quot;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="string">&quot;pheatmap&quot;</span><span class="punctuation">,</span> <span class="string">&quot;glue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ape&quot;</span><span class="punctuation">,</span> <span class="string">&quot;readr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;vsn&quot;</span><span class="punctuation">,</span> <span class="string">&quot;vegan&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>pkg<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  library<span class="punctuation">(</span>pkg<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> character.only <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> attach.required <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">save.image<span class="punctuation">(</span><span class="string">&#x27;./data/r.RData&#x27;</span><span class="punctuation">)</span></span><br><span class="line">load<span class="punctuation">(</span><span class="string">&quot;./data/r.RData&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="2-从qiime2导入工件到r"><a href="#2-从qiime2导入工件到r" class="headerlink" title="2.从qiime2导入工件到r"></a>2.从qiime2导入工件到r</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#making phyloseq objects from qiime files</span></span><br><span class="line">ps <span class="operator">&lt;-</span> qiime2R<span class="operator">::</span>qza_to_phyloseq<span class="punctuation">(</span>features <span class="operator">=</span> <span class="string">&quot;~/data/ccd/table-ccd.qza&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                       taxonomy <span class="operator">=</span> <span class="string">&quot;~/data/ccd/taxonomy-ccd.qza&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                     tree <span class="operator">=</span> <span class="string">&quot;./tree-ccd.qza&quot;</span><span class="punctuation">)</span></span><br><span class="line">repseqs <span class="operator">&lt;-</span> qiime2R<span class="operator">::</span>read_qza<span class="punctuation">(</span><span class="string">&quot;~/data/ccd/repseqa.qza&quot;</span><span class="punctuation">)</span><span class="operator">$</span>data</span><br><span class="line"><span class="comment">#we need to merge the refseqs like this since in above fun, there is no argument for that</span></span><br><span class="line">ps<span class="operator">=</span> merge_phyloseq<span class="punctuation">(</span>ps<span class="punctuation">,</span> repseqs<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Metadata</span></span><br><span class="line"><span class="comment">#importing the metadata</span></span><br><span class="line">metadata <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;./metadata.tsv&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#converting non numeric and non-logical variables to factors</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">seq_len</span><span class="punctuation">(</span>ncol<span class="punctuation">(</span>metadata<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="keyword">if</span><span class="punctuation">(</span><span class="operator">!</span><span class="built_in">is.numeric</span><span class="punctuation">(</span>metadata<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">&amp;&amp;</span> <span class="operator">!</span><span class="built_in">is.logical</span><span class="punctuation">(</span>metadata<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">&amp;&amp;</span> <span class="operator">!</span><span class="built_in">is.integer</span><span class="punctuation">(</span>metadata<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    metadata<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">=</span> as.factor<span class="punctuation">(</span>metadata<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span>  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">     metadata<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">&#125;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#changing sample names</span></span><br><span class="line">asvs <span class="operator">&lt;-</span> otu_table<span class="punctuation">(</span>ps<span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.matrix</span><br><span class="line"></span><br><span class="line"><span class="comment">#Merging all artifacts</span></span><br><span class="line">pst <span class="operator">=</span> phyloseq<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>asvs<span class="punctuation">,</span> taxa_are_rows <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> phy_tree<span class="punctuation">(</span>ps<span class="punctuation">)</span><span class="punctuation">,</span> sample_data<span class="punctuation">(</span>metadata<span class="punctuation">)</span><span class="punctuation">,</span> refseq<span class="punctuation">(</span>ps<span class="punctuation">)</span><span class="punctuation">,</span> tax_table<span class="punctuation">(</span>ps<span class="punctuation">)</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>

<p>将 Illumina 输出导入 r</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">ft <span class="operator">=</span> read_tsv<span class="punctuation">(</span><span class="string">&#x27;./MAC2023.github.io/data/illumina/Results_MAC23_MAC96_S96/OTU-tables/zOTU_table_GG.txt&#x27;</span> <span class="punctuation">)</span> <span class="operator">%&gt;%</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">ft <span class="operator">&lt;-</span> column_to_rownames<span class="punctuation">(</span>ft<span class="punctuation">,</span> <span class="string">&quot;X.OTU.ID&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tx <span class="operator">=</span> ft <span class="operator">%&gt;%</span> as.data.frame<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> select<span class="punctuation">(</span><span class="number">81</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ft<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">dim</span><span class="punctuation">(</span>ft<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span><span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">tx <span class="operator">=</span> tidyr<span class="operator">::</span>separate<span class="punctuation">(</span>tx<span class="punctuation">,</span> col <span class="operator">=</span> taxonomy<span class="punctuation">,</span> into <span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Kingdom&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="string">&quot;Class&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Order&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Family&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="string">&quot;Genus&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Species&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            sep <span class="operator">=</span> <span class="string">&#x27;;&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.matrix<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tx <span class="operator">=</span> apply<span class="punctuation">(</span>tx<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span>gsub<span class="punctuation">(</span><span class="string">&quot;^.__&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">colnames<span class="punctuation">(</span>ft<span class="punctuation">)</span> <span class="operator">&lt;-</span> sapply<span class="punctuation">(</span>colnames<span class="punctuation">(</span>ft<span class="punctuation">)</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span>gsub<span class="punctuation">(</span><span class="string">&quot;.*[S]([0-9]+)$&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BRK\\1&quot;</span><span class="punctuation">,</span> x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.vector<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">mt <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&#x27;./data/metadata.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line">mt</span><br><span class="line">data.frame<span class="punctuation">(</span>barcode <span class="operator">=</span> colnames<span class="punctuation">(</span>ft<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">mt<span class="punctuation">[</span><span class="operator">!</span>rownames<span class="punctuation">(</span>mt<span class="punctuation">)</span> <span class="operator">%in%</span> colnames<span class="punctuation">(</span>ft<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> select<span class="punctuation">(</span>barcode<span class="punctuation">)</span> <span class="operator">%&gt;%</span> pull<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tr<span class="operator">$</span>tip.label <span class="operator">%&gt;%</span> <span class="built_in">length</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">tr <span class="operator">=</span> ggtree<span class="operator">::</span>read.tree<span class="punctuation">(</span><span class="string">&#x27;./MAC2023.github.io/data/illumina/Results_MAC23_MAC96_S96/zOTU.tree&#x27;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line">phyloseq<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ft<span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> phy_tree<span class="punctuation">(</span>tr<span class="punctuation">)</span><span class="punctuation">,</span> tax_table<span class="punctuation">(</span>tx<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> ggtree<span class="punctuation">(</span>layout <span class="operator">=</span> <span class="string">&quot;circular&quot;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>color <span class="operator">=</span> Phylum<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>将 ONT 输出导入 R</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#setwd(&#x27;/home/hackion/Dropbox/Old-2gb/postdoc/mac2023&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Reading feature table</span></span><br><span class="line">ft <span class="operator">=</span> read_tsv<span class="punctuation">(</span><span class="string">&#x27;./data/count_matrix.tsv&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">as.data.frame<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">column_to_rownames<span class="punctuation">(</span><span class="string">&#x27;#OTU ID&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">as.matrix<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reading taxonomy table</span></span><br><span class="line">tx <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&#x27;./data/taxonomy.tsv&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">                header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> </span><br><span class="line">                sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">                row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">dim</span><span class="punctuation">(</span>tx<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## [1] 5056    1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Parse the taxonomy</span></span><br><span class="line">tx <span class="operator">=</span> tidyr<span class="operator">::</span>separate<span class="punctuation">(</span>data <span class="operator">=</span> tx<span class="punctuation">,</span> </span><br><span class="line">            col <span class="operator">=</span> V2<span class="punctuation">,</span> </span><br><span class="line">            into <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Kingdom&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="string">&quot;Class&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Order&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Family&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="string">&quot;Genus&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Species&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            sep <span class="operator">=</span> <span class="string">&#x27;;&#x27;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#removing taxon tags </span></span><br><span class="line"></span><br><span class="line">tx <span class="operator">=</span> apply<span class="punctuation">(</span>tx<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span>gsub<span class="punctuation">(</span><span class="string">&quot;^.__&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#reading metadata</span></span><br><span class="line">mt <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&#x27;./data/metadata.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reading rep_seqs</span></span><br><span class="line">seqs <span class="operator">=</span> Biostrings<span class="operator">::</span>readDNAStringSet<span class="punctuation">(</span><span class="string">&#x27;./data/rep_seqs.fasta&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reading the tree</span></span><br><span class="line">tr <span class="operator">=</span> ggtree<span class="operator">::</span>read.tree<span class="punctuation">(</span><span class="string">&#x27;./data/tree.nwk&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Merging data</span></span><br><span class="line">pst <span class="operator">=</span> phyloseq<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ft<span class="punctuation">,</span> taxa_are_row<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> phyloseq<span class="operator">::</span>tax_table<span class="punctuation">(</span>tx<span class="punctuation">)</span><span class="punctuation">,</span> phy_tree<span class="punctuation">(</span>tr<span class="punctuation">)</span><span class="punctuation">,</span> sample_data<span class="punctuation">(</span>mt<span class="punctuation">)</span><span class="punctuation">,</span> refseq<span class="punctuation">(</span>seqs<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pst</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## phyloseq-class experiment-level object</span></span><br><span class="line"><span class="comment">## otu_table()   OTU Table:         [ 5056 taxa and 95 samples ]</span></span><br><span class="line"><span class="comment">## sample_data() Sample Data:       [ 95 samples by 2 sample variables ]</span></span><br><span class="line"><span class="comment">## tax_table()   Taxonomy Table:    [ 5056 taxa by 7 taxonomic ranks ]</span></span><br><span class="line"><span class="comment">## phy_tree()    Phylogenetic Tree: [ 5056 tips and 4980 internal nodes ]</span></span><br><span class="line"><span class="comment">## refseq()      DNAStringSet:      [ 5056 reference sequences ]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span><span class="punctuation">(</span>rowSums<span class="punctuation">(</span>pst<span class="operator">@</span>otu_table<span class="punctuation">)</span><span class="operator">==</span><span class="number">0</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## [1] 0</span></span><br></pre></td></tr></table></figure>

<h4 id="3、reads的过滤和预处理"><a href="#3、reads的过滤和预处理" class="headerlink" title="3、reads的过滤和预处理"></a>3、reads的过滤和预处理</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#removing unassigned and NA phylum taxa</span></span><br><span class="line">pst <span class="operator">&lt;-</span> subset_taxa<span class="punctuation">(</span>pst<span class="punctuation">,</span> <span class="operator">!</span><span class="built_in">is.na</span><span class="punctuation">(</span>Phylum<span class="punctuation">)</span> <span class="operator">&amp;</span> <span class="operator">!</span>Phylum <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;uncharacterized&quot;</span><span class="punctuation">,</span> <span class="string">&quot;unassigned&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#keeping only bacterial kingdom</span></span><br><span class="line">pst <span class="operator">&lt;-</span> subset_taxa<span class="punctuation">(</span>pst<span class="punctuation">,</span> Kingdom <span class="operator">%in%</span> <span class="string">&quot;Bacteria&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pst</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## phyloseq-class experiment-level object</span></span><br><span class="line"><span class="comment">## otu_table()   OTU Table:         [ 4858 taxa and 95 samples ]</span></span><br><span class="line"><span class="comment">## sample_data() Sample Data:       [ 95 samples by 2 sample variables ]</span></span><br><span class="line"><span class="comment">## tax_table()   Taxonomy Table:    [ 4858 taxa by 7 taxonomic ranks ]</span></span><br><span class="line"><span class="comment">## phy_tree()    Phylogenetic Tree: [ 4858 tips and 4784 internal nodes ]</span></span><br><span class="line"><span class="comment">## refseq()      DNAStringSet:      [ 4858 reference sequences ]</span></span><br></pre></td></tr></table></figure>

<p>基于（低）流行率的分类过滤：监督</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#monitoring the number of the samples in which the prevalence of a taxon is at least one</span></span><br><span class="line">prevdf <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">,</span>ifelse<span class="punctuation">(</span>taxa_are_rows<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">weight_df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>ASVprev <span class="operator">=</span> prevdf<span class="punctuation">,</span> </span><br><span class="line">                    TaxaAbund <span class="operator">=</span> taxa_sums<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                    tax_table<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>weight_df<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">##          ASVprev TaxaAbund  Kingdom           Phylum          Class</span></span><br><span class="line"><span class="comment">## OTU_1133      14        22 Bacteria Actinobacteriota Actinobacteria</span></span><br><span class="line"><span class="comment">## OTU_3649      28        50 Bacteria Actinobacteriota Actinobacteria</span></span><br><span class="line"><span class="comment">## OTU_3778      15        30 Bacteria Actinobacteriota Actinobacteria</span></span><br><span class="line"><span class="comment">## OTU_614       70       934 Bacteria Actinobacteriota Actinobacteria</span></span><br><span class="line"><span class="comment">## OTU_1186      51       110 Bacteria       Firmicutes     Clostridia</span></span><br><span class="line"><span class="comment">## OTU_4237      22        35 Bacteria       Firmicutes     Clostridia</span></span><br><span class="line"><span class="comment">##                      Order             Family           Genus</span></span><br><span class="line"><span class="comment">## OTU_1133 Bifidobacteriales Bifidobacteriaceae Bifidobacterium</span></span><br><span class="line"><span class="comment">## OTU_3649 Bifidobacteriales Bifidobacteriaceae Bifidobacterium</span></span><br><span class="line"><span class="comment">## OTU_3778 Bifidobacteriales Bifidobacteriaceae Bifidobacterium</span></span><br><span class="line"><span class="comment">## OTU_614  Bifidobacteriales Bifidobacteriaceae Bifidobacterium</span></span><br><span class="line"><span class="comment">## OTU_1186    Lachnospirales    Lachnospiraceae         Blautia</span></span><br><span class="line"><span class="comment">## OTU_4237    Lachnospirales    Lachnospiraceae         Blautia</span></span><br><span class="line"><span class="comment">##                               Species</span></span><br><span class="line"><span class="comment">## OTU_1133 Bifidobacterium_adolescentis</span></span><br><span class="line"><span class="comment">## OTU_3649       Bifidobacterium_longum</span></span><br><span class="line"><span class="comment">## OTU_3778      Bifidobacterium_bifidum</span></span><br><span class="line"><span class="comment">## OTU_614  Bifidobacterium_adolescentis</span></span><br><span class="line"><span class="comment">## OTU_1186                         &lt;NA&gt;</span></span><br><span class="line"><span class="comment">## OTU_4237                         &lt;NA&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Find out the phyla that are of mostly low-prevalence features by computing the total and average prev of features in Phylum</span></span><br><span class="line">plyr<span class="operator">::</span>ddply<span class="punctuation">(</span>weight_df<span class="punctuation">,</span> <span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span>cbind<span class="punctuation">(</span>means <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>mean<span class="punctuation">(</span>x<span class="operator">$</span>ASVprev<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> sums <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="operator">$</span>ASVprev<span class="punctuation">)</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span>sanity <span class="operator">=</span> ifelse<span class="punctuation">(</span>means <span class="operator">==</span> sums<span class="punctuation">,</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FALSE&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">##              Phylum means   sums sanity</span></span><br><span class="line"><span class="comment">## 1  Actinobacteriota 40.19  17645  FALSE</span></span><br><span class="line"><span class="comment">## 2      Bacteroidota 29.43  25282  FALSE</span></span><br><span class="line"><span class="comment">## 3     Cyanobacteria 20.25    486  FALSE</span></span><br><span class="line"><span class="comment">## 4  Desulfobacterota 22.89    435  FALSE</span></span><br><span class="line"><span class="comment">## 5        Firmicutes 35.80 116352  FALSE</span></span><br><span class="line"><span class="comment">## 6    Fusobacteriota 24.02    985  FALSE</span></span><br><span class="line"><span class="comment">## 7    Proteobacteria 26.01   4941  FALSE</span></span><br><span class="line"><span class="comment">## 8     Spirochaetota  9.80     49  FALSE</span></span><br><span class="line"><span class="comment">## 9 Verrucomicrobiota 35.52   1101  FALSE</span></span><br></pre></td></tr></table></figure>

<p>根据所有样本中 n 个样本中出现的流行阈值过滤 ASV</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This means that each ASV should have appeared at least in n samples to be kept.</span></span><br><span class="line">asv.filter <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>asvtab<span class="punctuation">,</span> n.samples <span class="operator">=</span> <span class="number">1</span> <span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  filter.threshold <span class="operator">&lt;-</span> n.samples<span class="operator">/</span>ncol<span class="punctuation">(</span>asvtab<span class="punctuation">)</span> <span class="operator">*</span><span class="number">100</span> <span class="comment"># In how many samples out of total samples an ASV should have occured</span></span><br><span class="line">  table_count <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>asvtab<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> ifelse<span class="punctuation">(</span>x<span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">  suspected_ASV <span class="operator">=</span> table_count<span class="punctuation">[</span>which<span class="punctuation">(</span><span class="punctuation">(</span>rowSums<span class="punctuation">(</span>table_count<span class="punctuation">)</span><span class="operator">/</span>ncol<span class="punctuation">(</span>table_count<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span> <span class="operator">&lt;</span> filter.threshold<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> rownames<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>suspected_ASV<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">print<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;&#123; asv.filter(asvtab = otu_table(pst), n.samples = 2) &#125; occured only in two samples&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sus_ASV <span class="operator">=</span> asv.filter<span class="punctuation">(</span>asvtab <span class="operator">=</span> otu_table<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">,</span> n.samples <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span>      </span><br><span class="line"><span class="comment">## Will you remove them?</span></span><br><span class="line"><span class="comment">#pst = subset_taxa(pst, !taxa_names(pst) %in% sus_ASV)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#or you could also do it by the phyloseq function</span></span><br><span class="line"></span><br><span class="line">condition <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">TaxaTokeep <span class="operator">&lt;-</span> genefilter_sample<span class="punctuation">(</span>pst<span class="punctuation">,</span>condition<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span>                      </span><br><span class="line"><span class="comment">#pst = subset_taxa(pst, taxa_names(pst) %in% TaxaTokeep)</span></span><br></pre></td></tr></table></figure>

<p>根据丰度删除单调</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#A function to find singletones. You need to be careful about this step!</span></span><br><span class="line">out.ASV <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>phyloseq<span class="punctuation">,</span> threshold <span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.01</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#Loading necessary pkgs      </span></span><br><span class="line">  pacman<span class="operator">::</span>p_load<span class="punctuation">(</span>glue<span class="punctuation">,</span> tidyverse<span class="punctuation">,</span> reshape2<span class="punctuation">,</span> ggrepel<span class="punctuation">,</span> S4Vectors<span class="punctuation">)</span> <span class="comment"># nolint</span></span><br><span class="line"><span class="comment">#This function requires phyloseq, tidyverse and glue packages to be loaded. </span></span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">(</span>colSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>ncol<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">==</span> <span class="number">100</span> <span class="punctuation">)</span> <span class="punctuation">&#123;</span><span class="comment">#making the relative abundance table</span></span><br><span class="line">                    rel_abund <span class="operator">=</span> as<span class="punctuation">(</span>t<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">(</span>colSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>ncol<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    rel_abund <span class="operator">=</span> as<span class="punctuation">(</span>t<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span></span><br><span class="line">                    <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    rel_abund <span class="operator">=</span> as<span class="punctuation">(</span>t<span class="punctuation">(</span>apply<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                    ifelse<span class="punctuation">(</span>taxa_are_rows<span class="punctuation">(</span>phyloseq<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                    <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span>  </span><br><span class="line">                    <span class="punctuation">&#125;</span> </span><br><span class="line">                      </span><br><span class="line">                      </span><br><span class="line">      names.single <span class="operator">=</span> apply<span class="punctuation">(</span>rel_abund<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span>ifelse<span class="punctuation">(</span>x <span class="operator">==</span> threshold<span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> </span><br><span class="line">                                                    ifelse<span class="punctuation">(</span>x <span class="operator">==</span> <span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">                                                    filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">                                                    dplyr<span class="operator">::</span>select<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">                                                    pull<span class="operator">%&gt;%</span> as.vector<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">                      </span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>names.single<span class="punctuation">)</span> <span class="operator">==</span> <span class="number">0</span> <span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">          print<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;WOW! &#123;length(names.single)&#125; singletones detected in this dataset&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                 qplot.noSing <span class="operator">=</span> qplot<span class="punctuation">(</span>rel_abund<span class="punctuation">,</span> geom <span class="operator">=</span> <span class="string">&quot;histogram&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> binwidth<span class="punctuation">,</span> </span><br><span class="line">                  show.legend <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Frequency count of relative abundance, no singletones detected&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">         xlab <span class="punctuation">(</span><span class="string">&quot;Relative abundance in samples&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">                   ylab<span class="punctuation">(</span><span class="string">&quot;Frequency&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">      </span><br><span class="line">    <span class="built_in">return</span><span class="punctuation">(</span>structure<span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span>qplot.noSing<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                            </span><br><span class="line">                        <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span> </span><br><span class="line">                             </span><br><span class="line">single.ASV <span class="operator">=</span> rel_abund<span class="punctuation">[</span>rownames<span class="punctuation">(</span>rel_abund<span class="punctuation">)</span> <span class="operator">%in%</span> names.single<span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">single.ASV<span class="punctuation">[</span>single.ASV <span class="operator">==</span> <span class="number">0</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NA</span> <span class="comment"># A separate dataset for annotation of singletones on the barplot</span></span><br><span class="line">                            </span><br><span class="line">         qplot.withSing <span class="operator">=</span> qplot<span class="punctuation">(</span>rel_abund<span class="punctuation">,</span> geom <span class="operator">=</span> <span class="string">&quot;histogram&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> binwidth<span class="punctuation">,</span> </span><br><span class="line">        main <span class="operator">=</span> <span class="string">&quot;Frequency count of relative abundance with singletones&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        geom_bar<span class="punctuation">(</span>aes<span class="punctuation">(</span>single.ASV<span class="punctuation">)</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span>  color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> width <span class="operator">=</span> binwidth<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">                       xlab <span class="punctuation">(</span><span class="string">&quot;Relative abundance in samples&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span><span class="string">&quot;Frequency&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">                       geom_label_repel<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> y <span class="operator">=</span><span class="built_in">length</span><span class="punctuation">(</span>rel_abund<span class="punctuation">)</span><span class="operator">/</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                       label.padding <span class="operator">=</span>  unit<span class="punctuation">(</span><span class="number">0.55</span><span class="punctuation">,</span> <span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                       label <span class="operator">=</span> glue<span class="punctuation">(</span><span class="string">&quot;&#123;length(names.single)&#125;\n Singletones&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">           theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">                            </span><br><span class="line">                       qplot.rmSing <span class="operator">=</span> qplot<span class="punctuation">(</span>rel_abund<span class="punctuation">[</span><span class="operator">!</span>rownames<span class="punctuation">(</span>rel_abund<span class="punctuation">)</span> <span class="operator">%in%</span> names.single<span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span> geom <span class="operator">=</span> <span class="string">&quot;histogram&quot;</span><span class="punctuation">,</span></span><br><span class="line">                       binwidth <span class="operator">=</span> binwidth<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Frequency count of relative abundance without singletones&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">                       xlab <span class="punctuation">(</span><span class="string">&quot;Relative abundance in samples&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span><span class="string">&quot;Frequency&quot;</span><span class="punctuation">)</span><span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">                            </span><br><span class="line">                       print<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&#x27;Oh no..! &#123;length(names.single)&#125; singletones detected in the dataset&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                       <span class="built_in">return</span><span class="punctuation">(</span>structure<span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span>qplot.withSing<span class="punctuation">,</span> qplot.rmSing<span class="punctuation">,</span> unlist<span class="punctuation">(</span>names.single<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">)</span></span><br><span class="line">                    </span><br><span class="line">                        <span class="punctuation">&#125;</span>                        </span><br><span class="line">    </span><br><span class="line">                             </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">                        </span><br><span class="line">single.test <span class="operator">=</span> out.ASV<span class="punctuation">(</span>phyloseq <span class="operator">=</span> pst<span class="punctuation">,</span> threshold <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.01</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#singletones = single.test[[3]] #here you can extract the names of the singletones</span></span><br><span class="line"></span><br><span class="line">single.test<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="comment">#to show the plot with singletones</span></span><br><span class="line">single.test<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="comment">#to show the plot without singletones</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Now you can remove the singletones from your pst file as follows:</span></span><br><span class="line"><span class="comment">#pst = subset_taxa(pst, !taxa_names(ps)%in% singletones)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rm<span class="punctuation">(</span>single.test<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="4-阿尔法多样性"><a href="#4-阿尔法多样性" class="headerlink" title="4.阿尔法多样性"></a>4.阿尔法多样性</h4><h5 id="4-1-稀疏"><a href="#4-1-稀疏" class="headerlink" title="4.1. 稀疏"></a>4.1. 稀疏</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#library(MicrobiotaProcess)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#This takes a bit of time</span></span><br><span class="line">ps_rar_curve <span class="operator">&lt;-</span> MicrobiotaProcess<span class="operator">::</span>ggrarecurve<span class="punctuation">(</span>obj <span class="operator">=</span> pst<span class="punctuation">,</span> </span><br><span class="line">                    indexNames <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Observe&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Shannon&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                    chunks<span class="operator">=</span><span class="number">400</span><span class="punctuation">,</span> </span><br><span class="line">                    theme<span class="punctuation">(</span>legend.spacing.y <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.02</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                          legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                          show.legend<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ps_rar_curve <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">30000</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> color <span class="operator">=</span> alpha<span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Rarefaction curves based on Richnessh and evenness&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Each line is a sample&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ggsave(&quot;./Alpha/rarefaction.curve.jpeg&quot;, device = &quot;png&quot;, dpi = 300, height = 6, width = 9)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rarefying the table with minimum depth of 10000 reads per sample</span></span><br><span class="line">ps_rar <span class="operator">=</span> rarefy_even_depth<span class="punctuation">(</span>pst<span class="punctuation">,</span> sample.size <span class="operator">=</span> <span class="number">30000</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="comment">#in this depth we have lost one sapmle (F.29) and no ASVs.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Taxonomic filtering based on abundance for rarefied data: supervsed</span></span><br><span class="line"><span class="comment">## Abumdance: ASV &gt; 0.0001% overall abundance across all samples</span></span><br><span class="line">total.depth <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">totAbuThreshold <span class="operator">&lt;-</span> 1e<span class="operator">-</span><span class="number">4</span> <span class="operator">*</span> total.depth</span><br><span class="line">ps_rar <span class="operator">&lt;-</span> prune_taxa<span class="punctuation">(</span>taxa_sums<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="operator">&gt;</span>totAbuThreshold<span class="punctuation">,</span> ps_rar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ps_rar</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## phyloseq-class experiment-level object</span></span><br><span class="line"><span class="comment">## otu_table()   OTU Table:         [ 1221 taxa and 87 samples ]</span></span><br><span class="line"><span class="comment">## sample_data() Sample Data:       [ 87 samples by 2 sample variables ]</span></span><br><span class="line"><span class="comment">## tax_table()   Taxonomy Table:    [ 1221 taxa by 7 taxonomic ranks ]</span></span><br><span class="line"><span class="comment">## phy_tree()    Phylogenetic Tree: [ 1221 tips and 1214 internal nodes ]</span></span><br><span class="line"><span class="comment">## refseq()      DNAStringSet:      [ 1221 reference sequences ]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span><span class="punctuation">(</span>rowSums<span class="punctuation">(</span>ps_rar<span class="operator">@</span>otu_table<span class="punctuation">)</span><span class="operator">==</span><span class="number">0</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## [1] 0</span></span><br></pre></td></tr></table></figure>

<h5 id="4-2-Alpha-多样性指标"><a href="#4-2-Alpha-多样性指标" class="headerlink" title="4.2. Alpha 多样性指标"></a>4.2. Alpha 多样性指标</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Calculating the alpha diversity indexes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Richness</span></span><br><span class="line">Chao1 <span class="operator">=</span> estimate_richness<span class="punctuation">(</span>pst<span class="punctuation">,</span> split <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> measures <span class="operator">=</span> <span class="string">&quot;Chao1&quot;</span><span class="punctuation">)</span><span class="comment">#for richness, we don&#x27;t use rarefied table</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Evenness: shannon =&gt; H&#x27; = -Σ (Pi * ln(Pi))</span></span><br><span class="line">Shannon <span class="operator">=</span> estimate_richness<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> split <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> measures <span class="operator">=</span> <span class="string">&quot;Shannon&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Faith Phylogenetic Diversity: PD = Σ(branch lengths leading to selected species)</span></span><br><span class="line">library<span class="punctuation">(</span>picante<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">FaithPD <span class="operator">=</span> picante<span class="operator">::</span>pd<span class="punctuation">(</span>samp <span class="operator">=</span> t<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> tree <span class="operator">=</span> phy_tree<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">$</span>PD</span><br><span class="line"></span><br><span class="line"><span class="comment">#adding the indexes to the metadatas              </span></span><br><span class="line">sample_data<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span> <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>sample_data<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">,</span> Chao1<span class="operator">=</span>Chao1<span class="punctuation">[</span>rownames<span class="punctuation">(</span>Chao1<span class="punctuation">)</span><span class="operator">%in%</span> rownames<span class="punctuation">(</span>sample_data<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> Shannon <span class="operator">=</span> Shannon<span class="operator">$</span>Shannon<span class="punctuation">,</span> FaithPD <span class="operator">=</span> FaithPD<span class="punctuation">)</span> <span class="comment">#note that we have removed that sample which has been removed by rarefaction.  </span></span><br></pre></td></tr></table></figure>

<h5 id="4-3-可视化α多样性指数"><a href="#4-3-可视化α多样性指数" class="headerlink" title="4.3.可视化α多样性指数"></a>4.3.可视化α多样性指数</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggpubr<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">alpha_ccd <span class="operator">=</span> sample_data<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span>   <span class="operator">%&gt;%</span> data.frame</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long_mtdat <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>alpha_ccd<span class="punctuation">,</span> <span class="punctuation">)</span></span><br><span class="line">long_mtdat<span class="operator">&lt;-</span> long_mtdat<span class="punctuation">[</span>long_mtdat<span class="operator">$</span>variable <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Chao1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Shannon&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FaithPD&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long_mtdat<span class="operator">$</span>variable <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>long_mtdat<span class="operator">$</span>variable <span class="punctuation">,</span> levels <span class="operator">=</span>  <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Chao1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Shannon&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FaithPD&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pie<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> colors<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">120</span><span class="punctuation">,</span> <span class="number">42</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> clockwise <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span>colors<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">120</span><span class="punctuation">,</span> <span class="number">42</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">cols <span class="operator">=</span> colors<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">120</span><span class="punctuation">,</span> <span class="number">42</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">my_comp <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;C&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;E&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mock&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#comparison between Samples by SampleID and digesta</span></span><br><span class="line"></span><br><span class="line">alpha_p <span class="operator">=</span> ggplot<span class="punctuation">(</span>long_mtdat<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> group<span class="punctuation">,</span> y <span class="operator">=</span> value<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_violin<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span> trim <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  stat_compare_means<span class="punctuation">(</span>paired <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> comparison <span class="operator">=</span> my_comp<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;t.test&quot;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&quot;p.signif&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_boxplot<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">0.10</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_jitter<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>long_mtdat<span class="operator">$</span>variable<span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_y&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> cols<span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  axis.text.y <span class="operator">=</span> element_text<span class="punctuation">(</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> strip.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  labs<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Sample type&quot;</span><span class="punctuation">,</span>  y <span class="operator">=</span> <span class="string">&quot;Alpha diversity&quot;</span><span class="punctuation">,</span></span><br><span class="line">  title <span class="operator">=</span> <span class="string">&quot;Alpha diversity metrics in different group samples.\n Means are compared by unpaired t.test&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  xlab<span class="punctuation">(</span><span class="string">&quot;Sample type&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(plot = alpha_p, &quot;./Alpha/alpha.jpeg&quot;, device = &quot;jpeg&quot;, width = 15, dpi =300)</span></span><br><span class="line"></span><br><span class="line">alpha_p</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">lm1 <span class="operator">=</span> lm<span class="punctuation">(</span>Chao1 <span class="operator">~</span> group<span class="punctuation">,</span> data <span class="operator">=</span> alpha_ccd<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">summary<span class="punctuation">(</span>lm1<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Call:</span></span><br><span class="line"><span class="comment">## lm(formula = Chao1 ~ group, data = alpha_ccd)</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Residuals:</span></span><br><span class="line"><span class="comment">##     Min      1Q  Median      3Q     Max </span></span><br><span class="line"><span class="comment">## -679.86 -196.49   40.58  234.99  533.47 </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Coefficients:</span></span><br><span class="line"><span class="comment">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span><br><span class="line"><span class="comment">## (Intercept)  2588.961     92.412  28.015  &lt; 2e-16 ***</span></span><br><span class="line"><span class="comment">## groupB        335.459    130.690   2.567 0.012177 *  </span></span><br><span class="line"><span class="comment">## groupC        -31.262    133.628  -0.234 0.815637    </span></span><br><span class="line"><span class="comment">## groupD          5.494    130.690   0.042 0.966577    </span></span><br><span class="line"><span class="comment">## groupE        535.158    130.690   4.095 0.000102 ***</span></span><br><span class="line"><span class="comment">## groupF        169.873    130.690   1.300 0.197493    </span></span><br><span class="line"><span class="comment">## groupG       -802.872    170.400  -4.712 1.05e-05 ***</span></span><br><span class="line"><span class="comment">## groupH      -1066.241    141.162  -7.553 6.86e-11 ***</span></span><br><span class="line"><span class="comment">## groupMock   -1103.125    244.499  -4.512 2.24e-05 ***</span></span><br><span class="line"><span class="comment">## ---</span></span><br><span class="line"><span class="comment">## Signif. codes:  0 &#x27;***&#x27; 0.001 &#x27;**&#x27; 0.01 &#x27;*&#x27; 0.05 &#x27;.&#x27; 0.1 &#x27; &#x27; 1</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Residual standard error: 320.1 on 78 degrees of freedom</span></span><br><span class="line"><span class="comment">## Multiple R-squared:  0.7232, Adjusted R-squared:  0.6948 </span></span><br><span class="line"><span class="comment">## F-statistic: 25.47 on 8 and 78 DF,  p-value: &lt; 2.2e-16</span></span><br></pre></td></tr></table></figure>

<h4 id="5-贝塔多样性"><a href="#5-贝塔多样性" class="headerlink" title="5. 贝塔多样性"></a>5. 贝塔多样性</h4><p>计数数据的转换又称为特征缩放</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span><span class="string">&quot;patchwork&quot;</span><span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Untransformed</span></span><br><span class="line">p1 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for raw&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p2 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> log10<span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for raw, Log10T&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1 <span class="operator">+</span> p2 <span class="operator">+</span> plot_layout<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span> <span class="punctuation">,</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Rarefied</span></span><br><span class="line">p3 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for rarefied data&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p4 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> log10<span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.07</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for raw, rarefied Log10T&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p3 <span class="operator">+</span> p4 <span class="operator">+</span>plot_layout<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span> <span class="punctuation">,</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Relabund</span></span><br><span class="line">ps_rel <span class="operator">=</span> transform_sample_counts<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span>x <span class="operator">/</span> <span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p5 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rel<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for relabund data&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p6 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> log10<span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rel<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.07</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for relabund, Log10T&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"> p5 <span class="operator">+</span> p6<span class="operator">+</span> plot_layout<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span> <span class="punctuation">,</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Natural log</span></span><br><span class="line">ps_log <span class="operator">=</span> transform_sample_counts<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">+</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p7 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for log data&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p8 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> log10<span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>pst<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.07</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for log, Log10T&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p7 <span class="operator">+</span> p8 <span class="operator">+</span> plot_layout<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span> <span class="punctuation">,</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#VST</span></span><br><span class="line">vst_count <span class="operator">=</span>  varianceStabilizingTransformation<span class="punctuation">(</span>object <span class="operator">=</span> as<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">,</span>  <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> fitType <span class="operator">=</span> <span class="string">&quot;mean&quot;</span><span class="punctuation">,</span> blind <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ps_vst <span class="operator">=</span> ps_rar</span><br><span class="line">otu_table<span class="punctuation">(</span>ps_vst<span class="punctuation">)</span> <span class="operator">&lt;-</span> otu_table<span class="punctuation">(</span>vst_count<span class="punctuation">,</span> taxa_are_rows <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p9 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_vst<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for VST data&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p10 <span class="operator">=</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> log10<span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_vst<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  fill <span class="operator">=</span> <span class="string">&quot;#4a8d78&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">0.07</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ggtitle<span class="punctuation">(</span><span class="string">&quot;Histogram for VST, Log10T&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Taxa sum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Count, all samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p9 <span class="operator">+</span> p10 <span class="operator">+</span> plot_layout<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span> <span class="punctuation">,</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">msd <span class="operator">=</span> meanSdPlot<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> ranks <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p11 <span class="operator">=</span> msd<span class="operator">$</span>gg <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;Mean vs. STD for raw counts of taxa&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">xlab<span class="punctuation">(</span><span class="string">&quot;Mean of normalized raw counts&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">ylab<span class="punctuation">(</span><span class="string">&quot;Standard deviation of counts&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">guides<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msd2 <span class="operator">=</span> meanSdPlot<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_vst<span class="punctuation">)</span><span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> ranks <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p12 <span class="operator">=</span> msd2<span class="operator">$</span>gg <span class="operator">+</span> </span><br><span class="line">ggtitle<span class="punctuation">(</span><span class="string">&quot;Mean vs. STD for VST counts of taxa&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">xlab<span class="punctuation">(</span><span class="string">&quot;Mean of normalized VST counts&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">ylab<span class="punctuation">(</span><span class="string">&quot;Standard deviation of VST counts&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p11 <span class="operator">+</span> p12 <span class="operator">+</span> plot_layout<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span> <span class="punctuation">,</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Standardization  (x-mean(x)/sd(x))</span></span><br><span class="line">tb <span class="operator">=</span> ps_rar<span class="operator">@</span>otu_table <span class="operator">%&gt;%</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">std <span class="operator">=</span> apply<span class="punctuation">(</span>tb<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span>scale<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>std<span class="punctuation">)</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>tb<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">qplot<span class="punctuation">(</span>rowSums<span class="punctuation">(</span>std<span class="punctuation">)</span><span class="punctuation">,</span> bins <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">pca_result <span class="operator">=</span> prcomp<span class="punctuation">(</span>std<span class="punctuation">,</span> scale <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>pca_result<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## [1] &quot;sdev&quot;     &quot;rotation&quot; &quot;center&quot;   &quot;scale&quot;    &quot;x&quot;</span></span><br><span class="line"></span><br><span class="line">pca_result<span class="operator">$</span>center</span><br><span class="line"></span><br><span class="line"><span class="comment">##         BRK01         BRK02         BRK03         BRK04         BRK05 </span></span><br><span class="line"><span class="comment">## -4.841882e-18 -4.516532e-18 -1.260552e-17  3.100055e-18 -3.685399e-18 </span></span><br><span class="line"><span class="comment">##         BRK06         BRK07         BRK08         BRK09         BRK10 </span></span><br><span class="line"><span class="comment">##  7.618008e-18  2.040467e-17  3.316007e-18 -1.672069e-17 -6.933211e-19 </span></span><br><span class="line"><span class="comment">##         BRK11         BRK12         BRK13         BRK14         BRK15 </span></span><br><span class="line"><span class="comment">## -4.578867e-18  1.868983e-17 -9.308688e-18 -9.223444e-18  6.710865e-18 </span></span><br><span class="line"><span class="comment">##         BRK16         BRK17         BRK18         BRK19         BRK20 </span></span><br><span class="line"><span class="comment">##  1.265311e-17  3.233746e-17  2.415258e-19  8.945689e-18  1.014977e-17 </span></span><br><span class="line"><span class="comment">##         BRK21         BRK22         BRK23         BRK24         BRK25 </span></span><br><span class="line"><span class="comment">## -3.020138e-18 -2.631637e-17 -1.553153e-17 -1.329742e-17 -1.175662e-18 </span></span><br><span class="line"><span class="comment">##         BRK26         BRK27         BRK28         BRK29         BRK30 </span></span><br><span class="line"><span class="comment">##  7.176868e-18 -4.081786e-18 -7.600248e-18 -1.728401e-17  1.236790e-17 </span></span><br><span class="line"><span class="comment">##         BRK31         BRK32         BRK33         BRK34         BRK36 </span></span><br><span class="line"><span class="comment">##  1.065555e-17 -5.702317e-18  1.599895e-17 -9.921737e-18 -1.142879e-17 </span></span><br><span class="line"><span class="comment">##         BRK37         BRK38         BRK39         BRK40         BRK41 </span></span><br><span class="line"><span class="comment">## -1.132330e-18  4.797839e-18 -1.785160e-17 -9.740593e-18 -1.431395e-18 </span></span><br><span class="line"><span class="comment">##         BRK42         BRK43         BRK44         BRK45         BRK46 </span></span><br><span class="line"><span class="comment">##  7.954723e-18  2.809868e-18  9.705075e-18  1.118122e-18 -1.449013e-17 </span></span><br><span class="line"><span class="comment">##         BRK47         BRK48         BRK49         BRK50         BRK51 </span></span><br><span class="line"><span class="comment">## -1.050495e-17  3.361471e-18  8.628154e-18 -6.707313e-18  6.816000e-18 </span></span><br><span class="line"><span class="comment">##         BRK52         BRK53         BRK54         BRK55         BRK56 </span></span><br><span class="line"><span class="comment">##  1.298627e-17 -3.862992e-18 -2.711482e-18  4.148383e-18  1.683044e-18 </span></span><br><span class="line"><span class="comment">##         BRK57         BRK58         BRK59         BRK60         BRK61 </span></span><br><span class="line"><span class="comment">##  1.528432e-17 -1.047796e-17 -2.039188e-17 -1.482258e-17 -1.254087e-17 </span></span><br><span class="line"><span class="comment">##         BRK62         BRK63         BRK64         BRK65         BRK66 </span></span><br><span class="line"><span class="comment">##  3.474420e-18  3.078743e-17 -1.463362e-17 -1.260125e-17 -1.770952e-18 </span></span><br><span class="line"><span class="comment">##         BRK67         BRK68         BRK69         BRK70         BRK71 </span></span><br><span class="line"><span class="comment">## -2.333565e-18  6.753132e-18  1.052697e-17  8.008267e-18  4.469648e-18 </span></span><br><span class="line"><span class="comment">##         BRK72         BRK81         BRK82         BRK83         BRK84 </span></span><br><span class="line"><span class="comment">##  1.414045e-17  1.019807e-17 -3.789824e-18 -3.597314e-18 -9.277432e-18 </span></span><br><span class="line"><span class="comment">##         BRK85         BRK86         BRK87         BRK88         BRK89 </span></span><br><span class="line"><span class="comment">##  9.331420e-18  4.660027e-19  1.505984e-17 -7.615166e-18 -1.365615e-17 </span></span><br><span class="line"><span class="comment">##         BRK90         BRK91         BRK92         BRK93         BRK94 </span></span><br><span class="line"><span class="comment">##  1.325266e-17  9.757642e-18 -3.472288e-18 -8.391956e-18 -1.005031e-17 </span></span><br><span class="line"><span class="comment">##         BRK95         BRK96 </span></span><br><span class="line"><span class="comment">##  6.060166e-18  1.130554e-17</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">pca_df <span class="operator">=</span> data.frame<span class="punctuation">(</span>PC1 <span class="operator">=</span> pca_result<span class="operator">$</span>rotation<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> PC2 <span class="operator">=</span> pca_result<span class="operator">$</span>rotation<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> group <span class="operator">=</span> sample_data<span class="punctuation">(</span>ps_rar<span class="punctuation">)</span><span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">explained_variance <span class="operator">&lt;-</span> pca_result<span class="operator">$</span>sdev<span class="operator">^</span><span class="number">2</span> <span class="operator">/</span> <span class="built_in">sum</span><span class="punctuation">(</span>pca_result<span class="operator">$</span>sdev<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">pc_labels <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;PC&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>explained_variance<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">var_df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>PC <span class="operator">=</span> pc_labels<span class="punctuation">,</span> ExplainedVariance <span class="operator">=</span> explained_variance<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>pca_df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> PC1<span class="punctuation">,</span> y <span class="operator">=</span> PC2<span class="punctuation">,</span> color <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> colors<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">40</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">80</span><span class="punctuation">,</span> <span class="number">42</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">xlab<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;PC1, &#123;round(var_df$ExplainedVariance[1] * 100,1)&#125;%&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">ylab<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;PC1, &#123;round(var_df$ExplainedVariance[2] * 100,1)&#125;%&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_legend<span class="punctuation">(</span>title <span class="operator">=</span> <span class="string">&quot;Group&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> color <span class="operator">=</span> alpha<span class="punctuation">(</span><span class="string">&quot;orange&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> color <span class="operator">=</span> alpha<span class="punctuation">(</span><span class="string">&quot;orange&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="5-1-排序图"><a href="#5-1-排序图" class="headerlink" title="5.1. 排序图"></a>5.1. 排序图</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">cols <span class="operator">=</span> colors<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">120</span><span class="punctuation">,</span> <span class="number">42</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment">#bray </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#bray PCoA: BC = (Σ|X_i - Y_i|) / (Σ(X_i + Y_i))</span></span><br><span class="line">bray_pcoa<span class="operator">=</span>ordinate<span class="punctuation">(</span>ps_log<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;PCoA&quot;</span><span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">evals<span class="operator">&lt;-</span>bray_pcoa<span class="operator">$</span>values<span class="operator">$</span>Eigenvalues</span><br><span class="line"></span><br><span class="line">bray_p <span class="operator">=</span> plot_ordination<span class="punctuation">(</span>ps_log<span class="punctuation">,</span> bray_pcoa<span class="punctuation">,</span>  title <span class="operator">=</span> <span class="string">&quot;Bray-Curtis PCoA plot, Log&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>col<span class="operator">=</span><span class="string">&quot;Group&quot;</span><span class="punctuation">)</span><span class="operator">+</span> geom_point<span class="punctuation">(</span> aes<span class="punctuation">(</span>fill <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span>  color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   <span class="comment">#coord_fixed() + </span></span><br><span class="line">  <span class="comment">#stat_ellipse(aes(group = group, fill = group), </span></span><br><span class="line">  <span class="comment">#  show.legend = F, type = &quot;t&quot;, level = 0.05, lty = 2, geom = &quot;polygon&quot;, alpha = 0.1) + </span></span><br><span class="line">    labs<span class="punctuation">(</span>x <span class="operator">=</span> sprintf<span class="punctuation">(</span><span class="string">&quot;PCo1 [%s%%]&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>evals<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>evals<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      y <span class="operator">=</span> sprintf<span class="punctuation">(</span><span class="string">&quot;PCo2 [%s%%]&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>evals<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>evals<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">         scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> cols<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">            geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">             geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">              theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                   axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&quot;./Beta/bray.pcoa.dig.vs.muc.jpeg&quot;, dpi = 300)</span></span><br><span class="line"></span><br><span class="line">wunifrac <span class="operator">=</span> ordinate<span class="punctuation">(</span>ps_log<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;NMDS&quot;</span><span class="punctuation">,</span> distance<span class="operator">=</span><span class="string">&#x27;wunifrac&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Run 0 stress 0.04758852 </span></span><br><span class="line"><span class="comment">## Run 1 stress 0.05257593 </span></span><br><span class="line"><span class="comment">## Run 2 stress 0.04758856 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 3.155827e-05  max resid 8.339069e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 3 stress 0.04758858 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 3.471801e-05  max resid 8.939346e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 4 stress 0.0475886 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 1.71134e-05  max resid 5.518678e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 5 stress 0.04758853 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 1.978362e-05  max resid 5.187433e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 6 stress 0.07429898 </span></span><br><span class="line"><span class="comment">## Run 7 stress 0.05257595 </span></span><br><span class="line"><span class="comment">## Run 8 stress 0.07429908 </span></span><br><span class="line"><span class="comment">## Run 9 stress 0.04758852 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 1.726039e-05  max resid 4.740674e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 10 stress 0.04758851 </span></span><br><span class="line"><span class="comment">## ... New best solution</span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 1.241057e-05  max resid 2.7403e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 11 stress 0.04758852 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 4.215754e-06  max resid 1.148943e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 12 stress 0.07429939 </span></span><br><span class="line"><span class="comment">## Run 13 stress 0.04758853 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 8.518784e-06  max resid 2.341394e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 14 stress 0.04758852 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 7.077508e-06  max resid 1.774362e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 15 stress 0.04758853 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 1.264987e-05  max resid 3.6171e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 16 stress 0.04758853 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 3.895438e-05  max resid 0.0001050886 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 17 stress 0.04758853 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 4.289572e-05  max resid 0.0001150774 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 18 stress 0.05257595 </span></span><br><span class="line"><span class="comment">## Run 19 stress 0.04758852 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 1.454469e-06  max resid 7.042092e-06 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## Run 20 stress 0.04758853 </span></span><br><span class="line"><span class="comment">## ... Procrustes: rmse 6.52229e-06  max resid 2.010471e-05 </span></span><br><span class="line"><span class="comment">## ... Similar to previous best</span></span><br><span class="line"><span class="comment">## *** Best solution repeated 9 times</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">wunifrac_p <span class="operator">=</span> plot_ordination<span class="punctuation">(</span>ps_log<span class="punctuation">,</span> wunifrac<span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&quot;WUNIFRAC NMDS, LogT&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_point<span class="punctuation">(</span> aes<span class="punctuation">(</span>fill <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> </span><br><span class="line">   alpha <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span><span class="number">8</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span>  <span class="operator">+</span> </span><br><span class="line">   <span class="comment">#coord_fixed()+</span></span><br><span class="line">    labs<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&quot;Group&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">         scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> cols<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">            geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">             geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">              theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                   axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">bray_p <span class="operator">+</span> wunifrac_p <span class="operator">+</span> plot_layout<span class="punctuation">(</span> heights <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span> widths <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span> plot_annotation<span class="punctuation">(</span><span class="string">&quot;Ordination plots of compostional analysis&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Bray-Curtis dissimilarity and\n Weighted Unifrac phylogenetic distance&quot;</span><span class="punctuation">,</span> <span class="string">&quot;You might know this as Beta diversity&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="Gloomer：一个包装“tax-glom-”函数并向分类单元添加简洁唯一名称的函数"><a href="#Gloomer：一个包装“tax-glom-”函数并向分类单元添加简洁唯一名称的函数" class="headerlink" title="Gloomer：一个包装“tax_glom()”函数并向分类单元添加简洁唯一名称的函数"></a>Gloomer：一个包装“tax_glom()”函数并向分类单元添加简洁唯一名称的函数</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Gloomer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#A function to create unique names for each ASV. If species is set as the taxa level, it removes any NA in Order level then attempts to use the name of one level higher taxa for those who have similar names, e.g. uncultured_bacterium</span></span><br><span class="line"></span><br><span class="line">gloomer <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>ps <span class="operator">=</span> data<span class="punctuation">,</span> taxa_level <span class="operator">=</span> taxa_level<span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    rank.names <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Kingdom&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Phylum&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Class&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Order&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Family&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Genus&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Species&#x27;</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">#====================Sometimes in genus level, we might have multiple uncultured organisms, which if we want to make unique out of them for the species level it won&#x27;t work====</span></span><br><span class="line">    <span class="comment">#since adding uncultured to uncultered is sill duplication. therefore if the taxa_level is set to species we first make a unique genus and then we go further to the speices===#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Removing unculured Family</span></span><br><span class="line">ps <span class="operator">=</span> subset_taxa<span class="punctuation">(</span>ps<span class="punctuation">,</span> <span class="operator">!</span>Family <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;uncultured&quot;</span><span class="punctuation">,</span> <span class="string">&quot;NA&quot;</span><span class="punctuation">,</span> <span class="string">&quot;uncategorized&quot;</span><span class="punctuation">,</span> <span class="string">&quot;unassigend&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> <span class="string">&quot; &quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span>taxa_level <span class="operator">==</span> <span class="string">&quot;Species&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">    ps <span class="operator">=</span> subset_taxa<span class="punctuation">(</span>ps<span class="punctuation">,</span> <span class="operator">!</span>Genus <span class="operator">%in%</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="comment">#we remove genus tagged NA</span></span><br><span class="line">tax_table<span class="punctuation">(</span>ps<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span><span class="built_in">is.na</span><span class="punctuation">(</span>tax_table<span class="punctuation">(</span>ps<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> paste0<span class="punctuation">(</span><span class="string">&quot;unknown&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> paste<span class="punctuation">(</span>tax_table<span class="punctuation">(</span>ps<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#convert NA in species into unknown</span></span><br><span class="line">    </span><br><span class="line">  physeq <span class="operator">=</span> tax_glom<span class="punctuation">(</span>physeq <span class="operator">=</span> ps<span class="punctuation">,</span> taxrank <span class="operator">=</span> taxa_level<span class="punctuation">,</span> NArm <span class="operator">=</span> NArm<span class="punctuation">)</span></span><br><span class="line">  taxdat <span class="operator">=</span> tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names <span class="operator">==</span> taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">   taxdat <span class="operator">=</span> taxdat<span class="punctuation">[</span>complete.cases<span class="punctuation">(</span>taxdat<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">    otudat <span class="operator">=</span> otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">#first take care of the uncultured genus</span></span><br><span class="line">taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span> <span class="operator">=</span> ifelse<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;uncategorized&quot;</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> <span class="string">&quot;uncultured&quot;</span><span class="punctuation">,</span> <span class="string">&quot;unassigend&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> <span class="string">&quot; &quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       paste0<span class="punctuation">(</span><span class="string">&quot;[&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">length</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names<span class="operator">==</span><span class="string">&quot;Genus&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;]&quot;</span><span class="punctuation">,</span> <span class="string">&quot;_&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line">spec1 <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">spec2  <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line"></span><br><span class="line">    uni  <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>spec2<span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>spec1<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    <span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>spec1<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="keyword">for</span><span class="punctuation">(</span>j <span class="keyword">in</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>spec2<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    uni<span class="punctuation">[</span>i<span class="punctuation">,</span> j<span class="punctuation">]</span> <span class="operator">=</span> ifelse<span class="punctuation">(</span>spec1<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">==</span> spec2<span class="punctuation">[</span>j<span class="punctuation">]</span> <span class="punctuation">,</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FALSE&quot;</span><span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>uni<span class="punctuation">)</span> <span class="operator">&lt;-</span>spec1</span><br><span class="line">colnames<span class="punctuation">(</span>uni<span class="punctuation">)</span> <span class="operator">&lt;-</span> spec2   </span><br><span class="line">uni<span class="punctuation">[</span>upper.tri<span class="punctuation">(</span>uni<span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">0</span> <span class="comment">#get rid of diagonals and upper triangle</span></span><br><span class="line"></span><br><span class="line">duplis <span class="operator">=</span> uni <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">dim</span><span class="punctuation">(</span>duplis<span class="punctuation">)</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">duplis <span class="operator">=</span> uni <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> dplyr<span class="operator">::</span>select<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unique<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">taxdat <span class="operator">=</span> taxdat <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span> uni<span class="operator">=</span> ifelse<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%in%</span> duplis<span class="punctuation">,</span></span><br><span class="line">                    paste0<span class="punctuation">(</span><span class="string">&quot;[&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">length</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names<span class="operator">==</span>taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;]&quot;</span><span class="punctuation">,</span> <span class="string">&quot;_&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#check if all the names are unique at species level, otherwise we will bring family instead of genus</span></span><br><span class="line">   dupies <span class="operator">&lt;-</span>  taxdat<span class="punctuation">[</span>duplicated<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;uni&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span> </span><br><span class="line">    <span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>dupies<span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        taxdat <span class="operator">=</span> taxdat <span class="operator">%&gt;%</span> data.frame <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span> uni2<span class="operator">=</span> ifelse<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span> <span class="operator">%in%</span> dupies<span class="punctuation">,</span></span><br><span class="line">                    paste0<span class="punctuation">(</span><span class="string">&quot;[&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">length</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names<span class="operator">==</span>taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;]&quot;</span><span class="punctuation">,</span> <span class="string">&quot;_&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;uni&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;uni&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">        </span><br><span class="line">        taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni2&quot;</span><span class="punctuation">]</span></span><br><span class="line">        taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">        taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni2&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">        taxdat <span class="operator">&lt;-</span> as<span class="punctuation">(</span>taxdat<span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span>   </span><br><span class="line">        rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">        rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">        taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">        otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line">        </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        </span><br><span class="line">taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span></span><br><span class="line">taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">taxdat <span class="operator">&lt;-</span> as<span class="punctuation">(</span>taxdat<span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span>   </span><br><span class="line">rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line">           <span class="punctuation">&#125;</span></span><br><span class="line">    </span><br><span class="line"><span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    </span><br><span class="line">taxdat <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> </span><br><span class="line">taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line">    </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">       </span><br><span class="line">    </span><br><span class="line"><span class="comment">#==========================================# </span></span><br><span class="line"><span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>taxa_level <span class="operator">==</span> <span class="string">&quot;Genus&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    </span><br><span class="line">    physeq <span class="operator">=</span> tax_glom<span class="punctuation">(</span>physeq <span class="operator">=</span> ps<span class="punctuation">,</span> taxrank <span class="operator">=</span> taxa_level<span class="punctuation">,</span> NArm <span class="operator">=</span> NArm<span class="punctuation">)</span></span><br><span class="line">    taxdat <span class="operator">=</span> tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names <span class="operator">==</span> taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">    </span><br><span class="line">   taxdat <span class="operator">=</span> taxdat<span class="punctuation">[</span>complete.cases<span class="punctuation">(</span>taxdat<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">    otudat <span class="operator">=</span> otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># take care of the uncultured genus</span></span><br><span class="line">taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span> <span class="operator">=</span> ifelse<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;uncategorized&quot;</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> <span class="string">&quot;uncultured&quot;</span><span class="punctuation">,</span> <span class="string">&quot;unassigend&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> <span class="string">&quot; &quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       paste0<span class="punctuation">(</span><span class="string">&quot;[&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">length</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names<span class="operator">==</span>taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;]&quot;</span><span class="punctuation">,</span> <span class="string">&quot;_&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line">gen1 <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">gen2  <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line"></span><br><span class="line">    uni  <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>gen2<span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>gen1<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    <span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>gen1<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="keyword">for</span><span class="punctuation">(</span>j <span class="keyword">in</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>gen2<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    uni<span class="punctuation">[</span>i<span class="punctuation">,</span> j<span class="punctuation">]</span> <span class="operator">=</span> ifelse<span class="punctuation">(</span>gen1<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">==</span> gen2<span class="punctuation">[</span>j<span class="punctuation">]</span> <span class="punctuation">,</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FALSE&quot;</span><span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>uni<span class="punctuation">)</span> <span class="operator">&lt;-</span>gen1</span><br><span class="line">colnames<span class="punctuation">(</span>uni<span class="punctuation">)</span> <span class="operator">&lt;-</span> gen2   </span><br><span class="line">uni<span class="punctuation">[</span>upper.tri<span class="punctuation">(</span>uni<span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">0</span> <span class="comment">#get rid of diagonals and upper triangle</span></span><br><span class="line"></span><br><span class="line">duplis <span class="operator">=</span> uni <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">dim</span><span class="punctuation">(</span>duplis<span class="punctuation">)</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#123;</span><span class="comment">#if there is not duplications, we can simply use the taxa names as the row name</span></span><br><span class="line">    </span><br><span class="line">        duplis <span class="operator">=</span> uni <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> dplyr<span class="operator">::</span>select<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">%&gt;%</span> unique<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">        taxdat <span class="operator">=</span> taxdat <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span> uni<span class="operator">=</span> ifelse<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%in%</span> duplis<span class="punctuation">,</span> </span><br><span class="line">                    paste0<span class="punctuation">(</span><span class="string">&quot;[&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">length</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names<span class="operator">==</span>taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;]&quot;</span><span class="punctuation">,</span> <span class="string">&quot;_&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line">        taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span></span><br><span class="line">        taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">        taxdat <span class="operator">&lt;-</span> as<span class="punctuation">(</span>taxdat<span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line">        rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">        rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">        taxdat <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> </span><br><span class="line">        taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">        otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line"> </span><br><span class="line">        <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">        taxdat <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> </span><br><span class="line">        taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">        rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">        taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">        tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">        otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line">       <span class="punctuation">&#125;</span>   </span><br><span class="line">    </span><br><span class="line"><span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">physeq <span class="operator">=</span> tax_glom<span class="punctuation">(</span>physeq <span class="operator">=</span> ps<span class="punctuation">,</span> taxrank <span class="operator">=</span> taxa_level<span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">    taxdat <span class="operator">=</span> tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names <span class="operator">==</span> taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">    </span><br><span class="line">taxdat <span class="operator">=</span> taxdat<span class="punctuation">[</span>complete.cases<span class="punctuation">(</span>taxdat<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">otudat <span class="operator">=</span> otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line">spec1 <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">spec2  <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line"></span><br><span class="line">    uni  <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>spec2<span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>spec1<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    <span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>spec1<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="keyword">for</span><span class="punctuation">(</span>j <span class="keyword">in</span> <span class="built_in">seq_along</span><span class="punctuation">(</span>spec2<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    uni<span class="punctuation">[</span>i<span class="punctuation">,</span> j<span class="punctuation">]</span> <span class="operator">=</span> ifelse<span class="punctuation">(</span>spec1<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">==</span> spec2<span class="punctuation">[</span>j<span class="punctuation">]</span> <span class="punctuation">,</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FALSE&quot;</span><span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>uni<span class="punctuation">)</span> <span class="operator">&lt;-</span>spec1</span><br><span class="line">colnames<span class="punctuation">(</span>uni<span class="punctuation">)</span> <span class="operator">&lt;-</span> spec2   </span><br><span class="line">uni<span class="punctuation">[</span>upper.tri<span class="punctuation">(</span>uni<span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">0</span> <span class="comment">#get rid of diagonals and upper triangle</span></span><br><span class="line"></span><br><span class="line">duplis <span class="operator">=</span> uni <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">dim</span><span class="punctuation">(</span>duplis<span class="punctuation">)</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#123;</span><span class="comment">#if there is not duplications, we can simply use the taxa names as the row name</span></span><br><span class="line">    </span><br><span class="line">    duplis <span class="operator">=</span> uni <span class="operator">%&gt;%</span> reshape2<span class="operator">::</span>melt<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>value <span class="operator">==</span> <span class="string">&quot;TRUE&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> dplyr<span class="operator">::</span>select<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">%&gt;%</span> unique<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">taxdat <span class="operator">=</span> taxdat <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span> uni<span class="operator">=</span> ifelse<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">%in%</span> duplis<span class="punctuation">,</span> </span><br><span class="line">                    paste<span class="punctuation">(</span>taxdat<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">length</span><span class="punctuation">(</span>rank.names<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>which<span class="punctuation">(</span>rank.names<span class="operator">==</span>taxa_level<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;_&quot;</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span>taxa_level<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line">taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span> <span class="operator">=</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span></span><br><span class="line">taxdat<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;uni&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">taxdat <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>taxdat<span class="punctuation">)</span>   </span><br><span class="line">rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line"><span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">taxdat <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> </span><br><span class="line">taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span>rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>otudat<span class="punctuation">)</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">rownames<span class="punctuation">(</span>taxdat<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat<span class="punctuation">[</span><span class="punctuation">,</span> taxa_level<span class="punctuation">]</span></span><br><span class="line">taxdat <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">taxa_names<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxa_names<span class="punctuation">(</span>taxdat<span class="punctuation">)</span></span><br><span class="line">tax_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> taxdat</span><br><span class="line">otu_table<span class="punctuation">(</span>physeq<span class="punctuation">)</span> <span class="operator">&lt;-</span> otudat</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">#ps = phyloseq(otu_table(otudat, taxa_are_rows = T), tax_table(as.matrix(taxdat)), sample_data(physeq))</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="built_in">return</span><span class="punctuation">(</span>physeq<span class="punctuation">)</span> </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="5-2-基于图表的-beta-多样性分析"><a href="#5-2-基于图表的-beta-多样性分析" class="headerlink" title="5.2. 基于图表的 beta 多样性分析"></a>5.2. 基于图表的 beta 多样性分析</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>igraph<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggnetwork<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>phyloseqGraphTest<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#For total none-rarefied dataset</span></span><br><span class="line">pst.spec <span class="operator">&lt;-</span> gloomer<span class="punctuation">(</span>ps <span class="operator">=</span> pst<span class="punctuation">,</span> taxa_level <span class="operator">=</span> <span class="string">&quot;Species&quot;</span><span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">ps_total <span class="operator">=</span> prune_taxa<span class="punctuation">(</span>taxa_sums<span class="punctuation">(</span>pst.spec<span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">1000</span><span class="punctuation">,</span> pst.spec<span class="punctuation">)</span><span class="comment">#filtering the taxa based on total sum</span></span><br><span class="line">sample_data<span class="punctuation">(</span>ps_total<span class="punctuation">)</span><span class="operator">$</span>sampleID <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_data<span class="punctuation">(</span>ps_total<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">net <span class="operator">&lt;-</span> make_network<span class="punctuation">(</span>ps_total<span class="punctuation">,</span> directed <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> max.dist <span class="operator">=</span> <span class="number">0.35</span><span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;samples&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sampledata <span class="operator">&lt;-</span> sample_data<span class="punctuation">(</span>ps_total<span class="punctuation">)</span> <span class="operator">%&gt;%</span> data.frame</span><br><span class="line"></span><br><span class="line">sampledata<span class="operator">$</span>sampleID <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sampledata<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">V<span class="punctuation">(</span>net<span class="punctuation">)</span><span class="operator">$</span>id <span class="operator">&lt;-</span> sampledata<span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>V<span class="punctuation">(</span>net<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;group&quot;</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">V<span class="punctuation">(</span>net<span class="punctuation">)</span><span class="operator">$</span>sample <span class="operator">&lt;-</span>  rownames<span class="punctuation">(</span>sampledata<span class="punctuation">)</span><span class="punctuation">[</span>rownames<span class="punctuation">(</span>sampledata<span class="punctuation">)</span> <span class="operator">%in%</span> <span class="built_in">names</span><span class="punctuation">(</span>V<span class="punctuation">(</span>net<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line">V<span class="punctuation">(</span>net<span class="punctuation">)</span><span class="operator">$</span>sample_type <span class="operator">&lt;-</span> sampledata<span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>V<span class="punctuation">(</span>net<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;group&quot;</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line"></span><br><span class="line"><span class="comment">#graph permutational test</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">2023</span><span class="punctuation">)</span></span><br><span class="line">graph.test <span class="operator">&lt;-</span> graph_perm_test<span class="punctuation">(</span>ps_total<span class="punctuation">,</span> sampletype <span class="operator">=</span> <span class="string">&quot;group&quot;</span><span class="punctuation">,</span> max.dist <span class="operator">=</span> <span class="number">0.35</span><span class="punctuation">,</span></span><br><span class="line">              grouping <span class="operator">=</span> <span class="string">&quot;sampleID&quot;</span><span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;mst&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                             nperm <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">)</span></span><br><span class="line">                      </span><br><span class="line">print<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;Test statistic for the graph-based analysis indicates that\n with p-value = &#123;graph.test$pval&#125;, \n we REJECT the Null hypothesis that the distribution of taxa in samples from different groiups are similar!&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Test statistic for the graph-based analysis indicates that</span></span><br><span class="line"><span class="comment">## with p-value = 0.000999000999000999, </span></span><br><span class="line"><span class="comment">## we REJECT the Null hypothesis that the distribution of taxa in samples from different groiups are similar!</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">V<span class="punctuation">(</span>graph.test<span class="operator">$</span>net<span class="punctuation">)</span><span class="operator">$</span>group <span class="operator">&lt;-</span> sampledata<span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>V<span class="punctuation">(</span>graph.test<span class="operator">$</span>net<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;group&quot;</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> as.vector</span><br><span class="line"></span><br><span class="line">plotNet1 <span class="operator">=</span> phyloseqGraphTest<span class="operator">::</span>plot_test_network<span class="punctuation">(</span>graph.test<span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">theme<span class="punctuation">(</span>legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_nodes<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>color <span class="operator">=</span> sampletype<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> cols<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plotPerm1<span class="operator">=</span>plot_permutations<span class="punctuation">(</span>graph.test<span class="punctuation">,</span> bins <span class="operator">=</span> <span class="number">40</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">                  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> glue<span class="punctuation">(</span><span class="string">&quot;&#123;ifelse(round(graph.test$pval, 2) == 0,</span></span><br><span class="line"><span class="string">                  &#x27;P &lt; 0.01&#x27;, round(graph.test$pval, 2))&#125;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                  x <span class="operator">=</span> <span class="number">65</span><span class="punctuation">,</span> y <span class="operator">=</span><span class="number">40</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">                  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">                  ggtitle<span class="punctuation">(</span><span class="string">&quot;Permutation test for pure edges&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Bray-Curtis&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">grid.arrange<span class="punctuation">(</span>ncol <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span>  plotNet1<span class="punctuation">,</span> plotPerm1<span class="punctuation">)</span> <span class="operator">+</span> geom_col<span class="punctuation">(</span>inherit.aes <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## NULL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&quot;./graph_perm_total.jpeg&quot;, plot = net.grid, device = &quot;jpeg&quot;, width = 15, beight = 10, dpi = 300)</span></span><br></pre></td></tr></table></figure>

<h5 id="5-3-Beta多样性指数的统计分析：基于距离的冗余分析（dbRDA）"><a href="#5-3-Beta多样性指数的统计分析：基于距离的冗余分析（dbRDA）" class="headerlink" title="5.3. Beta多样性指数的统计分析：基于距离的冗余分析（dbRDA）"></a>5.3. Beta多样性指数的统计分析：基于距离的冗余分析（dbRDA）</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Calculating Bray-Curtis dissimilarity coefficeints</span></span><br><span class="line">bray_log <span class="operator">=</span> phyloseq<span class="operator">::</span>distance<span class="punctuation">(</span>ps_log<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="5-3-1-检查质心周围方差的离散程度（方差同源检验）"><a href="#5-3-1-检查质心周围方差的离散程度（方差同源检验）" class="headerlink" title="5.3.1. 检查质心周围方差的离散程度（方差同源检验）"></a>5.3.1. 检查质心周围方差的离散程度（方差同源检验）</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#test for the disperssion of the variance around the centroids</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>permute<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#set the age of the animal as the random variable</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">1990</span><span class="punctuation">)</span></span><br><span class="line">h <span class="operator">&lt;-</span> with<span class="punctuation">(</span>data <span class="operator">=</span> data.frame<span class="punctuation">(</span>sample_data<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> how<span class="punctuation">(</span>blocks <span class="operator">=</span> group<span class="punctuation">,</span> nperm <span class="operator">=</span> <span class="number">999</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##total data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Now we do a Homogeneity of dispersion test</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">bray.disp <span class="operator">&lt;-</span> vegan<span class="operator">::</span>betadisper<span class="punctuation">(</span>bray_log<span class="punctuation">,</span> group <span class="operator">=</span> sample_data<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="operator">$</span>group<span class="punctuation">,</span> </span><br><span class="line">                                 type <span class="operator">=</span> <span class="string">&quot;centroid&quot;</span><span class="punctuation">)</span><span class="comment">#if the p-value is significant, it means that there is a significant difference in variance for any of the tested levels. </span></span><br><span class="line">perm.test <span class="operator">=</span> permutest<span class="punctuation">(</span>bray.disp<span class="punctuation">,</span> permutation <span class="operator">=</span>h<span class="punctuation">,</span> pairwise <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p.val.perm <span class="operator">=</span> perm.test<span class="operator">$</span>tab<span class="operator">$</span>`Pr(&gt;F)`<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">disp.centroid <span class="operator">=</span> bray.disp<span class="operator">$</span>centroids <span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">disp.vectors <span class="operator">=</span> bray.disp<span class="operator">$</span>vectors <span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">eig.vals <span class="operator">=</span> bray.disp<span class="operator">$</span>eig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#jpeg( &quot;./Beta/dispersion of variance_bray_total_sample.type.jpeg&quot;,  quality = 100)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>bray.disp<span class="punctuation">,</span> col <span class="operator">=</span> cols<span class="punctuation">,</span> </span><br><span class="line">    bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span>  las <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> </span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;Dispersion of variance around the centroids, \n bray | LogT dataset&quot;</span><span class="punctuation">,</span> </span><br><span class="line">     sub<span class="operator">=</span><span class="literal">NULL</span><span class="punctuation">,</span>  xlab <span class="operator">=</span> sprintf<span class="punctuation">(</span><span class="string">&quot;PCo1 [%s%%]&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>eig.vals<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>eig.vals<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      ylab <span class="operator">=</span> sprintf<span class="punctuation">(</span><span class="string">&quot;PCo2 [%s%%]&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="built_in">round</span><span class="punctuation">(</span>eig.vals<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>eig.vals<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span>; text<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;P = &#123;p.val.perm&#125;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        x <span class="operator">=</span> <span class="operator">-</span><span class="number">0.1</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span><span class="number">0.29</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="5-3-2-数据库RDA模型"><a href="#5-3-2-数据库RDA模型" class="headerlink" title="5.3.2. 数据库RDA模型"></a>5.3.2. 数据库RDA模型</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Whole dataset</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">2023</span><span class="punctuation">)</span></span><br><span class="line">h <span class="operator">&lt;-</span> with<span class="punctuation">(</span>data <span class="operator">=</span> data.frame<span class="punctuation">(</span>sample_data<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> how<span class="punctuation">(</span>blocks <span class="operator">=</span> group<span class="punctuation">,</span> nperm <span class="operator">=</span> <span class="number">999</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">bray.dbrda <span class="operator">=</span> dbrda<span class="punctuation">(</span>t<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">~</span> group<span class="punctuation">,</span></span><br><span class="line">                        dist <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">,</span> permutations<span class="operator">=</span>h<span class="punctuation">,</span> data <span class="operator">=</span> sample_data<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="operator">%&gt;%</span>data.frame<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Sex not sig, so reduced the model</span></span><br><span class="line"></span><br><span class="line">bray.dbrda</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Call: dbrda(formula = t(otu_table(ps_log)) ~ group, data =</span></span><br><span class="line"><span class="comment">## sample_data(ps_log) %&gt;% data.frame, distance = &quot;bray&quot;, permutations =</span></span><br><span class="line"><span class="comment">## h)</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">##               Inertia Proportion Rank RealDims</span></span><br><span class="line"><span class="comment">## Total         13.5609     1.0000              </span></span><br><span class="line"><span class="comment">## Constrained    8.3821     0.6181    8        8</span></span><br><span class="line"><span class="comment">## Unconstrained  5.1788     0.3819   78       62</span></span><br><span class="line"><span class="comment">## Inertia is squared Bray distance </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Eigenvalues for constrained axes:</span></span><br><span class="line"><span class="comment">## dbRDA1 dbRDA2 dbRDA3 dbRDA4 dbRDA5 dbRDA6 dbRDA7 dbRDA8 </span></span><br><span class="line"><span class="comment">##  4.931  1.071  0.857  0.555  0.470  0.343  0.138  0.017 </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Eigenvalues for unconstrained axes:</span></span><br><span class="line"><span class="comment">##   MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 </span></span><br><span class="line"><span class="comment">## 1.9737 1.1133 0.6623 0.4507 0.1619 0.1129 0.0996 0.0569 </span></span><br><span class="line"><span class="comment">## (Showing 8 of 78 unconstrained eigenvalues)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">permutest<span class="punctuation">(</span>x <span class="operator">=</span> bray.dbrda<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;terms&quot;</span><span class="punctuation">,</span> permutations <span class="operator">=</span> h<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Permutation test for dbrda under reduced model </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Blocks:  group </span></span><br><span class="line"><span class="comment">## Permutation: free</span></span><br><span class="line"><span class="comment">## Number of permutations: 999</span></span><br><span class="line"><span class="comment">##  </span></span><br><span class="line"><span class="comment">## Model: dbrda(formula = t(otu_table(ps_log)) ~ group, data =</span></span><br><span class="line"><span class="comment">## sample_data(ps_log) %&gt;% data.frame, distance = &quot;bray&quot;, permutations =</span></span><br><span class="line"><span class="comment">## h)</span></span><br><span class="line"><span class="comment">## Permutation test for all constrained eigenvalues</span></span><br><span class="line"><span class="comment">##          Df Inertia      F Pr(&gt;F)</span></span><br><span class="line"><span class="comment">## group     8  8.3821 15.781      1</span></span><br><span class="line"><span class="comment">## Residual 78  5.1788</span></span><br></pre></td></tr></table></figure>

<h5 id="5-3-3-绘制模型提取图"><a href="#5-3-3-绘制模型提取图" class="headerlink" title="5.3.3. 绘制模型提取图"></a>5.3.3. 绘制模型提取图</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Make the plot out of the model, which is the variation explained only by the terms </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#digesta</span></span><br><span class="line">score.site <span class="operator">=</span> vegan<span class="operator">::</span>scores<span class="punctuation">(</span>bray.dbrda<span class="punctuation">,</span> display <span class="operator">=</span> <span class="string">&quot;sites&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">score.centroid <span class="operator">=</span> vegan<span class="operator">::</span>scores<span class="punctuation">(</span>bray.dbrda<span class="punctuation">,</span> display <span class="operator">=</span> <span class="string">&quot;cn&quot;</span><span class="punctuation">)</span><span class="operator">%&gt;%</span> as.data.frame</span><br><span class="line">rownames<span class="punctuation">(</span>score.centroid<span class="punctuation">)</span><span class="operator">&lt;-</span> levels<span class="punctuation">(</span>sample_data<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eig.vals <span class="operator">=</span> bray.dbrda<span class="operator">$</span>CCA<span class="operator">$</span>eig</span><br><span class="line">inertia.total <span class="operator">=</span> bray.dbrda<span class="operator">$</span>tot.chi <span class="comment">#total variation (inertia) explained. </span></span><br><span class="line"><span class="comment">#this number should be used as the denominator for measuring the amount of variance out of totoal variance wxplained by each dbrda</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Digesta</span></span><br><span class="line">score.site <span class="operator">%&gt;%</span> ggplot<span class="punctuation">(</span>aes<span class="punctuation">(</span>dbRDA1<span class="punctuation">,</span> dbRDA2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> sample_data<span class="punctuation">(</span>ps_log<span class="punctuation">)</span><span class="operator">$</span>group<span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span><span class="number">6</span>  <span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> cols<span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">scale_y_continuous<span class="punctuation">(</span>na.value <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> n.breaks <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>na.value <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> n.breaks <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">labs<span class="punctuation">(</span>fill <span class="operator">=</span><span class="string">&quot;Groups&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">xlab<span class="punctuation">(</span>label <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;dbRDA1 [&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>eig.vals<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>eig.vals<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                    <span class="string">&quot;% of fitted and&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                   <span class="built_in">round</span><span class="punctuation">(</span>eig.vals<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">/</span>inertia.total<span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                   <span class="string">&quot;% of total variation]&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">ylab<span class="punctuation">(</span>label <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;dbRDA2 [&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>eig.vals<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>eig.vals<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                   <span class="string">&quot;% of fitted and&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>eig.vals<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">/</span>inertia.total<span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                   <span class="string">&quot;of total variation]&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">      text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">13</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      axis.text.x <span class="operator">=</span>element_text<span class="punctuation">(</span>size <span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">axis.text.y <span class="operator">=</span>element_text<span class="punctuation">(</span>size <span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">ggtitle<span class="punctuation">(</span>label <span class="operator">=</span> <span class="string">&quot;dbRDA plot of Bray&quot;</span><span class="punctuation">,</span> <span class="string">&quot;LogT data&quot;</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ggsave(&quot;./Beta/bray.dbRDA.dig.jpeg&quot;, height = 8, width = 9, dpi =300)</span></span><br></pre></td></tr></table></figure>

<h4 id="6-差异丰度分析：DESeq2"><a href="#6-差异丰度分析：DESeq2" class="headerlink" title="6. 差异丰度分析：DESeq2"></a>6. 差异丰度分析：DESeq2</h4><h5 id="6-1-堆积条形图"><a href="#6-1-堆积条形图" class="headerlink" title="6.1. 堆积条形图"></a>6.1. 堆积条形图</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Aglomerating the taxa</span></span><br><span class="line"></span><br><span class="line">phyl <span class="operator">=</span>  gloomer<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> taxa_level <span class="operator">=</span>  <span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">spec <span class="operator">=</span>  gloomer<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> taxa_level <span class="operator">=</span>  <span class="string">&quot;Species&quot;</span><span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Barplot of relative abundance of phylum in digesta</span></span><br><span class="line">trans_phyl <span class="operator">&lt;-</span> merge_samples<span class="punctuation">(</span>phyl<span class="punctuation">,</span> <span class="string">&quot;group&quot;</span><span class="punctuation">)</span></span><br><span class="line">relabund_phyl <span class="operator">&lt;-</span> transform_sample_counts<span class="punctuation">(</span>trans_phyl<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x <span class="operator">/</span> <span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">relabund_phyl <span class="operator">=</span> prune_taxa<span class="punctuation">(</span> taxa_sums<span class="punctuation">(</span>relabund_phyl<span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">0.0001</span><span class="punctuation">,</span> relabund_phyl<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#choosing colors</span></span><br><span class="line">phylcol<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span> <span class="string">&quot;deepskyblue&quot;</span><span class="punctuation">,</span><span class="string">&#x27;springgreen3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;snow3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;burlywood4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cadetblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;darkblue&#x27;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&#x27;cornflowerblue&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;deeppink2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;orangered&#x27;</span><span class="punctuation">,</span>  <span class="string">&#x27;dimgrey&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;limegreen&#x27;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&#x27;cyan1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;darkmagenta&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gold&#x27;</span><span class="punctuation">)</span> </span><br><span class="line">phy_col <span class="operator">=</span> phylcol<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">7</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"> phyl_p <span class="operator">&lt;-</span> plot_bar<span class="punctuation">(</span>relabund_phyl<span class="punctuation">,</span> fill<span class="operator">=</span><span class="string">&quot;Phylum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> phylcol<span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    xlab<span class="punctuation">(</span><span class="string">&quot;Groups&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">    ylab<span class="punctuation">(</span><span class="string">&quot;Relative abundance, %&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">    ggtitle<span class="punctuation">(</span>label <span class="operator">=</span> <span class="string">&quot;Stacked barplot&quot;</span><span class="punctuation">,</span> <span class="string">&quot;rarefied, relabund data &gt; 0.01%&quot;</span><span class="punctuation">)</span>  <span class="operator">+</span></span><br><span class="line">            theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">            theme<span class="punctuation">(</span> legend.position <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span><span class="number">15</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#+ </span></span><br><span class="line">            <span class="comment">#coord_flip()</span></span><br><span class="line">                                             </span><br><span class="line"> phyl_p                                            </span><br></pre></td></tr></table></figure>

<h5 id="6-2-DESeq2"><a href="#6-2-DESeq2" class="headerlink" title="6.2. DESeq2"></a>6.2. DESeq2</h5><p>请记住使用原始数据，因为 DESEq2 内部会计算大小因子和色散的差异。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">phyl <span class="operator">=</span>  gloomer<span class="punctuation">(</span>pst<span class="punctuation">,</span> taxa_level <span class="operator">=</span>  <span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">spec <span class="operator">=</span> gloomer<span class="punctuation">(</span>pst<span class="punctuation">,</span> taxa_level <span class="operator">=</span> <span class="string">&quot;Species&quot;</span><span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#converting phylosq to deseq</span></span><br><span class="line">phyl_dds <span class="operator">&lt;-</span> phyloseq_to_deseq2<span class="punctuation">(</span>phyl<span class="punctuation">,</span> design <span class="operator">=</span> <span class="operator">~</span>  group<span class="punctuation">)</span> </span><br><span class="line">spec_dds <span class="operator">&lt;-</span> phyloseq_to_deseq2<span class="punctuation">(</span>spec<span class="punctuation">,</span> design <span class="operator">=</span> <span class="operator">~</span> group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#calculate geometric means prior to estimate size factors</span></span><br><span class="line">gm.mean <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> na.rm<span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="built_in">exp</span><span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">(</span><span class="built_in">log</span><span class="punctuation">(</span>x<span class="punctuation">[</span>x<span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> na.rm<span class="operator">=</span>na.rm<span class="punctuation">)</span><span class="operator">/</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##Phylum level</span></span><br><span class="line">geo.mean <span class="operator">=</span> apply<span class="punctuation">(</span>counts<span class="punctuation">(</span>phyl_dds<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> gm.mean<span class="punctuation">)</span></span><br><span class="line">phyl_dds <span class="operator">=</span> estimateSizeFactors<span class="punctuation">(</span>phyl_dds<span class="punctuation">,</span> geoMeans <span class="operator">=</span> geo.mean<span class="punctuation">)</span></span><br><span class="line">phyl_dds <span class="operator">&lt;-</span>DESeq<span class="punctuation">(</span>phyl_dds<span class="punctuation">,</span> test <span class="operator">=</span> <span class="string">&quot;Wald&quot;</span><span class="punctuation">,</span> fitType <span class="operator">=</span> <span class="string">&quot;parametric&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Species level</span></span><br><span class="line">geo.mean <span class="operator">=</span> apply<span class="punctuation">(</span>counts<span class="punctuation">(</span>spec_dds<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> gm.mean<span class="punctuation">)</span></span><br><span class="line">spec_dds <span class="operator">=</span> estimateSizeFactors<span class="punctuation">(</span>spec_dds<span class="punctuation">,</span> geoMeans <span class="operator">=</span> geo.mean<span class="punctuation">)</span></span><br><span class="line">spec_dds <span class="operator">&lt;-</span>DESeq<span class="punctuation">(</span>spec_dds<span class="punctuation">,</span> test <span class="operator">=</span> <span class="string">&quot;Wald&quot;</span><span class="punctuation">,</span> fitType <span class="operator">=</span> <span class="string">&quot;parametric&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="6-3-可视化-DESeq-结果：瀑布图和火山图"><a href="#6-3-可视化-DESeq-结果：瀑布图和火山图" class="headerlink" title="6.3. 可视化 DESeq 结果：瀑布图和火山图"></a>6.3. 可视化 DESeq 结果：瀑布图和火山图</h5><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggrepel<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Waterfall plot for phylum</span></span><br><span class="line"></span><br><span class="line">sigtabspec <span class="operator">=</span> results<span class="punctuation">(</span>spec_dds<span class="punctuation">,</span> contrast <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;group&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;A&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">              data.frame<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">              filter<span class="punctuation">(</span>padj <span class="operator">&lt;=</span><span class="number">0.05</span><span class="punctuation">,</span> <span class="built_in">abs</span><span class="punctuation">(</span>log2FoldChange<span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">7</span> <span class="punctuation">)</span> </span><br><span class="line">sigtabspec<span class="operator">$</span>Order <span class="operator">&lt;-</span> tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">[</span>rownames<span class="punctuation">(</span>tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>sigtabspec<span class="punctuation">)</span><span class="punctuation">]</span> </span><br><span class="line">sigtabspec<span class="operator">$</span>Species <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sigtabspec<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#plotting for the phylum alone</span></span><br><span class="line"></span><br><span class="line">spec_col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span> <span class="string">&quot;deepskyblue&quot;</span><span class="punctuation">,</span><span class="string">&#x27;springgreen3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;snow3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;burlywood4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cadetblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;darkblue&#x27;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&#x27;cornflowerblue&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;deeppink2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;orangered&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dimgrey&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;limegreen&#x27;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&#x27;cyan1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;darkmagenta&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gold&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#470e19&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#124435&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#1d723f&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#57e9ff&#x27;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">colindex <span class="operator">=</span> data.frame<span class="punctuation">(</span>color <span class="operator">=</span> spec_col<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>sigtabspec<span class="operator">$</span>Order<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">                      Order <span class="operator">=</span> sort<span class="punctuation">(</span>unique<span class="punctuation">(</span>sigtabspec<span class="operator">$</span>Order<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ords <span class="operator">=</span> unique<span class="punctuation">(</span>data.frame<span class="punctuation">(</span>sigtabspec<span class="operator">$</span>Order<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> pull</span><br><span class="line">colors <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> ords<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">   colors<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">=</span> colindex<span class="punctuation">[</span>colindex<span class="operator">$</span>Order <span class="operator">==</span> i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Phylum order</span></span><br><span class="line">x <span class="operator">=</span> tapply<span class="punctuation">(</span>sigtabspec<span class="operator">$</span>log2FoldChange<span class="punctuation">,</span> sigtabspec<span class="operator">$</span>Order<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="built_in">max</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">x <span class="operator">=</span> sort<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">sigtabspec<span class="operator">$</span>Order <span class="operator">=</span> factor<span class="punctuation">(</span><span class="built_in">as.character</span><span class="punctuation">(</span>sigtabspec<span class="operator">$</span>Order<span class="punctuation">)</span><span class="punctuation">,</span> levels<span class="operator">=</span><span class="built_in">names</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Species reorder</span></span><br><span class="line">x <span class="operator">=</span> tapply<span class="punctuation">(</span>sigtabspec<span class="operator">$</span>log2FoldChange<span class="punctuation">,</span> sigtabspec<span class="operator">$</span>Species<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="built_in">max</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">x <span class="operator">=</span> sort<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">sigtabspec<span class="operator">$</span>Species <span class="operator">=</span> factor<span class="punctuation">(</span><span class="built_in">as.character</span><span class="punctuation">(</span>sigtabspec<span class="operator">$</span>Species<span class="punctuation">)</span><span class="punctuation">,</span> levels<span class="operator">=</span><span class="built_in">names</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">waterfall_p <span class="operator">=</span> ggplot<span class="punctuation">(</span>sigtabspec<span class="punctuation">,</span> aes<span class="punctuation">(</span>y<span class="operator">=</span>Species<span class="punctuation">,</span> x<span class="operator">=</span>log2FoldChange<span class="punctuation">)</span><span class="punctuation">,</span> stroke <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0.0</span><span class="punctuation">,</span> </span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> Order<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> </span><br><span class="line">  color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> stroke <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">           scale_x_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">20</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> n.breaks <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">           ggtitle<span class="punctuation">(</span><span class="string">&quot;Log2FoldChange of Species&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mock vs. A&quot;</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">        scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> colors<span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>colors<span class="punctuation">)</span> <span class="operator">%in%</span> sigtabspec<span class="operator">$</span>Order<span class="punctuation">]</span><span class="punctuation">)</span> </span><br><span class="line">           </span><br><span class="line"><span class="comment">#ggsave(&quot;./deseq2/mucus/difabund_muc_DiarNoInfl_vs_NoDiar.jpeg&quot;, device = &quot;jpeg&quot;, dpi = 300)</span></span><br><span class="line"></span><br><span class="line">waterfall_p</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">rm<span class="punctuation">(</span>sigtabphyl<span class="punctuation">,</span> alpha<span class="punctuation">,</span> x<span class="punctuation">,</span> colors<span class="punctuation">,</span> colindex<span class="punctuation">,</span> phyla<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Volcano plot</span></span><br><span class="line"></span><br><span class="line">alpha <span class="operator">=</span> <span class="number">0.05</span></span><br><span class="line">spec_dat <span class="operator">=</span> results<span class="punctuation">(</span>spec_dds<span class="punctuation">,</span> contrast <span class="operator">=</span>  <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;group&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;A&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">%&gt;%</span> data.frame</span><br><span class="line"></span><br><span class="line">spec_dat <span class="operator">=</span> spec_dat<span class="punctuation">[</span>complete.cases<span class="punctuation">(</span>spec_dat<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">spec_dat<span class="operator">$</span>Significant <span class="operator">=</span> ifelse<span class="punctuation">(</span>spec_dat<span class="operator">$</span>padj <span class="operator">&lt;=</span> alpha<span class="punctuation">,</span> paste0<span class="punctuation">(</span><span class="string">&quot;FDR &lt; &quot;</span><span class="punctuation">,</span> alpha<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;Not Sig&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">factor<span class="punctuation">(</span>levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;FDR &lt; 0.05&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Not Sig&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line">spec_taxa <span class="operator">=</span> tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.matrix</span><br><span class="line"></span><br><span class="line">sigtabspec <span class="operator">=</span> cbind<span class="punctuation">(</span>as<span class="punctuation">(</span>spec_dat<span class="punctuation">,</span> <span class="string">&quot;data.frame&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                   as<span class="punctuation">(</span>spec_taxa<span class="punctuation">[</span>rownames<span class="punctuation">(</span>spec_taxa<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>spec_dat<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#a costumized color scheme</span></span><br><span class="line">phylcol<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;coral4&#x27;</span><span class="punctuation">,</span> <span class="string">&quot;deeppink&quot;</span><span class="punctuation">,</span><span class="string">&#x27;brown2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;antiquewhite4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cornflowerblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;plum4&#x27;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&#x27;darkgoldenrod3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;aquamarine4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;darkblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Maroon&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Gray&#x27;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&#x27;steelblue2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;darkgreen&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;tomato1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;magenta&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">colindex <span class="operator">=</span> data.frame<span class="punctuation">(</span>color <span class="operator">=</span> phylcol<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> phylum <span class="operator">=</span> sort<span class="punctuation">(</span>unique<span class="punctuation">(</span>tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">phyla <span class="operator">=</span> unique<span class="punctuation">(</span>data.frame<span class="punctuation">(</span>tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> pull</span><br><span class="line">colors <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> phyla<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">   colors<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">=</span> colindex<span class="punctuation">[</span>colindex<span class="operator">$</span>Phylum <span class="operator">==</span> i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#filtering out the taxa below 2 LFC</span></span><br><span class="line"><span class="comment">#sigtabspec = sigtabspec[abs(sigtabspec$log2FoldChange)&gt;2,]</span></span><br><span class="line"></span><br><span class="line">volc_p <span class="operator">=</span> sigtabspec <span class="operator">%&gt;%</span> group_by<span class="punctuation">(</span>log2FoldChange<span class="punctuation">)</span> <span class="operator">%&gt;%</span> arrange<span class="punctuation">(</span>desc<span class="punctuation">(</span>log2FoldChange<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">ggplot<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FoldChange<span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>pvalue<span class="punctuation">)</span><span class="punctuation">,</span> label <span class="operator">=</span> Genus<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>sigtabspec<span class="punctuation">[</span>sigtabspec<span class="operator">$</span>Significant <span class="operator">==</span> <span class="string">&quot;Not Sig&quot;</span><span class="punctuation">,</span><span class="string">&quot;pvalue&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span>  <span class="operator">%&gt;%</span> </span><br><span class="line">           <span class="built_in">max</span><span class="punctuation">,</span> color <span class="operator">=</span> alpha<span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> color <span class="operator">=</span> alpha<span class="punctuation">(</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>data <span class="operator">=</span> sigtabspec<span class="punctuation">[</span>sigtabspec<span class="operator">$</span>Significant <span class="operator">==</span> <span class="string">&quot;Not Sig&quot;</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">           aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FoldChange<span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>pvalue<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">           color <span class="operator">=</span> alpha<span class="punctuation">(</span><span class="string">&quot;darkgreen&quot;</span><span class="punctuation">,</span> <span class="number">0.6</span><span class="punctuation">)</span><span class="punctuation">,</span>  size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span>  <span class="operator">+</span> </span><br><span class="line">theme_bw<span class="punctuation">(</span>base_size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">theme<span class="punctuation">(</span>legend.position<span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_point<span class="punctuation">(</span>data <span class="operator">=</span> sigtabspec<span class="punctuation">[</span>sigtabspec<span class="operator">$</span>Significant <span class="operator">==</span> <span class="string">&quot;FDR &lt; 0.05&quot;</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FoldChange<span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>pvalue<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        fill <span class="operator">=</span> Phylum<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>  </span><br><span class="line">        color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> stroke <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> colors<span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>colors<span class="punctuation">)</span> <span class="operator">%in%</span> </span><br><span class="line">                sigtabspec<span class="punctuation">[</span>sigtabspec<span class="operator">$</span>Significant <span class="operator">==</span> <span class="string">&quot;FDR &lt; 0.05&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Phylum&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_text_repel<span class="punctuation">(</span> nudge_y <span class="operator">=</span> <span class="number">0.15</span><span class="punctuation">,</span> nudge_x <span class="operator">=</span> <span class="operator">-</span><span class="number">.5</span><span class="punctuation">,</span> </span><br><span class="line">               data<span class="operator">=</span> top_n<span class="punctuation">(</span>sigtabspec<span class="punctuation">[</span>sigtabspec<span class="operator">$</span>Significant <span class="operator">==</span> <span class="string">&quot;FDR &lt; 0.05&quot;</span> <span class="operator">&amp;</span> sigtabspec<span class="operator">$</span>log2FoldChange <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">               n <span class="operator">=</span>  <span class="operator">-</span><span class="number">10</span><span class="punctuation">,</span> wt <span class="operator">=</span> pvalue<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               aes<span class="punctuation">(</span>label <span class="operator">=</span> Genus<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">               size <span class="operator">=</span> <span class="number">2.5</span><span class="punctuation">,</span> </span><br><span class="line">               box.padding <span class="operator">=</span> unit<span class="punctuation">(</span> <span class="number">0.4</span><span class="punctuation">,</span> units <span class="operator">=</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               point.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> max.overlaps <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span>  <span class="operator">+</span> </span><br><span class="line">geom_text_repel<span class="punctuation">(</span>nudge_y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> nudge_x <span class="operator">=</span><span class="number">0.5</span><span class="punctuation">,</span> </span><br><span class="line">               data<span class="operator">=</span> top_n<span class="punctuation">(</span>sigtabspec<span class="punctuation">[</span>sigtabspec<span class="operator">$</span>Significant <span class="operator">==</span> <span class="string">&quot;FDR &lt; 0.05&quot;</span> <span class="operator">&amp;</span> sigtabspec<span class="operator">$</span>log2FoldChange <span class="operator">&gt;</span> <span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">               <span class="operator">-</span><span class="number">10</span><span class="punctuation">,</span> pvalue<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">               aes<span class="punctuation">(</span>label <span class="operator">=</span> Genus<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> </span><br><span class="line">               box.padding <span class="operator">=</span> unit<span class="punctuation">(</span> <span class="number">0.4</span><span class="punctuation">,</span> units <span class="operator">=</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               point.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> max.overlaps <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">geom_text<span class="punctuation">(</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> y <span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&quot;Not Sig&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> y <span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&quot;FDR &lt; 0.05&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2.5</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">ggtitle <span class="punctuation">(</span>label <span class="operator">=</span> <span class="string">&quot;Volcano Plot of the top 10 most significant log2FoldChange&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Species in Mock vs. A groups&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> n.breaks <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">7.5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> n.breaks <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">guides<span class="punctuation">(</span>size <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line">volc_p</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ggsave(&quot;./deseq2/mucus/volc_gen_DiarNoInfl_vs_NoDiar_muc.jpeg&quot;, device = &quot;jpeg&quot;, dpi = 300)</span></span><br></pre></td></tr></table></figure>

<h4 id="7-生物标志物和分类单元数据之间的热图关联"><a href="#7-生物标志物和分类单元数据之间的热图关联" class="headerlink" title="7. 生物标志物和分类单元数据之间的热图关联"></a>7. 生物标志物和分类单元数据之间的热图关联</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#correlation heatmap between biomarker and the Genus</span></span><br><span class="line">gen <span class="operator">&lt;-</span> gloomer<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> taxa_level <span class="operator">=</span> <span class="string">&quot;Genus&quot;</span><span class="punctuation">,</span> NArm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gen_log <span class="operator">=</span> filter_taxa<span class="punctuation">(</span>gen<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="built_in">sum</span><span class="punctuation">(</span>x<span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment">#filtering the zero counts out</span></span><br><span class="line">gen_log <span class="operator">=</span> transform_sample_counts<span class="punctuation">(</span>gen_log<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span><span class="built_in">log</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">+</span>x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating dummy variables                                       </span></span><br><span class="line">biodf <span class="operator">=</span> sample_data<span class="punctuation">(</span>gen_log<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">biodf <span class="operator">=</span> data.frame<span class="punctuation">(</span>biodf<span class="punctuation">,</span> geneA <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">87</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">          geneB <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">87</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">          geneC <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">87</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">0.005</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">          select<span class="punctuation">(</span><span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">          as.matrix<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">                     </span><br><span class="line">countdf <span class="operator">=</span> as.matrix<span class="punctuation">(</span>otu_table<span class="punctuation">(</span>gen_log<span class="punctuation">)</span><span class="punctuation">)</span>       </span><br><span class="line"> </span><br><span class="line">countdf <span class="operator">=</span> countdf<span class="punctuation">[</span><span class="operator">!</span>rownames<span class="punctuation">(</span>countdf<span class="punctuation">)</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Unknown&quot;</span><span class="punctuation">,</span> <span class="string">&quot;uncultured&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Uncultured&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Unassigned&quot;</span><span class="punctuation">,</span> <span class="string">&quot;NA&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> </span><br><span class="line">                                  </span><br><span class="line">countdf <span class="operator">=</span> t<span class="punctuation">(</span>countdf<span class="punctuation">)</span>  </span><br><span class="line">countdf <span class="operator">=</span> countdf<span class="punctuation">[</span>rownames<span class="punctuation">(</span>countdf<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>biodf<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment">#cor gene taxa</span></span><br><span class="line"></span><br><span class="line">cor_main <span class="operator">=</span> Hmisc<span class="operator">::</span>rcorr<span class="punctuation">(</span>countdf<span class="punctuation">,</span> biodf<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;spearman&quot;</span><span class="punctuation">)</span></span><br><span class="line">cors <span class="operator">=</span> cor_main<span class="operator">$</span>r</span><br><span class="line">cors <span class="operator">=</span> cors<span class="punctuation">[</span>rownames<span class="punctuation">(</span>cors<span class="punctuation">)</span> <span class="operator">%in%</span> colnames<span class="punctuation">(</span>countdf<span class="punctuation">)</span><span class="punctuation">,</span> colnames<span class="punctuation">(</span>cors<span class="punctuation">)</span> <span class="operator">%in%</span> colnames<span class="punctuation">(</span>biodf<span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment">#rows as taxa, cols as chemical data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#calculating the qvalues for the correlations</span></span><br><span class="line">cor.pval <span class="operator">=</span> cor_main<span class="operator">$</span>P<span class="punctuation">[</span>rownames<span class="punctuation">(</span>cor_main<span class="operator">$</span>P<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>cors<span class="punctuation">)</span> <span class="punctuation">,</span> colnames<span class="punctuation">(</span>cor_main<span class="operator">$</span>P<span class="punctuation">)</span> <span class="operator">%in%</span> colnames<span class="punctuation">(</span>cors<span class="punctuation">)</span><span class="punctuation">]</span> </span><br><span class="line">cor.qval <span class="operator">=</span> p.adjust<span class="punctuation">(</span>cor.pval<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;BH&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">q.vals <span class="operator">=</span> matrix<span class="punctuation">(</span>cor.qval<span class="punctuation">,</span> ncol <span class="operator">=</span> ncol<span class="punctuation">(</span>cor.pval<span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> nrow<span class="punctuation">(</span>cor.pval<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">dimnames</span> <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>rownames<span class="punctuation">(</span>cor.pval<span class="punctuation">)</span><span class="punctuation">,</span> colnames<span class="punctuation">(</span>cor.pval<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                     </span><br><span class="line"><span class="comment">#Adding significance signes to the qval matrix to be used in the heatmap later on</span></span><br><span class="line">q.vals<span class="punctuation">[</span>cor.qval <span class="operator">&lt;</span><span class="number">0.05</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">q.vals<span class="punctuation">[</span>cor.qval <span class="operator">&gt;=</span> <span class="number">0.05</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>Biobase<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">asvdat <span class="operator">=</span> as<span class="punctuation">(</span>cors<span class="punctuation">,</span><span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span><span class="comment">#in the aassay dataset, we add our correlation matrix instead of the abundance matrix</span></span><br><span class="line"></span><br><span class="line">taxadat <span class="operator">=</span> Biobase<span class="operator">::</span>AnnotatedDataFrame<span class="punctuation">(</span>data.frame<span class="punctuation">(</span>cors<span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#taxa table</span></span><br><span class="line">pdata <span class="operator">=</span> cors <span class="operator">%&gt;%</span> data.frame</span><br><span class="line"></span><br><span class="line">x <span class="operator">=</span> ExpressionSet<span class="punctuation">(</span>assayData <span class="operator">=</span> asvdat<span class="punctuation">,</span>  featureData <span class="operator">=</span> taxadat  <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Adding phenotype data</span></span><br><span class="line">pData<span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">&lt;-</span> pdata          </span><br><span class="line"></span><br><span class="line"><span class="comment"># Filtering based on row standard deviation and choosing the most variable 50 taxa</span></span><br><span class="line">library<span class="punctuation">(</span>matrixStats<span class="punctuation">)</span></span><br><span class="line">sds <span class="operator">&lt;-</span> rowSds<span class="punctuation">(</span>Biobase<span class="operator">::</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">o <span class="operator">&lt;-</span> order<span class="punctuation">(</span>sds<span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">50</span><span class="punctuation">]</span></span><br><span class="line">h_1 <span class="operator">&lt;-</span> hclust<span class="punctuation">(</span>dist<span class="punctuation">(</span>Biobase<span class="operator">::</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span>o<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;ward.D2&quot;</span><span class="punctuation">)</span></span><br><span class="line">h_2 <span class="operator">&lt;-</span> hclust<span class="punctuation">(</span>dist<span class="punctuation">(</span>t<span class="punctuation">(</span>Biobase<span class="operator">::</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span>o<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;ward.D2&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#making a phylum annotation and it only accepts one column dataframe</span></span><br><span class="line"></span><br><span class="line">row.annot <span class="operator">=</span> gen_log<span class="operator">@</span>tax_table<span class="punctuation">[</span>rownames<span class="punctuation">(</span>gen_log<span class="operator">@</span>tax_table<span class="punctuation">)</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>Biobase<span class="operator">::</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span>o<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#making color index for the phylum annotation </span></span><br><span class="line"></span><br><span class="line">phylcol<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;coral4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#ff00aa&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;tomato1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cornflowerblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;plum4&#x27;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&#x27;darkgoldenrod3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;aquamarine4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cadetblue2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;darkblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Maroon&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Gray&#x27;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&#x27;steelblue2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;darkmagenta&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;antiquewhite4&#x27;</span><span class="punctuation">,</span> <span class="string">&quot;darkorange&quot;</span><span class="punctuation">,</span> <span class="string">&#x27;darkgreen&#x27;</span><span class="punctuation">)</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">phylcol <span class="operator">=</span> sample<span class="punctuation">(</span>phylcol<span class="punctuation">,</span> size <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>row.annot<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">phyl.col <span class="operator">=</span> data.frame<span class="punctuation">(</span>Phylum <span class="operator">=</span> unique<span class="punctuation">(</span>row.annot<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> phyl.col <span class="operator">=</span> phylcol<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>row.annot<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>phyl.col<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">phyl.col <span class="operator">=</span> column_to_rownames<span class="punctuation">(</span>phyl.col<span class="punctuation">,</span> <span class="string">&quot;Phylum&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> as.matrix</span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">mat <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> nrow <span class="operator">=</span> nrow<span class="punctuation">(</span>row.annot<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>row.annot<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"> mat<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">=</span> ifelse<span class="punctuation">(</span>row.annot<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">%in%</span> rownames<span class="punctuation">(</span>phyl.col<span class="punctuation">)</span><span class="punctuation">,</span> phyl.col<span class="punctuation">[</span>rownames<span class="punctuation">(</span>phyl.col<span class="punctuation">)</span> <span class="operator">%in%</span> row.annot<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;NA&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">colnames<span class="punctuation">(</span>mat<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="string">&quot;col&quot;</span></span><br><span class="line"></span><br><span class="line">row.annot <span class="operator">=</span> cbind<span class="punctuation">(</span>row.annot<span class="punctuation">,</span> mat<span class="punctuation">)</span> <span class="operator">%&gt;%</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pheatmap<span class="punctuation">(</span>Biobase<span class="operator">::</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span>o<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span> annotation_row <span class="operator">=</span> row.annot <span class="operator">%&gt;%</span> select<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                          cellheight <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> annotation_colors <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">                            Phylum <span class="operator">=</span> phyl.col<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                           cellwidth <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> cutree_rows <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> border_color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> </span><br><span class="line">                           fontsize_number <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> number_color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                           display_numbers <span class="operator">=</span> q.vals<span class="punctuation">[</span>rownames<span class="punctuation">(</span>q.vals<span class="punctuation">)</span> <span class="operator">%in%</span> </span><br><span class="line">                           rownames<span class="punctuation">(</span>Biobase<span class="operator">::</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span>o<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> colnames<span class="punctuation">(</span>q.vals<span class="punctuation">)</span> <span class="operator">%in%</span> </span><br><span class="line">                           colnames<span class="punctuation">(</span>exprs<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span>o<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> angle_col <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span></span><br><span class="line">                           Rowv <span class="operator">=</span> as.dendrogram<span class="punctuation">(</span>h_1<span class="punctuation">)</span><span class="punctuation">,</span> Colv <span class="operator">=</span> as.dendrogram<span class="punctuation">(</span>h_2<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                           cutcluster_rows <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> cluster_cols <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> col <span class="operator">=</span> brewer.pal<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> <span class="string">&quot;Reds&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                           width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Spearman correlation of top 50 Genre \nand 3 Genes, clustered row &quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ggsave(plot = pheat.chem.scfa, &quot;./heatmap/heatmap.SCFA.gen_50.jpeg&quot;, dpi = 750, height = 10, width = 8)</span></span><br></pre></td></tr></table></figure>
<p>在原假设下，p 值是具有均匀分布的随机值。因此，我们必须执行调整后的 p 值来校正族错误率 (FWER)。FWER 是指同时进行多个假设检验时至少出现一个 I 类错误（误报）的概率。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Set the parameters</span></span><br><span class="line">num_simulations <span class="operator">&lt;-</span> 10000  <span class="comment"># Number of simulated datasets</span></span><br><span class="line">sample_size <span class="operator">&lt;-</span> 50         <span class="comment"># Sample size for each group</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize a vector to store p-values</span></span><br><span class="line">simulated_p_values <span class="operator">&lt;-</span> numeric<span class="punctuation">(</span>num_simulations<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate data and compute p-values</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>num_simulations<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment"># Simulate data under the null hypothesis for two groups</span></span><br><span class="line">  group1 <span class="operator">&lt;-</span> rnorm<span class="punctuation">(</span>sample_size<span class="punctuation">)</span></span><br><span class="line">  group2 <span class="operator">&lt;-</span> rnorm<span class="punctuation">(</span>sample_size<span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Perform a two-sample t-test on the simulated data</span></span><br><span class="line">  test_result <span class="operator">&lt;-</span> t.test<span class="punctuation">(</span>group1<span class="punctuation">,</span> group2<span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Store the p-value</span></span><br><span class="line">  simulated_p_values<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> test_result<span class="operator">$</span>p.value</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot a histogram of simulated p-values</span></span><br><span class="line">hist<span class="punctuation">(</span>simulated_p_values<span class="punctuation">,</span> breaks <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;lightblue&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Distribution of Simulated P-values under Null hypothesis&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">print<span class="punctuation">(</span>glue<span class="punctuation">(</span><span class="string">&quot;&#123;sum(simulated_p_values&lt;=0.05)&#125; of the tests out of 10000 test were significant. \n This indicates that under the Null hypothesis alpha % of times your test will be rendered false positive (type-I error).&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 515 of the tests out of 10000 test were significant. </span></span><br><span class="line"><span class="comment">## This indicates that under the Null hypothesis alpha % of times your test will be rendered false positive (type-I error).</span></span><br></pre></td></tr></table></figure>

<h4 id="8-系统发育树可视化"><a href="#8-系统发育树可视化" class="headerlink" title="8. 系统发育树可视化"></a>8. 系统发育树可视化</h4><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>phytools<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>TDbook<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggimage<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>treeio<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tidytree<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">spec <span class="operator">&lt;-</span> gloomer<span class="punctuation">(</span>ps_rar<span class="punctuation">,</span> taxa_level <span class="operator">=</span> <span class="string">&quot;Class&quot;</span><span class="punctuation">)</span></span><br><span class="line">spec <span class="operator">&lt;-</span> transform_sample_counts<span class="punctuation">(</span>spec<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span>x<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line">spec <span class="operator">&lt;-</span> prune_taxa<span class="punctuation">(</span>taxa_sums<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">1</span><span class="punctuation">,</span> spec<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">taxadf <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">color.index <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#771155&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#AA4488&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#CC99BB&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#114477&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#4477AA&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#77AADD&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#117777&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#44AAAA&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#77CCCC&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#117744&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#44AA77&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#88CCAA&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#777711&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#AAAA44&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#DDDD77&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#774411&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#AA7744&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#DDAA77&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#771122&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#AA4455&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#DD7788&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#creating a highlihgt df with a costum function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mrca.wrap <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>highlight<span class="punctuation">,</span> taxa.df<span class="punctuation">,</span> tree<span class="punctuation">,</span> tax_level<span class="operator">=</span><span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> type.id <span class="operator">=</span> <span class="string">&quot;node&quot;</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">taxa <span class="operator">&lt;-</span> taxa.df <span class="operator">%&gt;%</span> data.frame </span><br><span class="line">node.id <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> phyls<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  node.id<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> findMRCA<span class="punctuation">(</span>tree<span class="punctuation">,</span> tree<span class="operator">$</span>tip.label<span class="punctuation">[</span>taxa<span class="punctuation">[</span><span class="punctuation">,</span>tax_level<span class="punctuation">]</span> <span class="operator">==</span> i<span class="punctuation">]</span><span class="punctuation">,</span> type <span class="operator">=</span> type.id<span class="punctuation">)</span> </span><br><span class="line">    node.df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>phyl <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>node.id<span class="punctuation">)</span><span class="punctuation">,</span> node.id <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>node.id<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">    node.id <span class="operator">=</span> node.id <span class="operator">=</span> as<span class="punctuation">(</span>node.id<span class="punctuation">,</span><span class="string">&quot;matrix&quot;</span><span class="punctuation">)</span></span><br><span class="line">    node.df <span class="operator">=</span> data.frame<span class="punctuation">(</span>highlights <span class="operator">=</span> rownames<span class="punctuation">(</span>node.id<span class="punctuation">)</span><span class="punctuation">,</span> node.id <span class="operator">=</span> unlist<span class="punctuation">(</span>node.id<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    <span class="built_in">return</span><span class="punctuation">(</span>node.df<span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">ps_mock <span class="operator">=</span> phyloseq<span class="operator">::</span>subset_samples<span class="punctuation">(</span>spec<span class="punctuation">,</span> group <span class="operator">==</span> <span class="string">&quot;Mock&quot;</span><span class="punctuation">)</span> </span><br><span class="line">phyls <span class="operator">=</span> tax_table<span class="punctuation">(</span>ps_mock<span class="punctuation">)</span><span class="punctuation">[</span>rowSums<span class="punctuation">(</span>ps_mock<span class="operator">@</span>otu_table<span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">0</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> distinct<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> pull<span class="punctuation">(</span><span class="punctuation">)</span><span class="comment">#chosoing phylum that that are in Mock samples</span></span><br><span class="line"></span><br><span class="line">node.df <span class="operator">&lt;-</span> mrca.wrap<span class="punctuation">(</span>highlight <span class="operator">=</span> phyls<span class="punctuation">,</span> </span><br><span class="line">          taxa.df <span class="operator">=</span> tax_table<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">          tree <span class="operator">=</span> phy_tree<span class="punctuation">(</span>spec<span class="punctuation">)</span><span class="punctuation">,</span> tax_level <span class="operator">=</span> <span class="string">&quot;Phylum&quot;</span><span class="punctuation">,</span> </span><br><span class="line">          type <span class="operator">=</span> <span class="string">&quot;node&quot;</span><span class="punctuation">)</span></span><br><span class="line">          </span><br><span class="line"></span><br><span class="line"><span class="comment">#drwing the tree</span></span><br><span class="line">tree_p <span class="operator">=</span>  ggtree<span class="punctuation">(</span>spec<span class="punctuation">,</span> aes<span class="punctuation">(</span>color <span class="operator">=</span> Phylum<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">branch.length <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">layout <span class="operator">=</span> <span class="string">&quot;circular&quot;</span><span class="punctuation">,</span></span><br><span class="line">show.legend <span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">open.angle <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span>  <span class="operator">+</span>  </span><br><span class="line">ggtitle<span class="punctuation">(</span><span class="string">&quot;Phylogenetic tree of different Classes.&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="string">&quot;Mock comunity phyla are highligted!&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_tiplab<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>Class<span class="punctuation">,</span> color <span class="operator">=</span> Phylum<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">check.overlap <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> </span><br><span class="line">face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> </span><br><span class="line">size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> </span><br><span class="line">offset <span class="operator">=</span> <span class="number">0.3</span></span><br><span class="line"><span class="punctuation">)</span>  <span class="operator">+</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> sample<span class="punctuation">(</span>color.index<span class="punctuation">,</span> </span><br><span class="line">                    <span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>taxadf<span class="operator">$</span>Phylum<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                    breaks <span class="operator">=</span> unique<span class="punctuation">(</span>taxadf<span class="operator">$</span>Phylum<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#to remove the NA from the legend</span></span><br><span class="line">geom_highlight<span class="punctuation">(</span>data <span class="operator">=</span> node.df<span class="punctuation">,</span> </span><br><span class="line">lwd <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span>  alpha <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span></span><br><span class="line">aes<span class="punctuation">(</span>node <span class="operator">=</span> node.id<span class="punctuation">,</span> fill <span class="operator">=</span> highlights<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">extend <span class="operator">=</span><span class="number">0.05</span><span class="punctuation">,</span> to.bottom <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> </span><br><span class="line">align <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_nodepoint<span class="punctuation">(</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_nodepoint<span class="punctuation">(</span>aes<span class="punctuation">(</span>subset <span class="operator">=</span> node <span class="operator">%in%</span> node.df<span class="operator">$</span>node.id<span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> </span><br><span class="line">fill <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#00ffff&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#ff7700&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_tippoint<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span>  color <span class="operator">=</span> alpha<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> branch<span class="punctuation">,</span> label <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>branch.length<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">label.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.05</span><span class="punctuation">,</span> <span class="string">&quot;line&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> inherit.aes <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span> <span class="string">&quot;#16f476&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#fc00fc&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># geom_cladelab(node = node.df$node.id, align = FALSE,</span></span><br><span class="line"><span class="comment"># label = node.df$highlights,</span></span><br><span class="line"><span class="comment">#  offset.text = 0.25, </span></span><br><span class="line"><span class="comment">#  offset = 16,</span></span><br><span class="line"><span class="comment">#  barsize = 0.05, </span></span><br><span class="line"><span class="comment">#  extend = 0.01,</span></span><br><span class="line"><span class="comment">#  angle =&quot;auto&quot;,</span></span><br><span class="line"><span class="comment">#  fontface = 2, size = 7) +</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Plotting abundance on tree</span></span><br><span class="line">rel.df <span class="operator">&lt;-</span> psmelt<span class="punctuation">(</span>spec<span class="punctuation">)</span> <span class="operator">%&gt;%</span> select<span class="punctuation">(</span>OTU<span class="punctuation">,</span> Abundance<span class="punctuation">,</span> group<span class="punctuation">)</span> <span class="operator">%&gt;%</span> group_by<span class="punctuation">(</span> OTU<span class="punctuation">,</span> group<span class="punctuation">)</span> <span class="operator">%&gt;%</span> summarise<span class="punctuation">(</span>rel <span class="operator">=</span> mean<span class="punctuation">(</span>Abundance<span class="punctuation">)</span><span class="punctuation">,</span> .groups <span class="operator">=</span> <span class="string">&quot;drop&quot;</span><span class="punctuation">)</span>  <span class="operator">%&gt;%</span> pivot_wider<span class="punctuation">(</span>values_from <span class="operator">=</span> <span class="string">&quot;rel&quot;</span><span class="punctuation">,</span> id_cols <span class="operator">=</span> <span class="string">&quot;OTU&quot;</span><span class="punctuation">,</span> names_from <span class="operator">=</span> <span class="string">&quot;group&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> column_to_rownames<span class="punctuation">(</span> <span class="string">&quot;OTU&quot;</span><span class="punctuation">)</span></span><br><span class="line">rescaled.reldf <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>rel.df<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span><span class="built_in">log</span><span class="punctuation">(</span>x<span class="operator">+</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggnewscale<span class="punctuation">,</span> verbose <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> tree_p <span class="operator">+</span> new_scale_fill<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">p3 <span class="operator">&lt;-</span> gheatmap<span class="punctuation">(</span>p2<span class="punctuation">,</span> font.size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span>  rescaled.reldf<span class="punctuation">,</span> offset<span class="operator">=</span><span class="number">6.04</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">.8</span><span class="punctuation">,</span> </span><br><span class="line">         colnames_angle<span class="operator">=</span><span class="number">60</span><span class="punctuation">,</span> colnames_offset_y <span class="operator">=</span> <span class="operator">-</span><span class="number">.45</span><span class="punctuation">,</span> colnames_position <span class="operator">=</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_fill_viridis_c<span class="punctuation">(</span>option<span class="operator">=</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span> name<span class="operator">=</span><span class="string">&quot;Log relative abundance, %&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p3</span><br></pre></td></tr></table></figure>

<p>原文链接和<a target="_blank" rel="noopener" href="https://github.com/farhadm1990/MAC2023.github.io">Github存储库位置</a></p>

  </div>
  
    <div class='div-ori-link'>
      <a class='ori-link' href='/16s-long-analysis'>
        去源站阅读
      </a>
    </div>
  
  
    
    <div class='footer'>
       <!-- 参考资料、相关资料等 -->
      
       <!-- 相关文章 -->
      
      <!-- 版权声明组件 -->
      
        
          <div class='copyright'>
            <blockquote>
              
                
                  <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

                
              
                
                  <p>本文永久链接是：<a href="https://blog.xiaohanys.xyz/undefined/">https://blog.xiaohanys.xyz/undefined/</a></p>
                
              
            </blockquote>
          </div>
        
      
      <!-- 打赏组件 -->
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateModified" datetime="2024-10-18T11:36:37+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2024年10月18日</p>
  </a>
</div>

        
      
        
          
  
  
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>生物信息</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/R%E8%AF%AD%E8%A8%80/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>R语言</p></a></div>
  <span hidden itemprop="keywords">生物信息 R语言</span>
  


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.xiaohanys.xyz/undefined/&title=16S rRNA基因扩增子分析 - XiaoHanys&summary=在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qq.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.xiaohanys.xyz/undefined/&title=16S rRNA基因扩增子分析 - XiaoHanys&summary=在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qzone.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qzone.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.xiaohanys.xyz/undefined/&title=16S rRNA基因扩增子分析 - XiaoHanys&summary=在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/weibo.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/weibo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        
        <div class='hoverbox'>
          <a class='share'><img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/wechat.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/wechat.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></a>
          <div class='target'>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAAAAACi5bZQAAAC7UlEQVR42u3aS5LCMAwFwNz/0jMXGMr6hSCmvaMgjtVsVE++fqw/14UADBgwYMCAWQNzFdfYQV7sVz1Htx4wYMCAAQMGzD6YbiHZ/U6FnQo9/b5aDxgwYMCAAQNmL0z1INkGrAt5GywYMGDAgAED5t/BdBu+V++vfg8GDBgwYMCAAdNt8LL7VwMtMGDAgAEDBgyYbmDULTRawMdPIsGAAQMGDBgwb4PJrirUuz6X6wEDBgwYMGDArIHprqcavmpDd6wHDBgwYMCAAbMGpjtAq+4ThagO0LLvBwMGDBgwYMDshZkOjE77T/0RJ5h0nWDAgAEDBgyYNTDV4Oj0fHfw1QWONp7hBA8MGDBgwIAB83EwdzVm3SDrscAMDBgwYMCAAbMGpgvRbbDuatjKkGDAgAEDBgyYr4GJbti9GB0NrKrnCoOCAQMGDBgwYL4WJvt5KuCqNp5pWDBgwIABAwbMOpi7Gq/uwKwalGXfCwYMGDBgwIDZB5N+MPniqQNnobP1gAEDBgwYMGD2wnQ3LA+4mgFVNnA7Bm1gwIABAwYMmDUwdzVOU1DVgKt6fjBgwIABAwbMHpipA2cbwO7vuoHaWOcLBgwYMGDAgHkcphssVQvIBlDdi0TH94ABAwYMGDBgvg4m21BFAaKN4l0DvHaDBwYMGDBgwIB5HCbbgE1dMKoWMB1YgQEDBgwYMGD2w1SDpuqFo2hjmX2+vB8YMGDAgAEDZi1M9wJOtqHL/iFXcYUbSTBgwIABAwbMGpjumgqsqtDdi0xgwIABAwYMmL0wdzdM2SBrKhCrgoMBAwYMGDBg9sFMBUrZi0XVoCvbAL7tRhUYMGDAgAED5jGYbgPVHbR1B33VC0dgwIABAwYMmP8L0w28qhePpgMyMGDAgAEDBgyYqcYrPTALfv8SGgwYMGDAgAGzFqYbLHUHXlMXhqrBGhgwYMCAAQNmH8xUwBQtePq5NEB04AYGDBgwYMCA+VgYCwwYMGDAgAGzbP0C/Arl/8kgG2MAAAAASUVORK5CYII=">
          </div>
        </div>
      
    
      
    
  </div>
</div>



        
      
    </div>
    <!-- Custom Files bottomMeta begin -->
    
    <!-- Custom Files bottomMeta end -->
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/laca-16s-long/'>
          <p class='title'><i class="fa-solid fa-chevron-left" aria-hidden="true"></i>使用LACA从长扩增子中从头挑选OTU</p>
          <p class='content'>LACA是用于长扩增子一致性分析（例如 16S rRNA 基因扩增子分析）的可重复且可扩展的工作流程。它使用用snakemake管理工作流程以及conda来管理环境。



LACA的安装完整的...</p>
        </a>
      
      
        <a class='next' href='/vue-fastapi-websocket/'>
          <p class='title'>用VueJS和Fastapi通过websocket实现进度条追踪<i class="fa-solid fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>简介在我们的应用小程序中，我们是前后端分离的。前端页面只负责渲染，而后端需要处理数据。但是如果遇到数据量很大的情况下，我们处理起来就很缓慢，如果我们想通过AJAX的方法追踪后台数据变化的进度，需...</p>
        </a>
      
    </div>
  
  <!-- 文章推荐 -->
  
  
  <!-- Custom Files postEnd begin-->
  
  <!-- Custom Files postEnd end-->
</article>


  


  <article class="post white-box shadow floatable blur" id="comments">
    <span hidden>
      <meta itemprop="discussionUrl" content="/undefined/index.html#comments">
    </span>
    <p ct><i class='fa-solid fa-comments'></i> 评论</p>
    

    <div id="layoutHelper-comments"></div>

  </article>






</div>
<aside id='l_side' itemscope itemtype="https://schema.org.cn/WPSideBar">
  

  
    
    
      
    
  


<div class="widget-sticky">

  
  


<section class="widget toc-wrapper desktop mobile" id="toc-div" >
  
  <header>
    
      <i class="fa-solid fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


  <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Qiime2%E4%B8%AD%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">Qiime2中的步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%B6%E4%BD%9C%E6%B8%85%E5%8D%95%E6%96%87%E4%BB%B6%E3%80%82"><span class="toc-text">1. 制作清单文件。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E5%88%9B%E5%BB%BA%E7%9A%84%E6%B8%85%E5%8D%95%E6%96%87%E4%BB%B6%E5%B0%86%E8%AF%BB%E5%8F%96%E5%AF%BC%E5%85%A5-Qiime2"><span class="toc-text">2. 使用创建的清单文件将读取导入 Qiime2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%A3%E5%A4%8D%E7%94%A8%E8%AF%BB%E5%8F%96%E7%9A%84%E6%8E%A8%E8%AE%BA%E7%BB%9F%E8%AE%A1"><span class="toc-text">3. 可视化解复用读取的推论统计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-qiime2%E4%B8%ADDADA2%E5%8C%85%E7%9A%84%E8%BF%87%E6%BB%A4%E3%80%81%E5%8E%BB%E9%87%8D%E5%A4%8D%E3%80%81%E6%A0%B7%E6%9C%AC%E6%8E%A8%E6%96%AD%E3%80%81%E5%B5%8C%E5%90%88%E4%BD%93%E8%AF%86%E5%88%AB%E3%80%81%E5%8F%8C%E7%AB%AF%E8%AF%BB%E6%AE%B5%E5%90%88%E5%B9%B6%E3%80%82"><span class="toc-text">4. qiime2中DADA2包的过滤、去重复、样本推断、嵌合体识别、双端读段合并。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E5%8F%AF%E8%A7%86%E5%8C%96%E8%AE%A1%E6%95%B0%E8%A1%A8"><span class="toc-text">4.1. 可视化计数表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BB%A3%E8%A1%A8%E6%80%A7%E5%BA%8F%E5%88%97"><span class="toc-text">4.2. 可视化代表性序列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%8F%AF%E8%A7%86%E5%8C%96%E5%8E%BB%E5%99%AA%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="toc-text">4.3. 可视化去噪统计数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%80%9A%E8%BF%87%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%96%B9%E6%B3%95%E8%AE%AD%E7%BB%83%E5%9F%BA%E4%BA%8E%E5%BC%95%E7%89%A9%E7%9A%84%E5%8C%BA%E5%9F%9F%E7%89%B9%E5%BC%82%E6%80%A7%E5%88%86%E7%B1%BB%E5%99%A8%EF%BC%88%E5%9C%A8-Qiime2-%E4%B8%AD%EF%BC%89"><span class="toc-text">5. 通过朴素贝叶斯方法训练基于引物的区域特异性分类器（在 Qiime2 中）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E7%B1%BB%E8%A1%A8"><span class="toc-text">5.1. 可视化分类表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%BD%BF%E7%94%A8%E6%94%AF%E6%8C%81-SATE-%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%8F%91%E8%82%B2%E6%94%BE%E7%BD%AE-SEPP-%E6%96%B9%E6%B3%95%E5%88%9B%E5%BB%BA%E7%B3%BB%E7%BB%9F%E5%8F%91%E8%82%B2%E6%A0%91%E4%BB%A5%E8%BF%9B%E8%A1%8C%E5%A4%9A%E6%A0%B7%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-text">6. 使用支持 SATE 的系统发育放置 (SEPP) 方法创建系统发育树以进行多样性分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#R-%E4%B8%AD%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">R 中的步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%BA%93"><span class="toc-text">1.安装和加载库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BB%8Eqiime2%E5%AF%BC%E5%85%A5%E5%B7%A5%E4%BB%B6%E5%88%B0r"><span class="toc-text">2.从qiime2导入工件到r</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81reads%E7%9A%84%E8%BF%87%E6%BB%A4%E5%92%8C%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-text">3、reads的过滤和预处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E9%98%BF%E5%B0%94%E6%B3%95%E5%A4%9A%E6%A0%B7%E6%80%A7"><span class="toc-text">4.阿尔法多样性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E7%A8%80%E7%96%8F"><span class="toc-text">4.1. 稀疏</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-Alpha-%E5%A4%9A%E6%A0%B7%E6%80%A7%E6%8C%87%E6%A0%87"><span class="toc-text">4.2. Alpha 多样性指标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-%E5%8F%AF%E8%A7%86%E5%8C%96%CE%B1%E5%A4%9A%E6%A0%B7%E6%80%A7%E6%8C%87%E6%95%B0"><span class="toc-text">4.3.可视化α多样性指数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%B4%9D%E5%A1%94%E5%A4%9A%E6%A0%B7%E6%80%A7"><span class="toc-text">5. 贝塔多样性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E6%8E%92%E5%BA%8F%E5%9B%BE"><span class="toc-text">5.1. 排序图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gloomer%EF%BC%9A%E4%B8%80%E4%B8%AA%E5%8C%85%E8%A3%85%E2%80%9Ctax-glom-%E2%80%9D%E5%87%BD%E6%95%B0%E5%B9%B6%E5%90%91%E5%88%86%E7%B1%BB%E5%8D%95%E5%85%83%E6%B7%BB%E5%8A%A0%E7%AE%80%E6%B4%81%E5%94%AF%E4%B8%80%E5%90%8D%E7%A7%B0%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-text">Gloomer：一个包装“tax_glom()”函数并向分类单元添加简洁唯一名称的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-%E5%9F%BA%E4%BA%8E%E5%9B%BE%E8%A1%A8%E7%9A%84-beta-%E5%A4%9A%E6%A0%B7%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-text">5.2. 基于图表的 beta 多样性分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-Beta%E5%A4%9A%E6%A0%B7%E6%80%A7%E6%8C%87%E6%95%B0%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%9A%E5%9F%BA%E4%BA%8E%E8%B7%9D%E7%A6%BB%E7%9A%84%E5%86%97%E4%BD%99%E5%88%86%E6%9E%90%EF%BC%88dbRDA%EF%BC%89"><span class="toc-text">5.3. Beta多样性指数的统计分析：基于距离的冗余分析（dbRDA）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-1-%E6%A3%80%E6%9F%A5%E8%B4%A8%E5%BF%83%E5%91%A8%E5%9B%B4%E6%96%B9%E5%B7%AE%E7%9A%84%E7%A6%BB%E6%95%A3%E7%A8%8B%E5%BA%A6%EF%BC%88%E6%96%B9%E5%B7%AE%E5%90%8C%E6%BA%90%E6%A3%80%E9%AA%8C%EF%BC%89"><span class="toc-text">5.3.1. 检查质心周围方差的离散程度（方差同源检验）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-2-%E6%95%B0%E6%8D%AE%E5%BA%93RDA%E6%A8%A1%E5%9E%8B"><span class="toc-text">5.3.2. 数据库RDA模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-3-%E7%BB%98%E5%88%B6%E6%A8%A1%E5%9E%8B%E6%8F%90%E5%8F%96%E5%9B%BE"><span class="toc-text">5.3.3. 绘制模型提取图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%B7%AE%E5%BC%82%E4%B8%B0%E5%BA%A6%E5%88%86%E6%9E%90%EF%BC%9ADESeq2"><span class="toc-text">6. 差异丰度分析：DESeq2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-%E5%A0%86%E7%A7%AF%E6%9D%A1%E5%BD%A2%E5%9B%BE"><span class="toc-text">6.1. 堆积条形图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-DESeq2"><span class="toc-text">6.2. DESeq2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-%E5%8F%AF%E8%A7%86%E5%8C%96-DESeq-%E7%BB%93%E6%9E%9C%EF%BC%9A%E7%80%91%E5%B8%83%E5%9B%BE%E5%92%8C%E7%81%AB%E5%B1%B1%E5%9B%BE"><span class="toc-text">6.3. 可视化 DESeq 结果：瀑布图和火山图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E7%94%9F%E7%89%A9%E6%A0%87%E5%BF%97%E7%89%A9%E5%92%8C%E5%88%86%E7%B1%BB%E5%8D%95%E5%85%83%E6%95%B0%E6%8D%AE%E4%B9%8B%E9%97%B4%E7%9A%84%E7%83%AD%E5%9B%BE%E5%85%B3%E8%81%94"><span class="toc-text">7. 生物标志物和分类单元数据之间的热图关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E7%B3%BB%E7%BB%9F%E5%8F%91%E8%82%B2%E6%A0%91%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text">8. 系统发育树可视化</span></a></li></ol></li></ol>
  </div>
</section>

  

</div>

  <!-- Custom Files side begin -->
  
  <!-- Custom Files side end -->
</aside>



        </div>
        
  
  <footer class="footer clearfix"  itemscope itemtype="https://schema.org.cn/WPFooter">
    <br><br>
    
      
        <br>
        <div class="social-wrapper" itemprop="about" itemscope itemtype="https://schema.org.cn/Thing">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="mailto:xiaoguang.pan@bio.ku.dk"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://github.com/panxiaoguang"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://github.com/volantis-x/hexo-theme-volantis/#6.0.0-alpha.1" target="_blank" class="codename">Volantis</a>
        作为主题
      
    
      
        <div class='copyright'>
        <p>[Copyright © 2017-2024 panxiaoguang]</p>

        </div>
      
    
    <!-- Custom Files footer begin-->
    
    <!-- Custom Files footer end-->
  </footer>


        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" title="top"></a>
      </div>
    </div>
    <div>
      <script>
  /******************** volantis.dom ********************************/
  // 页面选择器 将dom对象缓存起来 see: /source/js/app.js etc.
  volantis.dom.bodyAnchor = volantis.dom.$(document.getElementById("safearea")); // 页面主体
  volantis.dom.topBtn = volantis.dom.$(document.getElementById('s-top')); // 向上
  volantis.dom.wrapper = volantis.dom.$(document.getElementById('wrapper')); // 整个导航栏
  volantis.dom.coverAnchor = volantis.dom.$(document.querySelector('#l_cover .cover-wrapper')); // 1个
  volantis.dom.switcher = volantis.dom.$(document.querySelector('#l_header .switcher .s-search')); // 搜索按钮   移动端 1个
  volantis.dom.header = volantis.dom.$(document.getElementById('l_header')); // 移动端导航栏
  volantis.dom.search = volantis.dom.$(document.querySelector('#l_header .m_search')); // 搜索框 桌面端 移动端 1个
  volantis.dom.mPhoneList = volantis.dom.$(document.querySelectorAll('#l_header .m-phone .list-v')); //  手机端 子菜单 多个
</script>

<script>
  
  volantis.css("https://unpkg.com/@fortawesome/fontawesome-free@6.6.0/css/all.min.css");
  
  
  
</script>

<!-- required -->


<!-- internal -->

<script src="/js/app.js"></script>




<!-- rightmenu要在darkmode之前（ToggleButton） darkmode要在comments之前（volantis.dark.push）-->

  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "color-scheme";
const rootElementDarkModeAttributeName = "color-scheme";
const setLS = (k, v) => {
    localStorage.setItem(k, v);
};
const removeLS = (k) => {
    localStorage.removeItem(k);
};
const getLS = (k) => {
    return localStorage.getItem(k);
};
const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};
const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};
const validColorModeKeys = {
  dark: true,
  light: true,
};
const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);
  getCustomDarkMode();
  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};
const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};
/**
 * get target mode
 */
 const getCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  if(currentSetting=="dark"){
    volantis.dark.mode="light";
  }else{
    volantis.dark.mode="dark";
  }
  // console.log(volantis.dark.mode)
};
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};
/**
 * 暗黑模式触发器
 */
volantis.dark.toggle=()=>{
  const mode = toggleCustomDarkMode();
  applyCustomDarkModeSettings(mode);
  // 使用 volantis.dark.push 方法传入volantis.dark.toggle回调函数 参见layout/_partial/scripts/global.ejs
  volantis.dark.method.toggle.start();
}
/**
 * bind event for toggle button
 */

function bindToggleButton() {
  var btn= document.querySelectorAll("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn")
  btn.forEach(function (e) {
    volantis.dom.$(e).on('click',volantis.dark.toggle);
  })
}
applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", ()=>{
  volantis.requestAnimationFrame(bindToggleButton)
});

const darkModelListeners={
  dark:(mediaQueryList )=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "dark";
    }
    volantis.dark.method.toggle.start();
  },
  light:(mediaQueryList)=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "light";
    }
    volantis.dark.method.toggle.start();
  }
}
window.matchMedia('(prefers-color-scheme: dark)').addListener(darkModelListeners.dark)
window.matchMedia('(prefers-color-scheme: light)').addListener(darkModelListeners.light)
</script>




<script>
  function loadIssuesJS() {
    
      const sites_api = document.getElementById('sites-api');
      if (sites_api != undefined && typeof SitesJS === 'undefined') {
        volantis.js("/js/plugins/tags/sites.js")
      }
    
    
      const friends_api = document.getElementById('friends-api');
      if (friends_api != undefined && typeof FriendsJS === 'undefined') {
        volantis.js("/js/plugins/tags/friends.js")
      }
    
    
      const contributors_api = document.getElementById('contributors-api');
      if (contributors_api != undefined && typeof ContributorsJS === 'undefined') {
        volantis.js("/js/plugins/tags/contributors.js")
      }
    
  };
  loadIssuesJS()
</script>




  <script defer src="https://unpkg.com/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: ["#"],
	maxRPS: 6,
	hoverDelay: 0
  };
</script>
<script defer src="https://unpkg.com/volantis-static@0.0.1660614606622/libs/flying-pages/flying-pages.min.js"></script>





   <script type="text/javascript">
  function p_scrollrebeal() {
    ScrollReveal().reveal("#l_main .reveal", {
      distance: "32px",
      duration: "800",
      interval: "20",
      scale: "1",
      easing: "ease-out",
    });
  }
  function init_scrollrebeal() {
    if (typeof ScrollReveal == "undefined") {
      volantis.requestAnimationFrame(init_scrollrebeal);
    } else {
      p_scrollrebeal();
    }
  }
  volantis.js("https://unpkg.com/scrollreveal@4.0.9/dist/scrollreveal.min.js");
  document.addEventListener("DOMContentLoaded", init_scrollrebeal)
</script>






      <script>
  volantis.layoutHelper("comments",`<div id="giscus_container"></div>`)

  volantis.giscus = {};

  function check_giscus() {
    if (volantis.dark.mode === "dark") {
      volantis.giscus.Theme = 'dark';
    } else {
      volantis.giscus.Theme = 'light';
    }

    return document.getElementById("giscus_container");
  }

  function p_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;
    let cfg = Object.assign({"theme":{"light":"light","dark":"dark"},"repo":"panxiaoguang/MyBlog_Discuss","repo-id":"R_kgDOM0Xlng","category":"Announcements","category-id":"DIC_kwDOM0Xlns4CioCX","mapping":"pathname","reactions-enabled":"1","emit-metadata":"0","lang":"zh-CN"},pdata.commentConfig)
    const script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    Object.keys(cfg).forEach(k=>{
      if (k != "theme") {
        script.setAttribute('data-'+k, cfg[k]);
      }
    })
    script.setAttribute('data-theme', volantis.giscus.Theme);
    script.setAttribute('crossorigin', "anonymous");
    HEAD.appendChild(script);
  }

  function dark_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;

    const message = {
      setConfig: {
        theme: volantis.giscus.Theme
      }
    };
    const giscusIframe = document.querySelector('iframe.giscus-frame');
    giscusIframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  p_giscus();
  volantis.dark.push(dark_giscus);
</script>

    





<!-- optional -->

  <script>
  async function loadSearchScript() {
    
        
    
    return volantis.js("/js/search/hexo.js");
  }

  function loadSearchService() {
    loadSearchScript();
    document.querySelectorAll(".input.u-search-input").forEach((e) => {
      e.removeEventListener("focus", loadSearchService, false);
    });

    document.querySelectorAll(".u-search-form").forEach((e) => {
      e.addEventListener("submit", (event) => {
        event.preventDefault();
      }, false);
    });
  }

  // 打开并搜索 字符串 s
  function OpenSearch(s) {
    if (typeof SearchService === 'undefined')
      loadSearchScript().then(() => {
        SearchService.setQueryText(s);
        SearchService.search();
      });
    else {
      SearchService.setQueryText(s);
      SearchService.search();
    }
  }

  // 访问含有 ?s=xxx  的链接时打开搜索 // 与搜索引擎 structured data 相关: /scripts/helpers/structured-data/lib/config.js
  if (window.location.search && /^\?s=/g.test(window.location.search)) {
    let queryText = decodeURI(window.location.search)
      .replace(/\ /g, "-")
      .replace(/^\?s=/g, "");
    OpenSearch(queryText);
  }

  // 搜索输入框获取焦点时加载搜索
  document.querySelectorAll(".input.u-search-input").forEach((e) => {
    e.addEventListener("focus", loadSearchService, false);
  });
</script>







  <script>



  function p_highlightjs_copyCode(){
    if (!(document.querySelector(".highlight .code pre") ||
      document.querySelector(".article pre code"))) {
      return;
    }
    VolantisApp.utilCopyCode(".highlight .code pre, .article pre code")
  }
  volantis.requestAnimationFrame(p_highlightjs_copyCode)

</script>










  <script>
  function load_swiper() {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    volantis.css("https://unpkg.com/swiper@11.1.14/swiper-bundle.min.css");
    volantis.js("https://unpkg.com/swiper@11.1.14/swiper-bundle.min.js").then(() => {
      p_swiper();
    });
  }

  load_swiper();

  function p_swiper() {
    volantis.swiper = new Swiper('.swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

</script>



  <script>
  volantis.css("https://unpkg.com/pace-js@1.2.4/themes/blue/pace-theme-minimal.css");
  volantis.js("https://unpkg.com/pace-js@1.2.4/pace.min.js").then(() => {
    Pace.options.restartOnPushState = false;
    // 阅读进度
    volantis.scroll.push(() => {
      Pace.stop();
      Pace.trigger('start');
      Pace.bar.update(volantis.scroll.progress() * 100);
      document.body.className = document.body.className.replaceAll("pace-running ","");
    },"阅读进度")
    // todo：配置项开关, 哪些页面添加阅读进度
  })
</script>



        <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = "https://unpkg.com/mathjax@3.2.2/es5/tex-mml-chtml.js";
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typesetPromise();
  }
</script>

        <style>
  #post-body p {
    text-indent: 2em;
  }
  #post-body .new-meta-box p,
  #post-body .note p,
  #post-body .prev-next p,
  #post-body .tag p,
  #post-body blockquote p,
  #post-body details p,
  #post-body p.p,
  #post-body .tab-pane .checkbox
  #post-body section p {
    text-indent: initial;
  }
</style>




<script>
  function listenSidebarTOC() {
    const navItems = document.querySelectorAll(".toc li");
    if (!navItems.length) return;
    const targets = []
    const sections = Array.from(navItems).forEach((element) => {
      const link = element.querySelector(".toc-link");
      const target = document.getElementById(
        link.getAttribute("href") ? decodeURI(link.getAttribute("href")).replace("#", "") : link.getAttribute("toc-action").split("toc-")[1] // 兼容 hexo-blog-encrypt
      );
      targets.push(target)
      // 解除 a 标签 href 的 锚点定位, a 标签 href 的 锚点定位 会随机启用?? 产生错位???
      if (link.getAttribute("href")) {
        link.setAttribute("toc-action", "toc-" + decodeURI(link.getAttribute("href")).replace("#", ""))
        link.removeAttribute("href")
      }
      // 配置 点击 触发新的锚点定位
      if (target && target.id) {
        link.addEventListener("click", (event) => {
          event.preventDefault();
          // 这里的 addTop 是通过错位使得 toc 自动展开.
          volantis.scroll.to(target, { addTop: 5, observer: true })
          // Anchor id
          history.pushState(null, document.title, "#" + target.id);
        });
      }
      return target;
    });

    function activateNavByIndex(target) {
      if (target.classList.contains("active-current")) return;

      document.querySelectorAll(".toc .active").forEach((element) => {
        element.classList.remove("active", "active-current");
      });
      target.classList.add("active", "active-current");
      let parent = target.parentNode;
      while (!parent.matches(".toc")) {
        if (parent.matches("li")) parent.classList.add("active");
        parent = parent.parentNode;
      }
    }

    // 方案一：
    volantis.activateNavIndex = 0
    activateNavByIndex(navItems[volantis.activateNavIndex])
    if (targets[0]) {
      volantis.scroll.push(() => {
        if (targets[0].getBoundingClientRect().top >= 0) {
          volantis.activateNavIndex = 0
        } else if (targets[targets.length - 1].getBoundingClientRect().top < 0) {
          volantis.activateNavIndex = targets.length - 1
        } else {
          for (let index = 0; index < targets.length; index++) {
            const target0 = targets[index];
            const target1 = targets[(index + 1) % targets.length];
            if (target0.getBoundingClientRect().top < 0 && target1.getBoundingClientRect().top >= 0) {
              volantis.activateNavIndex = index
              break;
            }
          }
        }
        activateNavByIndex(navItems[volantis.activateNavIndex])
      })
    }

    // 方案二：
    // IntersectionObserver 不是完美精确到像素级别 也不是低延时性的
    // function findIndex(entries) {
    //   let index = 0;
    //   let entry = entries[index];
    //   if (entry.boundingClientRect.top > 0) {
    //     index = sections.indexOf(entry.target);
    //     return index === 0 ? 0 : index - 1;
    //   }
    //   for (; index < entries.length; index++) {
    //     if (entries[index].boundingClientRect.top <= 0) {
    //       entry = entries[index];
    //     } else {
    //       return sections.indexOf(entry.target);
    //     }
    //   }
    //   return sections.indexOf(entry.target);
    // }
    // function createIntersectionObserver(marginTop) {
    //   marginTop = Math.floor(marginTop + 10000);
    //   let intersectionObserver = new IntersectionObserver(
    //     (entries, observe) => {
    //       let scrollHeight = document.documentElement.scrollHeight;
    //       if (scrollHeight > marginTop) {
    //         observe.disconnect();
    //         createIntersectionObserver(scrollHeight);
    //         return;
    //       }
    //       let index = findIndex(entries);
    //       activateNavByIndex(navItems[index]);
    //     }, {
    //       rootMargin: marginTop + "px 0px -100% 0px",
    //       threshold: 0,
    //     }
    //   );
    //   sections.forEach((element) => {
    //     element && intersectionObserver.observe(element);
    //   });
    // }
    // createIntersectionObserver(document.documentElement.scrollHeight);
  }

  document.addEventListener("DOMContentLoaded", () => {
    volantis.requestAnimationFrame(listenSidebarTOC)
  });
</script>





<script>
  document.onreadystatechange = function () {
    if (document.readyState == 'complete') {
      // 页面加载完毕 样式加载失败，或是当前网速慢，或是开启了省流模式
      const { saveData, effectiveType } = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {}
      if (getComputedStyle(document.querySelector("#safearea"), null)["display"] == "none" || saveData || /2g/.test(effectiveType)) {
        document.querySelectorAll(".reveal").forEach(function (e) {
          e.style["opacity"] = "1";
        });
        document.querySelector("#safearea").style["display"] = "block";
      }
    }
  }
</script>


  <script type="application/ld+json">[{"@context":"https://schema.org.cn","@type":"Organization","name":"XiaoHanys","url":"https://blog.xiaohanys.xyz/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},{"@context":"https://schema.org.cn","@type":"Person","name":"XiaoGuang","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"https://blog.xiaohanys.xyz/","sameAs":["https://github.com/volantis-x"],"description":"生物信息知识库, 编程, 前端, 网站搭建, 人工智能, AI"},{"@context":"https://schema.org.cn","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://blog.xiaohanys.xyz/","name":"XiaoHanys"}},{"@type":"ListItem","position":2,"item":{"@id":"https://blog.xiaohanys.xyz/categories/生物信息/","name":"生物信息"}},{"@type":"ListItem","position":3,"item":{"@id":"https://blog.xiaohanys.xyz/undefined/","name":"16S rRNA基因扩增子分析"}}]},{"@context":"https://schema.org.cn","@type":"WebSite","name":"XiaoHanys","url":"https://blog.xiaohanys.xyz/","keywords":["生物信息知识库","编程","前端","Python","网站搭建","人工智能"],"description":"生物信息知识库, 编程, 前端, 网站搭建, 人工智能, AI","author":{"@type":"Person","name":"XiaoGuang","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"https://blog.xiaohanys.xyz/","description":"生物信息知识库, 编程, 前端, 网站搭建, 人工智能, AI"},"publisher":{"@type":"Organization","name":"XiaoHanys","url":"https://blog.xiaohanys.xyz/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"potentialAction":{"@type":"SearchAction","name":"Site Search","target":{"@type":"EntryPoint","urlTemplate":"https://blog.xiaohanys.xyz?s={search_term_string}"},"query-input":"required name=search_term_string"}},{"@context":"https://schema.org.cn","@type":"BlogPosting","headline":"16S rRNA基因扩增子分析","description":"在此工作流程中，介绍了 Qiime2 和 R 中 16S rRNA 基因扩增子数据分析的主要步骤。本教程是为哥本哈根大学食品科学系的 MAC 2023 课程准备的。尽管这些步骤是为 Oxford Nanopore Tech (ONT) 测序设计的，但也在 Ilumina 短读长上进行了测试。","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.xiaohanys.xyz/undefined/"},"author":{"@type":"Person","name":"XiaoGuang","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"https://blog.xiaohanys.xyz/"},"publisher":{"@type":"Organization","name":"XiaoHanys","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"url":"https://blog.xiaohanys.xyz/undefined/","wordCount":146,"datePublished":"2024-09-20T05:10:07.000Z","dateModified":"2024-10-18T03:36:37.525Z","articleSection":"生物信息","keywords":"生物信息,R语言","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}}]</script>




    </div>
    <!-- import body_end begin-->
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    
    <!-- Custom Files bodyEnd end-->
  </body>
</html>
